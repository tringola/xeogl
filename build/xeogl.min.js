xeogl.js:6714:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  6714|         this.fire("processes", this._processes);
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:7064:20: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  7064|                     self.fire("webglcontextrestored", self.gl);
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:7133:20: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  7133|                     self.fire("boundary", boundary);
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:8414:12: WARNING - [JSC_USELESS_CODE] Suspicious code. This code lacks side-effects. Is there a bug?
  8414|             if (state.indices) {
                    ^^^^^^^^^^^^^^^^^^^^^
  8415|                 // indicesBufCombined is created when VertexBufs are built for this Geometry
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  8416|             }
        ^^^^^^^^^^^^^

xeogl.js:11149:12: WARNING - [JSC_UNREACHABLE_CODE] unreachable code
  11149|             if (!object) {
                     ^^^^^^^^^^^^^^^
  11150|                 return;
         ^^^^^^^^^^^^^^^^^^^^^^^^
  11151|             }
         ^^^^^^^^^^^^^

xeogl.js:12338:18: WARNING - [JSC_SUSPICIOUS_LEFT_OPERAND_OF_LOGICAL_OPERATOR] Left operand of && operator is always falsy.
  12338|     const solid = false && materialState.backfaces;
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:12615:18: WARNING - [JSC_SUSPICIOUS_LEFT_OPERAND_OF_LOGICAL_OPERATOR] Left operand of && operator is always falsy.
  12615|     const solid = false && materialState.backfaces;
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:14438:19: WARNING - [JSC_USELESS_CODE] Suspicious code. This code lacks side-effects. Is there a bug?
  14438|             } else if (geometryState.positions) {
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  14439|                 // gl.drawArrays(gl.TRIANGLES, 0, geometryState.positions.numItems);
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  14440|                 //  frame.drawArrays++;
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  14441|             }
         ^^^^^^^^^^^^^

xeogl.js:15209:19: WARNING - [JSC_USELESS_CODE] Suspicious code. This code lacks side-effects. Is there a bug?
  15209|             } else if (geometryState.positions) {
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  15210|                 // gl.drawArrays(gl.TRIANGLES, 0, geometryState.positions.numItems);
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  15211|                 //  frame.drawArrays++;
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  15212|             }
         ^^^^^^^^^^^^^

xeogl.js:15955:19: WARNING - [JSC_USELESS_CODE] Suspicious code. This code lacks side-effects. Is there a bug?
  15955|             } else if (geometryState.positions) {
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  15956|                 // gl.drawArrays(gl.TRIANGLES, 0, geometryState.positions.numItems);
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  15957|                 //  frame.drawArrays++;
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  15958|             }
         ^^^^^^^^^^^^^

xeogl.js:16387:19: WARNING - [JSC_USELESS_CODE] Suspicious code. This code lacks side-effects. Is there a bug?
  16387|             } else if (geometryState.positions) {
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  16388|                 // gl.drawArrays(gl.TRIANGLES, 0, geometryState.positions.numItems);
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  16389|                 //  frame.drawArrays++;
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  16390|             }
         ^^^^^^^^^^^^^

xeogl.js:18086:20: WARNING - [JSC_SUSPICIOUS_LEFT_OPERAND_OF_LOGICAL_OPERATOR] Left operand of || operator is always falsy.
  18086|         if (value = undefined || value === null) {
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:21215:20: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  21215|                     self.fire("keydown", e.keyCode, true);
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:21248:20: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  21248|                     self.fire("keyup", e.keyCode, true);
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:21269:12: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  21269|             self.fire("mouseenter", coords, true);
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:21288:12: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  21288|             self.fire("mouseleave", coords, true);
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:21326:12: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  21326|             self.fire("mousedown", coords, true);
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:21365:12: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  21365|             self.fire("mouseup", coords, true);
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:21406:12: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  21406|             self.fire("dblclick", coords, true);
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:21427:12: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  21427|             self.fire("mousemove", coords, true);
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:21448:12: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  21448|             self.fire("mousewheel", delta, true);
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:21479:20: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  21479|                     self.fire("mouseclicked", params, true);
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:21537:24: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  21537|                         self.fire("orientationchange", orientationChangeEvent);
                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:21583:24: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  21583|                         self.fire("devicemotion", deviceMotionEvent);
                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:21608:24: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  21608|                         self.fire("deviceorientation", deviceOrientationEvent);
                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:21811:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  21811|         this.fire("boundary", this._state.boundary);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:21859:20: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  21859|                     this.fire("boundary", this._state.boundary);
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:21874:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  21874|         this.fire("autoBoundary", this._autoBoundary);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:21999:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  21999|         this.fire("fov", this._fov);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:22034:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  22034|         this.fire("fovAxis", this._fovAxis);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:22058:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  22058|         this.fire("near", this._near);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:22083:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  22083|         this.fire("far", this._far);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:22252:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  22252|         this.fire("scale", this._scale);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:22277:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  22277|         this.fire("near", this._near);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:22302:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  22302|         this.fire("far", this._far);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:22437:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  22437|         this.fire("left", this._left);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:22462:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  22462|         this.fire("right", this._right);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:22487:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  22487|         this.fire("top", this._top);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:22512:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  22512|         this.fire("bottom", this._bottom);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:22537:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  22537|         this.fire("near", this._near);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:22562:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  22562|         this.fire("far", this._far);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:22666:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  22666|         this.fire("far", this._state.matrix);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:23140:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  23140|         this.fire("eye", this._eye);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:23165:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  23165|         this.fire("look", this._look);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:23190:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  23190|         this.fire("up", this._up);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:23215:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  23215|         this.fire("deviceMatrix", this._state.deviceMatrix);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:23253:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  23253|         this.fire("worldAxis", this._worldAxis);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:23313:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  23313|         this.fire("gimbalLock", this._gimbalLock);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:23340:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  23340|         this.fire("constrainPitch", this._constrainPitch);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:25844:0: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  25844| class Scene extends Component {
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  25845| 
         ^
...
  27902|     }
         ^^^^^^
  27903| }
         ^

xeogl.js:26641:12: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  26641|             this.fire("rendering", renderEvent, true);
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:26654:12: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  26654|             this.fire("rendered", renderEvent, true);
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:28125:12: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  28125|             scene.fire("tick", tickEvent, true);
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:28895:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  28895|         this.fire("active", this._state.active);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:28918:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  28918|         this.fire("pos", this._state.pos);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:28944:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  28944|         this.fire("dir", this._state.dir);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:29460:24: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  29460|                         self.fire("hoverOut", {
                                 ^^^^^^^^^^^^^^^^^^^^^^^^
  29461|                             mesh: scene.meshes[lastPickedMeshId]
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  29462|                         });
         ^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:29470:20: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  29470|                     self.fire("hoverEnter", hit);
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:29478:16: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  29478|                 self.fire("hover", hit);
                         ^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:29492:20: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  29492|                     self.fire("hoverSurface", hit);
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:29501:20: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  29501|                     self.fire("hoverOut", {
                             ^^^^^^^^^^^^^^^^^^^^^^^^
  29502|                         mesh: scene.meshes[lastPickedMeshId]
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  29503|                     });
         ^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:30337:32: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  30337|                                 self.fire("picked", hit);
                                         ^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:30349:36: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  30349|                                     self.fire("pickedSurface", hit);
                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:30404:32: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  30404|                                 self.fire("doublePicked", hit);
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:30415:36: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  30415|                                     self.fire("doublePickedSurface", hit);
                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:32926:24: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  32926|                         self.fire("loaded", self._src);
                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:33184:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  33184|         this.fire("resolution", this._state.resolution);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

xeogl.js:33213:8: WARNING - [JSC_MISPLACED_ANNOTATION] Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
  33213|         this.fire("intensity", this._state.intensity);
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

0 error(s), 68 warning(s)
(function(I,Fa){"object"===typeof exports&&"undefined"!==typeof module?Fa(exports):"function"===typeof define&&define.amd?define(["exports"],Fa):Fa(I.xeogl={})})(this,function(I){function Fa(a,b){const c=new Float32Array(b),d=new Float32Array(b);let f,e;for(f=0;f<b;f++)c[f]=Number.MAX_VALUE,d[f]=-Number.MAX_VALUE;for(f=0;f<a.length;f+=b)for(e=0;e<b;e++)c[e]=Math.min(c[e],a[f+e]),d[e]=Math.max(d[e],a[f+e]);return{min:c,max:d}}function ib(a,b,c,d){let f=a[b]/(Math.abs(a[b])+Math.abs(a[b+1])+Math.abs(a[b+
2]));var e=a[b+1]/(Math.abs(a[b])+Math.abs(a[b+1])+Math.abs(a[b+2]));0>a[b+2]&&(a=(1-Math.abs(e))*(0<=f?1:-1),e=(1-Math.abs(f))*(0<=e?1:-1),f=a);return new Int8Array([Math[c](127.5*f+(0>f?-1:0)),Math[d](127.5*e+(0>e?-1:0))])}function jb(a){let b=a[0];a=a[1];b/=0>b?127:128;a/=0>a?127:128;const c=1-Math.abs(b)-Math.abs(a);0>c&&(b=(1-Math.abs(a))*(0<=b?1:-1),a=(1-Math.abs(b))*(0<=a?1:-1));const d=Math.sqrt(b*b+a*a+c*c);return[b/d,a/d,c/d]}function kb(a,b,c){return a[b]*c[0]+a[b+1]*c[1]+a[b+2]*c[2]}function yc(a){if(!a._state.receiveShadow)return!1;
a=a.scene._lightsState.lights;if(!a||0===a.length)return!1;for(let b=0,c=a.length;b<c;b++)if(a[b].shadow)return!0;return!1}function zc(a){const b=a._geometry._state.primitiveName;return!a._geometry._state.autoVertexNormals&&!a._geometry._state.normals||"triangles"!==b&&"triangle-strip"!==b&&"triangle-fan"!==b?!1:!0}function Ac(a){const b=[];let c,d;for(let f=0,e=a.length;f<e;f++)c=a[f],d=c.indexOf("/"),0<d&&"/"===c.charAt(d+1)&&(c=c.substring(0,d)),b.push(c);return b.join("\n")}function Bc(a,b){const c=
{};let d,f;for(let e=0,g=b.length;e<g;e++)d=b[e],(f=a.meshes[d])?c[d]=!0:a.warn("pick(): Mesh not found: "+d);return c}function lb(a,b,c){if(void 0===b)return c;b=Jd[b];return void 0===b?c:a[b]}function Cc(a){return 0===(a&a-1)}function Dc(a){--a;for(let b=1;32>b;b<<=1)a|=a>>b;return a+1}function Ec(a){if(!Fc(a.width)||!Fc(a.height)){const b=document.createElement("canvas");b.width=Gc(a.width);b.height=Gc(a.height);b.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,b.width,b.height);a=b}return a}
function Fc(a){return 0===(a&a-1)}function Gc(a){--a;for(let b=1;32>b;b<<=1)a|=a>>b;return a+1}class ta{constructor(a,b){this.items=a||[];this._lastUniqueId=(b||0)+1}addItem(){let a;if(2===arguments.length){var b=arguments[0];a=arguments[1];if(this.items[b])throw"ID clash: '"+b+"'";this.items[b]=a;return b}for(a=arguments[0]||{};;)if(b=this._lastUniqueId++,!this.items[b])return this.items[b]=a,b}removeItem(a){const b=this.items[a];delete this.items[a];return b}}const P={build:{version:"0.8"},client:{browser:navigator&&
navigator.userAgent?navigator.userAgent:"n/a"},components:{scenes:0,models:0,meshes:0,objects:0},memory:{meshes:0,positions:0,colors:0,normals:0,uvs:0,indices:0,textures:0,transforms:0,materials:0,programs:0},frame:{frameCount:0,fps:0,useProgram:0,bindTexture:0,bindArray:0,drawElements:0,drawArrays:0,tasksRun:0,tasksScheduled:0}};var G={isArray:function(a){return a&&!a.propertyIsEnumerable("length")&&"object"===typeof a&&"number"===typeof a.length},isString:function(a){return"string"===typeof a||
a instanceof String},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isID:function(a){return G.isString(a)||G.isNumeric(a)},isSameComponent:function(a,b){if(!a||!b)return!1;a=G.isNumeric(a)||G.isString(a)?`${a}`:a.id;b=G.isNumeric(b)||G.isString(b)?`${b}`:b.id;return a===b},isFunction:function(a){return"function"===typeof a},isObject:function(a){const b={}.constructor;return!!a&&a.constructor===b},copy:function(a){return G.apply(a,{})},apply:function(a,b){for(const c in a)a.hasOwnProperty(c)&&
(b[c]=a[c]);return b},apply2:function(a,b){for(const c in a)a.hasOwnProperty(c)&&void 0!==a[c]&&null!==a[c]&&(b[c]=a[c]);return b},applyIf:function(a,b){for(const c in a)!a.hasOwnProperty(c)||void 0!==b[c]&&null!==b[c]||(b[c]=a[c]);return b},isEmptyObject:function(a){for(const b in a)if(a.hasOwnProperty(b))return!1;return!0},inQuotes:function(a){return G.isNumeric(a)?`${a}`:`'${a}'`},concat:function(a,b){const c=new a.constructor(a.length+b.length);c.set(a);c.set(b,a.length);return c}};const mb=new Float32Array(16),
nb=new Float32Array(16),Kd=new Float32Array(4);let ob=!1;const pb=[];let Pb=0;const l={MAX_DOUBLE:Number.MAX_VALUE,MIN_DOUBLE:Number.MIN_VALUE,DEGTORAD:.0174532925,RADTODEG:57.295779513,openCache(){ob=!0;Pb=0},cacheVec3(a){return a||(ob?pb[Pb++]||(pb[Pb-1]=new Float32Array(3)):new Float32Array(3))},cacheVec4(a){return a||(ob?pb[vec4CacheLen++]||(pb[vec4CacheLen-1]=new Float32Array(4)):new Float32Array(4))},closeCache(){ob=!1},vec2(a){return new Float32Array(a||2)},vec3(a){return new Float32Array(a||
3)},vec4(a){return new Float32Array(a||4)},mat3(a){return new Float32Array(a||9)},mat3ToMat4(a,b=new Float32Array(16)){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=0;b[4]=a[3];b[5]=a[4];b[6]=a[5];b[7]=0;b[8]=a[6];b[9]=a[7];b[10]=a[8];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},mat4(a){return new Float32Array(a||16)},mat4ToMat3(a,b){},createUUID:(()=>{const a=[];for(let b=0;256>b;b++)a[b]=(16>b?"0":"")+b.toString(16);return()=>{const b=4294967295*Math.random()|0,c=4294967295*Math.random()|0,d=4294967295*
Math.random()|0,f=4294967295*Math.random()|0;return`${a[b&255]+a[b>>8&255]+a[b>>16&255]+a[b>>24&255]}-${a[c&255]}${a[c>>8&255]}-${a[c>>16&15|64]}${a[c>>24&255]}-${a[d&63|128]}${a[d>>8&255]}-${a[d>>16&255]}${a[d>>24&255]}${a[f&255]}${a[f>>8&255]}${a[f>>16&255]}${a[f>>24&255]}`}})(),clamp(a,b,c){return Math.max(b,Math.min(c,a))},fmod(a,b){if(a<b)return console.error("xeogl.math.fmod : Attempting to find modulus within negative range - would be infinite loop - ignoring"),a;for(;b<=a;)a-=b;return a},
negateVec4(a,b){b||=a;b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b},addVec4(a,b,c){c||=a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c},addVec4Scalar(a,b,c){c||=a;c[0]=a[0]+b;c[1]=a[1]+b;c[2]=a[2]+b;c[3]=a[3]+b;return c},addVec3(a,b,c){c||=a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c},addVec3Scalar(a,b,c){c||=a;c[0]=a[0]+b;c[1]=a[1]+b;c[2]=a[2]+b;return c},subVec4(a,b,c){c||=a;c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];c[3]=a[3]-b[3];return c},subVec3(a,
b,c){c||=a;c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c},subVec2(a,b,c){c||=a;c[0]=a[0]-b[0];c[1]=a[1]-b[1];return c},subVec4Scalar(a,b,c){c||=a;c[0]=a[0]-b;c[1]=a[1]-b;c[2]=a[2]-b;c[3]=a[3]-b;return c},subScalarVec4(a,b,c){c||=a;c[0]=b-a[0];c[1]=b-a[1];c[2]=b-a[2];c[3]=b-a[3];return c},mulVec4(a,b,c){c||=a;c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];c[3]=a[3]*b[3];return c},mulVec4Scalar(a,b,c){c||=a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c},mulVec3Scalar(a,b,c){c||=a;c[0]=
a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c},mulVec2Scalar(a,b,c){c||=a;c[0]=a[0]*b;c[1]=a[1]*b;return c},divVec3(a,b,c){c||=a;c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];return c},divVec4(a,b,c){c||=a;c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];c[3]=a[3]/b[3];return c},divScalarVec3(a,b,c){c||=b;c[0]=a/b[0];c[1]=a/b[1];c[2]=a/b[2];return c},divVec3Scalar(a,b,c){c||=a;c[0]=a[0]/b;c[1]=a[1]/b;c[2]=a[2]/b;return c},divVec4Scalar(a,b,c){c||=a;c[0]=a[0]/b;c[1]=a[1]/b;c[2]=a[2]/b;c[3]=a[3]/b;return c},divScalarVec4(a,
b,c){c||=b;c[0]=a/b[0];c[1]=a/b[1];c[2]=a/b[2];c[3]=a/b[3];return c},dotVec4(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},cross3Vec4(a,b){const c=a[0],d=a[1];a=a[2];const f=b[0],e=b[1];b=b[2];return[d*b-a*e,a*f-c*b,c*e-d*f,0]},cross3Vec3(a,b,c){c||=a;const d=a[0],f=a[1];a=a[2];const e=b[0],g=b[1];b=b[2];c[0]=f*b-a*g;c[1]=a*e-d*b;c[2]=d*g-f*e;return c},sqLenVec4(a){return l.dotVec4(a,a)},lenVec4(a){return Math.sqrt(l.sqLenVec4(a))},dotVec3(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},dotVec2(a,
b){return a[0]*b[0]+a[1]*b[1]},sqLenVec3(a){return l.dotVec3(a,a)},sqLenVec2(a){return l.dotVec2(a,a)},lenVec3(a){return Math.sqrt(l.sqLenVec3(a))},distVec3:(()=>{const a=new Float32Array(3);return(b,c)=>l.lenVec3(l.subVec3(b,c,a))})(),lenVec2(a){return Math.sqrt(l.sqLenVec2(a))},distVec2:(()=>{const a=new Float32Array(2);return(b,c)=>l.lenVec2(l.subVec2(b,c,a))})(),rcpVec3(a,b){return l.divScalarVec3(1,a,b)},normalizeVec4(a,b){const c=1/l.lenVec4(a);return l.mulVec4Scalar(a,c,b)},normalizeVec3(a,
b){const c=1/l.lenVec3(a);return l.mulVec3Scalar(a,c,b)},normalizeVec2(a,b){const c=1/l.lenVec2(a);return l.mulVec2Scalar(a,c,b)},angleVec3(a,b){a=l.dotVec3(a,b)/Math.sqrt(l.sqLenVec3(a)*l.sqLenVec3(b));return Math.acos(-1>a?-1:1<a?1:a)},vec3FromMat4Scale:(()=>{const a=new Float32Array(3);return(b,c)=>{a[0]=b[0];a[1]=b[1];a[2]=b[2];c[0]=l.lenVec3(a);a[0]=b[4];a[1]=b[5];a[2]=b[6];c[1]=l.lenVec3(a);a[0]=b[8];a[1]=b[9];a[2]=b[10];c[2]=l.lenVec3(a);return c}})(),vecToArray:(()=>a=>{a=Array.prototype.slice.call(a);
for(let b=0,c=a.length;b<c;b++)a[b]=Math.round(1E5*a[b])/1E5;return a})(),dupMat4(a){return a.slice(0,16)},mat4To3(a){return[a[0],a[1],a[2],a[4],a[5],a[6],a[8],a[9],a[10]]},m4s(a){return[a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a]},setMat4ToZeroes(){return l.m4s(0)},setMat4ToOnes(){return l.m4s(1)},diagonalMat4v(a){return new Float32Array([a[0],0,0,0,0,a[1],0,0,0,0,a[2],0,0,0,0,a[3]])},diagonalMat4c(a,b,c,d){return l.diagonalMat4v([a,b,c,d])},diagonalMat4s(a){return l.diagonalMat4c(a,a,a,a)},identityMat4(a=
new Float32Array(16)){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},identityMat3(a=new Float32Array(9)){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},isIdentityMat4(a){return 1!==a[0]||0!==a[1]||0!==a[2]||0!==a[3]||0!==a[4]||1!==a[5]||0!==a[6]||0!==a[7]||0!==a[8]||0!==a[9]||1!==a[10]||0!==a[11]||0!==a[12]||0!==a[13]||0!==a[14]||1!==a[15]?!1:!0},negateMat4(a,b){b||=a;b[0]=-a[0];b[1]=-a[1];b[2]=
-a[2];b[3]=-a[3];b[4]=-a[4];b[5]=-a[5];b[6]=-a[6];b[7]=-a[7];b[8]=-a[8];b[9]=-a[9];b[10]=-a[10];b[11]=-a[11];b[12]=-a[12];b[13]=-a[13];b[14]=-a[14];b[15]=-a[15];return b},addMat4(a,b,c){c||=a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];c[4]=a[4]+b[4];c[5]=a[5]+b[5];c[6]=a[6]+b[6];c[7]=a[7]+b[7];c[8]=a[8]+b[8];c[9]=a[9]+b[9];c[10]=a[10]+b[10];c[11]=a[11]+b[11];c[12]=a[12]+b[12];c[13]=a[13]+b[13];c[14]=a[14]+b[14];c[15]=a[15]+b[15];return c},addMat4Scalar(a,b,c){c||=a;c[0]=a[0]+b;c[1]=
a[1]+b;c[2]=a[2]+b;c[3]=a[3]+b;c[4]=a[4]+b;c[5]=a[5]+b;c[6]=a[6]+b;c[7]=a[7]+b;c[8]=a[8]+b;c[9]=a[9]+b;c[10]=a[10]+b;c[11]=a[11]+b;c[12]=a[12]+b;c[13]=a[13]+b;c[14]=a[14]+b;c[15]=a[15]+b;return c},addScalarMat4(a,b,c){return l.addMat4Scalar(b,a,c)},subMat4(a,b,c){c||=a;c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];c[3]=a[3]-b[3];c[4]=a[4]-b[4];c[5]=a[5]-b[5];c[6]=a[6]-b[6];c[7]=a[7]-b[7];c[8]=a[8]-b[8];c[9]=a[9]-b[9];c[10]=a[10]-b[10];c[11]=a[11]-b[11];c[12]=a[12]-b[12];c[13]=a[13]-b[13];c[14]=a[14]-
b[14];c[15]=a[15]-b[15];return c},subMat4Scalar(a,b,c){c||=a;c[0]=a[0]-b;c[1]=a[1]-b;c[2]=a[2]-b;c[3]=a[3]-b;c[4]=a[4]-b;c[5]=a[5]-b;c[6]=a[6]-b;c[7]=a[7]-b;c[8]=a[8]-b;c[9]=a[9]-b;c[10]=a[10]-b;c[11]=a[11]-b;c[12]=a[12]-b;c[13]=a[13]-b;c[14]=a[14]-b;c[15]=a[15]-b;return c},subScalarMat4(a,b,c){c||=b;c[0]=a-b[0];c[1]=a-b[1];c[2]=a-b[2];c[3]=a-b[3];c[4]=a-b[4];c[5]=a-b[5];c[6]=a-b[6];c[7]=a-b[7];c[8]=a-b[8];c[9]=a-b[9];c[10]=a-b[10];c[11]=a-b[11];c[12]=a-b[12];c[13]=a-b[13];c[14]=a-b[14];c[15]=a-b[15];
return c},mulMat4(a,b,c){c||=a;const d=a[0],f=a[1],e=a[2],g=a[3],h=a[4],m=a[5],n=a[6],p=a[7],r=a[8],q=a[9],k=a[10],t=a[11],w=a[12],u=a[13],z=a[14];a=a[15];const x=b[0],B=b[1],C=b[2],D=b[3],F=b[4],K=b[5],J=b[6],X=b[7],R=b[8],Q=b[9],W=b[10],L=b[11],ca=b[12],A=b[13],E=b[14];b=b[15];c[0]=x*d+B*h+C*r+D*w;c[1]=x*f+B*m+C*q+D*u;c[2]=x*e+B*n+C*k+D*z;c[3]=x*g+B*p+C*t+D*a;c[4]=F*d+K*h+J*r+X*w;c[5]=F*f+K*m+J*q+X*u;c[6]=F*e+K*n+J*k+X*z;c[7]=F*g+K*p+J*t+X*a;c[8]=R*d+Q*h+W*r+L*w;c[9]=R*f+Q*m+W*q+L*u;c[10]=R*e+Q*
n+W*k+L*z;c[11]=R*g+Q*p+W*t+L*a;c[12]=ca*d+A*h+E*r+b*w;c[13]=ca*f+A*m+E*q+b*u;c[14]=ca*e+A*n+E*k+b*z;c[15]=ca*g+A*p+E*t+b*a;return c},mulMat3(a,b,c){c||=new Float32Array(9);const d=a[0],f=a[3],e=a[6],g=a[1],h=a[4],m=a[7],n=a[2],p=a[5];a=a[8];const r=b[0],q=b[3],k=b[6],t=b[1],w=b[4],u=b[7],z=b[2],x=b[5];b=b[8];c[0]=d*r+f*t+e*z;c[3]=d*q+f*w+e*x;c[6]=d*k+f*u+e*b;c[1]=g*r+h*t+m*z;c[4]=g*q+h*w+m*x;c[7]=g*k+h*u+m*b;c[2]=n*r+p*t+a*z;c[5]=n*q+p*w+a*x;c[8]=n*k+p*u+a*b;return c},mulMat4Scalar(a,b,c){c||=a;
c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;c[4]=a[4]*b;c[5]=a[5]*b;c[6]=a[6]*b;c[7]=a[7]*b;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12]*b;c[13]=a[13]*b;c[14]=a[14]*b;c[15]=a[15]*b;return c},mulMat4v4(a,b,c=l.vec4()){const d=b[0],f=b[1],e=b[2];b=b[3];c[0]=a[0]*d+a[4]*f+a[8]*e+a[12]*b;c[1]=a[1]*d+a[5]*f+a[9]*e+a[13]*b;c[2]=a[2]*d+a[6]*f+a[10]*e+a[14]*b;c[3]=a[3]*d+a[7]*f+a[11]*e+a[15]*b;return c},transposeMat4(a,b){const c=a[4],d=a[14],f=a[8],e=a[13],g=a[12],h=a[9];if(!b||a===
b){b=a[1];const m=a[2],n=a[3],p=a[6],r=a[7],q=a[11];a[1]=c;a[2]=f;a[3]=g;a[4]=b;a[6]=h;a[7]=e;a[8]=m;a[9]=p;a[11]=d;a[12]=n;a[13]=r;a[14]=q;return a}b[0]=a[0];b[1]=c;b[2]=f;b[3]=g;b[4]=a[1];b[5]=a[5];b[6]=h;b[7]=e;b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=d;b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b},transposeMat3(a,b){if(b===a){const c=a[1],d=a[2],f=a[5];b[1]=a[3];b[2]=a[6];b[3]=c;b[5]=a[7];b[6]=d;b[7]=f}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],
b[8]=a[8];return b},determinantMat4(a){const b=a[0],c=a[1],d=a[2],f=a[3],e=a[4],g=a[5],h=a[6],m=a[7],n=a[8],p=a[9],r=a[10],q=a[11],k=a[12],t=a[13],w=a[14];a=a[15];return k*p*h*f-n*t*h*f-k*g*r*f+e*t*r*f+n*g*w*f-e*p*w*f-k*p*d*m+n*t*d*m+k*c*r*m-b*t*r*m-n*c*w*m+b*p*w*m+k*g*d*q-e*t*d*q-k*c*h*q+b*t*h*q+e*c*w*q-b*g*w*q-n*g*d*a+e*p*d*a+n*c*h*a-b*p*h*a-e*c*r*a+b*g*r*a},inverseMat4(a,b){b||=a;const c=a[0],d=a[1],f=a[2],e=a[3],g=a[4],h=a[5],m=a[6],n=a[7],p=a[8],r=a[9],q=a[10],k=a[11],t=a[12],w=a[13],u=a[14];
a=a[15];const z=c*h-d*g,x=c*m-f*g,B=c*n-e*g,C=d*m-f*h,D=d*n-e*h,F=f*n-e*m,K=p*w-r*t,J=p*u-q*t,X=p*a-k*t,R=r*u-q*w,Q=r*a-k*w,W=q*a-k*u,L=1/(z*W-x*Q+B*R+C*X-D*J+F*K);b[0]=(h*W-m*Q+n*R)*L;b[1]=(-d*W+f*Q-e*R)*L;b[2]=(w*F-u*D+a*C)*L;b[3]=(-r*F+q*D-k*C)*L;b[4]=(-g*W+m*X-n*J)*L;b[5]=(c*W-f*X+e*J)*L;b[6]=(-t*F+u*B-a*x)*L;b[7]=(p*F-q*B+k*x)*L;b[8]=(g*Q-h*X+n*K)*L;b[9]=(-c*Q+d*X-e*K)*L;b[10]=(t*D-w*B+a*z)*L;b[11]=(-p*D+r*B-k*z)*L;b[12]=(-g*R+h*J-m*K)*L;b[13]=(c*R-d*J+f*K)*L;b[14]=(-t*C+w*x-u*z)*L;b[15]=(p*
C-r*x+q*z)*L;return b},traceMat4(a){return a[0]+a[5]+a[10]+a[15]},translationMat4v(a,b){b=b||l.identityMat4();b[12]=a[0];b[13]=a[1];b[14]=a[2];return b},translationMat3v(a,b){b=b||l.identityMat3();b[6]=a[0];b[7]=a[1];return b},translationMat4c:(()=>{const a=new Float32Array(3);return(b,c,d,f)=>{a[0]=b;a[1]=c;a[2]=d;return l.translationMat4v(a,f)}})(),translationMat4s(a,b){return l.translationMat4c(a,a,a,b)},translateMat4v(a,b){return l.translateMat4c(a[0],a[1],a[2],b)},OLDtranslateMat4c(a,b,c,d){var f=
d[12];d[0]+=f*a;d[4]+=f*b;d[8]+=f*c;f=d[13];d[1]+=f*a;d[5]+=f*b;d[9]+=f*c;f=d[14];d[2]+=f*a;d[6]+=f*b;d[10]+=f*c;f=d[15];d[3]+=f*a;d[7]+=f*b;d[11]+=f*c;return d},translateMat4c(a,b,c,d){var f=d[3];d[0]+=f*a;d[1]+=f*b;d[2]+=f*c;f=d[7];d[4]+=f*a;d[5]+=f*b;d[6]+=f*c;f=d[11];d[8]+=f*a;d[9]+=f*b;d[10]+=f*c;f=d[15];d[12]+=f*a;d[13]+=f*b;d[14]+=f*c;return d},rotationMat4v(a,b,c){var d=l.normalizeVec4([b[0],b[1],b[2],0],[]);b=Math.sin(a);a=Math.cos(a);const f=1-a,e=d[0],g=d[1];d=d[2];let h,m,n,p,r;h=e*g;
m=g*d;n=d*e;p=e*b;r=g*b;b*=d;c=c||l.mat4();c[0]=f*e*e+a;c[1]=f*h+b;c[2]=f*n-r;c[3]=0;c[4]=f*h-b;c[5]=f*g*g+a;c[6]=f*m+p;c[7]=0;c[8]=f*n+r;c[9]=f*m-p;c[10]=f*d*d+a;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c},rotationMat4c(a,b,c,d,f){return l.rotationMat4v(a,[b,c,d],f)},scalingMat4v(a,b=l.identityMat4()){b[0]=a[0];b[5]=a[1];b[10]=a[2];return b},scalingMat3v(a,b=l.identityMat3()){b[0]=a[0];b[4]=a[1];return b},scalingMat4c:(()=>{const a=new Float32Array(3);return(b,c,d,f)=>{a[0]=b;a[1]=c;a[2]=d;
return l.scalingMat4v(a,f)}})(),scaleMat4c(a,b,c,d){d[0]*=a;d[4]*=b;d[8]*=c;d[1]*=a;d[5]*=b;d[9]*=c;d[2]*=a;d[6]*=b;d[10]*=c;d[3]*=a;d[7]*=b;d[11]*=c;return d},scaleMat4v(a,b){const c=a[0],d=a[1];a=a[2];b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return b},scalingMat4s(a){return l.scalingMat4c(a,a,a)},rotationTranslationMat4(a,b,c=l.mat4()){var d=a[0],f=a[1],e=a[2],g=a[3],h=d+d,m=f+f;const n=e+e;a=d*h;const p=d*m;d*=n;const r=f*m;f*=n;e*=n;h*=
g;m*=g;g*=n;c[0]=1-(r+e);c[1]=p+g;c[2]=d-m;c[3]=0;c[4]=p-g;c[5]=1-(a+e);c[6]=f+h;c[7]=0;c[8]=d+m;c[9]=f-h;c[10]=1-(a+r);c[11]=0;c[12]=b[0];c[13]=b[1];c[14]=b[2];c[15]=1;return c},mat4ToEuler(a,b,c=l.vec4()){const d=l.clamp,f=a[0],e=a[4],g=a[8],h=a[1],m=a[5],n=a[9],p=a[2],r=a[6];a=a[10];"XYZ"===b?(c[1]=Math.asin(d(g,-1,1)),.99999>Math.abs(g)?(c[0]=Math.atan2(-n,a),c[2]=Math.atan2(-e,f)):(c[0]=Math.atan2(r,m),c[2]=0)):"YXZ"===b?(c[0]=Math.asin(-d(n,-1,1)),.99999>Math.abs(n)?(c[1]=Math.atan2(g,a),c[2]=
Math.atan2(h,m)):(c[1]=Math.atan2(-p,f),c[2]=0)):"ZXY"===b?(c[0]=Math.asin(d(r,-1,1)),.99999>Math.abs(r)?(c[1]=Math.atan2(-p,a),c[2]=Math.atan2(-e,m)):(c[1]=0,c[2]=Math.atan2(h,f))):"ZYX"===b?(c[1]=Math.asin(-d(p,-1,1)),.99999>Math.abs(p)?(c[0]=Math.atan2(r,a),c[2]=Math.atan2(h,f)):(c[0]=0,c[2]=Math.atan2(-e,m))):"YZX"===b?(c[2]=Math.asin(d(h,-1,1)),.99999>Math.abs(h)?(c[0]=Math.atan2(-n,m),c[1]=Math.atan2(-p,f)):(c[0]=0,c[1]=Math.atan2(g,a))):"XZY"===b&&(c[2]=Math.asin(-d(e,-1,1)),.99999>Math.abs(e)?
(c[0]=Math.atan2(r,m),c[1]=Math.atan2(g,f)):(c[0]=Math.atan2(-n,a),c[1]=0));return c},composeMat4(a,b,c,d=l.mat4()){l.quaternionToRotationMat4(b,d);l.scaleMat4v(c,d);l.translateMat4v(a,d);return d},decomposeMat4:(()=>{const a=new Float32Array(3),b=new Float32Array(16);return function(c,d,f,e){a[0]=c[0];a[1]=c[1];a[2]=c[2];let g=l.lenVec3(a);a[0]=c[4];a[1]=c[5];a[2]=c[6];const h=l.lenVec3(a);a[8]=c[8];a[9]=c[9];a[10]=c[10];const m=l.lenVec3(a);0>l.determinantMat4(c)&&(g=-g);d[0]=c[12];d[1]=c[13];d[2]=
c[14];b.set(c);c=1/g;d=1/h;const n=1/m;b[0]*=c;b[1]*=c;b[2]*=c;b[4]*=d;b[5]*=d;b[6]*=d;b[8]*=n;b[9]*=n;b[10]*=n;l.mat4ToQuaternion(b,f);e[0]=g;e[1]=h;e[2]=m;return this}})(),lookAtMat4v(a,b,c,d){d||=l.mat4();const f=a[0],e=a[1];a=a[2];var g=c[0],h=c[1],m=c[2],n=b[0];c=b[1];var p=b[2];if(f===n&&e===c&&a===p)return l.identityMat4();let r,q,k;b=f-n;c=e-c;p=a-p;k=1/Math.sqrt(b*b+c*c+p*p);b*=k;c*=k;p*=k;n=h*p-m*c;m=m*b-g*p;g=g*c-h*b;(k=Math.sqrt(n*n+m*m+g*g))?(k=1/k,n*=k,m*=k,g*=k):g=m=n=0;h=c*g-p*m;r=
p*n-b*g;q=b*m-c*n;(k=Math.sqrt(h*h+r*r+q*q))?(k=1/k,h*=k,r*=k,q*=k):q=r=h=0;d[0]=n;d[1]=h;d[2]=b;d[3]=0;d[4]=m;d[5]=r;d[6]=c;d[7]=0;d[8]=g;d[9]=q;d[10]=p;d[11]=0;d[12]=-(n*f+m*e+g*a);d[13]=-(h*f+r*e+q*a);d[14]=-(b*f+c*e+p*a);d[15]=1;return d},lookAtMat4c(a,b,c,d,f,e,g,h,m){return l.lookAtMat4v([a,b,c],[d,f,e],[g,h,m],[])},orthoMat4c(a,b,c,d,f,e,g){g||=l.mat4();const h=b-a,m=d-c,n=e-f;g[0]=2/h;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2/m;g[6]=0;g[7]=0;g[8]=0;g[9]=0;g[10]=-2/n;g[11]=0;g[12]=-(a+b)/h;g[13]=
-(d+c)/m;g[14]=-(e+f)/n;g[15]=1;return g},frustumMat4v(a,b,c){c||=l.mat4();a=[a[0],a[1],a[2],0];b=[b[0],b[1],b[2],0];l.addVec4(b,a,mb);l.subVec4(b,a,nb);a=2*a[2];const d=nb[0],f=nb[1],e=nb[2];c[0]=a/d;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=a/f;c[6]=0;c[7]=0;c[8]=mb[0]/d;c[9]=mb[1]/f;c[10]=-mb[2]/e;c[11]=-1;c[12]=0;c[13]=0;c[14]=-a*b[2]/e;c[15]=0;return c},frustumMat4(a,b,c,d,f,e,g){g||=l.mat4();const h=b-a,m=d-c,n=e-f;g[0]=2*f/h;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2*f/m;g[6]=0;g[7]=0;g[8]=(b+a)/h;g[9]=(d+
c)/m;g[10]=-(e+f)/n;g[11]=-1;g[12]=0;g[13]=0;g[14]=-(e*f*2)/n;g[15]=0;return g},perspectiveMat4(a,b,c,d,f){const e=[],g=[];e[2]=c;g[2]=d;g[1]=e[2]*Math.tan(a/2);e[1]=-g[1];g[0]=g[1]*b;e[0]=-g[0];return l.frustumMat4v(e,g,f)},transformPoint3(a,b,c=l.vec3()){c[0]=a[0]*b[0]+a[4]*b[1]+a[8]*b[2]+a[12];c[1]=a[1]*b[0]+a[5]*b[1]+a[9]*b[2]+a[13];c[2]=a[2]*b[0]+a[6]*b[1]+a[10]*b[2]+a[14];return c},transformPoint4(a,b,c=l.vec4()){c[0]=a[0]*b[0]+a[4]*b[1]+a[8]*b[2]+a[12]*b[3];c[1]=a[1]*b[0]+a[5]*b[1]+a[9]*b[2]+
a[13]*b[3];c[2]=a[2]*b[0]+a[6]*b[1]+a[10]*b[2]+a[14]*b[3];c[3]=a[3]*b[0]+a[7]*b[1]+a[11]*b[2]+a[15]*b[3];return c},transformPoints3(a,b,c){c=c||[];const d=b.length;let f;const e=a[0],g=a[1],h=a[2],m=a[3],n=a[4],p=a[5],r=a[6],q=a[7],k=a[8],t=a[9],w=a[10],u=a[11],z=a[12],x=a[13],B=a[14],C=a[15];let D;for(let K=0;K<d;++K){var F=b[K];a=F[0];f=F[1];F=F[2];D=c[K]||(c[K]=[0,0,0]);D[0]=e*a+n*f+k*F+z;D[1]=g*a+p*f+t*F+x;D[2]=h*a+r*f+w*F+B;D[3]=m*a+q*f+u*F+C}c.length=d;return c},transformPositions3(a,b,c=b){const d=
b.length;let f,e,g;const h=a[0],m=a[1],n=a[2],p=a[3],r=a[4],q=a[5],k=a[6],t=a[7],w=a[8],u=a[9],z=a[10],x=a[11],B=a[12],C=a[13],D=a[14],F=a[15];for(a=0;a<d;a+=3)f=b[a+0],e=b[a+1],g=b[a+2],c[a+0]=h*f+r*e+w*g+B,c[a+1]=m*f+q*e+u*g+C,c[a+2]=n*f+k*e+z*g+D,c[a+3]=p*f+t*e+x*g+F;return c},transformPositions4(a,b,c=b){const d=b.length;let f,e,g;const h=a[0],m=a[1],n=a[2],p=a[3],r=a[4],q=a[5],k=a[6],t=a[7],w=a[8],u=a[9],z=a[10],x=a[11],B=a[12],C=a[13],D=a[14],F=a[15];for(a=0;a<d;a+=4)f=b[a+0],e=b[a+1],g=b[a+
2],c[a+0]=h*f+r*e+w*g+B,c[a+1]=m*f+q*e+u*g+C,c[a+2]=n*f+k*e+z*g+D,c[a+3]=p*f+t*e+x*g+F;return c},transformVec3(a,b,c){const d=b[0],f=b[1];b=b[2];c=c||this.vec3();c[0]=a[0]*d+a[4]*f+a[8]*b;c[1]=a[1]*d+a[5]*f+a[9]*b;c[2]=a[2]*d+a[6]*f+a[10]*b;return c},transformVec4(a,b,c){const d=b[0],f=b[1],e=b[2];b=b[3];c=c||l.vec4();c[0]=a[0]*d+a[4]*f+a[8]*e+a[12]*b;c[1]=a[1]*d+a[5]*f+a[9]*e+a[13]*b;c[2]=a[2]*d+a[6]*f+a[10]*e+a[14]*b;c[3]=a[3]*d+a[7]*f+a[11]*e+a[15]*b;return c},rotateVec3X(a,b,c,d){const f=[],e=
[];f[0]=a[0]-b[0];f[1]=a[1]-b[1];f[2]=a[2]-b[2];e[0]=f[0];e[1]=f[1]*Math.cos(c)-f[2]*Math.sin(c);e[2]=f[1]*Math.sin(c)+f[2]*Math.cos(c);d[0]=e[0]+b[0];d[1]=e[1]+b[1];d[2]=e[2]+b[2];return d},rotateVec3Y(a,b,c,d){const f=[],e=[];f[0]=a[0]-b[0];f[1]=a[1]-b[1];f[2]=a[2]-b[2];e[0]=f[2]*Math.sin(c)+f[0]*Math.cos(c);e[1]=f[1];e[2]=f[2]*Math.cos(c)-f[0]*Math.sin(c);d[0]=e[0]+b[0];d[1]=e[1]+b[1];d[2]=e[2]+b[2];return d},rotateVec3Z(a,b,c,d){const f=[],e=[];f[0]=a[0]-b[0];f[1]=a[1]-b[1];f[2]=a[2]-b[2];e[0]=
f[0]*Math.cos(c)-f[1]*Math.sin(c);e[1]=f[0]*Math.sin(c)+f[1]*Math.cos(c);e[2]=f[2];d[0]=e[0]+b[0];d[1]=e[1]+b[1];d[2]=e[2]+b[2];return d},projectVec4(a,b){a=1/a[3];b=b||l.vec2();b[0]=v[0]*a;b[1]=v[1]*a;return b},unprojectVec3:(()=>{const a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16);return function(d,f,e,g){return this.transformVec3(this.mulMat4(this.inverseMat4(f,a),this.inverseMat4(e,b),c),d,g)}})(),lerpVec3(a,b,c,d,f,e){e=e||l.vec3();a=(a-b)/(c-b);e[0]=d[0]+a*(f[0]-d[0]);
e[1]=d[1]+a*(f[1]-d[1]);e[2]=d[2]+a*(f[2]-d[2]);return e},flatten(a){const b=[];let c,d,f,e,g;c=0;for(d=a.length;c<d;c++)for(g=a[c],f=0,e=g.length;f<e;f++)b.push(g[f]);return b},identityQuaternion(a=l.vec4()){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a},eulerToQuaternion(a,b,c=l.vec4()){var d=a[0]*l.DEGTORAD/2,f=a[1]*l.DEGTORAD/2,e=a[2]*l.DEGTORAD/2;a=Math.cos(d);const g=Math.cos(f),h=Math.cos(e);d=Math.sin(d);f=Math.sin(f);e=Math.sin(e);"XYZ"===b?(c[0]=d*g*h+a*f*e,c[1]=a*f*h-d*g*e,c[2]=a*g*e+d*f*h,c[3]=
a*g*h-d*f*e):"YXZ"===b?(c[0]=d*g*h+a*f*e,c[1]=a*f*h-d*g*e,c[2]=a*g*e-d*f*h,c[3]=a*g*h+d*f*e):"ZXY"===b?(c[0]=d*g*h-a*f*e,c[1]=a*f*h+d*g*e,c[2]=a*g*e+d*f*h,c[3]=a*g*h-d*f*e):"ZYX"===b?(c[0]=d*g*h-a*f*e,c[1]=a*f*h+d*g*e,c[2]=a*g*e-d*f*h,c[3]=a*g*h+d*f*e):"YZX"===b?(c[0]=d*g*h+a*f*e,c[1]=a*f*h+d*g*e,c[2]=a*g*e-d*f*h,c[3]=a*g*h-d*f*e):"XZY"===b&&(c[0]=d*g*h-a*f*e,c[1]=a*f*h-d*g*e,c[2]=a*g*e+d*f*h,c[3]=a*g*h+d*f*e);return c},mat4ToQuaternion(a,b=l.vec4()){var c=a[0];const d=a[4],f=a[8],e=a[1],g=a[5],h=
a[9],m=a[2],n=a[6];a=a[10];const p=c+g+a;0<p?(c=.5/Math.sqrt(p+1),b[3]=.25/c,b[0]=(n-h)*c,b[1]=(f-m)*c,b[2]=(e-d)*c):c>g&&c>a?(c=2*Math.sqrt(1+c-g-a),b[3]=(n-h)/c,b[0]=.25*c,b[1]=(d+e)/c,b[2]=(f+m)/c):g>a?(c=2*Math.sqrt(1+g-c-a),b[3]=(f-m)/c,b[0]=(d+e)/c,b[1]=.25*c,b[2]=(h+n)/c):(c=2*Math.sqrt(1+a-c-g),b[3]=(e-d)/c,b[0]=(f+m)/c,b[1]=(h+n)/c,b[2]=.25*c);return b},vec3PairToQuaternion(a,b,c=l.vec4()){const d=Math.sqrt(l.dotVec3(a,a)*l.dotVec3(b,b));let f=d+l.dotVec3(a,b);f<1E-8*d?(f=0,Math.abs(a[0])>
Math.abs(a[2])?(c[0]=-a[1],c[1]=a[0],c[2]=0):(c[0]=0,c[1]=-a[2],c[2]=a[1])):l.cross3Vec3(a,b,c);c[3]=f;return l.normalizeQuaternion(c)},angleAxisToQuaternion(a,b=l.vec4()){const c=a[3]/2,d=Math.sin(c);b[0]=d*a[0];b[1]=d*a[1];b[2]=d*a[2];b[3]=Math.cos(c);return b},quaternionToEuler:(()=>{const a=new Float32Array(16);return(b,c,d)=>{d=d||l.vec3();l.quaternionToRotationMat4(b,a);l.mat4ToEuler(a,c,d);return d}})(),mulQuaternions(a,b,c=l.vec4()){const d=a[0],f=a[1],e=a[2];a=a[3];const g=b[0],h=b[1],m=
b[2];b=b[3];c[0]=a*g+d*b+f*m-e*h;c[1]=a*h+f*b+e*g-d*m;c[2]=a*m+e*b+d*h-f*g;c[3]=a*b-d*g-f*h-e*m;return c},vec3ApplyQuaternion(a,b,c=l.vec3()){var d=b[0];const f=b[1],e=b[2];b=a[0];const g=a[1],h=a[2];a=a[3];const m=a*d+g*e-h*f,n=a*f+h*d-b*e,p=a*e+b*f-g*d;d=-b*d-g*f-h*e;c[0]=m*a+d*-b+n*-h-p*-g;c[1]=n*a+d*-g+p*-b-m*-h;c[2]=p*a+d*-h+m*-g-n*-b;return c},quaternionToMat4(a,b){b=l.identityMat4(b);var c=a[0],d=a[1],f=a[2],e=a[3],g=2*c,h=2*d;const m=2*f;a=g*e;const n=h*e;e*=m;g*=c;const p=h*c;c*=m;h*=d;d*=
m;f*=m;b[0]=1-(h+f);b[1]=p+e;b[2]=c-n;b[4]=p-e;b[5]=1-(g+f);b[6]=d+a;b[8]=c+n;b[9]=d-a;b[10]=1-(g+h);return b},quaternionToRotationMat4(a,b){var c=a[0],d=a[1],f=a[2],e=a[3],g=c+c,h=d+d;const m=f+f;a=c*g;const n=c*h;c*=m;const p=d*h;d*=m;f*=m;g*=e;h*=e;e*=m;b[0]=1-(p+f);b[4]=n-e;b[8]=c+h;b[1]=n+e;b[5]=1-(a+f);b[9]=d-g;b[2]=c-h;b[6]=d+g;b[10]=1-(a+p);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},normalizeQuaternion(a,b=a){const c=l.lenVec4([a[0],a[1],a[2],a[3]]);b[0]=a[0]/c;b[1]=a[1]/
c;b[2]=a[2]/c;b[3]=a[3]/c;return b},conjugateQuaternion(a,b=a){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b},inverseQuaternion(a,b){return l.normalizeQuaternion(l.conjugateQuaternion(a,b))},quaternionToAngleAxis(a,b=l.vec4()){a=l.normalizeQuaternion(a,Kd);var c=a[3];const d=2*Math.acos(c);c=Math.sqrt(1-c*c);.001>c?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):(b[0]=a[0]/c,b[1]=a[1]/c,b[2]=a[2]/c);b[3]=d;return b},decompressPosition(a,b,c){c[0]=a[0]*b[0]+b[12];c[1]=a[1]*b[5]+b[13];c[2]=a[2]*b[10]+b[14]},
decompressPositions(a,b,c=new Float32Array(a.length)){for(let d=0,f=a.length;d<f;d+=3)c[d+0]=a[d+0]*b[0]+b[12],c[d+1]=a[d+1]*b[5]+b[13],c[d+2]=a[d+2]*b[10]+b[14];return c},decompressUV(a,b,c){c[0]=a[0]*b[0]+b[6];c[1]=a[1]*b[4]+b[7]},decompressUVs(a,b,c=new Float32Array(a.length)){for(let d=0,f=a.length;d<f;d+=3)c[d+0]=a[d+0]*b[0]+b[6],c[d+1]=a[d+1]*b[4]+b[7];return c},octDecodeVec2(a,b){let c=a[0];a=a[1];c=(2*c+1)/255;a=(2*a+1)/255;const d=1-Math.abs(c)-Math.abs(a);0>d&&(c=(1-Math.abs(a))*(0<=c?1:
-1),a=(1-Math.abs(c))*(0<=a?1:-1));const f=Math.sqrt(c*c+a*a+d*d);b[0]=c/f;b[1]=a/f;b[2]=d/f;return b},octDecodeVec2s(a,b){for(let c=0,d=0,f=a.length;c<f;c+=2){let e=a[c+0],g=a[c+1];e=(2*e+1)/255;g=(2*g+1)/255;const h=1-Math.abs(e)-Math.abs(g);0>h&&(e=(1-Math.abs(g))*(0<=e?1:-1),g=(1-Math.abs(e))*(0<=g?1:-1));const m=Math.sqrt(e*e+g*g+h*h);b[d+0]=e/m;b[d+1]=g/m;b[d+2]=h/m;d+=3}return b},AABB3(a){return new Float32Array(a||6)},AABB2(a){return new Float32Array(a||4)},OBB3(a){return new Float32Array(a||
32)},OBB2(a){return new Float32Array(a||16)},transformOBB3(a,b,c=b){const d=b.length;let f,e,g;const h=a[0],m=a[1],n=a[2],p=a[3],r=a[4],q=a[5],k=a[6],t=a[7],w=a[8],u=a[9],z=a[10],x=a[11],B=a[12],C=a[13],D=a[14],F=a[15];for(a=0;a<d;a+=4)f=b[a+0],e=b[a+1],g=b[a+2],c[a+0]=h*f+r*e+w*g+B,c[a+1]=m*f+q*e+u*g+C,c[a+2]=n*f+k*e+z*g+D,c[a+3]=p*f+t*e+x*g+F;return c},getAABB3Diag:(()=>{const a=new Float32Array(3),b=new Float32Array(3),c=new Float32Array(3);return d=>{a[0]=d[0];a[1]=d[1];a[2]=d[2];b[0]=d[3];b[1]=
d[4];b[2]=d[5];l.subVec3(b,a,c);return Math.abs(l.lenVec3(c))}})(),getAABB3DiagPoint:(()=>{const a=new Float32Array(3),b=new Float32Array(3),c=new Float32Array(3);return(d,f)=>{a[0]=d[0];a[1]=d[1];a[2]=d[2];b[0]=d[3];b[1]=d[4];b[2]=d[5];const e=l.subVec3(b,a,c),g=f[0]-d[0],h=d[3]-f[0],m=f[1]-d[1],n=d[4]-f[1],p=f[2]-d[2];d=d[5]-f[2];e[0]+=g>h?g:h;e[1]+=m>n?m:n;e[2]+=p>d?p:d;return Math.abs(l.lenVec3(e))}})(),getAABB3Center(a,b){b=b||l.vec3();b[0]=(a[0]+a[3])/2;b[1]=(a[1]+a[4])/2;b[2]=(a[2]+a[5])/2;
return b},getAABB2Center(a,b){b=b||l.vec2();b[0]=(a[2]+a[0])/2;b[1]=(a[3]+a[1])/2;return b},collapseAABB3(a=l.AABB3()){a[0]=l.MAX_DOUBLE;a[1]=l.MAX_DOUBLE;a[2]=l.MAX_DOUBLE;a[3]=-l.MAX_DOUBLE;a[4]=-l.MAX_DOUBLE;a[5]=-l.MAX_DOUBLE;return a},AABB3ToOBB3(a,b=l.OBB3()){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=1;b[4]=a[3];b[5]=a[1];b[6]=a[2];b[7]=1;b[8]=a[3];b[9]=a[4];b[10]=a[2];b[11]=1;b[12]=a[0];b[13]=a[4];b[14]=a[2];b[15]=1;b[16]=a[0];b[17]=a[1];b[18]=a[5];b[19]=1;b[20]=a[3];b[21]=a[1];b[22]=a[5];b[23]=1;
b[24]=a[3];b[25]=a[4];b[26]=a[5];b[27]=1;b[28]=a[0];b[29]=a[4];b[30]=a[5];b[31]=1;return b},positions3ToAABB3:(()=>{const a=new Float32Array(3);return(b,c,d)=>{c=c||l.AABB3();let f=l.MAX_DOUBLE,e=l.MAX_DOUBLE,g=l.MAX_DOUBLE,h=-l.MAX_DOUBLE,m=-l.MAX_DOUBLE,n=-l.MAX_DOUBLE,p,r,q;for(let k=0,t=b.length;k<t;k+=3)d?(a[0]=b[k+0],a[1]=b[k+1],a[2]=b[k+2],l.decompressPosition(a,d,a),p=a[0],r=a[1],q=a[2]):(p=b[k+0],r=b[k+1],q=b[k+2]),p<f&&(f=p),r<e&&(e=r),q<g&&(g=q),p>h&&(h=p),r>m&&(m=r),q>n&&(n=q);c[0]=f;
c[1]=e;c[2]=g;c[3]=h;c[4]=m;c[5]=n;return c}})(),OBB3ToAABB3(a,b=l.AABB3()){let c=l.MAX_DOUBLE,d=l.MAX_DOUBLE,f=l.MAX_DOUBLE,e=-l.MAX_DOUBLE,g=-l.MAX_DOUBLE,h=-l.MAX_DOUBLE,m,n,p;for(let r=0,q=a.length;r<q;r+=4)m=a[r+0],n=a[r+1],p=a[r+2],m<c&&(c=m),n<d&&(d=n),p<f&&(f=p),m>e&&(e=m),n>g&&(g=n),p>h&&(h=p);b[0]=c;b[1]=d;b[2]=f;b[3]=e;b[4]=g;b[5]=h;return b},points3ToAABB3(a,b=l.AABB3()){let c=l.MAX_DOUBLE,d=l.MAX_DOUBLE,f=l.MAX_DOUBLE,e=-l.MAX_DOUBLE,g=-l.MAX_DOUBLE,h=-l.MAX_DOUBLE,m,n,p;for(let r=0,
q=a.length;r<q;r++)m=a[r][0],n=a[r][1],p=a[r][2],m<c&&(c=m),n<d&&(d=n),p<f&&(f=p),m>e&&(e=m),n>g&&(g=n),p>h&&(h=p);b[0]=c;b[1]=d;b[2]=f;b[3]=e;b[4]=g;b[5]=h;return b},points3ToSphere3:(()=>{const a=new Float32Array(3);return(b,c)=>{c=c||l.vec4();var d=0,f=0;let e=0,g;const h=b.length;for(g=0;g<h;g++)d+=b[g][0],f+=b[g][1],e+=b[g][2];c[0]=d/h;c[1]=f/h;c[2]=e/h;for(g=d=0;g<h;g++)f=Math.abs(l.lenVec3(l.subVec3(b[g],c,a))),f>d&&(d=f);c[3]=d;return c}})(),OBB3ToSphere3:(()=>{const a=new Float32Array(3),
b=new Float32Array(3);return(c,d)=>{d=d||l.vec4();var f=0,e=0;let g=0,h;const m=c.length,n=m/4;for(h=0;h<m;h+=4)f+=c[h+0],e+=c[h+1],g+=c[h+2];d[0]=f/n;d[1]=e/n;d[2]=g/n;for(h=f=0;h<m;h+=4)a[0]=c[h+0],a[1]=c[h+1],a[2]=c[h+2],e=Math.abs(l.lenVec3(l.subVec3(a,d,b))),e>f&&(f=e);d[3]=f;return d}})(),getSphere3Center(a,b=l.vec3()){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},expandAABB3(a,b){a[0]>b[0]&&(a[0]=b[0]);a[1]>b[1]&&(a[1]=b[1]);a[2]>b[2]&&(a[2]=b[2]);a[3]<b[3]&&(a[3]=b[3]);a[4]<b[4]&&(a[4]=b[4]);a[5]<
b[5]&&(a[5]=b[5]);return a},expandAABB3Point3(a,b){a[0]<b[0]&&(a[0]=b[0]);a[1]<b[1]&&(a[1]=b[1]);a[2]<b[2]&&(a[2]=b[2]);a[3]>b[0]&&(a[3]=b[0]);a[4]>b[1]&&(a[4]=b[1]);a[5]>b[2]&&(a[5]=b[2]);return a},collapseAABB2(a=l.AABB2()){a[0]=l.MAX_DOUBLE;a[1]=l.MAX_DOUBLE;a[2]=-l.MAX_DOUBLE;a[3]=-l.MAX_DOUBLE;return a},OBB3ToAABB2(a,b=l.AABB2()){let c=l.MAX_DOUBLE,d=l.MAX_DOUBLE,f=-l.MAX_DOUBLE,e=-l.MAX_DOUBLE,g,h;for(let n=0,p=a.length;n<p;n+=4){g=a[n+0];h=a[n+1];var m=a[n+3]||1;m=1/m;g*=m;h*=m;g<c&&(c=g);
h<d&&(d=h);g>f&&(f=g);h>e&&(e=h)}b[0]=c;b[1]=d;b[2]=f;b[3]=e;return b},expandAABB2(a,b){a[0]>b[0]&&(a[0]=b[0]);a[1]>b[1]&&(a[1]=b[1]);a[2]<b[2]&&(a[2]=b[2]);a[3]<b[3]&&(a[3]=b[3]);return a},expandAABB2Point2(a,b){a[0]>b[0]&&(a[0]=b[0]);a[1]>b[1]&&(a[1]=b[1]);a[2]<b[0]&&(a[2]=b[0]);a[3]<b[1]&&(a[3]=b[1]);return a},AABB2ToCanvas(a,b,c,d=a){const f=.5*(a[1]+1),e=.5*(a[2]+1),g=.5*(a[3]+1);d[0]=Math.floor(.5*(a[0]+1)*b);d[1]=c-Math.floor(g*c);d[2]=Math.floor(e*b);d[3]=c-Math.floor(f*c);return d},tangentQuadraticBezier(a,
b,c,d){return 2*(1-a)*(c-b)+2*a*(d-c)},tangentQuadraticBezier3(a,b,c,d,f){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*d*(1-a)-3*a*a*d+3*a*a*f},tangentSpline(a){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},catmullRomInterpolate(a,b,c,d,f){a=.5*(c-a);d=.5*(d-b);const e=f*f;return(2*b-2*c+a+d)*f*e+(-3*b+3*c-2*a-d)*e+a*f+b},b2p0(a,b){a=1-a;return a*a*b},b2p1(a,b){return 2*(1-a)*a*b},b2p2(a,b){return a*a*b},b2(a,b,c,d){return this.b2p0(a,b)+this.b2p1(a,c)+this.b2p2(a,d)},b3p0(a,
b){a=1-a;return a*a*a*b},b3p1(a,b){const c=1-a;return 3*c*c*a*b},b3p2(a,b){return 3*(1-a)*a*a*b},b3p3(a,b){return a*a*a*b},b3(a,b,c,d,f){return this.b3p0(a,b)+this.b3p1(a,c)+this.b3p2(a,d)+this.b3p3(a,f)},triangleNormal(a,b,c,d=l.vec3()){var f=b[0]-a[0],e=b[1]-a[1],g=b[2]-a[2];b=c[0]-a[0];const h=c[1]-a[1];c=c[2]-a[2];a=e*c-g*h;g=g*b-f*c;f=f*h-e*b;e=Math.sqrt(a*a+g*g+f*f);0===e?(d[0]=0,d[1]=0,d[2]=0):(d[0]=a/e,d[1]=g/e,d[2]=f/e);return d},rayTriangleIntersect:(()=>{const a=new Float32Array(3),b=new Float32Array(3),
c=new Float32Array(3),d=new Float32Array(3),f=new Float32Array(3);return(e,g,h,m,n,p)=>{p=p||l.vec3();var r=l.subVec3(m,h,a);n=l.subVec3(n,h,b);var q=l.cross3Vec3(g,n,c);m=l.dotVec3(r,q);if(1E-6>m)return null;const k=l.subVec3(e,h,d);h=l.dotVec3(k,q);if(0>h||h>m)return null;r=l.cross3Vec3(k,r,f);q=l.dotVec3(g,r);if(0>q||h+q>m)return null;n=l.dotVec3(n,r)/m;p[0]=e[0]+n*g[0];p[1]=e[1]+n*g[1];p[2]=e[2]+n*g[2];return p}})(),rayPlaneIntersect:(()=>{const a=new Float32Array(3),b=new Float32Array(3),c=new Float32Array(3),
d=new Float32Array(3);return(f,e,g,h,m,n)=>{n=n||l.vec3();e=l.normalizeVec3(e,a);h=l.subVec3(h,g,b);m=l.subVec3(m,g,c);m=l.cross3Vec3(h,m,d);l.normalizeVec3(m,m);g=-l.dotVec3(g,m);g=-(l.dotVec3(f,m)+g)/l.dotVec3(e,m);n[0]=f[0]+g*e[0];n[1]=f[1]+g*e[1];n[2]=f[2]+g*e[2];return n}})(),cartesianToBarycentric:(()=>{const a=new Float32Array(3),b=new Float32Array(3),c=new Float32Array(3);return(d,f,e,g,h)=>{g=l.subVec3(g,f,a);e=l.subVec3(e,f,b);var m=l.subVec3(d,f,c);d=l.dotVec3(g,g);f=l.dotVec3(g,e);g=l.dotVec3(g,
m);var n=l.dotVec3(e,e);e=l.dotVec3(e,m);m=d*n-f*f;if(0===m)return null;m=1/m;n=(n*g-f*e)*m;d=(d*e-f*g)*m;h[0]=1-n-d;h[1]=d;h[2]=n;return h}})(),barycentricInsideTriangle(a){const b=a[1];a=a[2];return 0<=a&&0<=b&&1>a+b},barycentricToCartesian(a,b,c,d,f=l.vec3()){const e=a[0],g=a[1];a=a[2];f[0]=b[0]*e+c[0]*g+d[0]*a;f[1]=b[1]*e+c[1]*g+d[1]*a;f[2]=b[2]*e+c[2]*g+d[2]*a;return f},mergeVertices(a,b,c,d){const f={},e=[],g=[],h=b?[]:null,m=c?[]:null,n=[];let p,r,q,k,t,w,u=0;t=0;for(w=a.length;t<w;t+=3)p=
a[t],r=a[t+1],q=a[t+2],k=`${Math.round(1E4*p)}_${Math.round(1E4*r)}_${Math.round(1E4*q)}`,void 0===f[k]&&(f[k]=g.length/3,g.push(p),g.push(r),g.push(q),b&&(h.push(b[t]),h.push(b[t+1]),h.push(b[t+2])),c&&(m.push(c[u]),m.push(c[u+1]))),e[t/3]=f[k],u+=2;t=0;for(w=d.length;t<w;t++)n[t]=e[d[t]];a={positions:g,indices:n};h&&(a.normals=h);m&&(a.uv=m);return a},buildNormals:(()=>{const a=new Float32Array(3),b=new Float32Array(3),c=new Float32Array(3),d=new Float32Array(3),f=new Float32Array(3),e=new Float32Array(3);
return(g,h,m)=>{let n,p;const r=Array(g.length/3);n=0;for(p=h.length;n<p;n+=3){var q=h[n];var k=h[n+1];var t=h[n+2];a[0]=g[3*q];a[1]=g[3*q+1];a[2]=g[3*q+2];b[0]=g[3*k];b[1]=g[3*k+1];b[2]=g[3*k+2];c[0]=g[3*t];c[1]=g[3*t+1];c[2]=g[3*t+2];l.subVec3(b,a,d);l.subVec3(c,a,f);const w=new Float32Array(3);l.normalizeVec3(l.cross3Vec3(d,f,e),w);r[q]||(r[q]=[]);r[k]||(r[k]=[]);r[t]||(r[t]=[]);r[q].push(w);r[k].push(w);r[t].push(w)}m=m&&m.length===g.length?m:new Float32Array(g.length);n=0;for(p=r.length;n<p;n++){g=
r[n].length;k=q=h=0;for(t=0;t<g;t++)h+=r[n][t][0],q+=r[n][t][1],k+=r[n][t][2];m[3*n]=h/g;m[3*n+1]=q/g;m[3*n+2]=k/g}return m}})(),buildTangents:(()=>{const a=new Float32Array(3),b=new Float32Array(3),c=new Float32Array(3),d=new Float32Array(3),f=new Float32Array(3),e=new Float32Array(3),g=new Float32Array(3);return(h,m,n)=>{const p=new Float32Array(h.length);for(let u=0;u<m.length;u+=3){var r=m[u],q=h.subarray(3*r,3*r+3),k=n.subarray(2*r,2*r+2);r=m[u+1];var t=h.subarray(3*r,3*r+3),w=n.subarray(2*r,
2*r+2);r=m[u+2];const z=h.subarray(3*r,3*r+3);r=n.subarray(2*r,2*r+2);t=l.subVec3(t,q,a);q=l.subVec3(z,q,b);w=l.subVec2(w,k,c);k=l.subVec2(r,k,d);r=1/(w[0]*k[1]-w[1]*k[0]);k=l.mulVec3Scalar(l.subVec3(l.mulVec3Scalar(t,k[1],f),l.mulVec3Scalar(q,w[1],e),g),r,e);for(w=0;3>w;w++)t=3*m[u+w],p[t]+=k[0],p[t+1]+=k[1],p[t+2]+=k[2]}return p}})(),buildPickTriangles(a,b,c){const d=b.length;c=c?new Uint16Array(9*d):new Float32Array(9*d);const f=new Uint8Array(12*d);let e=0;let g=0,h=0,m,n,p,r;for(let k=0;k<d;k+=
3){r=e>>24&255;p=e>>16&255;n=e>>8&255;m=e&255;var q=b[k];q*=3;c[g++]=a[q];c[g++]=a[q+1];c[g++]=a[q+2];f[h++]=m;f[h++]=n;f[h++]=p;f[h++]=r;q=b[k+1];q*=3;c[g++]=a[q];c[g++]=a[q+1];c[g++]=a[q+2];f[h++]=m;f[h++]=n;f[h++]=p;f[h++]=r;q=b[k+2];q*=3;c[g++]=a[q];c[g++]=a[q+1];c[g++]=a[q+2];f[h++]=m;f[h++]=n;f[h++]=p;f[h++]=r;e++}return{positions:c,colors:f}},faceToVertexNormals(a,b,c={}){c=c.smoothNormalsAngleThreshold||20;const d={},f=[],e={};let g;var h;g=0;for(h=a.length;g<h;g+=3){var m=g/3;var n=a[g];
var p=a[g+1];var r=a[g+2];n=`${Math.round(1E4*n)}_${Math.round(1E4*p)}_${Math.round(1E4*r)}`;void 0===d[n]?d[n]=[m]:d[n].push(m);p=l.normalizeVec3([b[g],b[g+1],b[g+2]]);f[m]=p;p=l.vec4([p[0],p[1],p[2],1]);e[m]=p}for(n in d)if(d.hasOwnProperty(n))for(h=d[n],r=h.length,g=0;g<r;g++){const k=h[g];p=e[k];for(a=0;a<r;a++)if(g!==a){var q=h[a];m=f[k];q=f[q];Math.abs(l.angleVec3(m,q)/l.DEGTORAD)<c&&(p[0]+=q[0],p[1]+=q[1],p[2]+=q[2],p[3]+=1)}}g=0;for(h=b.length;g<h;g+=3)p=e[g/3],b[g+0]=p[0]/p[3],b[g+1]=p[1]/
p[3],b[g+2]=p[2]/p[3]},canvasPosToWorldRay:(()=>{const a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(4),d=new Float32Array(4),f=new Float32Array(4),e=new Float32Array(4);return(g,h,m,n)=>{var p=g.scene.canvas.canvas;g=l.mulMat4("ortho"===g.projection?g.ortho.matrix:g.perspective.matrix,g.viewMatrix,a);g=l.inverseMat4(g,b);var r=p.width;p=p.height;r=(h[0]-r/2)/(r/2);h=-(h[1]-p/2)/(p/2);c[0]=r;c[1]=h;c[2]=-1;c[3]=1;l.transformVec4(g,c,d);l.mulVec4Scalar(d,1/d[3]);f[0]=r;f[1]=h;f[2]=
1;f[3]=1;l.transformVec4(g,f,e);l.mulVec4Scalar(e,1/e[3]);m[0]=e[0];m[1]=e[1];m[2]=e[2];l.subVec3(e,d,n);l.normalizeVec3(n)}})(),canvasPosToLocalRay:(()=>{const a=new Float32Array(3),b=new Float32Array(3);return(c,d,f,e,g)=>{l.canvasPosToWorldRay(c,f,a,b);l.worldRayToLocalRay(d,a,b,e,g)}})(),worldRayToLocalRay:(()=>{const a=new Float32Array(16),b=new Float32Array(4),c=new Float32Array(4);return(d,f,e,g,h)=>{d=l.inverseMat4(d.worldMatrix||d.matrix,a);b[0]=f[0];b[1]=f[1];b[2]=f[2];b[3]=1;l.transformVec4(d,
b,c);g[0]=c[0];g[1]=c[1];g[2]=c[2];l.transformVec3(d,e,h)}})(),buildKDTree:(()=>{function a(c,d,f,e){var g=new Float32Array(6);const h={triangles:null,left:null,right:null,leaf:!1,splitDim:0,aabb:g};g[0]=g[1]=g[2]=Number.POSITIVE_INFINITY;g[3]=g[4]=g[5]=Number.NEGATIVE_INFINITY;let m,n;m=0;for(n=c.length;m<n;++m){var p=3*c[m];for(var r=0;3>r;++r){var q=3*d[p+r];f[q]<g[0]&&(g[0]=f[q]);f[q]>g[3]&&(g[3]=f[q]);f[q+1]<g[1]&&(g[1]=f[q+1]);f[q+1]>g[4]&&(g[4]=f[q+1]);f[q+2]<g[2]&&(g[2]=f[q+2]);f[q+2]>g[5]&&
(g[5]=f[q+2])}}if(20>c.length||10<e)return h.triangles=c,h.leaf=!0,h;b[0]=g[3]-g[0];b[1]=g[4]-g[1];b[2]=g[5]-g[2];r=0;b[1]>b[r]&&(r=1);b[2]>b[r]&&(r=2);h.splitDim=r;g=(g[r]+g[r+3])/2;q=Array(c.length);let k=0;const t=Array(c.length);let w=0;m=0;for(n=c.length;m<n;++m){p=3*c[m];const u=3*d[p+1],z=3*d[p+2];f[3*d[p]+r]<=g||f[u+r]<=g||f[z+r]<=g?q[k++]=c[m]:t[w++]=c[m]}q.length=k;t.length=w;h.left=a(q,d,f,e+1);h.right=a(t,d,f,e+1);return h}const b=new Float32Array;return(c,d)=>{const f=c.length/3,e=Array(f);
for(let g=0;g<f;++g)e[g]=g;return a(e,c,d,0)}})()};class Ld{constructor(){this._head=[];this._headLength=0;this._tail=[];this._length=this._index=0}get length(){return this._length}shift(){if(this._index>=this._headLength){var a=this._head;a.length=0;this._head=this._tail;this._tail=a;this._index=0;this._headLength=this._head.length;if(!this._headLength)return}a=this._head[this._index];0>this._index?delete this._head[this._index++]:this._head[this._index++]=void 0;this._length--;return a}push(a){this._length++;
this._tail.push(a);return this}unshift(a){this._head[--this._index]=a;this._length++;return this}}const Na=new Ld,za={scheduleTask(a,b){Na.push(a);Na.push(b)},runTasks(a){var b=(new Date).getTime();let c,d=0;for(;0<Na.length&&b<a;)b=Na.shift(),(c=Na.shift())?b.call(c):b(),b=(new Date).getTime(),d++;return d},getNumTasks(){return Na.length}},M={};class Z{get type(){return"xeogl.Component"}constructor(a,b){var c={},d=null;this.scene=null;"xeogl.Scene"===this.type?(this.scene=this,a&&(c=a)):(a?"xeogl.Scene"===
a.type?(d=this.scene=a,b&&(c=b)):a instanceof Z?(this.scene=a.scene,d=a,b&&(c=b)):(d=this.scene=ba.getDefaultScene(),c=a):d=this.scene=ba.getDefaultScene(),this._renderer=this.scene._renderer);this._dontClear=!!c.dontClear;this._model=null;this._renderer=this.scene._renderer;this.meta=c.meta||{};this.id=c.id;this.destroyed=!1;this._attached={};this._events=this._eventSubs=this._subIdEvents=this._subIdMap=this._attachments=null;this._eventCallDepth=0;this._adoptees=null;this!==this.scene&&this.scene._addComponent(this);
this._updateScheduled=!1;this.init(c);d&&d._adopt(this)}init(){}_addedToModel(a){this._model=a}_removedFromModel(a){this._model=null}get model(){return this._model}isType(a){return G.isString(a)||(a=a.type,a)?ba.isComponentType(this.type,a):!1}fire(a,b,c){this._events||(this._events={});this._eventSubs||(this._eventSubs={});!0!==c&&(this._events[a]=b||!0);c=this._eventSubs[a];let d;if(c)for(const f in c)c.hasOwnProperty(f)&&(d=c[f],this._eventCallDepth++,300>this._eventCallDepth?d.callback.call(d.scope,
b):this.error("fire: potential stack overflow from recursive event '"+a+"' - dropping this event"),this._eventCallDepth--)}on(a,b,c){this._events||(this._events={});this._subIdMap||(this._subIdMap=new ta);this._subIdEvents||(this._subIdEvents={});this._eventSubs||(this._eventSubs={});let d=this._eventSubs[a];d||(d={},this._eventSubs[a]=d);const f=this._subIdMap.addItem();d[f]={callback:b,scope:c||this};this._subIdEvents[f]=a;a=this._events[a];void 0!==a&&b.call(c||this,a);return f}off(a){if(void 0!==
a&&null!==a&&this._subIdEvents){var b=this._subIdEvents[a];b&&(delete this._subIdEvents[a],(b=this._eventSubs[b])&&delete b[a],this._subIdMap.removeItem(a))}}once(a,b,c){const d=this,f=this.on(a,function(e){d.off(f);b(e)},c)}hasSubs(a){return this._eventSubs&&!!this._eventSubs[a]}log(a){a="[LOG]"+this._message(a);window.console.log(a);this.scene.fire("log",a)}_message(a){return" ["+this.type+" "+G.inQuotes(this.id)+"]: "+a}warn(a){a="[WARN]"+this._message(a);window.console.warn(a);this.scene.fire("warn",
a)}error(a){a="[ERROR]"+this._message(a);window.console.error(a);this.scene.fire("error",a)}_attach(a){const b=a.name;if(b){var c=a.component,d=a.sceneDefault,f=a.sceneSingleton,e=a.type,g=a.on,h=!1!==a.recompiles,m=!1;if(c)if(G.isNumeric(c)||G.isString(c)){var n=c;c=this.scene.components[n];if(!c){this.error("Component not found: "+G.inQuotes(n));return}}else if(G.isObject(c)){m=c.type||e||"xeogl.Component";n=M[m];if(!n){this.error("Component type not found: "+m);return}if(e&&!ba.isComponentType(m,
e)){this.error("Expected a "+e+" type or subtype, not a "+m);return}c=new n(this.scene,c);m=!0}if(!c)if(!0===f){d=this.scene.types[e];for(var p in d)if(d.hasOwnProperty){c=d[p];break}if(!c)return this.error("Scene has no default component for '"+b+"'"),null}else if(!0===d&&(c=this.scene[b],!c))return this.error("Scene has no default component for '"+b+"'"),null;if(c){if(c.scene.id!==this.scene.id){this.error("Not in same scene: "+c.type+" "+G.inQuotes(c.id));return}if(e&&!c.isType(e)){this.error("Expected a "+
e+" type or subtype: "+c.type+" "+G.inQuotes(c.id));return}}this._attachments||(this._attachments={});if(e=this._attached[b]){if(c&&e.id===c.id)return;p=this._attachments[e.id];d=p.subs;f=0;for(n=d.length;f<n;f++)e.off(d[f]);delete this._attached[b];delete this._attachments[e.id];(d=p.params.onDetached)&&(G.isFunction(d)?d(e):d.scope?d.callback.call(d.scope,e):d.callback(e));p.managingLifecycle&&e.destroy()}if(c){const r={params:a,component:c,subs:[],managingLifecycle:m};r.subs.push(c.on("destroyed",
function(){r.params.component=null;this._attach(r.params)},this));h&&r.subs.push(c.on("dirty",function(){this.fire("dirty",this)},this));this._attached[b]=c;this._attachments[c.id]=r;(a=a.onAttached)&&(G.isFunction(a)?a(c):a.scope?a.callback.call(a.scope,c):a.callback(c));if(g){let q;for(q in g)g.hasOwnProperty(q)&&(m=g[q],G.isFunction(m)?(a=m,m=null):(a=m.callback,m=m.scope),a&&r.subs.push(c.on(q,a,m)))}}h&&this.fire("dirty",this);this.fire(b,c);return c}this.error("Component 'name' expected")}_checkComponent(a,
b){if(G.isObject(b)){if(b.type){if(!ba.isComponentType(b.type,a)){this.error("Expected a "+a+" type or subtype: "+b.type+" "+G.inQuotes(b.id));return}}else b.type=a;b=new M[b.type](this.scene,b)}else if(G.isID(b)&&(b=this.scene.components[b],!b)){this.error("Component not found: "+G.inQuotes(b.id));return}if(b.scene.id!==this.scene.id)this.error("Not in same scene: "+b.type+" "+G.inQuotes(b.id));else{if(b.isType(a))return b;this.error("Expected a "+a+" type or subtype: "+b.type+" "+G.inQuotes(b.id))}}create(a){let b,
c;G.isObject(a)?(b=a.type||"xeogl.Component",c=M[b]):G.isString(a)?(b=a,c=M[b]):(c=a,b=a.prototype.type);if(c){if(ba.isComponentType(b,"xeogl.Component"))return a&&a.id&&this.components[a.id]&&(this.error("Component "+G.inQuotes(a.id)+" already exists in Scene - ignoring ID, will randomly-generate instead"),a.id=void 0),a=new c(this,a),this._adopt(a),a;this.error("Expected a xeogl.Component type or subtype")}else this.error("Component type not found: "+b)}_adopt(a){this._adoptees||(this._adoptees=
{});this._adoptees[a.id]||(this._adoptees[a.id]=a);a.on("destroyed",function(){delete this._adoptees[a.id]},this)}_needUpdate(a){this._updateScheduled||(this._updateScheduled=!0,0===a?this._doUpdate():za.scheduleTask(this._doUpdate,this))}_doUpdate(){this._updateScheduled&&(this._updateScheduled=!1,this._update&&this._update())}_update(){}destroy(){if(!this.destroyed){var a;if(this._attachments)for(e in this._attachments)if(this._attachments.hasOwnProperty(e)){var b=this._attachments[e];var c=b.component;
var d=b.subs;var f=0;for(a=d.length;f<a;f++)c.off(d[f]);b.managingLifecycle&&c.destroy()}if(this._adoptees){var e=Object.keys(this._adoptees);f=0;for(a=e.length;f<a;f++)c=this._adoptees[e[f]],c.destroy()}this.scene._removeComponent(this);this._attached={};this._events=this._eventSubs=this._subIdEvents=this._subIdMap=this._attachments=null;this._eventCallDepth=0;this._adoptees=null;this._updateScheduled=!1;this.fire("destroyed",this.destroyed=!0)}}}M["xeogl.Component"]=Z;const qb=function(){const a=
document.createElement("canvas"),b=String.fromCharCode;if(!a.getContext)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};const c=!!a.getContext("2d").getImageData,d=!!a.toDataURL,f=!!window.btoa,e=function(m){window.open(m)||(document.location.href=m)},g=function(m){const n=document.createElement("img");n.src=m;return n},h=function(m,n,p){if(n&&p){const r=document.createElement("canvas");r.width=n;r.height=p;r.style.width=n+"px";r.style.height=p+"px";r.getContext("2d").drawImage(m,
0,0,m.width,m.height,0,0,n,n);return r}return m};return{saveAsPNG:function(m,n,p,r){if(!d)return!1;m=h(m,p,r).toDataURL("image/png");if(n)return g(m);e(m);return!0},saveAsJPEG:function(m,n,p,r){if(!d)return!1;m=h(m,p,r).toDataURL("image/jpeg");if(5!=m.indexOf("image/jpeg"))return!1;if(n)return g(m);e(m);return!0},saveAsBMP:function(m,n,p,r){if(!(d&&c&&f))return!1;m=h(m,p,r);p=parseInt(m.width);r=parseInt(m.height);var q=m.getContext("2d").getImageData(0,0,p,r);p=q.width;r=q.height;var k=p*r*4+54;
m="BM"+b(k%256);k=Math.floor(k/256);m+=b(k%256);k=Math.floor(k/256);m+=b(k%256);k=Math.floor(k/256);m+=b(k%256);m+=b(0,0,0,0,54,0,0,0);m+=b(40,0,0,0);k=p;m+=b(k%256);k=Math.floor(k/256);m+=b(k%256);k=Math.floor(k/256);m+=b(k%256);k=Math.floor(k/256);m+=b(k%256);k=r;m+=b(k%256);k=Math.floor(k/256);m+=b(k%256);k=Math.floor(k/256);m+=b(k%256);k=Math.floor(k/256);m+=b(k%256);m+=b(1,0,32,0);m+=b(0,0,0,0);k=p*r*4;m+=b(k%256);k=Math.floor(k/256);m+=b(k%256);k=Math.floor(k/256);m+=b(k%256);k=Math.floor(k/
256);m+=b(k%256);m+=b(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);q=q.data;k="";let t=r,w,u,z;do{u=p*(t-1)*4;z="";for(r=0;r<p;r++)w=4*r,z+=b(q[u+w+2],q[u+w+1],q[u+w],q[u+w+3]);k+=z}while(--t);m+=k;r="";if("string"==typeof m)r=m;else for(p=0;p<m.length;p++)r+=b(m[p]);m=btoa(r);if(n)return g("data:image/bmp;base64,"+m);e("data:image/bmp;base64,"+m);return!0}}}();let Hc=!1;class Ic extends Z{get type(){return"xeogl.Spinner"}init(a){super.init(a);this._canvas=a.canvas;this._injectSpinnerCSS();a=document.createElement("div");
const b=a.style;b["z-index"]="9000";b.position="absolute";a.innerHTML='<div class="sk-fading-circle">                <div class="sk-circle1 sk-circle"></div>                <div class="sk-circle2 sk-circle"></div>                <div class="sk-circle3 sk-circle"></div>                <div class="sk-circle4 sk-circle"></div>                <div class="sk-circle5 sk-circle"></div>                <div class="sk-circle6 sk-circle"></div>                <div class="sk-circle7 sk-circle"></div>                <div class="sk-circle8 sk-circle"></div>                <div class="sk-circle9 sk-circle"></div>                <div class="sk-circle10 sk-circle"></div>                <div class="sk-circle11 sk-circle"></div>                <div class="sk-circle12 sk-circle"></div>                </div>';
this._canvas.parentElement.appendChild(a);this._element=a;this._adjustPosition();this.processes=0}set processes(a){a=a||0;if(this._processes!==a&&!(0>a)){var b=this._processes;this._processes=a;this._element.style.visibility=0<this._processes?"visible":"hidden";this.fire("processes",this._processes);0===this._processes&&this._processes!==b&&this.fire("zeroProcesses",this._processes)}}get processes(){return this._processes}_adjustPosition(){if(this._canvas&&this._element){var a=this._canvas,b=this._element,
c=b.style;c.left=a.offsetLeft+.5*a.clientWidth-.5*b.clientWidth+"px";c.top=a.offsetTop+.5*a.clientHeight-.5*b.clientHeight+"px"}}_injectSpinnerCSS(){if(!Hc){var a=document.createElement("style");a.innerHTML=".sk-fading-circle {        background: transparent;        margin: 20px auto;        width: 50px;        height:50px;        position: relative;        }        .sk-fading-circle .sk-circle {        width: 120%;        height: 120%;        position: absolute;        left: 0;        top: 0;        }        .sk-fading-circle .sk-circle:before {        content: '';        display: block;        margin: 0 auto;        width: 15%;        height: 15%;        background-color: #ff8800;        border-radius: 100%;        -webkit-animation: sk-circleFadeDelay 1.2s infinite ease-in-out both;        animation: sk-circleFadeDelay 1.2s infinite ease-in-out both;        }        .sk-fading-circle .sk-circle2 {        -webkit-transform: rotate(30deg);        -ms-transform: rotate(30deg);        transform: rotate(30deg);    }    .sk-fading-circle .sk-circle3 {        -webkit-transform: rotate(60deg);        -ms-transform: rotate(60deg);        transform: rotate(60deg);    }    .sk-fading-circle .sk-circle4 {        -webkit-transform: rotate(90deg);        -ms-transform: rotate(90deg);        transform: rotate(90deg);    }    .sk-fading-circle .sk-circle5 {        -webkit-transform: rotate(120deg);        -ms-transform: rotate(120deg);        transform: rotate(120deg);    }    .sk-fading-circle .sk-circle6 {        -webkit-transform: rotate(150deg);        -ms-transform: rotate(150deg);        transform: rotate(150deg);    }    .sk-fading-circle .sk-circle7 {        -webkit-transform: rotate(180deg);        -ms-transform: rotate(180deg);        transform: rotate(180deg);    }    .sk-fading-circle .sk-circle8 {        -webkit-transform: rotate(210deg);        -ms-transform: rotate(210deg);        transform: rotate(210deg);    }    .sk-fading-circle .sk-circle9 {        -webkit-transform: rotate(240deg);        -ms-transform: rotate(240deg);        transform: rotate(240deg);    }    .sk-fading-circle .sk-circle10 {        -webkit-transform: rotate(270deg);        -ms-transform: rotate(270deg);        transform: rotate(270deg);    }    .sk-fading-circle .sk-circle11 {        -webkit-transform: rotate(300deg);        -ms-transform: rotate(300deg);        transform: rotate(300deg);    }    .sk-fading-circle .sk-circle12 {        -webkit-transform: rotate(330deg);        -ms-transform: rotate(330deg);        transform: rotate(330deg);    }    .sk-fading-circle .sk-circle2:before {        -webkit-animation-delay: -1.1s;        animation-delay: -1.1s;    }    .sk-fading-circle .sk-circle3:before {        -webkit-animation-delay: -1s;        animation-delay: -1s;    }    .sk-fading-circle .sk-circle4:before {        -webkit-animation-delay: -0.9s;        animation-delay: -0.9s;    }    .sk-fading-circle .sk-circle5:before {        -webkit-animation-delay: -0.8s;        animation-delay: -0.8s;    }    .sk-fading-circle .sk-circle6:before {        -webkit-animation-delay: -0.7s;        animation-delay: -0.7s;    }    .sk-fading-circle .sk-circle7:before {        -webkit-animation-delay: -0.6s;        animation-delay: -0.6s;    }    .sk-fading-circle .sk-circle8:before {        -webkit-animation-delay: -0.5s;        animation-delay: -0.5s;    }    .sk-fading-circle .sk-circle9:before {        -webkit-animation-delay: -0.4s;        animation-delay: -0.4s;    }    .sk-fading-circle .sk-circle10:before {        -webkit-animation-delay: -0.3s;        animation-delay: -0.3s;    }    .sk-fading-circle .sk-circle11:before {        -webkit-animation-delay: -0.2s;        animation-delay: -0.2s;    }    .sk-fading-circle .sk-circle12:before {        -webkit-animation-delay: -0.1s;        animation-delay: -0.1s;    }    @-webkit-keyframes sk-circleFadeDelay {        0%, 39%, 100% { opacity: 0; }        40% { opacity: 1; }    }    @keyframes sk-circleFadeDelay {        0%, 39%, 100% { opacity: 0; }        40% { opacity: 1; }    }";
document.body.appendChild(a);Hc=!0}}}const Y={WEBGL:!1,SUPPORTED_EXTENSIONS:{}},Qb=document.createElement("canvas");if(Qb){const a=Qb.getContext("webgl",{antialias:!0})||Qb.getContext("experimental-webgl",{antialias:!0});Y.WEBGL=!!a;Y.WEBGL&&(Y.ANTIALIAS=a.getContextAttributes().antialias,a.getShaderPrecisionFormat?0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision?Y.FS_MAX_FLOAT_PRECISION="highp":0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision?Y.FS_MAX_FLOAT_PRECISION=
"mediump":Y.FS_MAX_FLOAT_PRECISION="lowp":Y.FS_MAX_FLOAT_PRECISION="mediump",Y.DEPTH_BUFFER_BITS=a.getParameter(a.DEPTH_BITS),Y.MAX_TEXTURE_SIZE=a.getParameter(a.MAX_TEXTURE_SIZE),Y.MAX_CUBE_MAP_SIZE=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE),Y.MAX_RENDERBUFFER_SIZE=a.getParameter(a.MAX_RENDERBUFFER_SIZE),Y.MAX_TEXTURE_UNITS=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS),Y.MAX_TEXTURE_IMAGE_UNITS=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),Y.MAX_VERTEX_ATTRIBS=a.getParameter(a.MAX_VERTEX_ATTRIBS),
Y.MAX_VERTEX_UNIFORM_VECTORS=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),Y.MAX_FRAGMENT_UNIFORM_VECTORS=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS),Y.MAX_VARYING_VECTORS=a.getParameter(a.MAX_VARYING_VECTORS),a.getSupportedExtensions().forEach(function(b){Y.SUPPORTED_EXTENSIONS[b]=!0}))}const Jc=["webgl","experimental-webgl","webkit-3d","moz-webgl","moz-glweb20"];class Rb extends Z{get type(){return"xeogl.Canvas"}init(a){super.init(a);this.gl=this.canvas=null;this.webgl2=!1;this.transparent=!!a.transparent;
this.contextAttr=a.contextAttr||{};this.contextAttr.alpha=this.transparent;if(void 0===this.contextAttr.preserveDrawingBuffer||null===this.contextAttr.preserveDrawingBuffer)this.contextAttr.preserveDrawingBuffer=!0;this.contextAttr.stencil=!1;this.contextAttr.antialias=!0;this.contextAttr.premultipliedAlpha=!1!==this.contextAttr.premultipliedAlpha;this.contextAttr.antialias=!1!==this.contextAttr.antialias;a.canvas?G.isString(a.canvas)?(this.canvas=document.getElementById(a.canvas),this.canvas||(this.error("Canvas element not found: "+
G.inQuotes(a.canvas)+" - creating default canvas instead."),this._createCanvas())):this.canvas=a.canvas:this._createCanvas();if(this.canvas){this.canvas.width=this.canvas.clientWidth;this.canvas.height=this.canvas.clientHeight;this.boundary=[this.canvas.offsetLeft,this.canvas.offsetTop,this.canvas.clientWidth,this.canvas.clientHeight];this._createBackground();a.simulateWebGLContextLost&&(window.WebGLDebugUtils?this.canvas=WebGLDebugUtils.makeLostContextSimulatingCanvas(this.canvas):this.error("To simulate context loss, please include WebGLDebugUtils"));
this._initWebGL(a);var b=this;this.canvas.addEventListener("webglcontextlost",this._webglcontextlostListener=function(n){console.time("webglcontextrestored");b.scene._webglContextLost();b.fire("webglcontextlost");n.preventDefault()},!1);this.canvas.addEventListener("webglcontextrestored",this._webglcontextrestoredListener=function(n){b._initWebGL();b.gl&&(b.scene._webglContextRestored(b.gl),b.fire("webglcontextrestored",b.gl),n.preventDefault());console.timeEnd("webglcontextrestored")},!1);var c=
null,d=null,f=null,e=null,g=null,h=null,m=null;this._tick=this.scene.on("tick",function(){const n=b.canvas,p=window.innerWidth!==c||window.innerHeight!==d;var r=n.clientWidth!==f||n.clientHeight!==e;const q=n.offsetLeft!==g||n.offsetTop!==h,k=n.parentElement;var t=k!==m;if(p||r||q||t){b._spinner._adjustPosition();if(r||q){t=n.clientWidth;const u=n.clientHeight;if(r){r=0;let z;for(var w in ba.scenes)ba.scenes.hasOwnProperty(w)&&(z=ba.scenes[w],r+=z.canvas.canvas.clientWidth*z.canvas.canvas.clientHeight);
P.memory.pixels=r;n.width=n.clientWidth;n.height=n.clientHeight}w=b.boundary;w[0]=n.offsetLeft;w[1]=n.offsetTop;w[2]=t;w[3]=u;b.fire("boundary",w);f=t;e=u}p&&(c=window.innerWidth,d=window.innerHeight);q&&(g=n.offsetLeft,h=n.offsetTop);m=k}});this.canvas.oncontextmenu=function(n){n.preventDefault()};this._spinner=new Ic(this.scene,{canvas:this.canvas});this.backgroundColor=a.backgroundColor;this.backgroundImage=a.backgroundImage}else this.error("Faied to create canvas")}_createCanvas(){const a="xeogl-canvas-"+
l.createUUID(),b=document.getElementsByTagName("body")[0],c=document.createElement("div"),d=c.style;d.height="100%";d.width="100%";d.padding="0";d.margin="0";d.background="rgba(0,0,0,0);";d.float="left";d.left="0";d.top="0";d.position="absolute";d.opacity="1.0";d["z-index"]="-10000";c.innerHTML+='<canvas id="'+a+'" style="width: 100%; height: 100%; float: left; margin: 0; padding: 0;"></canvas>';b.appendChild(c);this.canvas=document.getElementById(a)}_createBackground(){const a=document.createElement("div"),
b=a.style;b.padding="0";b.margin="0";b.background=null;b.backgroundImage=null;b.float="left";b.left="0";b.top="0";b.width="100%";b.height="100%";b.position="absolute";b.opacity=1;b["z-index"]="-20000";this.canvas.parentElement.appendChild(a);this._backgroundElement=a}_getElementXY(a){let b=0,c=0;for(;a;)b+=a.offsetLeft-a.scrollLeft,c+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{x:b,y:c}}_initWebGL(a){if(!this.gl)for(a=0;!this.gl&&a<Jc.length;a++)try{this.gl=this.canvas.getContext(Jc[a],this.contextAttr)}catch(b){}this.gl||
(this.error("Failed to get a WebGL context"),this.fire("webglContextFailed",!0,!0));this.gl&&(this.webgl2?this.gl.hint(this.gl.FRAGMENT_SHADER_DERIVATIVE_HINT,this.gl.FASTEST):Y.SUPPORTED_EXTENSIONS.OES_standard_derivatives&&(a=this.gl.getExtension("OES_standard_derivatives"),this.gl.hint(a.FRAGMENT_SHADER_DERIVATIVE_HINT_OES,this.gl.FASTEST)))}getSnapshot(a,b){if(this.canvas)if(b){const c=this;requestAnimationFrame(function(){c.scene.render(!0);b(c._getSnapshot(a))})}else return this._getSnapshot(a);
else this.error("Can't get snapshot - no canvas."),b(null)}_getSnapshot(a){a=a||{};var b=a.width||this.canvas.width;const c=a.height||this.canvas.height;a=a.format||"jpeg";switch(a){case "jpeg":b=qb.saveAsJPEG(this.canvas,!1,b,c);break;case "png":b=qb.saveAsPNG(this.canvas,!0,b,c);break;case "bmp":b=qb.saveAsBMP(this.canvas,!0,b,c);break;default:this.error("Unsupported snapshot format: '"+a+"' - supported types are 'jpeg', 'bmp' and 'png' - defaulting to 'jpeg'"),b=qb.saveAsJPEG(this.canvas,!0,b,
c)}return b.src}readPixels(a,b,c,d){return this.scene._renderer.readPixels(a,b,c,d)}loseWebGLContext(){this.canvas.loseContext&&this.canvas.loseContext()}set backgroundColor(a){a?((this._backgroundColor=this._backgroundColor||l.vec4()).set(a||[0,0,0,1]),this._backgroundImageSrc||(this._backgroundElement.style.background="rgb("+Math.round(255*this._backgroundColor[0])+", "+Math.round(255*this._backgroundColor[1])+","+Math.round(255*this._backgroundColor[2])+")")):this._backgroundColor=null}get backgroundColor(){return this._backgroundColor}set backgroundImage(a){a&&
(G.isString(a)?a!==this._backgroundImageSrc&&(this._backgroundElement.style.backgroundImage="url('"+a+"')",this._backgroundImageSrc=a,this._backgroundImageSrc||(this._backgroundElement.style.background="rgb("+Math.round(255*this._backgroundColor[0])+", "+Math.round(255*this._backgroundColor[1])+","+Math.round(255*this._backgroundColor[2])+")")):this.error("Value for 'backgroundImage' should be a string"))}get backgroundImage(){return this._backgroundImageSrc}get spinner(){return this._spinner}destroy(){this.scene.off(this._tick);
this.canvas.removeEventListener("webglcontextlost",this._webglcontextlostListener);this.canvas.removeEventListener("webglcontextrestored",this._webglcontextrestoredListener);this.gl=this.canvas=null;super.destroy()}}M["xeogl.Canvas"]=Rb;class Md{constructor(){this.reset()}reset(){this.lastProgramId=null;this.backfaces=!1;this.frontface=!0;this.pass=this.bindArray=this.bindTexture=this.useProgram=this.drawArrays=this.drawElements=this.textureUnit=0;this.pickProjMatrix=this.pickViewMatrix=this.shadowProjMatrix=
this.shadowViewMatrix=null;this.pickmeshIndex=1}}class Wa{constructor(a,b,c){c=c||{};this.gl=b;this.allocated=!1;this.canvas=a;this.buffer=null;this.bound=!1;this.size=c.size}setSize(a){this.size=a}webglContextRestored(a){this.gl=a;this.buffer=null;this.bound=this.allocated=!1}bind(){this._touch();if(!this.bound){var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.buffer.framebuf);this.bound=!0}}_touch(){let a,b;const c=this.gl;this.size?(a=this.size[0],b=this.size[1]):(a=this.canvas.clientWidth,b=
this.canvas.clientHeight);if(this.buffer){if(this.buffer.width===a&&this.buffer.height===b)return;c.deleteTexture(this.buffer.texture);c.deleteFramebuffer(this.buffer.framebuf);c.deleteRenderbuffer(this.buffer.renderbuf)}const d=c.createTexture();c.bindTexture(c.TEXTURE_2D,d);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,b,0,c.RGBA,c.UNSIGNED_BYTE,null);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,
c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);const f=c.createRenderbuffer();c.bindRenderbuffer(c.RENDERBUFFER,f);c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,a,b);const e=c.createFramebuffer();c.bindFramebuffer(c.FRAMEBUFFER,e);c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,d,0);c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,f);c.bindTexture(c.TEXTURE_2D,null);c.bindRenderbuffer(c.RENDERBUFFER,null);c.bindFramebuffer(c.FRAMEBUFFER,
null);c.bindFramebuffer(c.FRAMEBUFFER,e);if(!c.isFramebuffer(e))throw"Invalid framebuffer";c.bindFramebuffer(c.FRAMEBUFFER,null);const g=c.checkFramebufferStatus(c.FRAMEBUFFER);switch(g){case c.FRAMEBUFFER_COMPLETE:break;case c.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case c.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case c.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS";
case c.FRAMEBUFFER_UNSUPPORTED:throw"Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED";default:throw"Incomplete framebuffer: "+g;}this.buffer={framebuf:e,renderbuf:f,texture:d,width:a,height:b};this.bound=!1}clear(){if(!this.bound)throw"Render buffer not bound";const a=this.gl;a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)}read(a,b){b=this.canvas.height-b;const c=new Uint8Array(4),d=this.gl;d.readPixels(a,b,1,1,d.RGBA,d.UNSIGNED_BYTE,c);return c}unbind(){const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,
null);this.bound=!1}getTexture(){const a=this;return{renderBuffer:this,bind:function(b){return a.buffer&&a.buffer.texture?(a.gl.activeTexture(a.gl["TEXTURE"+b]),a.gl.bindTexture(a.gl.TEXTURE_2D,a.buffer.texture),!0):!1},unbind:function(b){a.buffer&&a.buffer.texture&&(a.gl.activeTexture(a.gl["TEXTURE"+b]),a.gl.bindTexture(a.gl.TEXTURE_2D,null))}}}destroy(){if(this.allocated){const a=this.gl;a.deleteTexture(this.buffer.texture);a.deleteFramebuffer(this.buffer.framebuf);a.deleteRenderbuffer(this.buffer.renderbuf);
this.allocated=!1;this.buffer=null;this.bound=!1}}}const Kc=new ta({});class da{constructor(a){this.id=Kc.addItem({});for(const b in a)a.hasOwnProperty(b)&&(this[b]=a[b])}destroy(){Kc.removeItem(this.id)}}class ja{constructor(a,b,c,d,f,e){this._gl=a;this.type=b;this.allocated=!1;switch(c.constructor){case Uint8Array:this.itemType=a.UNSIGNED_BYTE;this.itemByteSize=1;break;case Int8Array:this.itemType=a.BYTE;this.itemByteSize=1;break;case Uint16Array:this.itemType=a.UNSIGNED_SHORT;this.itemByteSize=
2;break;case Int16Array:this.itemType=a.SHORT;this.itemByteSize=2;break;case Uint32Array:this.itemType=a.UNSIGNED_INT;this.itemByteSize=4;break;case Int32Array:this.itemType=a.INT;this.itemByteSize=4;break;default:this.itemType=a.FLOAT,this.itemByteSize=4}this.usage=e;this.numItems=this.length=0;this.itemSize=f;this._allocate(c)}_allocate(a){this.allocated=!1;this._handle=this._gl.createBuffer();if(!this._handle)throw"Failed to allocate WebGL ArrayBuffer";this._handle&&(this._gl.bindBuffer(this.type,
this._handle),this._gl.bufferData(this.type,a,this.usage),this._gl.bindBuffer(this.type,null),this.length=a.length,this.numItems=this.length/this.itemSize,this.allocated=!0)}setData(a,b){this.allocated&&(a.length>this.length?(this.destroy(),this._allocate(a,a.length)):(this._gl.bindBuffer(this.type,this._handle),b||0===b?this._gl.bufferSubData(this.type,b*this.itemByteSize,a):this._gl.bufferData(this.type,a,this.usage),this._gl.bindBuffer(this.type,null)))}bind(){this.allocated&&this._gl.bindBuffer(this.type,
this._handle)}unbind(){this.allocated&&this._gl.bindBuffer(this.type,null)}destroy(){this.allocated&&(this._gl.deleteBuffer(this._handle),this._handle=null,this.allocated=!1)}}const Mc=Lc?Number.MAX_SAFE_INTEGER/6:256E3,Aa=P.memory;var Lc=Y.SUPPORTED_EXTENSIONS.OES_element_index_uint;const Nd=new da({});class Od{constructor(a,b,c,d,f,e){this.scene=a;this.gl=a.canvas.gl;this.contextLost=!1;this.geometries={};this.geometryIndicesOffsets={};this.newGeometries=[];this.geometryVertexBufs={};this.needAppend=
this.needRebuild=!1;this.positions=b?[]:null;this.normals=c?[]:null;this.colors=d?[]:null;this.uv=f?[]:null;this.quantized=e;this.vertexBufs=null}addGeometry(a){a.positions&&a.indices?(this.geometries[a.id]=a,this.geometryIndicesOffsets[a.id]=0,this.newGeometries.push(a),this.needAppend=!0):this.scene.warn(`Ignoring geometry with no positions or indices: ${a.id}`)}getIndicesOffset(a){(this.needRebuild||this.needAppend)&&this.build();return this.geometryIndicesOffsets[a.id]}getVertexBufs(a){if(!this.geometries[a.id])return Nd;
(this.needRebuild||this.needAppend)&&this.build();return this.geometryVertexBufs[a.id]}setPositions(a){var b=this.geometryVertexBufs[a.id];b&&a.positions&&(b=b.positionsBuf)&&b.setData(a.positions,3*this.geometryIndicesOffsets[a.id])}setNormals(a){var b=this.geometryVertexBufs[a.id];b&&a.normals&&(b=b.normalsBuf)&&b.setData(a.normals,3*this.geometryIndicesOffsets[a.id])}setUVs(a){var b=this.geometryVertexBufs[a.id];b&&a.uv&&(b=b.uvBuf)&&b.setData(a.uv,2*this.geometryIndicesOffsets[a.id])}setColors(a){var b=
this.geometryVertexBufs[a.id];b&&a.color&&(b=b.colorsBuf)&&b.setData(a.colors,4*this.geometryIndicesOffsets[a.id])}removeGeometry(a){const b=a.id;this.geometries[b]&&(delete this.geometries[b],delete this.geometryIndicesOffsets[b],a.indicesBufCombined&&a.indicesBufCombined.destroy(),this.needRebuild=!0)}webglContextLost(){this.contextLost=!0}webglContextRestored(){if(this.contextLost){for(const a in this.geometries)this.geometries.hasOwnProperty(a)&&(this.geometries[a].indicesBufCombined=null);this.build();
this.contextLost=!1}}build(){const a=this.scene.canvas.gl;this.geometryVertexBufs={};let b,c,d=0;this.vertexBufs=null;for(b in this.geometries)this.geometries.hasOwnProperty(b);for(b in this.geometries)if(this.geometries.hasOwnProperty(b)){c=this.geometries[b];if(!this.vertexBufs||this.positions.length+c.positions.length>Mc)this.vertexBufs&&this.createBufs(this.vertexBufs),this.vertexBufs=new da({positionsBuf:null,normalsBuf:null,uvBuf:null,colorsBuf:null,quantized:this.quantized}),d=0;this.geometryVertexBufs[b]=
this.vertexBufs;if(this.positions)for(var f=0,e=c.positions.length;f<e;f++)this.positions.push(c.positions[f]);if(this.normals)for(f=0,e=c.normals.length;f<e;f++)this.normals.push(c.normals[f]);if(this.colors)for(f=0,e=c.colors.length;f<e;f++)this.colors.push(c.colors[f]);if(this.uv)for(f=0,e=c.uv.length;f<e;f++)this.uv.push(c.uv[f]);this.geometryIndicesOffsets[b]=d;let g;if(d)for(g=new (Lc?Uint32Array:Uint16Array)(c.indices),f=0,e=g.length;f<e;f++)g[f]+=d,g[f]>Mc/3&&console.error(`out of range: ${g[f]}`);
else g=c.indices;c.indicesBufCombined?c.indicesBufCombined.setData(g):c.indicesBufCombined=new ja(a,a.ELEMENT_ARRAY_BUFFER,g,g.length,1,a.STATIC_DRAW);d+=c.positions.length/3}this.vertexBufs&&this.createBufs(this.vertexBufs);this.needAppend=this.needRebuild=!1}createBufs(a){const b=this.scene.canvas.gl;let c;this.positions&&(c=this.quantized?new Uint16Array(this.positions):new Float32Array(this.positions),a.positionsBuf=new ja(b,b.ARRAY_BUFFER,c,c.length,3,b.STATIC_DRAW),Aa.positions+=a.positionsBuf.numItems,
this.positions=[]);this.normals&&(c=this.quantized?new Int8Array(this.normals):new Float32Array(this.normals),a.normalsBuf=new ja(b,b.ARRAY_BUFFER,c,c.length,3,b.STATIC_DRAW),Aa.normals+=a.normalsBuf.numItems,this.normals=[]);this.colors&&(c=new Float32Array(this.colors),a.colorsBuf=new ja(b,b.ARRAY_BUFFER,c,c.length,4,b.STATIC_DRAW),Aa.colors+=a.colorsBuf.numItems,this.colors=[]);this.uv&&(c=this.quantized?new Uint16Array(this.uv):new Float32Array(this.uv),a.uvBuf=new ja(b,b.ARRAY_BUFFER,c,c.length,
2,b.STATIC_DRAW),Aa.uvs+=a.uvBuf.numItems,this.uv=[])}}const ia=P.memory;var Nc=Y.SUPPORTED_EXTENSIONS.OES_element_index_uint;const Pd=Nc?Uint32Array:Uint16Array,Qd=new da({}),Oc=l.AABB3();class ua extends Z{get type(){return"xeogl.Geometry"}init(a){super.init(a);this._state=new da({combined:!!a.combined,quantized:!!a.quantized,autoVertexNormals:!!a.autoVertexNormals,primitive:null,primitiveName:null,positions:null,normals:null,colors:null,uv:null,indices:null,positionsDecodeMatrix:null,uvDecodeMatrix:null,
positionsBuf:null,normalsBuf:null,colorsbuf:null,uvBuf:null,indicesBuf:null,indicesBufCombined:null,hash:""});this._edgeThreshold=a.edgeThreshold||2;this._pickTriangleColorsBuf=this._pickTrianglePositionsBuf=this._edgesIndicesBuf=null;this._boundaryDirty=!0;this._aabb=null;this._aabbDirty=!0;this._obb=null;this._obbDirty=!0;var b=this._state,c=this.scene.canvas.gl;a.primitive=a.primitive||"triangles";switch(a.primitive){case "points":b.primitive=c.POINTS;b.primitiveName=a.primitive;break;case "lines":b.primitive=
c.LINES;b.primitiveName=a.primitive;break;case "line-loop":b.primitive=c.LINE_LOOP;b.primitiveName=a.primitive;break;case "line-strip":b.primitive=c.LINE_STRIP;b.primitiveName=a.primitive;break;case "triangles":b.primitive=c.TRIANGLES;b.primitiveName=a.primitive;break;case "triangle-strip":b.primitive=c.TRIANGLE_STRIP;b.primitiveName=a.primitive;break;case "triangle-fan":b.primitive=c.TRIANGLE_FAN;b.primitiveName=a.primitive;break;default:this.error("Unsupported value for 'primitive': '"+a.primitive+
"' - supported values are 'points', 'lines', 'line-loop', 'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'. Defaulting to 'triangles'."),b.primitive=c.TRIANGLES,b.primitiveName=a.primitive}if(a.positions)if(this._state.quantized){var d=Fa(a.positions,3);d=Pc(a.positions,d.min,d.max);b.positions=d.quantized;b.positionsDecodeMatrix=d.decode}else b.positions=a.positions.constructor===Float32Array?a.positions:new Float32Array(a.positions);a.colors&&(b.colors=a.colors.constructor===Float32Array?
a.colors:new Float32Array(a.colors));a.uv&&(this._state.quantized?(d=Fa(a.uv,2),d=Rd(a.uv,d.min,d.max),b.uv=d.quantized,b.uvDecodeMatrix=d.decode):b.uv=a.uv.constructor===Float32Array?a.uv:new Float32Array(a.uv));if(a.normals)if(this._state.quantized){d=a.normals;var f=new Int8Array(2*d.length/3),e;let n,p;for(p=n=0;n<d.length;n+=3,p+=2){var g=e=ib(d,n,"floor","floor");var h=jb(e);var m=kb(d,n,h);e=ib(d,n,"ceil","floor");h=jb(e);h=kb(d,n,h);h>m&&(g=e,m=h);e=ib(d,n,"floor","ceil");h=jb(e);h=kb(d,n,
h);h>m&&(g=e,m=h);e=ib(d,n,"ceil","ceil");h=jb(e);h=kb(d,n,h);h>m&&(g=e);f[p]=g[0];f[p+1]=g[1]}b.normals=f}else b.normals=a.normals.constructor===Float32Array?a.normals:new Float32Array(a.normals);if(a.indices){if(!Nc&&a.indices.constructor===Uint32Array){this.error("This WebGL implementation does not support Uint32Array");return}b.indices=a.indices.constructor===Uint32Array||a.indices.constructor===Uint16Array?a.indices:new Pd(a.indices)}b.indices&&(b.indicesBuf=new ja(c,c.ELEMENT_ARRAY_BUFFER,b.indices,
b.indices.length,1,c.STATIC_DRAW),ia.indices+=b.indicesBuf.numItems);this._buildHash();ia.meshes++;this._state.combined&&(a=this.scene,e=this._state,b=!!e.positions,c=!!e.quantized,d=!!e.normals,f=!!e.colors,e=!!e.uv,g=[a.id,b?"p":"",c?"c":"",d?"n":"",f?"c":"",e?"u":""].join(";"),a._sceneVertexBufs||(a._sceneVertexBufs={}),m=a._sceneVertexBufs[g],m||(m=new Od(a,b,d,f,e,c),a._sceneVertexBufs[g]=m),this._sceneVertexBufs=m,this._sceneVertexBufs.addGeometry(this._state));this._buildVBOs();this.fire("created",
this.created=!0)}_buildVBOs(){const a=this._state,b=this.scene.canvas.gl;a.indices&&(a.indicesBuf=new ja(b,b.ELEMENT_ARRAY_BUFFER,a.indices,a.indices.length,1,b.STATIC_DRAW),ia.indices+=a.indicesBuf.numItems);a.combined||(a.positions&&(a.positionsBuf=new ja(b,b.ARRAY_BUFFER,a.positions,a.positions.length,3,b.STATIC_DRAW),ia.positions+=a.positionsBuf.numItems),a.normals&&(a.normalsBuf=new ja(b,b.ARRAY_BUFFER,a.normals,a.normals.length,3,b.STATIC_DRAW),ia.normals+=a.normalsBuf.numItems),a.colors&&(a.colorsBuf=
new ja(b,b.ARRAY_BUFFER,a.colors,a.colors.length,4,b.STATIC_DRAW),ia.colors+=a.colorsBuf.numItems),a.uv&&(a.uvBuf=new ja(b,b.ARRAY_BUFFER,a.uv,a.uv.length,2,b.STATIC_DRAW),ia.uvs+=a.uvBuf.numItems))}_buildHash(){const a=this._state,b=["/g"];b.push("/"+a.primitive+";");a.positions&&b.push("p");a.colors&&b.push("c");(a.normals||a.autoVertexNormals)&&b.push("n");a.uv&&b.push("u");a.quantized&&b.push("cp");b.push(";");a.hash=b.join("")}_getEdgesIndices(){this._edgesIndicesBuf||this._buildEdgesIndices();
return this._edgesIndicesBuf}_getPickTrianglePositions(){this._pickTrianglePositionsBuf||this._buildPickTriangleVBOs();return this._pickTrianglePositionsBuf}_getPickTriangleColors(){this._pickTriangleColorsBuf||this._buildPickTriangleVBOs();return this._pickTriangleColorsBuf}_buildEdgesIndices(){var a=this._state;if(a.positions&&a.indices){var b=this.scene.canvas.gl,c=Sd(a.positions,a.indices,a.positionsDecodeMatrix,this._edgeThreshold,a.combined);if(a.combined){a=this._sceneVertexBufs.getIndicesOffset(a);
for(let d=0,f=c.length;d<f;d++)c[d]+=a}this._edgesIndicesBuf=new ja(b,b.ELEMENT_ARRAY_BUFFER,c,c.length,1,b.STATIC_DRAW);ia.indices+=this._edgesIndicesBuf.numItems}}_buildPickTriangleVBOs(){var a=this._state;if(a.positions&&a.indices){var b=this.scene.canvas.gl,c=l.buildPickTriangles(a.positions,a.indices,a.quantized);a=c.positions;c=c.colors;this._pickTrianglePositionsBuf=new ja(b,b.ARRAY_BUFFER,a,a.length,3,b.STATIC_DRAW);this._pickTriangleColorsBuf=new ja(b,b.ARRAY_BUFFER,c,c.length,4,b.STATIC_DRAW,
!0);ia.positions+=this._pickTrianglePositionsBuf.numItems;ia.colors+=this._pickTriangleColorsBuf.numItems}}_buildPickVertexVBOs(){}_webglContextLost(){this._sceneVertexBufs&&this._sceneVertexBufs.webglContextLost()}_webglContextRestored(){this._sceneVertexBufs&&this._sceneVertexBufs.webglContextRestored();this._buildVBOs();this._pickVertexColorsBuf=this._pickVertexPositionsBuf=this._pickTriangleColorsBuf=this._pickTrianglePositionsBuf=this._edgesIndicesBuf=null}get primitive(){return this._state.primitiveName}get quantized(){return this._state.quantized}get combined(){return this._state.combined}get positions(){if(this._state.positions){if(!this._state.quantized)return this._state.positions;
this._decompressedPositions||(this._decompressedPositions=new Float32Array(this._state.positions.length),l.decompressPositions(this._state.positions,this._state.positionsDecodeMatrix,this._decompressedPositions));return this._decompressedPositions}}set positions(a){const b=this._state,c=b.positions;if(c)if(c.length!==a.length)this.error("can't update geometry positions - new positions are wrong length");else{if(this._state.quantized){var d=Fa(a,3);d=Pc(a,d.min,d.max);a=d.quantized;b.positionsDecodeMatrix=
d.decode}c.set(a);b.positionsBuf&&b.positionsBuf.setData(c);this._state.combined&&this._sceneVertexBufs.setPositions(b);this._setBoundaryDirty();this._renderer.imageDirty()}else this.error("can't update geometry positions - geometry has no positions")}get normals(){if(this._state.normals){if(!this._state.quantized)return this._state.normals;if(!this._decompressedNormals){const a=this._state.normals.length;this._decompressedNormals=new Float32Array(a+a/2);l.octDecodeVec2s(this._state.normals,this._decompressedNormals)}return this._decompressedNormals}}set normals(a){if(this._state.quantized)this.error("can't update geometry normals - quantized geometry is immutable");
else{var b=this._state,c=b.normals;c?c.length!==a.length?this.error("can't update geometry normals - new normals are wrong length"):(c.set(a),b.normalsBuf&&b.normalsBuf.setData(c),this._state.combined&&this._sceneVertexBufs.setNormals(b),this._renderer.imageDirty()):this.error("can't update geometry normals - geometry has no normals")}}get uv(){if(this._state.uv){if(!this._state.quantized)return this._state.uv;this._decompressedUV||(this._decompressedUV=new Float32Array(this._state.uv.length),l.decompressUVs(this._state.uv,
this._state.uvDecodeMatrix,this._decompressedUV));return this._decompressedUV}}set uv(a){if(this._state.quantized)this.error("can't update geometry UVs - quantized geometry is immutable");else{var b=this._state,c=b.uv;c?c.length!==a.length?this.error("can't update geometry UVs - new UVs are wrong length"):(c.set(a),b.uvBuf&&b.uvBuf.setData(c),this._state.combined&&this._sceneVertexBufs.setUVs(b),this._renderer.imageDirty()):this.error("can't update geometry UVs - geometry has no UVs")}}get colors(){return this._state.colors}set colors(a){if(this._state.quantized)this.error("can't update geometry colors - quantized geometry is immutable");
else{var b=this._state,c=b.colors;c?c.length!==a.length?this.error("can't update geometry colors - new colors are wrong length"):(c.set(a),b.colorsBuf&&b.colorsBuf.setData(c),this._state.combined&&this._sceneVertexBufs.setColors(b),this._renderer.imageDirty()):this.error("can't update geometry colors - geometry has no colors")}}get indices(){return this._state.indices}get aabb(){this._aabbDirty&&(this._aabb||(this._aabb=l.AABB3()),l.positions3ToAABB3(this._state.positions,this._aabb,this._state.positionsDecodeMatrix),
this._aabbDirty=!1);return this._aabb}get obb(){this._obbDirty&&(this._obb||(this._obb=l.OBB3()),l.positions3ToAABB3(this._state.positions,Oc,this._state.positionsDecodeMatrix),l.AABB3ToOBB3(Oc,this._obb),this._obbDirty=!1);return this._obb}get kdtree(){const a=this._state;if(a.indices&&a.positions)return this._kdtree||(this._kdtree=l.buildKDTree(a.indices,a.positions,this._state.positionsDecodeMatrix)),this._kdtree;this.error("Can't provide a KD-tree: no indices/positions")}_setBoundaryDirty(){this._boundaryDirty||
(this._obbDirty=this._aabbDirty=this._boundaryDirty=!0,this.fire("boundary"))}_getState(){return this._state}_getVertexBufs(){return this._state&&this._state.combined?this._sceneVertexBufs.getVertexBufs(this._state):Qd}destroy(){super.destroy();const a=this._state;a.indicesBuf&&a.indicesBuf.destroy();this._edgesIndicesBuf&&this._edgesIndicesBuf.destroy();this._pickTrianglePositionsBuf&&this._pickTrianglePositionsBuf.destroy();this._pickTriangleColorsBuf&&this._pickTriangleColorsBuf.destroy();this._pickVertexPositionsBuf&&
this._pickVertexPositionsBuf.destroy();this._pickVertexColorsBuf&&this._pickVertexColorsBuf.destroy();this._state.combined&&this._sceneVertexBufs.removeGeometry(a);a.destroy();ia.meshes--}}var Pc=function(){const a=l.mat4(),b=l.mat4();return function(c,d,f){const e=new Uint16Array(c.length),g=new Float32Array([65535/(f[0]-d[0]),65535/(f[1]-d[1]),65535/(f[2]-d[2])]);let h;for(h=0;h<c.length;h+=3)e[h+0]=Math.floor((c[h+0]-d[0])*g[0]),e[h+1]=Math.floor((c[h+1]-d[1])*g[1]),e[h+2]=Math.floor((c[h+2]-d[2])*
g[2]);l.identityMat4(a);l.translationMat4v(d,a);l.identityMat4(b);l.scalingMat4v([(f[0]-d[0])/65535,(f[1]-d[1])/65535,(f[2]-d[2])/65535],b);c=l.mulMat4(a,b,l.identityMat4());return{quantized:e,decode:c}}}(),Rd=function(){const a=l.mat3(),b=l.mat3();return function(c,d,f){const e=new Uint16Array(c.length),g=new Float32Array([65535/(f[0]-d[0]),65535/(f[1]-d[1])]);let h;for(h=0;h<c.length;h+=2)e[h+0]=Math.floor((c[h+0]-d[0])*g[0]),e[h+1]=Math.floor((c[h+1]-d[1])*g[1]);l.identityMat3(a);l.translationMat3v(d,
a);l.identityMat3(b);l.scalingMat3v([(f[0]-d[0])/65535,(f[1]-d[1])/65535],b);c=l.mulMat3(a,b,l.identityMat3());return{quantized:e,decode:c}}}(),Sd=function(){const a=[],b=[],c=[],d=[],f=[];let e=0;const g=new Uint16Array(3),h=new Uint16Array(3),m=new Uint16Array(3),n=l.vec3(),p=l.vec3(),r=l.vec3(),q=l.vec3(),k=l.vec3(),t=l.vec3(),w=l.vec3();return function(u,z,x,B,C){var D={};let F;const K=Math.pow(10,4);let J,X,R=0;J=0;for(X=u.length;J<X;J+=3){var Q=u[J];var W=u[J+1];var L=u[J+2];F=Math.round(Q*
K)+"_"+Math.round(W*K)+"_"+Math.round(L*K);void 0===D[F]&&(D[F]=R/3,a[R++]=Q,a[R++]=W,a[R++]=L);b[J/3]=D[F]}J=0;for(X=z.length;J<X;J++)d[J]=b[z[J]],c[d[J]]=z[J];u=z.length;e=0;for(let A=0,E=u;A<E;A+=3)u=3*d[A],D=3*d[A+1],Q=3*d[A+2],x?(g[0]=a[u],g[1]=a[u+1],g[2]=a[u+2],h[0]=a[D],h[1]=a[D+1],h[2]=a[D+2],m[0]=a[Q],m[1]=a[Q+1],m[2]=a[Q+2],l.decompressPosition(g,x,n),l.decompressPosition(h,x,p),l.decompressPosition(m,x,r)):(n[0]=a[u],n[1]=a[u+1],n[2]=a[u+2],p[0]=a[D],p[1]=a[D+1],p[2]=a[D+2],r[0]=a[Q],
r[1]=a[Q+1],r[2]=a[Q+2]),l.subVec3(r,p,q),l.subVec3(n,p,k),l.cross3Vec3(q,k,t),l.normalizeVec3(t,w),u=f[e]||(f[e]={normal:l.vec3()}),u.normal[0]=w[0],u.normal[1]=w[1],u.normal[2]=w[2],e++;x=[];B=Math.cos(l.DEGTORAD*B);u={};D=!1;for(let A=0,E=z.length;A<E;A+=3)for(Q=A/3,W=0;3>W;W++){var ca=d[A+W];L=d[A+(W+1)%3];z=Math.min(ca,L);L=Math.max(ca,L);ca=z+","+L;void 0===u[ca]?u[ca]={index1:z,index2:L,face1:Q,face2:void 0}:u[ca].face2=Q}for(ca in u){z=u[ca];if(void 0!==z.face2&&(Q=f[z.face1].normal,W=f[z.face2].normal,
Q=l.dotVec3(Q,W),Q>B))continue;Q=c[z.index1];z=c[z.index2];if(!D&&65535<Q||65535<z)D=!0;x.push(Q);x.push(z)}return D||C?new Uint32Array(x):new Uint16Array(x)}}();M["xeogl.Geometry"]=ua;class Xa extends ua{get type(){return"xeogl.AABBGeometry"}init(a){super.init(G.apply(a,{combined:!0,quantized:!0,primitive:a.primitive||"lines",indices:[0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7],positions:a.positions||[1,1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1]}));a.target?this.target=a.target:
a.targetAABB&&(this.targetAABB=a.targetAABB)}set target(a){let b=!1;const c=this;this._attach({name:"target",type:"xeogl.Component",component:a,sceneDefault:!1,on:{boundary:function(){b||(b=!0,za.scheduleTask(function(){c._setPositionsFromAABB(c._attached.target.aabb);b=!1}))}},onAttached:function(){c._setPositionsFromAABB(c._attached.target.aabb)}})}get target(){return this._attached.target}set targetAABB(a){a&&(this._attached.target&&(this.target=null),this._setPositionsFromAABB(a))}_setPositionsFromAABB(a){this.positions=
[a[3],a[4],a[5],a[3],a[1],a[5],a[0],a[1],a[5],a[0],a[4],a[5],a[3],a[4],a[2],a[3],a[1],a[2],a[0],a[1],a[2],a[0],a[4],a[2]]}}M["xeogl.AABBGeometry"]=Xa;class va extends Z{get type(){return"xeogl.Material"}init(a){super.init(a);P.memory.materials++}destroy(){super.destroy();P.memory.materials--}}M["xeogl.Material"]=va;const Td={opaque:0,mask:1,blend:2},Ud=["opaque","mask","blend"];class Oa extends va{get type(){return"xeogl.PhongMaterial"}init(a){super.init(a);this._state=new da({type:"PhongMaterial",
ambient:l.vec3([1,1,1]),diffuse:l.vec3([1,1,1]),specular:l.vec3([1,1,1]),emissive:l.vec3([0,0,0]),alpha:null,shininess:null,reflectivity:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null});this.ambient=a.ambient;this.diffuse=a.diffuse;this.specular=a.specular;this.emissive=a.emissive;this.alpha=a.alpha;this.shininess=a.shininess;this.reflectivity=a.reflectivity;this.lineWidth=a.lineWidth;this.pointSize=a.pointSize;a.ambientMap&&(this._ambientMap=
this._checkComponent("xeogl.Texture",a.ambientMap));a.diffuseMap&&(this._diffuseMap=this._checkComponent("xeogl.Texture",a.diffuseMap));a.specularMap&&(this._specularMap=this._checkComponent("xeogl.Texture",a.specularMap));a.emissiveMap&&(this._emissiveMap=this._checkComponent("xeogl.Texture",a.emissiveMap));a.alphaMap&&(this._alphaMap=this._checkComponent("xeogl.Texture",a.alphaMap));a.reflectivityMap&&(this._reflectivityMap=this._checkComponent("xeogl.Texture",a.reflectivityMap));a.normalMap&&(this._normalMap=
this._checkComponent("xeogl.Texture",a.normalMap));a.occlusionMap&&(this._occlusionMap=this._checkComponent("xeogl.Texture",a.occlusionMap));a.diffuseFresnel&&(this._diffuseFresnel=this._checkComponent("xeogl.Fresnel",a.diffuseFresnel));a.specularFresnel&&(this._specularFresnel=this._checkComponent("xeogl.Fresnel",a.specularFresnel));a.emissiveFresnel&&(this._emissiveFresnel=this._checkComponent("xeogl.Fresnel",a.emissiveFresnel));a.alphaFresnel&&(this._alphaFresnel=this._checkComponent("xeogl.Fresnel",
a.alphaFresnel));a.reflectivityFresnel&&(this._reflectivityFresnel=this._checkComponent("xeogl.Fresnel",a.reflectivityFresnel));this.alphaMode=a.alphaMode;this.alphaCutoff=a.alphaCutoff;this.backfaces=a.backfaces;this.frontface=a.frontface;this._makeHash()}_makeHash(){const a=this._state,b=["/p"];this._normalMap&&(b.push("/nm"),this._normalMap.hasMatrix&&b.push("/mat"));this._ambientMap&&(b.push("/am"),this._ambientMap.hasMatrix&&b.push("/mat"),b.push("/"+this._ambientMap.encoding));this._diffuseMap&&
(b.push("/dm"),this._diffuseMap.hasMatrix&&b.push("/mat"),b.push("/"+this._diffuseMap.encoding));this._specularMap&&(b.push("/sm"),this._specularMap.hasMatrix&&b.push("/mat"));this._emissiveMap&&(b.push("/em"),this._emissiveMap.hasMatrix&&b.push("/mat"),b.push("/"+this._emissiveMap.encoding));this._alphaMap&&(b.push("/opm"),this._alphaMap.hasMatrix&&b.push("/mat"));this._reflectivityMap&&(b.push("/rm"),this._reflectivityMap.hasMatrix&&b.push("/mat"));this._occlusionMap&&(b.push("/ocm"),this._occlusionMap.hasMatrix&&
b.push("/mat"));this._diffuseFresnel&&b.push("/df");this._specularFresnel&&b.push("/sf");this._emissiveFresnel&&b.push("/ef");this._alphaFresnel&&b.push("/of");this._reflectivityFresnel&&b.push("/rf");b.push(";");a.hash=b.join("")}set ambient(a){let b=this._state.ambient;if(!b)b=this._state.ambient=new Float32Array(3);else if(a&&b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2])return;a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):(b[0]=.2,b[1]=.2,b[2]=.2);this._renderer.imageDirty()}get ambient(){return this._state.ambient}set diffuse(a){let b=
this._state.diffuse;if(!b)b=this._state.diffuse=new Float32Array(3);else if(a&&b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2])return;a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):(b[0]=1,b[1]=1,b[2]=1);this._renderer.imageDirty()}get diffuse(){return this._state.diffuse}set specular(a){let b=this._state.specular;if(!b)b=this._state.specular=new Float32Array(3);else if(a&&b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2])return;a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):(b[0]=1,b[1]=1,b[2]=1);this._renderer.imageDirty()}get specular(){return this._state.specular}set emissive(a){let b=
this._state.emissive;if(!b)b=this._state.emissive=new Float32Array(3);else if(a&&b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2])return;a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):(b[0]=0,b[1]=0,b[2]=0);this._renderer.imageDirty()}get emissive(){return this._state.emissive}set alpha(a){a=void 0!==a&&null!==a?a:1;this._state.alpha!==a&&(this._state.alpha=a,this._renderer.imageDirty())}get alpha(){return this._state.alpha}set shininess(a){this._state.shininess=void 0!==a?a:80;this._renderer.imageDirty()}get shininess(){return this._state.shininess}set lineWidth(a){this._state.lineWidth=
a||1;this._renderer.imageDirty()}get lineWidth(){return this._state.lineWidth}set pointSize(a){this._state.pointSize=a||1;this._renderer.imageDirty()}get pointSize(){return this._state.pointSize}set reflectivity(a){this._state.reflectivity=void 0!==a?a:1;this._renderer.imageDirty()}get reflectivity(){return this._state.reflectivity}get normalMap(){return this._normalMap}get ambientMap(){return this._ambientMap}get diffuseMap(){return this._diffuseMap}get specularMap(){return this._specularMap}get emissiveMap(){return this._emissiveMap}get alphaMap(){return this._alphaMap}get reflectivityMap(){return this._reflectivityMap}get occlusionMap(){return this._occlusionMap}get diffuseFresnel(){return this._diffuseFresnel}get specularFresnel(){return this._specularFresnel}get emissiveFresnel(){return this._emissiveFresnel}get alphaFresnel(){return this._alphaFresnel}get reflectivityFresnel(){return this._reflectivityFresnel}set alphaMode(a){a=
a||"opaque";let b=Td[a];void 0===b&&(this.error("Unsupported value for 'alphaMode': "+a+" - defaulting to 'opaque'"),b="opaque");this._state.alphaMode!==b&&(this._state.alphaMode=b,this._renderer.imageDirty())}get alphaMode(){return Ud[this._state.alphaMode]}set alphaCutoff(a){if(null===a||void 0===a)a=.5;this._state.alphaCutoff!==a&&(this._state.alphaCutoff=a)}get alphaCutoff(){return this._state.alphaCutoff}set backfaces(a){a=!!a;this._state.backfaces!==a&&(this._state.backfaces=a,this._renderer.imageDirty())}get backfaces(){return this._state.backfaces}set frontface(a){a=
"cw"!==a;this._state.frontface!==a&&(this._state.frontface=a,this._renderer.imageDirty())}get frontface(){return this._state.frontface?"ccw":"cw"}destroy(){super.destroy();this._state.destroy()}}M["xeogl.PhongMaterial"]=Oa;const ra=new Float32Array(4),Ya=new Float32Array(4),Qc=new Float32Array(4),Rc=new Float32Array([1,0,0]),Sc=new Float32Array([0,1,0]),Tc=new Float32Array([0,0,1]),Uc=new Float32Array(3),Vc=new Float32Array(3),Vd=l.identityMat4();class rb extends Z{get type(){return"xeogl.Object"}init(a){super.init(a);
this._guid=a.guid;this._parent=null;this._childList=[];this._childMap={};this._aabb=this._childIDs=null;this._aabbDirty=!0;this.scene._aabbDirty=!0;this._scale=l.vec3();this._quaternion=l.identityQuaternion();this._rotation=l.vec3();this._position=l.vec3();this._worldMatrix=l.identityMat4();this._worldNormalMatrix=l.identityMat4();this._worldNormalMatrixDirty=this._worldMatrixDirty=this._localMatrixDirty=!0;a.matrix?this.matrix=a.matrix:(this.scale=a.scale,this.position=a.position,a.quaternion||(this.rotation=
a.rotation));a.entityType&&(this._entityType=a.entityType,this.scene._entityTypeAssigned(this,this._entityType));this.visible=a.visible;this.culled=a.culled;this.pickable=a.pickable;this.clippable=a.clippable;this.collidable=a.collidable;this.castShadow=a.castShadow;this.receiveShadow=a.receiveShadow;this.outlined=a.outlined;this.solid=a.solid;this.ghosted=a.ghosted;this.highlighted=a.highlighted;this.selected=a.selected;this.edges=a.edges;this.aabbVisible=a.aabbVisible;this.layer=a.layer;this.colorize=
a.colorize;this.opacity=a.opacity;if(a.children){const b=a.children;for(let c=0,d=b.length;c<d;c++)this.addChild(b[c],a.inheritStates)}a.parent&&a.parent.addChild(this);this.scene._objectCreated(this)}_setLocalMatrixDirty(){this._localMatrixDirty=!0;this._setWorldMatrixDirty()}_setWorldMatrixDirty(){this._worldNormalMatrixDirty=this._worldMatrixDirty=!0;if(this._childList)for(let a=0,b=this._childList.length;a<b;a++)this._childList[a]._setWorldMatrixDirty()}_buildWorldMatrix(){const a=this.matrix;
if(this._parent)l.mulMat4(this._parent.worldMatrix,a,this._worldMatrix);else for(let b=0,c=a.length;b<c;b++)this._worldMatrix[b]=a[b];this._worldMatrixDirty=!1}_buildWorldNormalMatrix(){this._worldMatrixDirty&&this._buildWorldMatrix();this._worldNormalMatrix||(this._worldNormalMatrix=l.mat4());l.inverseMat4(this._worldMatrix,this._worldNormalMatrix);l.transposeMat4(this._worldNormalMatrix);this._worldNormalMatrixDirty=!1}_setSubtreeAABBsDirty(a){a._aabbDirty=!0;a.fire("boundary",!0);if(a._childList)for(let b=
0,c=a._childList.length;b<c;b++)this._setSubtreeAABBsDirty(a._childList[b])}_setAABBDirty(){this._setSubtreeAABBsDirty(this);if(this.collidable)for(let a=this;a;a=a._parent)a._aabbDirty=!0,a.fire("boundary",!0)}_updateAABB(){this.scene._aabbDirty=!0;this._aabb||(this._aabb=l.AABB3());if(this._buildMeshAABB)this._buildMeshAABB(this.worldMatrix,this._aabb);else{l.collapseAABB3(this._aabb);let a;for(let b=0,c=this._childList.length;b<c;b++)a=this._childList[b],a.collidable&&l.expandAABB3(this._aabb,
a.aabb)}this._aabbCenter||(this._aabbCenter=new Float32Array(3));l.getAABB3Center(this._aabb,this._aabbCenter);this._aabbDirty=!1}addChild(a,b){if(G.isNumeric(a)||G.isString(a)){const c=a;a=this.scene.objects[c];if(!a){this.warn("Object not found: "+G.inQuotes(c));return}}else{if(G.isObject(a))throw"addChild( * ) not implemented";if(!a.isType("xeogl.Object")){this.error("Not a xeogl.Object: "+a.id);return}if(a._parent){if(a._parent.id===this.id){this.warn("Already a child object: "+a.id);return}a._parent.removeChild(a)}}if(a.scene.id!==
this.scene.id)this.error("Object not in same Scene: "+a.id);else return delete this.scene.rootObjects[a.id],this._childList.push(a),this._childMap[a.id]=a,this._childIDs=null,a._parent=this,b&&(a.visible=this.visible,a.culled=this.culled,a.ghosted=this.ghosted,a.highlited=this.highlighted,a.selected=this.selected,a.edges=this.edges,a.outlined=this.outlined,a.clippable=this.clippable,a.pickable=this.pickable,a.collidable=this.collidable,a.castShadow=this.castShadow,a.receiveShadow=this.receiveShadow,
a.colorize=this.colorize,a.opacity=this.opacity),a._setWorldMatrixDirty(),a._setAABBDirty(),a}removeChild(a){for(let b=0,c=this._childList.length;b<c;b++)if(this._childList[b].id===a.id){a._parent=null;this._childList=this._childList.splice(b,1);delete this._childMap[a.id];this._childIDs=null;this.scene.rootObjects[a.id]=a;a._setWorldMatrixDirty();a._setAABBDirty();this._setAABBDirty();break}}removeChildren(){let a;for(let b=0,c=this._childList.length;b<c;b++)a=this._childList[b],a._parent=null,this.scene.rootObjects[a.id]=
a,a._setWorldMatrixDirty(),a._setAABBDirty();this._childList=[];this._childMap={};this._childIDs=null;this._setAABBDirty()}rotate(a,b){ra[0]=a[0];ra[1]=a[1];ra[2]=a[2];ra[3]=b*l.DEGTORAD;l.angleAxisToQuaternion(ra,Ya);l.mulQuaternions(this.quaternion,Ya,Qc);this.quaternion=Qc;this._setLocalMatrixDirty();this._setAABBDirty();this._renderer.imageDirty();return this}rotateOnWorldAxis(a,b){ra[0]=a[0];ra[1]=a[1];ra[2]=a[2];ra[3]=b*l.DEGTORAD;l.angleAxisToQuaternion(ra,Ya);l.mulQuaternions(Ya,this.quaternion,
Ya);return this}rotateX(a){return this.rotate(Rc,a)}rotateY(a){return this.rotate(Sc,a)}rotateZ(a){return this.rotate(Tc,a)}translate(a,b){l.vec3ApplyQuaternion(this.quaternion,a,Uc);l.mulVec3Scalar(Uc,b,Vc);l.addVec3(this.position,Vc,this.position);this._setLocalMatrixDirty();this._setAABBDirty();this._renderer.imageDirty();return this}translateX(a){return this.translate(Rc,a)}translateY(a){return this.translate(Sc,a)}translateZ(a){return this.translate(Tc,a)}get guid(){return this._guid}get entityType(){return this._entityType}get numChildren(){return this._childList.length}get children(){return this._childList}get childMap(){return this._childMap}get childIDs(){this._childIDs||
(this._childIDs=Object.keys(this._childMap));return this._childIDs}set parent(a){if(G.isNumeric(a)||G.isString(a)){const b=a;a=this.scene.objects[b];if(!a){this.warn("Group not found: "+G.inQuotes(b));return}}a.scene.id!==this.scene.id?this.error("Group not in same Scene: "+a.id):this._parent&&this._parent.id===a.id?this.warn("Already a child of Group: "+a.id):a.addChild(this)}get parent(){return this._parent}set position(a){this._position.set(a||[0,0,0]);this._setLocalMatrixDirty();this._setAABBDirty();
this._renderer.imageDirty()}get position(){return this._position}set rotation(a){this._rotation.set(a||[0,0,0]);l.eulerToQuaternion(this._rotation,"XYZ",this._quaternion);this._setLocalMatrixDirty();this._setAABBDirty();this._renderer.imageDirty()}get rotation(){return this._rotation}set quaternion(a){this._quaternion.set(a||[0,0,0,1]);l.quaternionToEuler(this._quaternion,"XYZ",this._rotation);this._setLocalMatrixDirty();this._setAABBDirty();this._renderer.imageDirty()}get quaternion(){return this._quaternion}set scale(a){this._scale.set(a||
[1,1,1]);this._setLocalMatrixDirty();this._setAABBDirty();this._renderer.imageDirty()}get scale(){return this._scale}set matrix(a){this.__localMatrix||(this.__localMatrix=l.identityMat4());this.__localMatrix.set(a||Vd);l.decomposeMat4(this.__localMatrix,this._position,this._quaternion,this._scale);this._localMatrixDirty=!1;this._setWorldMatrixDirty();this._setAABBDirty();this._renderer.imageDirty()}get matrix(){this._localMatrixDirty&&(this.__localMatrix||(this.__localMatrix=l.identityMat4()),l.composeMat4(this._position,
this._quaternion,this._scale,this.__localMatrix),this._localMatrixDirty=!1);return this.__localMatrix}get worldMatrix(){this._worldMatrixDirty&&this._buildWorldMatrix();return this._worldMatrix}get worldNormalMatrix(){this._worldNormalMatrixDirty&&this._buildWorldNormalMatrix();return this._worldNormalMatrix}get aabb(){this._aabbDirty&&this._updateAABB();return this._aabb}get center(){this._aabbDirty&&this._updateAABB();return this._aabbCenter}set visible(a){this._visible=a=!1!==a;for(let b=0,c=this._childList.length;b<
c;b++)this._childList[b].visible=a;this._entityType&&this.scene._entityVisibilityUpdated(this,a)}get visible(){return this._visible}set highlighted(a){this._highlighted=a=!!a;for(let b=0,c=this._childList.length;b<c;b++)this._childList[b].highlighted=a;this._entityType&&this.scene._entityHighlightedUpdated(this,a)}get highlighted(){return this._highlighted}set ghosted(a){this._ghosted=a=!!a;for(let b=0,c=this._childList.length;b<c;b++)this._childList[b].ghosted=a;this._entityType&&this.scene._entityGhostedUpdated(this,
a)}get ghosted(){return this._ghosted}set selected(a){this._selected=a=!!a;for(let b=0,c=this._childList.length;b<c;b++)this._childList[b].selected=a;this._entityType&&this.scene._entitySelectedUpdated(this,a)}get selected(){return this._selected}set edges(a){this._edges=a=!!a;for(let b=0,c=this._childList.length;b<c;b++)this._childList[b].edges=a}get edges(){return this._edges}set culled(a){this._culled=a=!!a;for(let b=0,c=this._childList.length;b<c;b++)this._childList[b].culled=a}get culled(){return this._culled}set clippable(a){this._clippable=
a=!1!==a;for(let b=0,c=this._childList.length;b<c;b++)this._childList[b].clippable=a}get clippable(){return this._clippable}set collidable(a){this._collidable=a=!1!==a;for(let b=0,c=this._childList.length;b<c;b++)this._childList[b].collidable=a}get collidable(){return this._collidable}set pickable(a){this._pickable=a=!1!==a;for(let b=0,c=this._childList.length;b<c;b++)this._childList[b].pickable=a}get pickable(){return this._pickable}set colorize(a){let b=this._colorize;b||(b=this._colorize=new Float32Array(4),
b[3]=1);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):(b[0]=1,b[1]=1,b[2]=1);for(let c=0,d=this._childList.length;c<d;c++)this._childList[c].colorize=b}get colorize(){return this._colorize.slice(0,3)}set opacity(a){let b=this._colorize;b||(b=this._colorize=new Float32Array(4),b[0]=1,b[1]=1,b[2]=1);b[3]=null!==a&&void 0!==a?a:1;for(let c=0,d=this._childList.length;c<d;c++)this._childList[c].opacity=a}get opacity(){return this._colorize[3]}set outlined(a){this._outlined=a=!!a;for(let b=0,c=this._childList.length;b<
c;b++)this._childList[b].outlined=a}get outlined(){return this._outlined}set castShadow(a){this._castShadow=a=!!a;for(let b=0,c=this._childList.length;b<c;b++)this._childList[b].castShadow=a}get castShadow(){return this._castShadow}set receiveShadow(a){this._receiveShadow=a=!!a;for(let b=0,c=this._childList.length;b<c;b++)this._childList[b].receiveShadow=a}get receiveShadow(){return this._receiveShadow}set aabbVisible(a){if(a||this._aabbHelper)this._aabbHelper||(this._aabbHelper=new Pa(this,{geometry:new Xa(this,
{target:this}),material:new Oa(this,{diffuse:[.5,1,.5],emissive:[.5,1,.5],lineWidth:2})})),this._aabbHelper.visible=a}get aabbVisible(){return this._aabbHelper?this._aabbHelper.visible:!1}destroy(){super.destroy();this._parent&&this._parent.removeChild(this);if(this._entityType){var a=this.scene;a._entityTypeRemoved(this,this._entityType);this._visible&&a._entityVisibilityUpdated(this,!1);this._ghosted&&a._entityGhostedUpdated(this,!1);this._selected&&a._entitySelectedUpdated(this,!1);this._highlighted&&
a._entityHighlightedUpdated(this,!1)}if(this._childList.length){a=this._childList.splice();let b;for(let c=0,d=a.length;c<d;c++)b=a[c],b.destroy()}this._childList=[];this._childMap={};this._childIDs=null;this._setAABBDirty();this.scene._aabbDirty=!0;this.scene._objectDestroyed(this)}}M["xeogl.Object"]=rb;const Wd=function(a){if("LambertMaterial"===a._material._state.type){var b=a.scene._lightsState,c=a._geometry._state,d=a._state.billboard,f=a._state.stationary,e=0<a.scene._clipsState.clips.length,
g=!!c.quantized,h,m=[];m.push("// Lambertian drawing vertex shader");m.push("attribute vec3 position;");m.push("uniform mat4 modelMatrix;");m.push("uniform mat4 viewMatrix;");m.push("uniform mat4 projMatrix;");m.push("uniform vec4 colorize;");g&&m.push("uniform mat4 positionsDecodeMatrix;");e&&m.push("varying vec4 vWorldPosition;");m.push("uniform vec4 lightAmbient;");m.push("uniform vec4 materialColor;");if(c.normals){m.push("attribute vec3 normal;");m.push("uniform mat4 modelNormalMatrix;");m.push("uniform mat4 viewNormalMatrix;");
var n=0;for(h=b.lights.length;n<h;n++){var p=b.lights[n];"ambient"!==p.type&&(m.push("uniform vec4 lightColor"+n+";"),"dir"===p.type&&m.push("uniform vec3 lightDir"+n+";"),"point"===p.type&&m.push("uniform vec3 lightPos"+n+";"),"spot"===p.type&&(m.push("uniform vec3 lightPos"+n+";"),m.push("uniform vec3 lightDir"+n+";")))}g&&(m.push("vec3 octDecode(vec2 oct) {"),m.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),m.push("    if (v.z < 0.0) {"),m.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),
m.push("    }"),m.push("    return normalize(v);"),m.push("}"))}m.push("varying vec4 vColor;");"points"===c.primitiveName&&m.push("uniform float pointSize;");if("spherical"===d||"cylindrical"===d)m.push("void billboard(inout mat4 mat) {"),m.push("   mat[0][0] = 1.0;"),m.push("   mat[0][1] = 0.0;"),m.push("   mat[0][2] = 0.0;"),"spherical"===d&&(m.push("   mat[1][0] = 0.0;"),m.push("   mat[1][1] = 1.0;"),m.push("   mat[1][2] = 0.0;")),m.push("   mat[2][0] = 0.0;"),m.push("   mat[2][1] = 0.0;"),m.push("   mat[2][2] =1.0;"),
m.push("}");m.push("void main(void) {");m.push("vec4 localPosition = vec4(position, 1.0); ");m.push("vec4 worldPosition;");g&&m.push("localPosition = positionsDecodeMatrix * localPosition;");c.normals&&(g?m.push("vec4 localNormal = vec4(octDecode(normal.xy), 0.0); "):m.push("vec4 localNormal = vec4(normal, 0.0); "),m.push("mat4 modelNormalMatrix2 = modelNormalMatrix;"),m.push("mat4 viewNormalMatrix2 = viewNormalMatrix;"));m.push("mat4 viewMatrix2 = viewMatrix;");m.push("mat4 modelMatrix2 = modelMatrix;");
f&&m.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"===d||"cylindrical"===d?(m.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),m.push("billboard(modelMatrix2);"),m.push("billboard(viewMatrix2);"),m.push("billboard(modelViewMatrix);"),c.normals&&(m.push("mat4 modelViewNormalMatrix =  viewNormalMatrix2 * modelNormalMatrix2;"),m.push("billboard(modelNormalMatrix2);"),m.push("billboard(viewNormalMatrix2);"),m.push("billboard(modelViewNormalMatrix);")),m.push("worldPosition = modelMatrix2 * localPosition;"),
m.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(m.push("worldPosition = modelMatrix2 * localPosition;"),m.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));c.normals&&m.push("vec3 viewNormal = normalize((viewNormalMatrix2 * modelNormalMatrix2 * localNormal).xyz);");m.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);");m.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);");m.push("float lambertian = 1.0;");if(c.normals)for(n=0,h=b.lights.length;n<h;n++)if(p=b.lights[n],"ambient"!==
p.type){if("dir"===p.type)"view"===p.space?m.push("viewLightDir = normalize(lightDir"+n+");"):m.push("viewLightDir = normalize((viewMatrix2 * vec4(lightDir"+n+", 0.0)).xyz);");else if("point"===p.type)"view"===p.space?m.push("viewLightDir = normalize(lightPos"+n+" - viewPosition.xyz);"):m.push("viewLightDir = normalize((viewMatrix2 * vec4(lightPos"+n+", 0.0)).xyz);");else if("spot"===p.type)"view"===p.space?m.push("viewLightDir = normalize(lightDir"+n+");"):m.push("viewLightDir = normalize((viewMatrix2 * vec4(lightDir"+
n+", 0.0)).xyz);");else continue;m.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);");m.push("reflectedColor += lambertian * (lightColor"+n+".rgb * lightColor"+n+".a);")}m.push("vColor = vec4((reflectedColor * materialColor.rgb), materialColor.a) * colorize;");e&&m.push("vWorldPosition = worldPosition;");"points"===c.primitiveName&&m.push("gl_PointSize = pointSize;");m.push("   gl_Position = projMatrix * viewPosition;");m.push("}");this.vertex=m;d=a.scene;b=d._clipsState;a=a._geometry._state;
c=0<b.clips.length;e=d.gammaOutput;g=[];g.push("// Lambertian drawing fragment shader");g.push("precision lowp float;");if(c)for(g.push("varying vec4 vWorldPosition;"),g.push("uniform bool clippable;"),d=0,f=b.clips.length;d<f;d++)g.push("uniform bool clipActive"+d+";"),g.push("uniform vec3 clipPos"+d+";"),g.push("uniform vec3 clipDir"+d+";");g.push("varying vec4 vColor;");e&&(g.push("uniform float gammaFactor;"),g.push("    vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),g.push("    return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),
g.push("}"));g.push("void main(void) {");if(c){g.push("if (clippable) {");g.push("  float dist = 0.0;");d=0;for(f=b.clips.length;d<f;d++)g.push("if (clipActive"+d+") {"),g.push("   dist += clamp(dot(-clipDir"+d+".xyz, vWorldPosition.xyz - clipPos"+d+".xyz), 0.0, 1000.0);"),g.push("}");g.push("  if (dist > 0.0) { discard; }");g.push("}")}"points"===a.primitiveName&&(g.push("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),g.push("float r = dot(cxy, cxy);"),g.push("if (r > 1.0) {"),g.push("   discard;"),g.push("}"));
e?g.push("gl_FragColor = linearToGamma(vColor, gammaFactor);"):g.push("gl_FragColor = vColor;");g.push("}");this.fragment=g}else{c=a.scene;e=a._material;f=a._state;h=c._clipsState;b=a._geometry._state;c=c._lightsState;var r;d=f.billboard;f=f.stationary;a._geometry._state.uv?(g=a._material,g=!!(g._ambientMap||g._occlusionMap||g._baseColorMap||g._diffuseMap||g._alphaMap||g._specularMap||g._glossinessMap||g._specularGlossinessMap||g._emissiveMap||g._metallicMap||g._roughnessMap||g._metallicRoughnessMap||
g._reflectivityMap||g._normalMap)):g=!1;n=zc(a);h=0<h.clips.length;p=yc(a);m=!!b.quantized;var q=[];n&&e._normalMap&&q.push("#extension GL_OES_standard_derivatives : enable");q.push("// Drawing vertex shader");q.push("attribute  vec3 position;");m&&q.push("uniform mat4 positionsDecodeMatrix;");q.push("uniform  mat4 modelMatrix;");q.push("uniform  mat4 viewMatrix;");q.push("uniform  mat4 projMatrix;");q.push("varying  vec3 vViewPosition;");h&&q.push("varying vec4 vWorldPosition;");0<c.lightMaps.length&&
q.push("varying    vec3 vWorldNormal;");if(n){q.push("attribute  vec3 normal;");q.push("uniform    mat4 modelNormalMatrix;");q.push("uniform    mat4 viewNormalMatrix;");q.push("varying    vec3 vViewNormal;");e=0;for(r=c.lights.length;e<r;e++){var k=c.lights[e];"ambient"!==k.type&&("dir"===k.type&&q.push("uniform vec3 lightDir"+e+";"),"point"===k.type&&q.push("uniform vec3 lightPos"+e+";"),"spot"===k.type&&(q.push("uniform vec3 lightPos"+e+";"),q.push("uniform vec3 lightDir"+e+";")),"dir"===k.type&&
"view"===k.space||q.push("varying vec4 vViewLightReverseDirAndDist"+e+";"))}m&&(q.push("vec3 octDecode(vec2 oct) {"),q.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),q.push("    if (v.z < 0.0) {"),q.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),q.push("    }"),q.push("    return normalize(v);"),q.push("}"))}g&&(q.push("attribute vec2 uv;"),q.push("varying vec2 vUV;"),m&&q.push("uniform mat3 uvDecodeMatrix;"));b.colors&&(q.push("attribute vec4 color;"),
q.push("varying vec4 vColor;"));"points"===b.primitiveName&&q.push("uniform float pointSize;");if("spherical"===d||"cylindrical"===d)q.push("void billboard(inout mat4 mat) {"),q.push("   mat[0][0] = 1.0;"),q.push("   mat[0][1] = 0.0;"),q.push("   mat[0][2] = 0.0;"),"spherical"===d&&(q.push("   mat[1][0] = 0.0;"),q.push("   mat[1][1] = 1.0;"),q.push("   mat[1][2] = 0.0;")),q.push("   mat[2][0] = 0.0;"),q.push("   mat[2][1] = 0.0;"),q.push("   mat[2][2] =1.0;"),q.push("}");if(p)for(q.push("const mat4 texUnitConverter = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);"),
e=0,r=c.lights.length;e<r;e++)c.lights[e].shadow&&(q.push("uniform mat4 shadowViewMatrix"+e+";"),q.push("uniform mat4 shadowProjMatrix"+e+";"),q.push("varying vec4 vShadowPosFromLight"+e+";"));q.push("void main(void) {");q.push("vec4 localPosition = vec4(position, 1.0); ");q.push("vec4 worldPosition;");m&&q.push("localPosition = positionsDecodeMatrix * localPosition;");n&&(m?q.push("vec4 localNormal = vec4(octDecode(normal.xy), 0.0); "):q.push("vec4 localNormal = vec4(normal, 0.0); "),q.push("mat4 modelNormalMatrix2    = modelNormalMatrix;"),
q.push("mat4 viewNormalMatrix2     = viewNormalMatrix;"));q.push("mat4 viewMatrix2           = viewMatrix;");q.push("mat4 modelMatrix2          = modelMatrix;");f&&q.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"===d||"cylindrical"===d?(q.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),q.push("billboard(modelMatrix2);"),q.push("billboard(viewMatrix2);"),q.push("billboard(modelViewMatrix);"),n&&(q.push("mat4 modelViewNormalMatrix =  viewNormalMatrix2 * modelNormalMatrix2;"),
q.push("billboard(modelNormalMatrix2);"),q.push("billboard(viewNormalMatrix2);"),q.push("billboard(modelViewNormalMatrix);")),q.push("worldPosition = modelMatrix2 * localPosition;"),q.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(q.push("worldPosition = modelMatrix2 * localPosition;"),q.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));if(n)for(q.push("vec3 worldNormal = (modelNormalMatrix2 * localNormal).xyz; "),0<c.lightMaps.length&&q.push("vWorldNormal = worldNormal;"),
q.push("vViewNormal = normalize((viewNormalMatrix2 * vec4(worldNormal, 1.0)).xyz);"),q.push("vec3 tmpVec3;"),q.push("float lightDist;"),e=0,r=c.lights.length;e<r;e++)k=c.lights[e],"ambient"!==k.type&&("dir"===k.type&&"world"===k.space&&(q.push("tmpVec3 = vec3(viewMatrix2 * vec4(lightDir"+e+", 0.0) ).xyz;"),q.push("vViewLightReverseDirAndDist"+e+" = vec4(-tmpVec3, 0.0);")),"point"===k.type&&("world"===k.space?q.push("tmpVec3 = (viewMatrix2 * vec4(lightPos"+e+", 1.0)).xyz - viewPosition.xyz;"):q.push("tmpVec3 = lightPos"+
e+".xyz - viewPosition.xyz;"),q.push("lightDist = abs(length(tmpVec3));"),q.push("vViewLightReverseDirAndDist"+e+" = vec4(tmpVec3, lightDist);")));g&&(m?q.push("vUV = (uvDecodeMatrix * vec3(uv, 1.0)).xy;"):q.push("vUV = uv;"));b.colors&&q.push("vColor = color;");"points"===b.primitiveName&&q.push("gl_PointSize = pointSize;");h&&q.push("vWorldPosition = worldPosition;");q.push("   vViewPosition = viewPosition.xyz;");q.push("   gl_Position = projMatrix * viewPosition;");q.push("const mat4 texUnitConverter = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);");
if(p)for(q.push("vec4 tempx; "),e=0,r=c.lights.length;e<r;e++)c.lights[e].shadow&&q.push("vShadowPosFromLight"+e+" = texUnitConverter * shadowProjMatrix"+e+" * (shadowViewMatrix"+e+" * worldPosition); ");q.push("}");this.vertex=q;r=a.scene;var t=r.canvas.gl;b=a._material;c=a._geometry._state;d=a.scene._clipsState;f=a.scene._lightsState;e=a._material._state;g=0<d.clips.length;n=zc(a);h=c.uv;p="PhongMaterial"===e.type;m="MetallicMaterial"===e.type;q="SpecularMaterial"===e.type;a=yc(a);r=r.gammaOutput;
let w,u;k=[];k.push("// Drawing fragment shader");n&&b._normalMap&&k.push("#extension GL_OES_standard_derivatives : enable");k.push("precision "+(t.getShaderPrecisionFormat?0<t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision?"highp":0<t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision?"mediump":"lowp":"mediump")+" float;");a&&(k.push("float unpackDepth (vec4 color) {"),k.push("  const vec4 bitShift = vec4(1.0, 1.0/256.0, 1.0/(256.0 * 256.0), 1.0/(256.0*256.0*256.0));"),
k.push("  return dot(color, bitShift);"),k.push("}"));k.push("uniform float gammaFactor;");k.push("vec4 linearToLinear( in vec4 value ) {");k.push("  return value;");k.push("}");k.push("vec4 sRGBToLinear( in vec4 value ) {");k.push("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );");k.push("}");k.push("vec4 gammaToLinear( in vec4 value) {");k.push("  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );");
k.push("}");r&&(k.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),k.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),k.push("}"));if(g)for(k.push("varying vec4 vWorldPosition;"),k.push("uniform bool clippable;"),t=0;t<d.clips.length;t++)k.push("uniform bool clipActive"+t+";"),k.push("uniform vec3 clipPos"+t+";"),k.push("uniform vec3 clipDir"+t+";");if(n){0<f.lightMaps.length&&(k.push("uniform samplerCube lightMap;"),k.push("uniform mat4 viewNormalMatrix;"));
0<f.reflectionMaps.length&&k.push("uniform samplerCube reflectionMap;");(0<f.lightMaps.length||0<f.reflectionMaps.length)&&k.push("uniform mat4 viewMatrix;");k.push("#define PI 3.14159265359");k.push("#define RECIPROCAL_PI 0.31830988618");k.push("#define RECIPROCAL_PI2 0.15915494");k.push("#define EPSILON 1e-6");k.push("#define saturate(a) clamp( a, 0.0, 1.0 )");k.push("vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {");k.push("   return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );");
k.push("}");k.push("struct IncidentLight {");k.push("   vec3 color;");k.push("   vec3 direction;");k.push("};");k.push("struct ReflectedLight {");k.push("   vec3 diffuse;");k.push("   vec3 specular;");k.push("};");k.push("struct Geometry {");k.push("   vec3 position;");k.push("   vec3 viewNormal;");k.push("   vec3 worldNormal;");k.push("   vec3 viewEyeDir;");k.push("};");k.push("struct Material {");k.push("   vec3    diffuseColor;");k.push("   float   specularRoughness;");k.push("   vec3    specularColor;");
k.push("   float   shine;");k.push("};");if(p){if(0<f.lightMaps.length||0<f.reflectionMaps.length)k.push("void computePhongLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),0<f.lightMaps.length&&(k.push("   vec3 irradiance = "+Qa[f.lightMaps[0].encoding]+"(textureCube(lightMap, geometry.worldNormal)).rgb;"),k.push("   irradiance *= PI;"),k.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),k.push("   reflectedLight.diffuse += irradiance * diffuseBRDFContrib;")),
0<f.reflectionMaps.length&&(k.push("   vec3 reflectVec             = reflect(-geometry.viewEyeDir, geometry.viewNormal);"),k.push("   vec3 radiance               = textureCube(reflectionMap, reflectVec).rgb * 0.2;"),k.push("   reflectedLight.specular     += radiance;")),k.push("}");k.push("void computePhongLighting(const in IncidentLight directLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {");k.push("   float dotNL     = saturate(dot(geometry.viewNormal, directLight.direction));");
k.push("   vec3 irradiance = dotNL * directLight.color * PI;");k.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);");k.push("   reflectedLight.specular += directLight.color * material.specularColor * pow(max(dot(reflect(-directLight.direction, -geometry.viewNormal), geometry.viewEyeDir), 0.0), material.shine);");k.push("}")}if(m||q){k.push("float GGXRoughnessToBlinnExponent(const in float ggxRoughness) {");k.push("   float r = ggxRoughness + 0.0001;");k.push("   return (2.0 / (r * r) - 2.0);");
k.push("}");k.push("float getSpecularMIPLevel(const in float blinnShininessExponent, const in int maxMIPLevel) {");k.push("   float maxMIPLevelScalar = float( maxMIPLevel );");k.push("   float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( ( blinnShininessExponent * blinnShininessExponent ) + 1.0 );");k.push("   return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );");k.push("}");0<f.reflectionMaps.length&&(k.push("vec3 getLightProbeIndirectRadiance(const in vec3 reflectVec, const in float blinnShininessExponent, const in int maxMIPLevel) {"),
k.push("   float mipLevel = 0.5 * getSpecularMIPLevel(blinnShininessExponent, maxMIPLevel);"),k.push("   vec3 envMapColor = "+Qa[f.reflectionMaps[0].encoding]+"(textureCube(reflectionMap, reflectVec, mipLevel)).rgb;"),k.push("  return envMapColor;"),k.push("}"));k.push("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {");k.push("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );");k.push("   return ( 1.0 - specularColor ) * fresnel + specularColor;");k.push("}");
k.push("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {");k.push("   float a2 = ( alpha * alpha );");k.push("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );");k.push("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );");k.push("   return 1.0 / ( gl * gv );");k.push("}");k.push("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {");k.push("   float a2 = ( alpha * alpha );");k.push("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );");
k.push("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );");k.push("   return 0.5 / max( gv + gl, EPSILON );");k.push("}");k.push("float D_GGX(const in float alpha, const in float dotNH) {");k.push("   float a2 = ( alpha * alpha );");k.push("   float denom = ( dotNH * dotNH) * ( a2 - 1.0 ) + 1.0;");k.push("   return RECIPROCAL_PI * a2 / ( denom * denom);");k.push("}");k.push("vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in Geometry geometry, const in vec3 specularColor, const in float roughness) {");
k.push("   float alpha = ( roughness * roughness );");k.push("   vec3 halfDir = normalize( incidentLight.direction + geometry.viewEyeDir );");k.push("   float dotNL = saturate( dot( geometry.viewNormal, incidentLight.direction ) );");k.push("   float dotNV = saturate( dot( geometry.viewNormal, geometry.viewEyeDir ) );");k.push("   float dotNH = saturate( dot( geometry.viewNormal, halfDir ) );");k.push("   float dotLH = saturate( dot( incidentLight.direction, halfDir ) );");k.push("   vec3  F = F_Schlick( specularColor, dotLH );");
k.push("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );");k.push("   float D = D_GGX( alpha, dotNH );");k.push("   return F * (G * D);");k.push("}");k.push("vec3 BRDF_Specular_GGX_Environment(const in Geometry geometry, const in vec3 specularColor, const in float roughness) {");k.push("   float dotNV = saturate(dot(geometry.viewNormal, geometry.viewEyeDir));");k.push("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);");k.push("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);");
k.push("   vec4 r = roughness * c0 + c1;");k.push("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;");k.push("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;");k.push("   return specularColor * AB.x + AB.y;");k.push("}");if(0<f.lightMaps.length||0<f.reflectionMaps.length)k.push("void computePBRLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),0<f.lightMaps.length&&(k.push("   vec3 irradiance = sRGBToLinear(textureCube(lightMap, geometry.worldNormal)).rgb;"),
k.push("   irradiance *= PI;"),k.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),k.push("   reflectedLight.diffuse += irradiance * diffuseBRDFContrib;")),0<f.reflectionMaps.length&&(k.push("   vec3 reflectVec             = reflect(-geometry.viewEyeDir, geometry.viewNormal);"),k.push("   reflectVec                  = inverseTransformDirection(reflectVec, viewMatrix);"),k.push("   float blinnExpFromRoughness = GGXRoughnessToBlinnExponent(material.specularRoughness);"),
k.push("   vec3 radiance               = getLightProbeIndirectRadiance(reflectVec, blinnExpFromRoughness, 8);"),k.push("   vec3 specularBRDFContrib    = BRDF_Specular_GGX_Environment(geometry, material.specularColor, material.specularRoughness);"),k.push("   reflectedLight.specular     += radiance * specularBRDFContrib;")),k.push("}");k.push("void computePBRLighting(const in IncidentLight incidentLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {");
k.push("   float dotNL     = saturate(dot(geometry.viewNormal, incidentLight.direction));");k.push("   vec3 irradiance = dotNL * incidentLight.color * PI;");k.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);");k.push("   reflectedLight.specular += irradiance * BRDF_Specular_GGX(incidentLight, geometry, material.specularColor, material.specularRoughness);");k.push("}")}}k.push("varying vec3 vViewPosition;");c.colors&&k.push("varying vec4 vColor;");h&&(n&&b._normalMap||
b._ambientMap||b._baseColorMap||b._diffuseMap||b._emissiveMap||b._metallicMap||b._roughnessMap||b._metallicRoughnessMap||b._specularMap||b._glossinessMap||b._specularGlossinessMap||b._occlusionMap||b._alphaMap)&&k.push("varying vec2 vUV;");n&&(0<f.lightMaps.length&&k.push("varying vec3 vWorldNormal;"),k.push("varying vec3 vViewNormal;"));e.ambient&&k.push("uniform vec3 materialAmbient;");e.baseColor&&k.push("uniform vec3 materialBaseColor;");void 0!==e.alpha&&null!==e.alpha&&k.push("uniform vec4 materialAlphaModeCutoff;");
e.emissive&&k.push("uniform vec3 materialEmissive;");e.diffuse&&k.push("uniform vec3 materialDiffuse;");void 0!==e.glossiness&&null!==e.glossiness&&k.push("uniform float materialGlossiness;");void 0!==e.shininess&&null!==e.shininess&&k.push("uniform float materialShininess;");e.specular&&k.push("uniform vec3 materialSpecular;");void 0!==e.metallic&&null!==e.metallic&&k.push("uniform float materialMetallic;");void 0!==e.roughness&&null!==e.roughness&&k.push("uniform float materialRoughness;");void 0!==
e.specularF0&&null!==e.specularF0&&k.push("uniform float materialSpecularF0;");h&&b._ambientMap&&(k.push("uniform sampler2D ambientMap;"),b._ambientMap._state.matrix&&k.push("uniform mat4 ambientMapMatrix;"));h&&b._baseColorMap&&(k.push("uniform sampler2D baseColorMap;"),b._baseColorMap._state.matrix&&k.push("uniform mat4 baseColorMapMatrix;"));h&&b._diffuseMap&&(k.push("uniform sampler2D diffuseMap;"),b._diffuseMap._state.matrix&&k.push("uniform mat4 diffuseMapMatrix;"));h&&b._emissiveMap&&(k.push("uniform sampler2D emissiveMap;"),
b._emissiveMap._state.matrix&&k.push("uniform mat4 emissiveMapMatrix;"));n&&h&&b._metallicMap&&(k.push("uniform sampler2D metallicMap;"),b._metallicMap._state.matrix&&k.push("uniform mat4 metallicMapMatrix;"));n&&h&&b._roughnessMap&&(k.push("uniform sampler2D roughnessMap;"),b._roughnessMap._state.matrix&&k.push("uniform mat4 roughnessMapMatrix;"));n&&h&&b._metallicRoughnessMap&&(k.push("uniform sampler2D metallicRoughnessMap;"),b._metallicRoughnessMap._state.matrix&&k.push("uniform mat4 metallicRoughnessMapMatrix;"));
n&&b._normalMap&&(k.push("uniform sampler2D normalMap;"),b._normalMap._state.matrix&&k.push("uniform mat4 normalMapMatrix;"),k.push("vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {"),k.push("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),k.push("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),k.push("      vec2 st0 = dFdx( uv.st );"),k.push("      vec2 st1 = dFdy( uv.st );"),k.push("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),
k.push("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),k.push("      vec3 N = normalize( surf_norm );"),k.push("      vec3 mapN = texture2D( normalMap, uv ).xyz * 2.0 - 1.0;"),k.push("      mat3 tsn = mat3( S, T, N );"),k.push("      return normalize( tsn * mapN );"),k.push("}"));h&&b._occlusionMap&&(k.push("uniform sampler2D occlusionMap;"),b._occlusionMap._state.matrix&&k.push("uniform mat4 occlusionMapMatrix;"));h&&b._alphaMap&&(k.push("uniform sampler2D alphaMap;"),b._alphaMap._state.matrix&&
k.push("uniform mat4 alphaMapMatrix;"));n&&h&&b._specularMap&&(k.push("uniform sampler2D specularMap;"),b._specularMap._state.matrix&&k.push("uniform mat4 specularMapMatrix;"));n&&h&&b._glossinessMap&&(k.push("uniform sampler2D glossinessMap;"),b._glossinessMap._state.matrix&&k.push("uniform mat4 glossinessMapMatrix;"));n&&h&&b._specularGlossinessMap&&(k.push("uniform sampler2D materialSpecularGlossinessMap;"),b._specularGlossinessMap._state.matrix&&k.push("uniform mat4 materialSpecularGlossinessMapMatrix;"));
n&&(b._diffuseFresnel||b._specularFresnel||b._alphaFresnel||b._emissiveFresnel||b._reflectivityFresnel)&&(k.push("float fresnel(vec3 eyeDir, vec3 normal, float edgeBias, float centerBias, float power) {"),k.push("    float fr = abs(dot(eyeDir, normal));"),k.push("    float finalFr = clamp((fr - edgeBias) / (centerBias - edgeBias), 0.0, 1.0);"),k.push("    return pow(finalFr, power);"),k.push("}"),b._diffuseFresnel&&(k.push("uniform float  diffuseFresnelCenterBias;"),k.push("uniform float  diffuseFresnelEdgeBias;"),
k.push("uniform float  diffuseFresnelPower;"),k.push("uniform vec3   diffuseFresnelCenterColor;"),k.push("uniform vec3   diffuseFresnelEdgeColor;")),b._specularFresnel&&(k.push("uniform float  specularFresnelCenterBias;"),k.push("uniform float  specularFresnelEdgeBias;"),k.push("uniform float  specularFresnelPower;"),k.push("uniform vec3   specularFresnelCenterColor;"),k.push("uniform vec3   specularFresnelEdgeColor;")),b._alphaFresnel&&(k.push("uniform float  alphaFresnelCenterBias;"),k.push("uniform float  alphaFresnelEdgeBias;"),
k.push("uniform float  alphaFresnelPower;"),k.push("uniform vec3   alphaFresnelCenterColor;"),k.push("uniform vec3   alphaFresnelEdgeColor;")),b._reflectivityFresnel&&(k.push("uniform float  materialSpecularF0FresnelCenterBias;"),k.push("uniform float  materialSpecularF0FresnelEdgeBias;"),k.push("uniform float  materialSpecularF0FresnelPower;"),k.push("uniform vec3   materialSpecularF0FresnelCenterColor;"),k.push("uniform vec3   materialSpecularF0FresnelEdgeColor;")),b._emissiveFresnel&&(k.push("uniform float  emissiveFresnelCenterBias;"),
k.push("uniform float  emissiveFresnelEdgeBias;"),k.push("uniform float  emissiveFresnelPower;"),k.push("uniform vec3   emissiveFresnelCenterColor;"),k.push("uniform vec3   emissiveFresnelEdgeColor;")));k.push("uniform vec4   lightAmbient;");if(n)for(t=0,w=f.lights.length;t<w;t++)u=f.lights[t],"ambient"!==u.type&&(k.push("uniform vec4 lightColor"+t+";"),"point"===u.type&&k.push("uniform vec3 lightAttenuation"+t+";"),"dir"===u.type&&"view"===u.space&&k.push("uniform vec3 lightDir"+t+";"),"point"===
u.type&&"view"===u.space?k.push("uniform vec3 lightPos"+t+";"):k.push("varying vec4 vViewLightReverseDirAndDist"+t+";"));if(a)for(t=0,w=f.lights.length;t<w;t++)f.lights[t].shadow&&(k.push("varying vec4 vShadowPosFromLight"+t+";"),k.push("uniform sampler2D shadowMap"+t+";"));k.push("uniform vec4 colorize;");k.push("void main(void) {");if(g){k.push("if (clippable) {");k.push("  float dist = 0.0;");for(t=0;t<d.clips.length;t++)k.push("if (clipActive"+t+") {"),k.push("   dist += clamp(dot(-clipDir"+t+
".xyz, vWorldPosition.xyz - clipPos"+t+".xyz), 0.0, 1000.0);"),k.push("}");k.push("  if (dist > 0.0) { discard; }");k.push("}")}"points"===c.primitiveName&&(k.push("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),k.push("float r = dot(cxy, cxy);"),k.push("if (r > 1.0) {"),k.push("   discard;"),k.push("}"));k.push("float occlusion = 1.0;");e.ambient?k.push("vec3 ambientColor = materialAmbient;"):k.push("vec3 ambientColor = vec3(1.0, 1.0, 1.0);");e.diffuse?k.push("vec3 diffuseColor = materialDiffuse;"):e.baseColor?
k.push("vec3 diffuseColor = materialBaseColor;"):k.push("vec3 diffuseColor = vec3(1.0, 1.0, 1.0);");c.colors&&k.push("diffuseColor *= vColor.rgb;");e.emissive?k.push("vec3 emissiveColor = materialEmissive;"):k.push("vec3  emissiveColor = vec3(0.0, 0.0, 0.0);");e.specular?k.push("vec3 specular = materialSpecular;"):k.push("vec3 specular = vec3(1.0, 1.0, 1.0);");void 0!==e.alpha?k.push("float alpha = materialAlphaModeCutoff[0];"):k.push("float alpha = 1.0;");c.colors&&k.push("alpha *= vColor.a;");void 0!==
e.glossiness?k.push("float glossiness = materialGlossiness;"):k.push("float glossiness = 1.0;");void 0!==e.metallic?k.push("float metallic = materialMetallic;"):k.push("float metallic = 1.0;");void 0!==e.roughness?k.push("float roughness = materialRoughness;"):k.push("float roughness = 1.0;");void 0!==e.specularF0?k.push("float specularF0 = materialSpecularF0;"):k.push("float specularF0 = 1.0;");h&&(n&&b._normalMap||b._ambientMap||b._baseColorMap||b._diffuseMap||b._occlusionMap||b._emissiveMap||b._metallicMap||
b._roughnessMap||b._metallicRoughnessMap||b._specularMap||b._glossinessMap||b._specularGlossinessMap||b._alphaMap)&&(k.push("vec4 texturePos = vec4(vUV.s, vUV.t, 1.0, 1.0);"),k.push("vec2 textureCoord;"));h&&b._ambientMap&&(b._ambientMap._state.matrix?k.push("textureCoord = (ambientMapMatrix * texturePos).xy;"):k.push("textureCoord = texturePos.xy;"),k.push("vec4 ambientTexel = texture2D(ambientMap, textureCoord).rgb;"),k.push("ambientTexel = "+Qa[b._ambientMap._state.encoding]+"(ambientTexel);"),
k.push("ambientColor *= ambientTexel.rgb;"));h&&b._diffuseMap&&(b._diffuseMap._state.matrix?k.push("textureCoord = (diffuseMapMatrix * texturePos).xy;"):k.push("textureCoord = texturePos.xy;"),k.push("vec4 diffuseTexel = texture2D(diffuseMap, textureCoord);"),k.push("diffuseTexel = "+Qa[b._diffuseMap._state.encoding]+"(diffuseTexel);"),k.push("diffuseColor *= diffuseTexel.rgb;"),k.push("alpha *= diffuseTexel.a;"));h&&b._baseColorMap&&(b._baseColorMap._state.matrix?k.push("textureCoord = (baseColorMapMatrix * texturePos).xy;"):
k.push("textureCoord = texturePos.xy;"),k.push("vec4 baseColorTexel = texture2D(baseColorMap, textureCoord);"),k.push("baseColorTexel = "+Qa[b._baseColorMap._state.encoding]+"(baseColorTexel);"),k.push("diffuseColor *= baseColorTexel.rgb;"),k.push("alpha *= baseColorTexel.a;"));h&&b._emissiveMap&&(b._emissiveMap._state.matrix?k.push("textureCoord = (emissiveMapMatrix * texturePos).xy;"):k.push("textureCoord = texturePos.xy;"),k.push("vec4 emissiveTexel = texture2D(emissiveMap, textureCoord);"),k.push("emissiveTexel = "+
Qa[b._emissiveMap._state.encoding]+"(emissiveTexel);"),k.push("emissiveColor *= emissiveTexel.rgb;"));h&&b._alphaMap&&(b._alphaMap._state.matrix?k.push("textureCoord = (alphaMapMatrix * texturePos).xy;"):k.push("textureCoord = texturePos.xy;"),k.push("alpha *= texture2D(alphaMap, textureCoord).r;"));h&&b._occlusionMap&&(b._occlusionMap._state.matrix?k.push("textureCoord = (occlusionMapMatrix * texturePos).xy;"):k.push("textureCoord = texturePos.xy;"),k.push("occlusion *= texture2D(occlusionMap, textureCoord).r;"));
if(n&&(0<f.lights.length||0<f.lightMaps.length||0<f.reflectionMaps.length)){h&&b._normalMap?(b._normalMap._state.matrix?k.push("textureCoord = (normalMapMatrix * texturePos).xy;"):k.push("textureCoord = texturePos.xy;"),k.push("vec3 viewNormal = perturbNormal2Arb( vViewPosition, normalize(vViewNormal), textureCoord );")):k.push("vec3 viewNormal = normalize(vViewNormal);");h&&b._specularMap&&(b._specularMap._state.matrix?k.push("textureCoord = (specularMapMatrix * texturePos).xy;"):k.push("textureCoord = texturePos.xy;"),
k.push("specular *= texture2D(specularMap, textureCoord).rgb;"));h&&b._glossinessMap&&(b._glossinessMap._state.matrix?k.push("textureCoord = (glossinessMapMatrix * texturePos).xy;"):k.push("textureCoord = texturePos.xy;"),k.push("glossiness *= texture2D(glossinessMap, textureCoord).r;"));h&&b._specularGlossinessMap&&(b._specularGlossinessMap._state.matrix?k.push("textureCoord = (materialSpecularGlossinessMapMatrix * texturePos).xy;"):k.push("textureCoord = texturePos.xy;"),k.push("vec4 specGlossRGB = texture2D(materialSpecularGlossinessMap, textureCoord).rgba;"),
k.push("specular *= specGlossRGB.rgb;"),k.push("glossiness *= specGlossRGB.a;"));h&&b._metallicMap&&(b._metallicMap._state.matrix?k.push("textureCoord = (metallicMapMatrix * texturePos).xy;"):k.push("textureCoord = texturePos.xy;"),k.push("metallic *= texture2D(metallicMap, textureCoord).r;"));h&&b._roughnessMap&&(b._roughnessMap._state.matrix?k.push("textureCoord = (roughnessMapMatrix * texturePos).xy;"):k.push("textureCoord = texturePos.xy;"),k.push("roughness *= texture2D(roughnessMap, textureCoord).r;"));
h&&b._metallicRoughnessMap&&(b._metallicRoughnessMap._state.matrix?k.push("textureCoord = (metallicRoughnessMapMatrix * texturePos).xy;"):k.push("textureCoord = texturePos.xy;"),k.push("vec3 metalRoughRGB = texture2D(metallicRoughnessMap, textureCoord).rgb;"),k.push("metallic *= metalRoughRGB.b;"),k.push("roughness *= metalRoughRGB.g;"));k.push("vec3 viewEyeDir = normalize(-vViewPosition);");b._diffuseFresnel&&(k.push("float diffuseFresnel = fresnel(viewEyeDir, viewNormal, diffuseFresnelEdgeBias, diffuseFresnelCenterBias, diffuseFresnelPower);"),
k.push("diffuseColor *= mix(diffuseFresnelEdgeColor, diffuseFresnelCenterColor, diffuseFresnel);"));b._specularFresnel&&(k.push("float specularFresnel = fresnel(viewEyeDir, viewNormal, specularFresnelEdgeBias, specularFresnelCenterBias, specularFresnelPower);"),k.push("specular *= mix(specularFresnelEdgeColor, specularFresnelCenterColor, specularFresnel);"));b._alphaFresnel&&(k.push("float alphaFresnel = fresnel(viewEyeDir, viewNormal, alphaFresnelEdgeBias, alphaFresnelCenterBias, alphaFresnelPower);"),
k.push("alpha *= mix(alphaFresnelEdgeColor.r, alphaFresnelCenterColor.r, alphaFresnel);"));b._emissiveFresnel&&(k.push("float emissiveFresnel = fresnel(viewEyeDir, viewNormal, emissiveFresnelEdgeBias, emissiveFresnelCenterBias, emissiveFresnelPower);"),k.push("emissiveColor *= mix(emissiveFresnelEdgeColor, emissiveFresnelCenterColor, emissiveFresnel);"));k.push("if (materialAlphaModeCutoff[1] == 1.0 && alpha < materialAlphaModeCutoff[2]) {");k.push("   discard;");k.push("}");k.push("IncidentLight  light;");
k.push("Material       material;");k.push("Geometry       geometry;");k.push("ReflectedLight reflectedLight = ReflectedLight(vec3(0.0,0.0,0.0), vec3(0.0,0.0,0.0));");k.push("vec3           viewLightDir;");p&&(k.push("material.diffuseColor      = diffuseColor;"),k.push("material.specularColor     = specular;"),k.push("material.shine             = materialShininess;"));q&&(k.push("float oneMinusSpecularStrength = 1.0 - max(max(specular.r, specular.g ),specular.b);"),k.push("material.diffuseColor      = diffuseColor * oneMinusSpecularStrength;"),
k.push("material.specularRoughness = clamp( 1.0 - glossiness, 0.04, 1.0 );"),k.push("material.specularColor     = specular;"));m&&(k.push("float dielectricSpecular = 0.16 * specularF0 * specularF0;"),k.push("material.diffuseColor      = diffuseColor * (1.0 - dielectricSpecular) * (1.0 - metallic);"),k.push("material.specularRoughness = clamp(roughness, 0.04, 1.0);"),k.push("material.specularColor     = mix(vec3(dielectricSpecular), diffuseColor, metallic);"));k.push("geometry.position      = vViewPosition;");
0<f.lightMaps.length&&k.push("geometry.worldNormal   = normalize(vWorldNormal);");k.push("geometry.viewNormal    = viewNormal;");k.push("geometry.viewEyeDir    = viewEyeDir;");p&&(0<f.lightMaps.length||0<f.reflectionMaps.length)&&k.push("computePhongLightMapping(geometry, material, reflectedLight);");(q||m)&&(0<f.lightMaps.length||0<f.reflectionMaps.length)&&k.push("computePBRLightMapping(geometry, material, reflectedLight);");k.push("float shadow = 1.0;");k.push("float shadowAcneRemover = 0.007;");
k.push("vec3 fragmentDepth;");k.push("float texelSize = 1.0 / 1024.0;");k.push("float amountInLight = 0.0;");k.push("vec3 shadowCoord;");k.push("vec4 rgbaDepth;");k.push("float depth;");t=0;for(w=f.lights.length;t<w;t++)u=f.lights[t],"ambient"!==u.type&&("dir"===u.type&&"view"===u.space?k.push("viewLightDir = -normalize(lightDir"+t+");"):"point"===u.type&&"view"===u.space?k.push("viewLightDir = normalize(lightPos"+t+" - vViewPosition);"):k.push("viewLightDir = normalize(vViewLightReverseDirAndDist"+
t+".xyz);"),a&&u.shadow?(k.push("shadow = 0.0;"),k.push("fragmentDepth = vShadowPosFromLight"+t+".xyz;"),k.push("fragmentDepth.z -= shadowAcneRemover;"),k.push("for (int x = -3; x <= 3; x++) {"),k.push("  for (int y = -3; y <= 3; y++) {"),k.push("      float texelDepth = unpackDepth(texture2D(shadowMap"+t+", fragmentDepth.xy + vec2(x, y) * texelSize));"),k.push("      if (fragmentDepth.z < texelDepth) {"),k.push("          shadow += 1.0;"),k.push("      }"),k.push("  }"),k.push("}"),k.push("shadow = shadow / 9.0;"),
k.push("light.color =  lightColor"+t+".rgb * (lightColor"+t+".a * shadow);")):k.push("light.color =  lightColor"+t+".rgb * (lightColor"+t+".a );"),k.push("light.direction = viewLightDir;"),p&&k.push("computePhongLighting(light, geometry, material, reflectedLight);"),(q||m)&&k.push("computePBRLighting(light, geometry, material, reflectedLight);"));p?(k.push("ambientColor *= (lightAmbient.rgb * lightAmbient.a);"),k.push("vec3 outgoingLight =  ((occlusion * (( reflectedLight.diffuse + reflectedLight.specular)))) + emissiveColor;")):
k.push("vec3 outgoingLight = (occlusion * (reflectedLight.diffuse)) + (occlusion * reflectedLight.specular) + emissiveColor;")}else k.push("ambientColor *= (lightAmbient.rgb * lightAmbient.a);"),k.push("vec3 outgoingLight = emissiveColor + ambientColor;");k.push("gl_FragColor = vec4(outgoingLight, alpha) * colorize;");r&&k.push("gl_FragColor = linearToGamma(gl_FragColor, gammaFactor);");k.push("}");this.fragment=k}},Qa={linear:"linearToLinear",sRGB:"sRGBToLinear",gamma:"gammaToLinear"};class Wc{constructor(a,
b,c){this.compiled=this.allocated=!1;if(this.handle=a.createShader(b)){if(this.allocated=!0,a.shaderSource(this.handle,c),a.compileShader(this.handle),this.compiled=a.getShaderParameter(this.handle,a.COMPILE_STATUS),!this.compiled&&!a.isContextLost()){b=c.split("\n");c=[];for(let d=0;d<b.length;d++)c.push(d+1+": "+b[d]+"\n");this.errors=[];this.errors.push("");this.errors.push(a.getShaderInfoLog(this.handle));this.errors=this.errors.concat(c.join(""))}}else this.errors=["Failed to allocate"]}destroy(){}}
class Xd{constructor(a,b){this.bindTexture=function(c,d){return c.bind(d)?(a.uniform1i(b,d),!0):!1}}}class Yd{constructor(a,b){this._gl=a;this.location=b}bindArrayBuffer(a,b){a&&(a.bind(),this._gl.enableVertexAttribArray(this.location),this._gl.vertexAttribPointer(this.location,b===this._gl.BYTE?2:a.itemSize,b||this._gl.FLOAT,b===this._gl.BYTE,0,0))}}const Xc=new ta({});class Ba{constructor(a,b){this.id=Xc.addItem({});this.source=b;this.init(a)}init(a){this.gl=a;this.validated=this.linked=this.compiled=
this.allocated=!1;this.errors=null;this.uniforms={};this.samplers={};this.attributes={};this._vertexShader=new Wc(a,a.VERTEX_SHADER,Ac(this.source.vertex));this._fragmentShader=new Wc(a,a.FRAGMENT_SHADER,Ac(this.source.fragment));if(this._vertexShader.allocated)if(this._fragmentShader.allocated)if(this.allocated=!0,this._vertexShader.compiled)if(this._fragmentShader.compiled){this.compiled=!0;var b,c;if(this.handle=a.createProgram())if(a.attachShader(this.handle,this._vertexShader.handle),a.attachShader(this.handle,
this._fragmentShader.handle),a.linkProgram(this.handle),this.linked=a.getProgramParameter(this.handle,a.LINK_STATUS),this.validated=!0,this.linked&&this.validated){var d=a.getProgramParameter(this.handle,a.ACTIVE_UNIFORMS);for(c=0;c<d;++c)if(b=a.getActiveUniform(this.handle,c)){var f=b.name;"\x00"===f[f.length-1]&&(f=f.substr(0,f.length-1));var e=a.getUniformLocation(this.handle,f);b.type===a.SAMPLER_2D||b.type===a.SAMPLER_CUBE||35682===b.type?this.samplers[f]=new Xd(a,e):this.uniforms[f]=e}f=a.getProgramParameter(this.handle,
a.ACTIVE_ATTRIBUTES);for(c=0;c<f;c++)if(b=a.getActiveAttrib(this.handle,c))e=a.getAttribLocation(this.handle,b.name),this.attributes[b.name]=new Yd(a,e);this.allocated=!0}else this.errors=[],this.errors.push(""),this.errors.push(a.getProgramInfoLog(this.handle)),this.errors.push("\nVertex shader:\n"),this.errors=this.errors.concat(shaderSource.vertex),this.errors.push("\nFragment shader:\n"),this.errors=this.errors.concat(shaderSource.fragment);else this.errors=["Failed to allocate program"]}else this.errors=
["Fragment shader failed to compile"].concat(this._fragmentShader.errors);else this.errors=["Vertex shader failed to compile"].concat(this._vertexShader.errors);else this.errors=["Fragment shader failed to allocate"].concat(this._fragmentShader.errors);else this.errors=["Vertex shader failed to allocate"].concat(this._vertexShader.errors)}bind(){this.allocated&&this.gl.useProgram(this.handle)}getLocation(a){if(this.allocated)return this.uniforms[a]}getAttribute(a){if(this.allocated)return this.attributes[a]}bindTexture(a,
b,c){return this.allocated?(a=this.samplers[a])?a.bindTexture(b,c):!1:!1}destroy(){this.allocated&&(Xc.removeItem(this.id),this.gl.deleteProgram(this.handle),this.gl.deleteShader(this._vertexShader.handle),this.gl.deleteShader(this._fragmentShader.handle),this.samplers=this.uniforms=this.attributes=this.handle=null,this.allocated=!1)}}const Yc=new ta({}),wa=function(a,b){this.id=Yc.addItem({});this._hash=a;this._scene=b.scene;this._useCount=0;this._shaderSource=new Wd(b);this._allocate(b)},Sb={};
wa.get=function(a){var b=a.scene;b=[b.canvas.canvas.id,(b.gammaInput?"gi;":";")+(b.gammaOutput?"go":""),b._lightsState.getHash(),b._clipsState.getHash(),a._geometry._state.hash,a._material._state.hash,a._state.hash].join(";");let c=Sb[b];if(!c){c=new wa(b,a);if(c.errors)return console.log(c.errors.join("\n")),null;Sb[b]=c;P.memory.programs++}c._useCount++;return c};wa.prototype.put=function(){0===--this._useCount&&(Yc.removeItem(this.id),this._program&&this._program.destroy(),delete Sb[this._hash],
P.memory.programs--)};wa.prototype.webglContextRestored=function(){this._program=null};wa.prototype.drawMesh=function(a,b){this._program||this._allocate(b);var c=Y.MAX_TEXTURE_UNITS,d=b._material;const f=b.scene.canvas.gl;var e=this._program;const g=b._state,h=b._material._state,m=b._geometry._state;a.lastProgramId!==this._program.id&&(a.lastProgramId=this._program.id,this._bindProgram(a));if(h.id!==this._lastMaterialId){a.textureUnit=this._baseTextureUnit;var n=h.backfaces;a.backfaces!==n&&(n?f.disable(f.CULL_FACE):
f.enable(f.CULL_FACE),a.backfaces=n);n=h.frontface;a.frontface!==n&&(n?f.frontFace(f.CCW):f.frontFace(f.CW),a.frontface=n);a.lineWidth!==h.lineWidth&&(f.lineWidth(h.lineWidth),a.lineWidth=h.lineWidth);this._uPointSize&&f.uniform1f(this._uPointSize,h.pointSize);switch(h.type){case "LambertMaterial":this._uMaterialAmbient&&f.uniform3fv(this._uMaterialAmbient,h.ambient);this._uMaterialColor&&f.uniform4f(this._uMaterialColor,h.color[0],h.color[1],h.color[2],h.alpha);this._uMaterialEmissive&&f.uniform3fv(this._uMaterialEmissive,
h.emissive);break;case "PhongMaterial":this._uMaterialShininess&&f.uniform1f(this._uMaterialShininess,h.shininess);this._uMaterialAmbient&&f.uniform3fv(this._uMaterialAmbient,h.ambient);this._uMaterialDiffuse&&f.uniform3fv(this._uMaterialDiffuse,h.diffuse);this._uMaterialSpecular&&f.uniform3fv(this._uMaterialSpecular,h.specular);this._uMaterialEmissive&&f.uniform3fv(this._uMaterialEmissive,h.emissive);this._uAlphaModeCutoff&&f.uniform4f(this._uAlphaModeCutoff,1*h.alpha,1===h.alphaMode?1:0,h.alphaCutoff,
0);d._ambientMap&&d._ambientMap._state.texture&&this._uMaterialAmbientMap&&(e.bindTexture(this._uMaterialAmbientMap,d._ambientMap._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uMaterialAmbientMapMatrix&&f.uniformMatrix4fv(this._uMaterialAmbientMapMatrix,!1,d._ambientMap._state.matrix));d._diffuseMap&&d._diffuseMap._state.texture&&this._uDiffuseMap&&(e.bindTexture(this._uDiffuseMap,d._diffuseMap._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,
a.bindTexture++,this._uDiffuseMapMatrix&&f.uniformMatrix4fv(this._uDiffuseMapMatrix,!1,d._diffuseMap._state.matrix));d._specularMap&&d._specularMap._state.texture&&this._uSpecularMap&&(e.bindTexture(this._uSpecularMap,d._specularMap._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uSpecularMapMatrix&&f.uniformMatrix4fv(this._uSpecularMapMatrix,!1,d._specularMap._state.matrix));d._emissiveMap&&d._emissiveMap._state.texture&&this._uEmissiveMap&&(e.bindTexture(this._uEmissiveMap,
d._emissiveMap._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uEmissiveMapMatrix&&f.uniformMatrix4fv(this._uEmissiveMapMatrix,!1,d._emissiveMap._state.matrix));d._alphaMap&&d._alphaMap._state.texture&&this._uAlphaMap&&(e.bindTexture(this._uAlphaMap,d._alphaMap._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uAlphaMapMatrix&&f.uniformMatrix4fv(this._uAlphaMapMatrix,!1,d._alphaMap._state.matrix));d._reflectivityMap&&d._reflectivityMap._state.texture&&
this._uReflectivityMap&&(e.bindTexture(this._uReflectivityMap,d._reflectivityMap._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,this._uReflectivityMapMatrix&&f.uniformMatrix4fv(this._uReflectivityMapMatrix,!1,d._reflectivityMap._state.matrix));d._normalMap&&d._normalMap._state.texture&&this._uNormalMap&&(e.bindTexture(this._uNormalMap,d._normalMap._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uNormalMapMatrix&&f.uniformMatrix4fv(this._uNormalMapMatrix,
!1,d._normalMap._state.matrix));d._occlusionMap&&d._occlusionMap._state.texture&&this._uOcclusionMap&&(e.bindTexture(this._uOcclusionMap,d._occlusionMap._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uOcclusionMapMatrix&&f.uniformMatrix4fv(this._uOcclusionMapMatrix,!1,d._occlusionMap._state.matrix));d._diffuseFresnel&&(this._uDiffuseFresnelEdgeBias&&f.uniform1f(this._uDiffuseFresnelEdgeBias,d._diffuseFresnel.edgeBias),this._uDiffuseFresnelCenterBias&&f.uniform1f(this._uDiffuseFresnelCenterBias,
d._diffuseFresnel.centerBias),this._uDiffuseFresnelEdgeColor&&f.uniform3fv(this._uDiffuseFresnelEdgeColor,d._diffuseFresnel.edgeColor),this._uDiffuseFresnelCenterColor&&f.uniform3fv(this._uDiffuseFresnelCenterColor,d._diffuseFresnel.centerColor),this._uDiffuseFresnelPower&&f.uniform1f(this._uDiffuseFresnelPower,d._diffuseFresnel.power));d._specularFresnel&&(this._uSpecularFresnelEdgeBias&&f.uniform1f(this._uSpecularFresnelEdgeBias,d._specularFresnel.edgeBias),this._uSpecularFresnelCenterBias&&f.uniform1f(this._uSpecularFresnelCenterBias,
d._specularFresnel.centerBias),this._uSpecularFresnelEdgeColor&&f.uniform3fv(this._uSpecularFresnelEdgeColor,d._specularFresnel.edgeColor),this._uSpecularFresnelCenterColor&&f.uniform3fv(this._uSpecularFresnelCenterColor,d._specularFresnel.centerColor),this._uSpecularFresnelPower&&f.uniform1f(this._uSpecularFresnelPower,d._specularFresnel.power));d._alphaFresnel&&(this._uAlphaFresnelEdgeBias&&f.uniform1f(this._uAlphaFresnelEdgeBias,d._alphaFresnel.edgeBias),this._uAlphaFresnelCenterBias&&f.uniform1f(this._uAlphaFresnelCenterBias,
d._alphaFresnel.centerBias),this._uAlphaFresnelEdgeColor&&f.uniform3fv(this._uAlphaFresnelEdgeColor,d._alphaFresnel.edgeColor),this._uAlphaFresnelCenterColor&&f.uniform3fv(this._uAlphaFresnelCenterColor,d._alphaFresnel.centerColor),this._uAlphaFresnelPower&&f.uniform1f(this._uAlphaFresnelPower,d._alphaFresnel.power));d._reflectivityFresnel&&(this._uReflectivityFresnelEdgeBias&&f.uniform1f(this._uReflectivityFresnelEdgeBias,d._reflectivityFresnel.edgeBias),this._uReflectivityFresnelCenterBias&&f.uniform1f(this._uReflectivityFresnelCenterBias,
d._reflectivityFresnel.centerBias),this._uReflectivityFresnelEdgeColor&&f.uniform3fv(this._uReflectivityFresnelEdgeColor,d._reflectivityFresnel.edgeColor),this._uReflectivityFresnelCenterColor&&f.uniform3fv(this._uReflectivityFresnelCenterColor,d._reflectivityFresnel.centerColor),this._uReflectivityFresnelPower&&f.uniform1f(this._uReflectivityFresnelPower,d._reflectivityFresnel.power));d._emissiveFresnel&&(this._uEmissiveFresnelEdgeBias&&f.uniform1f(this._uEmissiveFresnelEdgeBias,d._emissiveFresnel.edgeBias),
this._uEmissiveFresnelCenterBias&&f.uniform1f(this._uEmissiveFresnelCenterBias,d._emissiveFresnel.centerBias),this._uEmissiveFresnelEdgeColor&&f.uniform3fv(this._uEmissiveFresnelEdgeColor,d._emissiveFresnel.edgeColor),this._uEmissiveFresnelCenterColor&&f.uniform3fv(this._uEmissiveFresnelCenterColor,d._emissiveFresnel.centerColor),this._uEmissiveFresnelPower&&f.uniform1f(this._uEmissiveFresnelPower,d._emissiveFresnel.power));break;case "MetallicMaterial":this._uBaseColor&&f.uniform3fv(this._uBaseColor,
h.baseColor);this._uMaterialMetallic&&f.uniform1f(this._uMaterialMetallic,h.metallic);this._uMaterialRoughness&&f.uniform1f(this._uMaterialRoughness,h.roughness);this._uMaterialSpecularF0&&f.uniform1f(this._uMaterialSpecularF0,h.specularF0);this._uMaterialEmissive&&f.uniform3fv(this._uMaterialEmissive,h.emissive);this._uAlphaModeCutoff&&f.uniform4f(this._uAlphaModeCutoff,1*h.alpha,1===h.alphaMode?1:0,h.alphaCutoff,0);(n=d._baseColorMap)&&n._state.texture&&this._uBaseColorMap&&(e.bindTexture(this._uBaseColorMap,
n._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uBaseColorMapMatrix&&f.uniformMatrix4fv(this._uBaseColorMapMatrix,!1,n._state.matrix));(n=d._metallicMap)&&n._state.texture&&this._uMetallicMap&&(e.bindTexture(this._uMetallicMap,n._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uMetallicMapMatrix&&f.uniformMatrix4fv(this._uMetallicMapMatrix,!1,n._state.matrix));(n=d._roughnessMap)&&n._state.texture&&this._uRoughnessMap&&(e.bindTexture(this._uRoughnessMap,
n._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uRoughnessMapMatrix&&f.uniformMatrix4fv(this._uRoughnessMapMatrix,!1,n._state.matrix));(n=d._metallicRoughnessMap)&&n._state.texture&&this._uMetallicRoughnessMap&&(e.bindTexture(this._uMetallicRoughnessMap,n._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uMetallicRoughnessMapMatrix&&f.uniformMatrix4fv(this._uMetallicRoughnessMapMatrix,!1,n._state.matrix));(n=d._emissiveMap)&&
n._state.texture&&this._uEmissiveMap&&(e.bindTexture(this._uEmissiveMap,n._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uEmissiveMapMatrix&&f.uniformMatrix4fv(this._uEmissiveMapMatrix,!1,n._state.matrix));(n=d._occlusionMap)&&d._occlusionMap._state.texture&&this._uOcclusionMap&&(e.bindTexture(this._uOcclusionMap,n._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uOcclusionMapMatrix&&f.uniformMatrix4fv(this._uOcclusionMapMatrix,
!1,n._state.matrix));(n=d._alphaMap)&&n._state.texture&&this._uAlphaMap&&(e.bindTexture(this._uAlphaMap,n._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uAlphaMapMatrix&&f.uniformMatrix4fv(this._uAlphaMapMatrix,!1,n._state.matrix));(d=d._normalMap)&&d._state.texture&&this._uNormalMap&&(e.bindTexture(this._uNormalMap,d._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uNormalMapMatrix&&f.uniformMatrix4fv(this._uNormalMapMatrix,
!1,d._state.matrix));break;case "SpecularMaterial":this._uMaterialDiffuse&&f.uniform3fv(this._uMaterialDiffuse,h.diffuse),this._uMaterialSpecular&&f.uniform3fv(this._uMaterialSpecular,h.specular),this._uMaterialGlossiness&&f.uniform1f(this._uMaterialGlossiness,h.glossiness),this._uMaterialReflectivity&&f.uniform1f(this._uMaterialReflectivity,h.reflectivity),this._uMaterialEmissive&&f.uniform3fv(this._uMaterialEmissive,h.emissive),this._uAlphaModeCutoff&&f.uniform4f(this._uAlphaModeCutoff,1*h.alpha,
1===h.alphaMode?1:0,h.alphaCutoff,0),(n=d._diffuseMap)&&n._state.texture&&this._uDiffuseMap&&(e.bindTexture(this._uDiffuseMap,n._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uDiffuseMapMatrix&&f.uniformMatrix4fv(this._uDiffuseMapMatrix,!1,n._state.matrix)),(n=d._specularMap)&&n._state.texture&&this._uSpecularMap&&(e.bindTexture(this._uSpecularMap,n._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uSpecularMapMatrix&&f.uniformMatrix4fv(this._uSpecularMapMatrix,
!1,n._state.matrix)),(n=d._glossinessMap)&&n._state.texture&&this._uGlossinessMap&&(e.bindTexture(this._uGlossinessMap,n._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uGlossinessMapMatrix&&f.uniformMatrix4fv(this._uGlossinessMapMatrix,!1,n._state.matrix)),(n=d._specularGlossinessMap)&&n._state.texture&&this._uSpecularGlossinessMap&&(e.bindTexture(this._uSpecularGlossinessMap,n._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uSpecularGlossinessMapMatrix&&
f.uniformMatrix4fv(this._uSpecularGlossinessMapMatrix,!1,n._state.matrix)),(n=d._emissiveMap)&&n._state.texture&&this._uEmissiveMap&&(e.bindTexture(this._uEmissiveMap,n._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uEmissiveMapMatrix&&f.uniformMatrix4fv(this._uEmissiveMapMatrix,!1,n._state.matrix)),(n=d._occlusionMap)&&n._state.texture&&this._uOcclusionMap&&(e.bindTexture(this._uOcclusionMap,n._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,
a.bindTexture++,this._uOcclusionMapMatrix&&f.uniformMatrix4fv(this._uOcclusionMapMatrix,!1,n._state.matrix)),(n=d._alphaMap)&&n._state.texture&&this._uAlphaMap&&(e.bindTexture(this._uAlphaMap,n._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%c,a.bindTexture++,this._uAlphaMapMatrix&&f.uniformMatrix4fv(this._uAlphaMapMatrix,!1,n._state.matrix)),(d=d._normalMap)&&d._state.texture&&this._uNormalMap&&(e.bindTexture(this._uNormalMap,d._state.texture,a.textureUnit),a.textureUnit=(a.textureUnit+
1)%c,a.bindTexture++,this._uNormalMapMatrix&&f.uniformMatrix4fv(this._uNormalMapMatrix,!1,d._state.matrix))}this._lastMaterialId=h.id}f.uniformMatrix4fv(this._uModelMatrix,f.FALSE,b.worldMatrix);this._uModelNormalMatrix&&f.uniformMatrix4fv(this._uModelNormalMatrix,f.FALSE,b.worldNormalMatrix);this._uClippable&&f.uniform1i(this._uClippable,g.clippable);this._uColorize&&(c=g.colorize,e=this._lastColorize,e[0]!==c[0]||e[1]!==c[1]||e[2]!==c[2]||e[3]!==c[3])&&(f.uniform4fv(this._uColorize,c),e[0]=c[0],
e[1]=c[1],e[2]=c[2],e[3]=c[3]);m.combined&&(b=b._geometry._getVertexBufs(),b.id!==this._lastVertexBufsId&&(b.positionsBuf&&this._aPosition&&(this._aPosition.bindArrayBuffer(b.positionsBuf,b.quantized?f.UNSIGNED_SHORT:f.FLOAT),a.bindArray++),b.normalsBuf&&this._aNormal&&(this._aNormal.bindArrayBuffer(b.normalsBuf,b.quantized?f.BYTE:f.FLOAT),a.bindArray++),b.uvBuf&&this._aUV&&(this._aUV.bindArrayBuffer(b.uvBuf,m.quantized?f.UNSIGNED_SHORT:f.FLOAT),a.bindArray++),b.colorsBuf&&this._aColor&&(this._aColor.bindArrayBuffer(b.colorsBuf),
a.bindArray++),b.flagsBuf&&this._aFlags&&(this._aFlags.bindArrayBuffer(b.flagsBuf,f.UNSIGNED_SHORT),a.bindArray++),this._lastVertexBufsId=b.id));m.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&f.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,m.positionsDecodeMatrix),this._uUVDecodeMatrix&&f.uniformMatrix3fv(this._uUVDecodeMatrix,!1,m.uvDecodeMatrix),m.combined?m.indicesBufCombined&&(m.indicesBufCombined.bind(),a.bindArray++):(this._aPosition&&(this._aPosition.bindArrayBuffer(m.positionsBuf,
m.quantized?f.UNSIGNED_SHORT:f.FLOAT),a.bindArray++),this._aNormal&&(this._aNormal.bindArrayBuffer(m.normalsBuf,m.quantized?f.BYTE:f.FLOAT),a.bindArray++),this._aUV&&(this._aUV.bindArrayBuffer(m.uvBuf,m.quantized?f.UNSIGNED_SHORT:f.FLOAT),a.bindArray++),this._aColor&&(this._aColor.bindArrayBuffer(m.colorsBuf),a.bindArray++),this._aFlags&&(this._aFlags.bindArrayBuffer(m.flagsBuf),a.bindArray++),m.indicesBuf&&(m.indicesBuf.bind(),a.bindArray++)),this._lastGeometryId=m.id);m.combined?m.indicesBufCombined&&
(f.drawElements(m.primitive,m.indicesBufCombined.numItems,m.indicesBufCombined.itemType,0),a.drawElements++):m.indicesBuf?(f.drawElements(m.primitive,m.indicesBuf.numItems,m.indicesBuf.itemType,0),a.drawElements++):m.positions&&(f.drawArrays(f.TRIANGLES,0,m.positions.numItems),a.drawArrays++)};wa.prototype._allocate=function(a){const b=a._material;var c=a.scene._lightsState;const d=a.scene._clipsState,f=a._material._state;this._program=new Ba(a.scene.canvas.gl,this._shaderSource);if(this._program.errors)this.errors=
this._program.errors;else{a=this._program;this._uPositionsDecodeMatrix=a.getLocation("positionsDecodeMatrix");this._uUVDecodeMatrix=a.getLocation("uvDecodeMatrix");this._uModelMatrix=a.getLocation("modelMatrix");this._uModelNormalMatrix=a.getLocation("modelNormalMatrix");this._uViewMatrix=a.getLocation("viewMatrix");this._uViewNormalMatrix=a.getLocation("viewNormalMatrix");this._uProjMatrix=a.getLocation("projMatrix");this._uGammaFactor=a.getLocation("gammaFactor");this._uLightAmbient=[];this._uLightColor=
[];this._uLightDir=[];this._uLightPos=[];this._uLightAttenuation=[];this._uShadowViewMatrix=[];this._uShadowProjMatrix=[];for(var e=c.lights,g,h=0,m=e.length;h<m;h++){g=e[h];switch(g.type){case "ambient":this._uLightAmbient[h]=a.getLocation("lightAmbient");break;case "dir":this._uLightColor[h]=a.getLocation("lightColor"+h);this._uLightPos[h]=null;this._uLightDir[h]=a.getLocation("lightDir"+h);break;case "point":this._uLightColor[h]=a.getLocation("lightColor"+h);this._uLightPos[h]=a.getLocation("lightPos"+
h);this._uLightDir[h]=null;this._uLightAttenuation[h]=a.getLocation("lightAttenuation"+h);break;case "spot":this._uLightColor[h]=a.getLocation("lightColor"+h),this._uLightPos[h]=a.getLocation("lightPos"+h),this._uLightDir[h]=a.getLocation("lightDir"+h),this._uLightAttenuation[h]=a.getLocation("lightAttenuation"+h)}g.shadow&&(this._uShadowViewMatrix[h]=a.getLocation("shadowViewMatrix"+h),this._uShadowProjMatrix[h]=a.getLocation("shadowProjMatrix"+h))}0<c.lightMaps.length&&(this._uLightMap="lightMap");
0<c.reflectionMaps.length&&(this._uReflectionMap="reflectionMap");this._uClips=[];c=d.clips;h=0;for(m=c.length;h<m;h++)this._uClips.push({active:a.getLocation("clipActive"+h),pos:a.getLocation("clipPos"+h),dir:a.getLocation("clipDir"+h)});this._uPointSize=a.getLocation("pointSize");switch(f.type){case "LambertMaterial":this._uMaterialColor=a.getLocation("materialColor");this._uMaterialEmissive=a.getLocation("materialEmissive");this._uAlphaModeCutoff=a.getLocation("materialAlphaModeCutoff");break;
case "PhongMaterial":this._uMaterialAmbient=a.getLocation("materialAmbient");this._uMaterialDiffuse=a.getLocation("materialDiffuse");this._uMaterialSpecular=a.getLocation("materialSpecular");this._uMaterialEmissive=a.getLocation("materialEmissive");this._uAlphaModeCutoff=a.getLocation("materialAlphaModeCutoff");this._uMaterialShininess=a.getLocation("materialShininess");b._ambientMap&&(this._uMaterialAmbientMap="ambientMap",this._uMaterialAmbientMapMatrix=a.getLocation("ambientMapMatrix"));b._diffuseMap&&
(this._uDiffuseMap="diffuseMap",this._uDiffuseMapMatrix=a.getLocation("diffuseMapMatrix"));b._specularMap&&(this._uSpecularMap="specularMap",this._uSpecularMapMatrix=a.getLocation("specularMapMatrix"));b._emissiveMap&&(this._uEmissiveMap="emissiveMap",this._uEmissiveMapMatrix=a.getLocation("emissiveMapMatrix"));b._alphaMap&&(this._uAlphaMap="alphaMap",this._uAlphaMapMatrix=a.getLocation("alphaMapMatrix"));b._reflectivityMap&&(this._uReflectivityMap="reflectivityMap",this._uReflectivityMapMatrix=a.getLocation("reflectivityMapMatrix"));
b._normalMap&&(this._uNormalMap="normalMap",this._uNormalMapMatrix=a.getLocation("normalMapMatrix"));b._occlusionMap&&(this._uOcclusionMap="occlusionMap",this._uOcclusionMapMatrix=a.getLocation("occlusionMapMatrix"));b._diffuseFresnel&&(this._uDiffuseFresnelEdgeBias=a.getLocation("diffuseFresnelEdgeBias"),this._uDiffuseFresnelCenterBias=a.getLocation("diffuseFresnelCenterBias"),this._uDiffuseFresnelEdgeColor=a.getLocation("diffuseFresnelEdgeColor"),this._uDiffuseFresnelCenterColor=a.getLocation("diffuseFresnelCenterColor"),
this._uDiffuseFresnelPower=a.getLocation("diffuseFresnelPower"));b._specularFresnel&&(this._uSpecularFresnelEdgeBias=a.getLocation("specularFresnelEdgeBias"),this._uSpecularFresnelCenterBias=a.getLocation("specularFresnelCenterBias"),this._uSpecularFresnelEdgeColor=a.getLocation("specularFresnelEdgeColor"),this._uSpecularFresnelCenterColor=a.getLocation("specularFresnelCenterColor"),this._uSpecularFresnelPower=a.getLocation("specularFresnelPower"));b._alphaFresnel&&(this._uAlphaFresnelEdgeBias=a.getLocation("alphaFresnelEdgeBias"),
this._uAlphaFresnelCenterBias=a.getLocation("alphaFresnelCenterBias"),this._uAlphaFresnelEdgeColor=a.getLocation("alphaFresnelEdgeColor"),this._uAlphaFresnelCenterColor=a.getLocation("alphaFresnelCenterColor"),this._uAlphaFresnelPower=a.getLocation("alphaFresnelPower"));b._reflectivityFresnel&&(this._uReflectivityFresnelEdgeBias=a.getLocation("reflectivityFresnelEdgeBias"),this._uReflectivityFresnelCenterBias=a.getLocation("reflectivityFresnelCenterBias"),this._uReflectivityFresnelEdgeColor=a.getLocation("reflectivityFresnelEdgeColor"),
this._uReflectivityFresnelCenterColor=a.getLocation("reflectivityFresnelCenterColor"),this._uReflectivityFresnelPower=a.getLocation("reflectivityFresnelPower"));b._emissiveFresnel&&(this._uEmissiveFresnelEdgeBias=a.getLocation("emissiveFresnelEdgeBias"),this._uEmissiveFresnelCenterBias=a.getLocation("emissiveFresnelCenterBias"),this._uEmissiveFresnelEdgeColor=a.getLocation("emissiveFresnelEdgeColor"),this._uEmissiveFresnelCenterColor=a.getLocation("emissiveFresnelCenterColor"),this._uEmissiveFresnelPower=
a.getLocation("emissiveFresnelPower"));break;case "MetallicMaterial":this._uBaseColor=a.getLocation("materialBaseColor");this._uMaterialMetallic=a.getLocation("materialMetallic");this._uMaterialRoughness=a.getLocation("materialRoughness");this._uMaterialSpecularF0=a.getLocation("materialSpecularF0");this._uMaterialEmissive=a.getLocation("materialEmissive");this._uAlphaModeCutoff=a.getLocation("materialAlphaModeCutoff");b._baseColorMap&&(this._uBaseColorMap="baseColorMap",this._uBaseColorMapMatrix=
a.getLocation("baseColorMapMatrix"));b._metallicMap&&(this._uMetallicMap="metallicMap",this._uMetallicMapMatrix=a.getLocation("metallicMapMatrix"));b._roughnessMap&&(this._uRoughnessMap="roughnessMap",this._uRoughnessMapMatrix=a.getLocation("roughnessMapMatrix"));b._metallicRoughnessMap&&(this._uMetallicRoughnessMap="metallicRoughnessMap",this._uMetallicRoughnessMapMatrix=a.getLocation("metallicRoughnessMapMatrix"));b._emissiveMap&&(this._uEmissiveMap="emissiveMap",this._uEmissiveMapMatrix=a.getLocation("emissiveMapMatrix"));
b._occlusionMap&&(this._uOcclusionMap="occlusionMap",this._uOcclusionMapMatrix=a.getLocation("occlusionMapMatrix"));b._alphaMap&&(this._uAlphaMap="alphaMap",this._uAlphaMapMatrix=a.getLocation("alphaMapMatrix"));b._normalMap&&(this._uNormalMap="normalMap",this._uNormalMapMatrix=a.getLocation("normalMapMatrix"));break;case "SpecularMaterial":this._uMaterialDiffuse=a.getLocation("materialDiffuse"),this._uMaterialSpecular=a.getLocation("materialSpecular"),this._uMaterialGlossiness=a.getLocation("materialGlossiness"),
this._uMaterialReflectivity=a.getLocation("reflectivityFresnel"),this._uMaterialEmissive=a.getLocation("materialEmissive"),this._uAlphaModeCutoff=a.getLocation("materialAlphaModeCutoff"),b._diffuseMap&&(this._uDiffuseMap="diffuseMap",this._uDiffuseMapMatrix=a.getLocation("diffuseMapMatrix")),b._specularMap&&(this._uSpecularMap="specularMap",this._uSpecularMapMatrix=a.getLocation("specularMapMatrix")),b._glossinessMap&&(this._uGlossinessMap="glossinessMap",this._uGlossinessMapMatrix=a.getLocation("glossinessMapMatrix")),
b._specularGlossinessMap&&(this._uSpecularGlossinessMap="materialSpecularGlossinessMap",this._uSpecularGlossinessMapMatrix=a.getLocation("materialSpecularGlossinessMapMatrix")),b._emissiveMap&&(this._uEmissiveMap="emissiveMap",this._uEmissiveMapMatrix=a.getLocation("emissiveMapMatrix")),b._occlusionMap&&(this._uOcclusionMap="occlusionMap",this._uOcclusionMapMatrix=a.getLocation("occlusionMapMatrix")),b._alphaMap&&(this._uAlphaMap="alphaMap",this._uAlphaMapMatrix=a.getLocation("alphaMapMatrix")),b._normalMap&&
(this._uNormalMap="normalMap",this._uNormalMapMatrix=a.getLocation("normalMapMatrix"))}this._aPosition=a.getAttribute("position");this._aNormal=a.getAttribute("normal");this._aUV=a.getAttribute("uv");this._aColor=a.getAttribute("color");this._aFlags=a.getAttribute("flags");this._uClippable=a.getLocation("clippable");this._uColorize=a.getLocation("colorize");this._lastGeometryId=this._lastVertexBufsId=this._lastMaterialId=null;this._lastColorize=new Float32Array(4);this._baseTextureUnit=0}};wa.prototype._bindProgram=
function(a){var b=Y.MAX_TEXTURE_UNITS;const c=this._scene,d=c.canvas.gl;var f=c._lightsState,e=c._clipsState,g=this._program;g.bind();a.useProgram++;a.textureUnit=0;this._lastGeometryId=this._lastVertexBufsId=this._lastMaterialId=null;this._lastColorize[0]=-1;this._lastColorize[1]=-1;this._lastColorize[2]=-1;this._lastColorize[3]=-1;var h=c.camera,m=h._state;d.uniformMatrix4fv(this._uViewMatrix,!1,m.matrix);d.uniformMatrix4fv(this._uViewNormalMatrix,!1,m.normalMatrix);d.uniformMatrix4fv(this._uProjMatrix,
!1,h._project._state.matrix);h=0;for(m=f.lights.length;h<m;h++){var n=f.lights[h];if(this._uLightAmbient[h])d.uniform4f(this._uLightAmbient[h],n.color[0],n.color[1],n.color[2],n.intensity);else if(this._uLightColor[h]&&d.uniform4f(this._uLightColor[h],n.color[0],n.color[1],n.color[2],n.intensity),this._uLightPos[h]&&(d.uniform3fv(this._uLightPos[h],n.pos),this._uLightAttenuation[h]&&d.uniform1f(this._uLightAttenuation[h],n.attenuation)),this._uLightDir[h]&&d.uniform3fv(this._uLightDir[h],n.dir),n.shadow&&
(this._uShadowViewMatrix[h]&&d.uniformMatrix4fv(this._uShadowViewMatrix[h],!1,n.getShadowViewMatrix()),this._uShadowProjMatrix[h]&&d.uniformMatrix4fv(this._uShadowProjMatrix[h],!1,n.getShadowProjMatrix()),n=n.getShadowRenderBuf()))g.bindTexture("shadowMap"+h,n.getTexture(),a.textureUnit),a.textureUnit=(a.textureUnit+1)%b,a.bindTexture++}0<f.lightMaps.length&&f.lightMaps[0].texture&&this._uLightMap&&(g.bindTexture(this._uLightMap,f.lightMaps[0].texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%
b,a.bindTexture++);0<f.reflectionMaps.length&&f.reflectionMaps[0].texture&&this._uReflectionMap&&(g.bindTexture(this._uReflectionMap,f.reflectionMaps[0].texture,a.textureUnit),a.textureUnit=(a.textureUnit+1)%b,a.bindTexture++);if(0<e.clips.length)for(b=c._clipsState.clips,h=0,m=this._uClips.length;h<m;h++)f=this._uClips[h],g=f.active,e=b[h],g&&d.uniform1i(g,e.active),(g=f.pos)&&d.uniform3fv(f.pos,e.pos),(g=f.dir)&&d.uniform3fv(f.dir,e.dir);this._uGammaFactor&&d.uniform1f(this._uGammaFactor,c.gammaFactor);
this._baseTextureUnit=a.textureUnit};class Zd{constructor(a){var b=a.scene,c=b._lightsState;var d=a._geometry._state.primitiveName;d=!a._geometry._state.autoVertexNormals&&!a._geometry._state.normals||"triangles"!==d&&"triangle-strip"!==d&&"triangle-fan"!==d?!1:!0;b=0<b._clipsState.clips.length;var f=!!a._geometry._state.quantized,e=a._state.billboard,g=a._state.stationary;const h=[];let m,n,p;h.push("// EmphasisFillShaderSource vertex shader");h.push("attribute vec3 position;");h.push("uniform mat4 modelMatrix;");
h.push("uniform mat4 viewMatrix;");h.push("uniform mat4 projMatrix;");h.push("uniform vec4 colorize;");f&&h.push("uniform mat4 positionsDecodeMatrix;");b&&h.push("varying vec4 vWorldPosition;");h.push("uniform vec4   lightAmbient;");h.push("uniform vec4   fillColor;");if(d){h.push("attribute vec3 normal;");h.push("uniform mat4 modelNormalMatrix;");h.push("uniform mat4 viewNormalMatrix;");m=0;for(n=c.lights.length;m<n;m++)p=c.lights[m],"ambient"!==p.type&&(h.push("uniform vec4 lightColor"+m+";"),"dir"===
p.type&&h.push("uniform vec3 lightDir"+m+";"),"point"===p.type&&h.push("uniform vec3 lightPos"+m+";"),"spot"===p.type&&h.push("uniform vec3 lightPos"+m+";"));f&&(h.push("vec3 octDecode(vec2 oct) {"),h.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),h.push("    if (v.z < 0.0) {"),h.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),h.push("    }"),h.push("    return normalize(v);"),h.push("}"))}h.push("varying vec4 vColor;");if("spherical"===
e||"cylindrical"===e)h.push("void billboard(inout mat4 mat) {"),h.push("   mat[0][0] = 1.0;"),h.push("   mat[0][1] = 0.0;"),h.push("   mat[0][2] = 0.0;"),"spherical"===e&&(h.push("   mat[1][0] = 0.0;"),h.push("   mat[1][1] = 1.0;"),h.push("   mat[1][2] = 0.0;")),h.push("   mat[2][0] = 0.0;"),h.push("   mat[2][1] = 0.0;"),h.push("   mat[2][2] =1.0;"),h.push("}");h.push("void main(void) {");h.push("vec4 localPosition = vec4(position, 1.0); ");h.push("vec4 worldPosition;");f&&h.push("localPosition = positionsDecodeMatrix * localPosition;");
d&&(f?h.push("vec4 localNormal = vec4(octDecode(normal.xy), 0.0); "):h.push("vec4 localNormal = vec4(normal, 0.0); "),h.push("mat4 modelNormalMatrix2 = modelNormalMatrix;"),h.push("mat4 viewNormalMatrix2 = viewNormalMatrix;"));h.push("mat4 viewMatrix2 = viewMatrix;");h.push("mat4 modelMatrix2 = modelMatrix;");g&&h.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"===e||"cylindrical"===e?(h.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),h.push("billboard(modelMatrix2);"),
h.push("billboard(viewMatrix2);"),h.push("billboard(modelViewMatrix);"),d&&(h.push("mat4 modelViewNormalMatrix =  viewNormalMatrix2 * modelNormalMatrix2;"),h.push("billboard(modelNormalMatrix2);"),h.push("billboard(viewNormalMatrix2);"),h.push("billboard(modelViewNormalMatrix);")),h.push("worldPosition = modelMatrix2 * localPosition;"),h.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(h.push("worldPosition = modelMatrix2 * localPosition;"),h.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));
d&&h.push("vec3 viewNormal = normalize((viewNormalMatrix2 * modelNormalMatrix2 * localNormal).xyz);");h.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);");h.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);");h.push("float lambertian = 1.0;");if(d)for(m=0,n=c.lights.length;m<n;m++)if(p=c.lights[m],"ambient"!==p.type){if("dir"===p.type)"view"===p.space?h.push("viewLightDir = normalize(lightDir"+m+");"):h.push("viewLightDir = normalize((viewMatrix2 * vec4(lightDir"+m+", 0.0)).xyz);");else if("point"===
p.type)"view"===p.space?h.push("viewLightDir = normalize(lightPos"+m+" - viewPosition.xyz);"):h.push("viewLightDir = normalize((viewMatrix2 * vec4(lightPos"+m+", 0.0)).xyz);");else continue;h.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);");h.push("reflectedColor += lambertian * (lightColor"+m+".rgb * lightColor"+m+".a);")}h.push("vColor = vec4(reflectedColor * fillColor.rgb, fillColor.a);");b&&h.push("vWorldPosition = worldPosition;");"points"===a._geometry._state.primitiveName&&h.push("gl_PointSize = pointSize;");
h.push("   gl_Position = projMatrix * viewPosition;");h.push("}");this.vertex=h;c=a.scene._clipsState;d=a.scene.gammaOutput;b=0<c.clips.length;g=[];g.push("// Lambertian drawing fragment shader");g.push("precision lowp float;");d&&(g.push("uniform float gammaFactor;"),g.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),g.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),g.push("}"));if(b)for(g.push("varying vec4 vWorldPosition;"),g.push("uniform bool clippable;"),
f=0,e=c.clips.length;f<e;f++)g.push("uniform bool clipActive"+f+";"),g.push("uniform vec3 clipPos"+f+";"),g.push("uniform vec3 clipDir"+f+";");g.push("varying vec4 vColor;");g.push("void main(void) {");if(b){g.push("if (clippable) {");g.push("  float dist = 0.0;");f=0;for(e=c.clips.length;f<e;f++)g.push("if (clipActive"+f+") {"),g.push("   dist += clamp(dot(-clipDir"+f+".xyz, vWorldPosition.xyz - clipPos"+f+".xyz), 0.0, 1000.0);"),g.push("}");g.push("  if (dist > 0.0) { discard; }");g.push("}")}"points"===
a._geometry._state.primitiveName&&(g.push("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),g.push("float r = dot(cxy, cxy);"),g.push("if (r > 1.0) {"),g.push("   discard;"),g.push("}"));g.push("gl_FragColor = vColor;");d?g.push("gl_FragColor = linearToGamma(vColor, gammaFactor);"):g.push("gl_FragColor = vColor;");g.push("}");this.fragment=g}}const Zc=new ta({}),pa=function(a,b){this.id=Zc.addItem({});this._hash=a;this._scene=b.scene;this._useCount=0;this._shaderSource=new Zd(b);this._allocate(b)},Tb={};pa.get=
function(a){const b=[a.scene.id,a.scene.gammaOutput?"go":"",a.scene._clipsState.getHash(),a._geometry.normals?"n":"",a._geometry._state.quantized?"cp":"",a._state.hash].join(";");let c=Tb[b];c||(c=new pa(b,a),Tb[b]=c,P.memory.programs++);c._useCount++;return c};pa.prototype.put=function(){0===--this._useCount&&(Zc.removeItem(this.id),this._program&&this._program.destroy(),delete Tb[this._hash],P.memory.programs--)};pa.prototype.webglContextRestored=function(){this._program=null};pa.prototype.drawMesh=
function(a,b,c){this._program||this._allocate(b);const d=this._scene.canvas.gl,f=0===c?b._ghostMaterial._state:1===c?b._highlightMaterial._state:b._selectedMaterial._state,e=b._state;c=b._geometry._state;a.lastProgramId!==this._program.id&&(a.lastProgramId=this._program.id,this._bindProgram(a));if(f.id!==this._lastMaterialId){const g=f.fillColor,h=f.backfaces;a.backfaces!==h&&(h?d.disable(d.CULL_FACE):d.enable(d.CULL_FACE),a.backfaces=h);d.uniform4f(this._uFillColor,g[0],g[1],g[2],f.fillAlpha);this._lastMaterialId=
f.id}d.uniformMatrix4fv(this._uModelMatrix,d.FALSE,b.worldMatrix);this._uModelNormalMatrix&&d.uniformMatrix4fv(this._uModelNormalMatrix,d.FALSE,b.worldNormalMatrix);this._uClippable&&d.uniform1i(this._uClippable,e.clippable);c.combined&&(b=b._geometry._getVertexBufs(),b.id!==this._lastVertexBufsId&&(b.positionsBuf&&this._aPosition&&(this._aPosition.bindArrayBuffer(b.positionsBuf,b.quantized?d.UNSIGNED_SHORT:d.FLOAT),a.bindArray++),b.normalsBuf&&this._aNormal&&(this._aNormal.bindArrayBuffer(b.normalsBuf,
b.quantized?d.BYTE:d.FLOAT),a.bindArray++),this._lastVertexBufsId=b.id));c.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&d.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,c.positionsDecodeMatrix),this._uUVDecodeMatrix&&d.uniformMatrix3fv(this._uUVDecodeMatrix,!1,c.uvDecodeMatrix),c.combined?c.indicesBufCombined&&(c.indicesBufCombined.bind(),a.bindArray++):(this._aPosition&&(this._aPosition.bindArrayBuffer(c.positionsBuf,c.quantized?d.UNSIGNED_SHORT:d.FLOAT),a.bindArray++),this._aNormal&&
(this._aNormal.bindArrayBuffer(c.normalsBuf,c.quantized?d.BYTE:d.FLOAT),a.bindArray++),c.indicesBuf&&(c.indicesBuf.bind(),a.bindArray++)),this._lastGeometryId=c.id);c.combined?c.indicesBufCombined&&(d.drawElements(c.primitive,c.indicesBufCombined.numItems,c.indicesBufCombined.itemType,0),a.drawElements++):c.indicesBuf?(d.drawElements(c.primitive,c.indicesBuf.numItems,c.indicesBuf.itemType,0),a.drawElements++):c.positions&&(d.drawArrays(d.TRIANGLES,0,c.positions.numItems),a.drawArrays++)};pa.prototype._allocate=
function(a){const b=a.scene._lightsState,c=a.scene._clipsState;this._program=new Ba(a.scene.canvas.gl,this._shaderSource);if(this._program.errors)this.errors=this._program.errors;else{a=this._program;this._uPositionsDecodeMatrix=a.getLocation("positionsDecodeMatrix");this._uModelMatrix=a.getLocation("modelMatrix");this._uModelNormalMatrix=a.getLocation("modelNormalMatrix");this._uViewMatrix=a.getLocation("viewMatrix");this._uViewNormalMatrix=a.getLocation("viewNormalMatrix");this._uProjMatrix=a.getLocation("projMatrix");
this._uLightAmbient=[];this._uLightColor=[];this._uLightDir=[];this._uLightPos=[];this._uLightAttenuation=[];for(var d=0,f=b.lights.length;d<f;d++)switch(b.lights[d].type){case "ambient":this._uLightAmbient[d]=a.getLocation("lightAmbient");break;case "dir":this._uLightColor[d]=a.getLocation("lightColor"+d);this._uLightPos[d]=null;this._uLightDir[d]=a.getLocation("lightDir"+d);break;case "point":this._uLightColor[d]=a.getLocation("lightColor"+d),this._uLightPos[d]=a.getLocation("lightPos"+d),this._uLightDir[d]=
null,this._uLightAttenuation[d]=a.getLocation("lightAttenuation"+d)}this._uClips=[];d=0;for(f=c.clips.length;d<f;d++)this._uClips.push({active:a.getLocation("clipActive"+d),pos:a.getLocation("clipPos"+d),dir:a.getLocation("clipDir"+d)});this._uFillColor=a.getLocation("fillColor");this._aPosition=a.getAttribute("position");this._aNormal=a.getAttribute("normal");this._uClippable=a.getLocation("clippable");this._uGammaFactor=a.getLocation("gammaFactor");this._lastGeometryId=this._lastVertexBufsId=this._lastMaterialId=
null}};pa.prototype._bindProgram=function(a){const b=this._scene,c=b.canvas.gl;var d=b._clipsState,f=b._lightsState,e=b.camera,g=e._state;this._program.bind();a.useProgram++;a.textureUnit=0;this._lastIndicesBufId=this._lastGeometryId=this._lastVertexBufsId=this._lastMaterialId=null;c.uniformMatrix4fv(this._uViewMatrix,!1,g.matrix);c.uniformMatrix4fv(this._uViewNormalMatrix,!1,g.normalMatrix);c.uniformMatrix4fv(this._uProjMatrix,!1,e.project._state.matrix);a=0;for(e=f.lights.length;a<e;a++)g=f.lights[a],
this._uLightAmbient[a]?c.uniform4f(this._uLightAmbient[a],g.color[0],g.color[1],g.color[2],g.intensity):(this._uLightColor[a]&&c.uniform4f(this._uLightColor[a],g.color[0],g.color[1],g.color[2],g.intensity),this._uLightPos[a]&&(c.uniform3fv(this._uLightPos[a],g.pos),this._uLightAttenuation[a]&&c.uniform1f(this._uLightAttenuation[a],g.attenuation)),this._uLightDir[a]&&c.uniform3fv(this._uLightDir[a],g.dir));if(0<d.clips.length)for(d=b._clipsState.clips,a=0,e=this._uClips.length;a<e;a++){f=this._uClips[a];
var h=f.active;g=d[a];h&&c.uniform1i(h,g.active);(h=f.pos)&&c.uniform3fv(f.pos,g.pos);(h=f.dir)&&c.uniform3fv(f.dir,g.dir)}this._uGammaFactor&&c.uniform1f(this._uGammaFactor,b.gammaFactor)};class $d{constructor(a){var b=0<a.scene._clipsState.clips.length,c=!!a._geometry._state.quantized,d=a._state.billboard,f=a._state.stationary,e=[];e.push("// Edges drawing vertex shader");e.push("attribute vec3 position;");e.push("uniform mat4 modelMatrix;");e.push("uniform mat4 viewMatrix;");e.push("uniform mat4 projMatrix;");
e.push("uniform vec4 edgeColor;");c&&e.push("uniform mat4 positionsDecodeMatrix;");b&&e.push("varying vec4 vWorldPosition;");e.push("varying vec4 vColor;");if("spherical"===d||"cylindrical"===d)e.push("void billboard(inout mat4 mat) {"),e.push("   mat[0][0] = 1.0;"),e.push("   mat[0][1] = 0.0;"),e.push("   mat[0][2] = 0.0;"),"spherical"===d&&(e.push("   mat[1][0] = 0.0;"),e.push("   mat[1][1] = 1.0;"),e.push("   mat[1][2] = 0.0;")),e.push("   mat[2][0] = 0.0;"),e.push("   mat[2][1] = 0.0;"),e.push("   mat[2][2] =1.0;"),
e.push("}");e.push("void main(void) {");e.push("vec4 localPosition = vec4(position, 1.0); ");e.push("vec4 worldPosition;");c&&e.push("localPosition = positionsDecodeMatrix * localPosition;");e.push("mat4 viewMatrix2 = viewMatrix;");e.push("mat4 modelMatrix2 = modelMatrix;");f&&e.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"===d||"cylindrical"===d?(e.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),e.push("billboard(modelMatrix2);"),e.push("billboard(viewMatrix2);"),
e.push("billboard(modelViewMatrix);"),e.push("worldPosition = modelMatrix2 * localPosition;"),e.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(e.push("worldPosition = modelMatrix2 * localPosition;"),e.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));e.push("vColor = edgeColor;");b&&e.push("vWorldPosition = worldPosition;");e.push("   gl_Position = projMatrix * viewPosition;");e.push("}");this.vertex=e;b=a.scene._clipsState;a=a.scene.gammaOutput;c=0<b.clips.length;e=[];e.push("// Edges drawing fragment shader");
e.push("precision lowp float;");a&&(e.push("uniform float gammaFactor;"),e.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),e.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),e.push("}"));if(c)for(e.push("varying vec4 vWorldPosition;"),e.push("uniform bool clippable;"),d=0,f=b.clips.length;d<f;d++)e.push("uniform bool clipActive"+d+";"),e.push("uniform vec3 clipPos"+d+";"),e.push("uniform vec3 clipDir"+d+";");e.push("varying vec4 vColor;");e.push("void main(void) {");
if(c){e.push("if (clippable) {");e.push("  float dist = 0.0;");d=0;for(f=b.clips.length;d<f;d++)e.push("if (clipActive"+d+") {"),e.push("   dist += clamp(dot(-clipDir"+d+".xyz, vWorldPosition.xyz - clipPos"+d+".xyz), 0.0, 1000.0);"),e.push("}");e.push("  if (dist > 0.0) { discard; }");e.push("}")}e.push("gl_FragColor = vColor;");a?e.push("gl_FragColor = linearToGamma(vColor, gammaFactor);"):e.push("gl_FragColor = vColor;");e.push("}");this.fragment=e}}const $c=new ta({}),la=function(a,b){this.id=
$c.addItem({});this._hash=a;this._scene=b.scene;this._useCount=0;this._shaderSource=new $d(b);this._allocate(b)},Ub={};la.get=function(a){const b=[a.scene.id,a.scene.gammaOutput?"go":"",a.scene._clipsState.getHash(),a._geometry._state.quantized?"cp":"",a._state.hash].join(";");let c=Ub[b];c||(c=new la(b,a),Ub[b]=c,P.memory.programs++);c._useCount++;return c};la.prototype.put=function(){0===--this._useCount&&($c.removeItem(this.id),this._program&&this._program.destroy(),delete Ub[this._hash],P.memory.programs--)};
la.prototype.webglContextRestored=function(){this._program=null};la.prototype.drawMesh=function(a,b,c){this._program||this._allocate(b);const d=this._scene.canvas.gl,f=b._state,e=b._geometry,g=e._state;a.lastProgramId!==this._program.id&&(a.lastProgramId=this._program.id,this._bindProgram(a));switch(c){case 0:c=b._ghostMaterial._state;break;case 1:c=b._highlightMaterial._state;break;case 2:c=b._selectedMaterial._state;break;default:c=b._edgeMaterial._state}if(c.id!==this._lastMaterialId){var h=c.backfaces;
a.backfaces!==h&&(h?d.disable(d.CULL_FACE):d.enable(d.CULL_FACE),a.backfaces=h);a.lineWidth!==c.edgeWidth&&(d.lineWidth(c.edgeWidth),a.lineWidth=c.edgeWidth);this._uEdgeColor&&(h=c.edgeColor,d.uniform4f(this._uEdgeColor,h[0],h[1],h[2],c.edgeAlpha));this._lastMaterialId=c.id}d.uniformMatrix4fv(this._uModelMatrix,d.FALSE,b.worldMatrix);this._uModelNormalMatrix&&d.uniformMatrix4fv(this._uModelNormalMatrix,d.FALSE,b.worldNormalMatrix);this._uClippable&&d.uniform1i(this._uClippable,f.clippable);g.combined&&
(b=b._geometry._getVertexBufs(),b.id!==this._lastVertexBufsId&&(b.positionsBuf&&this._aPosition&&(this._aPosition.bindArrayBuffer(b.positionsBuf,b.quantized?d.UNSIGNED_SHORT:d.FLOAT),a.bindArray++),this._lastVertexBufsId=b.id));let m;g.primitive===d.TRIANGLES?m=e._getEdgesIndices():g.primitive===d.LINES&&(m=g.indicesBuf);m&&(g.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&d.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,g.positionsDecodeMatrix),!g.combined&&this._aPosition&&(this._aPosition.bindArrayBuffer(g.positionsBuf,
g.quantized?d.UNSIGNED_SHORT:d.FLOAT),a.bindArray++),m.bind(),a.bindArray++,this._lastGeometryId=g.id),d.drawElements(d.LINES,m.numItems,m.itemType,0),a.drawElements++)};la.prototype._allocate=function(a){const b=a.scene._clipsState;this._program=new Ba(a.scene.canvas.gl,this._shaderSource);if(this._program.errors)this.errors=this._program.errors;else{a=this._program;this._uPositionsDecodeMatrix=a.getLocation("positionsDecodeMatrix");this._uModelMatrix=a.getLocation("modelMatrix");this._uViewMatrix=
a.getLocation("viewMatrix");this._uProjMatrix=a.getLocation("projMatrix");this._uClips=[];for(let c=0,d=b.clips.length;c<d;c++)this._uClips.push({active:a.getLocation("clipActive"+c),pos:a.getLocation("clipPos"+c),dir:a.getLocation("clipDir"+c)});this._uEdgeColor=a.getLocation("edgeColor");this._aPosition=a.getAttribute("position");this._uClippable=a.getLocation("clippable");this._uGammaFactor=a.getLocation("gammaFactor");this._lastGeometryId=this._lastVertexBufsId=this._lastMaterialId=null}};la.prototype._bindProgram=
function(a){const b=this._scene,c=b.canvas.gl;var d=b._clipsState,f=b.camera,e=f._state;this._program.bind();a.useProgram++;this._lastGeometryId=this._lastVertexBufsId=this._lastMaterialId=null;c.uniformMatrix4fv(this._uViewMatrix,!1,e.matrix);c.uniformMatrix4fv(this._uProjMatrix,!1,f.project._state.matrix);if(0<d.clips.length){a=d.clips;for(let g=0,h=this._uClips.length;g<h;g++)d=this._uClips[g],e=d.active,f=a[g],e&&c.uniform1i(e,f.active),(e=d.pos)&&c.uniform3fv(d.pos,f.pos),(e=d.dir)&&c.uniform3fv(d.dir,
f.dir)}this._uGammaFactor&&c.uniform1f(this._uGammaFactor,b.gammaFactor)};class ae{constructor(a){var b=0<a.scene._clipsState.clips.length,c=!!a._geometry._state.quantized,d=a._state.billboard,f=a._state.stationary,e=[];e.push("// Vertices drawing vertex shader");e.push("attribute vec3 position;");e.push("uniform mat4 modelMatrix;");e.push("uniform mat4 viewMatrix;");e.push("uniform mat4 projMatrix;");e.push("uniform vec4 vertexColor;");e.push("uniform float vertexSize;");c&&e.push("uniform mat4 positionsDecodeMatrix;");
b&&e.push("varying vec4 vWorldPosition;");e.push("varying vec4 vColor;");if("spherical"===d||"cylindrical"===d)e.push("void billboard(inout mat4 mat) {"),e.push("   mat[0][0] = 1.0;"),e.push("   mat[0][1] = 0.0;"),e.push("   mat[0][2] = 0.0;"),"spherical"===d&&(e.push("   mat[1][0] = 0.0;"),e.push("   mat[1][1] = 1.0;"),e.push("   mat[1][2] = 0.0;")),e.push("   mat[2][0] = 0.0;"),e.push("   mat[2][1] = 0.0;"),e.push("   mat[2][2] =1.0;"),e.push("}");e.push("void main(void) {");e.push("vec4 localPosition = vec4(position, 1.0); ");
e.push("vec4 worldPosition;");c&&e.push("localPosition = positionsDecodeMatrix * localPosition;");e.push("mat4 viewMatrix2 = viewMatrix;");e.push("mat4 modelMatrix2 = modelMatrix;");f&&e.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"===d||"cylindrical"===d?(e.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),e.push("billboard(modelMatrix2);"),e.push("billboard(viewMatrix2);"),e.push("billboard(modelViewMatrix);"),e.push("worldPosition = modelMatrix2 * localPosition;"),
e.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(e.push("worldPosition = modelMatrix2 * localPosition;"),e.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));e.push("vColor = vertexColor;");e.push("gl_PointSize = vertexSize;");b&&e.push("vWorldPosition = worldPosition;");e.push("   gl_Position = projMatrix * viewPosition;");e.push("}");this.vertex=e;b=a.scene._clipsState;a=a.scene.gammaOutput;c=0<b.clips.length;e=[];e.push("// Vertices drawing fragment shader");e.push("precision lowp float;");
a&&(e.push("uniform float gammaFactor;"),e.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),e.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),e.push("}"));if(c)for(e.push("varying vec4 vWorldPosition;"),e.push("uniform bool clippable;"),d=0,f=b.clips.length;d<f;d++)e.push("uniform bool clipActive"+d+";"),e.push("uniform vec3 clipPos"+d+";"),e.push("uniform vec3 clipDir"+d+";");e.push("varying vec4 vColor;");e.push("void main(void) {");if(c){e.push("if (clippable) {");
e.push("  float dist = 0.0;");d=0;for(f=b.clips.length;d<f;d++)e.push("if (clipActive"+d+") {"),e.push("   dist += clamp(dot(-clipDir"+d+".xyz, vWorldPosition.xyz - clipPos"+d+".xyz), 0.0, 1000.0);"),e.push("}");e.push("  if (dist > 0.0) { discard; }");e.push("}")}e.push("vec2 cxy = 2.0 * gl_PointCoord - 1.0;");e.push("float r = dot(cxy, cxy);");e.push("if (r > 1.0) {");e.push("   discard;");e.push("}");e.push("gl_FragColor = vColor;");a?e.push("gl_FragColor = linearToGamma(vColor, gammaFactor);"):
e.push("gl_FragColor = vColor;");e.push("}");this.fragment=e}}const ad=new ta({}),qa=function(a,b){this.id=ad.addItem({});this._hash=a;this._scene=b.scene;this._shaderSource=new ae(b);this._allocate(b)},Vb={};qa.get=function(a){const b=[a.scene.id,a.scene.gammaOutput?"go":"",a.scene._clipsState.getHash(),a._geometry._state.quantized?"cp":"",a._state.hash].join(";");let c=Vb[b];c||(c=new qa(b,a),Vb[b]=c,P.memory.programs++);c._useCount++;return c};qa.prototype.put=function(){0===--this._useCount&&
(this._scene.off(this._onWebglcontextrestored),ad.removeItem(this.id),this._program&&this._program.destroy(),delete Vb[this._hash],P.memory.programs--)};qa.prototype.webglContextRestored=function(){this._program=null};qa.prototype.drawMesh=function(a,b,c){this._program||this._allocate(b);const d=this._scene.canvas.gl,f=0===c?b._ghostMaterial._state:1===c?b._highlightMaterial._state:b._selectedMaterial._state,e=b._state;c=b._geometry._state;a.lastProgramId!==this._program.id&&(a.lastProgramId=this._program.id,
this._bindProgram(a,b));if(f.id!==this._lastMaterialId){var g=f.backfaces;a.backfaces!==g&&(g?d.disable(d.CULL_FACE):d.enable(d.CULL_FACE),a.backfaces=g);this._uVertexSize&&d.uniform1f(this._uVertexSize,f.vertexSize);this._uVertexColor&&(g=f.vertexColor,d.uniform4f(this._uVertexColor,g[0],g[1],g[2],f.vertexAlpha));this._lastMaterialId=f.id}d.uniformMatrix4fv(this._uModelMatrix,d.FALSE,b.worldMatrix);this._uModelNormalMatrix&&d.uniformMatrix4fv(this._uModelNormalMatrix,d.FALSE,b.worldNormalMatrix);
this._uClippable&&d.uniform1i(this._uClippable,e.clippable);c.combined&&(b=b._geometry._getVertexBufs(),b.id!==this._lastVertexBufsId&&(b.positionsBuf&&this._aPosition&&(this._aPosition.bindArrayBuffer(b.positionsBuf,b.quantized?d.UNSIGNED_SHORT:d.FLOAT),a.bindArray++),this._lastVertexBufsId=b.id));c.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&d.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,c.positionsDecodeMatrix),c.combined?c.indicesBufCombined&&(c.indicesBufCombined.bind(),a.bindArray++):
(this._aPosition&&(this._aPosition.bindArrayBuffer(c.positionsBuf,c.quantized?d.UNSIGNED_SHORT:d.FLOAT),a.bindArray++),c.indicesBuf&&(c.indicesBuf.bind(),a.bindArray++)),this._lastGeometryId=c.id);c.combined?c.indicesBufCombined&&(d.drawElements(d.POINTS,c.indicesBufCombined.numItems,c.indicesBufCombined.itemType,0),a.drawElements++):c.indicesBuf?(d.drawElements(d.POINTS,c.indicesBuf.numItems,c.indicesBuf.itemType,0),a.drawElements++):c.positions&&(d.drawArrays(d.POINTS,0,c.positions.numItems),a.drawArrays++)};
qa.prototype._allocate=function(a){const b=a.scene._clipsState;this._program=new Ba(a.scene.canvas.gl,this._shaderSource);this._useCount=0;if(this._program.errors)this.errors=this._program.errors;else{a=this._program;this._uPositionsDecodeMatrix=a.getLocation("positionsDecodeMatrix");this._uModelMatrix=a.getLocation("modelMatrix");this._uViewMatrix=a.getLocation("viewMatrix");this._uProjMatrix=a.getLocation("projMatrix");this._uClips=[];for(let c=0,d=b.clips.length;c<d;c++)this._uClips.push({active:a.getLocation("clipActive"+
c),pos:a.getLocation("clipPos"+c),dir:a.getLocation("clipDir"+c)});this._uVertexColor=a.getLocation("vertexColor");this._uVertexSize=a.getLocation("vertexSize");this._aPosition=a.getAttribute("position");this._uClippable=a.getLocation("clippable");this._uGammaFactor=a.getLocation("gammaFactor");this._lastGeometryId=this._lastVertexBufsId=this._lastMaterialId=null}};qa.prototype._bindProgram=function(a,b){b=this._scene;const c=b.canvas.gl;var d=b._clipsState,f=b.camera,e=f._state;this._program.bind();
a.useProgram++;a.textureUnit=0;this._lastGeometryId=this._lastVertexBufsId=this._lastMaterialId=null;c.uniformMatrix4fv(this._uViewMatrix,!1,e.matrix);c.uniformMatrix4fv(this._uProjMatrix,!1,f.project._state.matrix);if(0<d.clips.length){a=d.clips;for(let g=0,h=this._uClips.length;g<h;g++)d=this._uClips[g],e=d.active,f=a[g],e&&c.uniform1i(e,f.active),(e=d.pos)&&c.uniform3fv(d.pos,f.pos),(e=d.dir)&&c.uniform3fv(d.dir,f.dir)}this._uGammaFactor&&c.uniform1f(this._uGammaFactor,b.gammaFactor)};class be{constructor(a){var b=
0<a.scene._clipsState.clips.length,c=!!a._geometry._state.quantized;var d=a._geometry._state.primitiveName;d=!a._geometry._state.autoVertexNormals&&!a._geometry._state.normals||"triangles"!==d&&"triangle-strip"!==d&&"triangle-fan"!==d?!1:!0;const f=a._state.billboard,e=a._state.stationary,g=[];g.push("// Outline effect vertex shader");g.push("attribute vec3 position;");g.push("uniform mat4 modelMatrix;");g.push("uniform mat4 viewMatrix;");g.push("uniform mat4 projMatrix;");g.push("uniform float width;");
c&&g.push("uniform mat4 positionsDecodeMatrix;");b&&g.push("varying vec4 vWorldPosition;");d&&(g.push("attribute vec3 normal;"),c&&(g.push("vec3 octDecode(vec2 oct) {"),g.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),g.push("    if (v.z < 0.0) {"),g.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),g.push("    }"),g.push("    return normalize(v);"),g.push("}")));if("spherical"===f||"cylindrical"===f)g.push("void billboard(inout mat4 mat) {"),
g.push("   mat[0][0] = 1.0;"),g.push("   mat[0][1] = 0.0;"),g.push("   mat[0][2] = 0.0;"),"spherical"===f&&(g.push("   mat[1][0] = 0.0;"),g.push("   mat[1][1] = 1.0;"),g.push("   mat[1][2] = 0.0;")),g.push("   mat[2][0] = 0.0;"),g.push("   mat[2][1] = 0.0;"),g.push("   mat[2][2] =1.0;"),g.push("}");g.push("void main(void) {");g.push("vec4 localPosition = vec4(position, 1.0); ");g.push("vec4 worldPosition;");c&&g.push("localPosition = positionsDecodeMatrix * localPosition;");d&&(c?g.push("vec3 localNormal = octDecode(normal.xy); "):
g.push("vec3 localNormal = normal; "),g.push("  localPosition.xyz += (normalize(normal) * (width * 0.0005));"));g.push("mat4 viewMatrix2 = viewMatrix;");g.push("mat4 modelMatrix2 = modelMatrix;");e&&g.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"===f||"cylindrical"===f?(g.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),g.push("billboard(modelMatrix2);"),g.push("billboard(viewMatrix2);"),g.push("billboard(modelViewMatrix);"),g.push("worldPosition = modelMatrix2 * localPosition;"),
g.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(g.push("worldPosition = modelMatrix2 * localPosition;"),g.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));b&&g.push("vWorldPosition = worldPosition;");g.push("   gl_Position = projMatrix * viewPosition;");g.push("}");this.vertex=g;a=a.scene._clipsState;b=0<a.clips.length;c=[];c.push("precision lowp float;");c.push("uniform vec4  color;");if(b)for(c.push("uniform bool clippable;"),c.push("varying vec4 vWorldPosition;"),d=
0;d<a.clips.length;d++)c.push("uniform bool clipActive"+d+";"),c.push("uniform vec3 clipPos"+d+";"),c.push("uniform vec3 clipDir"+d+";");c.push("void main(void) {");if(b){c.push("if (clippable) {");c.push("  float dist = 0.0;");for(d=0;d<a.clips.length;d++)c.push("if (clipActive"+d+") {"),c.push("   dist += clamp(dot(-clipDir"+d+".xyz, vWorldPosition.xyz - clipPos"+d+".xyz), 0.0, 1000.0);"),c.push("}");c.push("  if (dist > 0.0) { discard; }");c.push("}")}c.push("   gl_FragColor = color;");c.push("}");
this.fragment=c}}const bd=new ta({}),Ca=function(a,b){this._init(a,b)},Wb={};Ca.get=function(a){const b=[a.scene.canvas.canvas.id,a.scene.gammaOutput?"go":"",a.scene._clipsState.getHash(),a._geometry._state.hash,a._state.hash].join(";");let c=Wb[b];c||(c=new Ca(b,a),Wb[b]=c,P.memory.programs++);c._useCount++;return c};Ca.prototype.put=function(){0===--this._useCount&&(bd.removeItem(this.id),this._program.destroy(),delete Wb[this._hash],P.memory.programs--)};Ca.prototype._init=function(a,b){this.id=
bd.addItem({});this._scene=b.scene;this._hash=a;this._shaderSource=new be(b);this._program=new Ba(b.scene.canvas.gl,this._shaderSource);this._useCount=0;if(this._program.errors)this.errors=this._program.errors;else{a=this._program;this._uPositionsDecodeMatrix=a.getLocation("positionsDecodeMatrix");this._uModelMatrix=a.getLocation("modelMatrix");this._uViewMatrix=a.getLocation("viewMatrix");this._uProjMatrix=a.getLocation("projMatrix");this._uClips=[];b=b.scene._clipsState.clips;for(let c=0,d=b.length;c<
d;c++)this._uClips.push({active:a.getLocation("clipActive"+c),pos:a.getLocation("clipPos"+c),dir:a.getLocation("clipDir"+c)});this._uColor=a.getLocation("color");this._uWidth=a.getLocation("width");this._aPosition=a.getAttribute("position");this._aNormal=a.getAttribute("normal");this._uClippable=a.getLocation("clippable");this._uGammaFactor=a.getLocation("gammaFactor");this._lastGeometryId=this._lastVertexBufsId=this._lastMaterialId=null}};Ca.prototype._bindProgram=function(a){const b=this._scene,
c=b.canvas.gl,d=b._clipsState;this._program.bind();a.useProgram++;this._lastGeometryId=this._lastVertexBufsId=this._lastMaterialId=null;c.uniformMatrix4fv(this._uViewMatrix,!1,b.viewTransform.matrix);c.uniformMatrix4fv(this._uProjMatrix,!1,b.projTransform.matrix);if(0<d.clips.length){let e;for(let g=0,h=this._uClips.length;g<h;g++){a=this._uClips[g];var f=a.active;e=d.clips[g];f&&c.uniform1i(f,e.active);(f=a.pos)&&c.uniform3fv(a.pos,e.pos);(f=a.dir)&&c.uniform3fv(a.dir,e.dir)}}this._uGammaFactor&&
c.uniform1f(this._uGammaFactor,b.gammaFactor)};Ca.prototype.drawMesh=function(a,b){const c=this._scene.canvas.gl,d=b.outlineMaterial,f=b._state,e=b._geometry._state;a.lastProgramId!==this._program.id&&(a.lastProgramId=this._program.id,this._bindProgram(a));if(d.id!==this._lastMaterialId){this._uWidth&&c.uniform1f(this._uWidth,d.width);if(this._uColor){const g=d.color;c.uniform4f(this._uColor,g[0],g[1],g[2],d.alpha)}this._lastMaterialId=d.id}c.uniformMatrix4fv(this._uModelMatrix,c.FALSE,b.worldMatrix);
this._uModelNormalMatrix&&c.uniformMatrix4fv(this._uModelNormalMatrix,c.FALSE,b.worldNormalMatrix);this._uClippable&&c.uniform1i(this._uClippable,f.clippable);e.combined&&(b=b._geometry._getVertexBufs(),b.id!==this._lastVertexBufsId&&(b.positionsBuf&&this._aPosition&&(this._aPosition.bindArrayBuffer(b.positionsBuf,b.quantized?c.UNSIGNED_SHORT:c.FLOAT),a.bindArray++),b.normalsBuf&&this._aNormal&&(this._aNormal.bindArrayBuffer(b.normalsBuf,b.quantized?c.BYTE:c.FLOAT),a.bindArray++),this._lastVertexBufsId=
b.id));e.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&c.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e.positionsDecodeMatrix),this._uUVDecodeMatrix&&c.uniformMatrix3fv(this._uUVDecodeMatrix,!1,e.uvDecodeMatrix),e.combined?e.indicesBufCombined&&(e.indicesBufCombined.bind(),a.bindArray++):(this._aPosition&&(this._aPosition.bindArrayBuffer(e.positionsBuf,e.quantized?c.UNSIGNED_SHORT:c.FLOAT),a.bindArray++),this._aNormal&&(this._aNormal.bindArrayBuffer(e.normalsBuf,e.quantized?c.BYTE:
c.FLOAT),a.bindArray++),e.indicesBuf&&(e.indicesBuf.bind(),a.bindArray++)),this._lastGeometryId=e.id);e.combined?e.indicesBufCombined&&(c.drawElements(e.primitive,e.indicesBufCombined.numItems,e.indicesBufCombined.itemType,0),a.drawElements++):e.indicesBuf?(c.drawElements(e.primitive,e.indicesBuf.numItems,e.indicesBuf.itemType,0),a.drawElements++):e.positions&&(c.drawArrays(c.TRIANGLES,0,e.positions.numItems),a.drawArrays++)};class ce{constructor(a){var b=0<a.scene._clipsState.clips.length,c=!!a._geometry._state.quantized,
d=a._state.billboard;const f=a._state.stationary,e=[];e.push("// mesh picking vertex shader");e.push("attribute vec3 position;");e.push("uniform mat4 modelMatrix;");e.push("uniform mat4 viewMatrix;");e.push("uniform mat4 viewNormalMatrix;");e.push("uniform mat4 projMatrix;");e.push("varying vec4 vViewPosition;");c&&e.push("uniform mat4 positionsDecodeMatrix;");b&&e.push("varying vec4 vWorldPosition;");if("spherical"===d||"cylindrical"===d)e.push("void billboard(inout mat4 mat) {"),e.push("   mat[0][0] = 1.0;"),
e.push("   mat[0][1] = 0.0;"),e.push("   mat[0][2] = 0.0;"),"spherical"===d&&(e.push("   mat[1][0] = 0.0;"),e.push("   mat[1][1] = 1.0;"),e.push("   mat[1][2] = 0.0;")),e.push("   mat[2][0] = 0.0;"),e.push("   mat[2][1] = 0.0;"),e.push("   mat[2][2] =1.0;"),e.push("}");e.push("void main(void) {");e.push("vec4 localPosition = vec4(position, 1.0); ");c&&e.push("localPosition = positionsDecodeMatrix * localPosition;");e.push("mat4 viewMatrix2 = viewMatrix;");e.push("mat4 modelMatrix2 = modelMatrix;");
f&&e.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");if("spherical"===d||"cylindrical"===d)e.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),e.push("billboard(modelMatrix2);"),e.push("billboard(viewMatrix2);");e.push("   vec4 worldPosition = modelMatrix2 * localPosition;");e.push("   vec4 viewPosition = viewMatrix2 * worldPosition;");b&&e.push("   vWorldPosition = worldPosition;");e.push("   gl_Position = projMatrix * viewPosition;");e.push("}");this.vertex=e;a=
a.scene._clipsState;b=0<a.clips.length;c=[];c.push("// mesh picking fragment shader");c.push("precision lowp float;");c.push("uniform vec4 pickColor;");if(b)for(c.push("uniform bool clippable;"),c.push("varying vec4 vWorldPosition;"),d=0;d<a.clips.length;d++)c.push("uniform bool clipActive"+d+";"),c.push("uniform vec3 clipPos"+d+";"),c.push("uniform vec3 clipDir"+d+";");c.push("void main(void) {");if(b){c.push("if (clippable) {");c.push("  float dist = 0.0;");for(d=0;d<a.clips.length;d++)c.push("if (clipActive"+
d+") {"),c.push("   dist += clamp(dot(-clipDir"+d+".xyz, vWorldPosition.xyz - clipPos"+d+".xyz), 0.0, 1000.0);"),c.push("}");c.push("  if (dist > 0.0) { discard; }");c.push("}")}c.push("   gl_FragColor = pickColor; ");c.push("}");this.fragment=c}}const xa=function(a,b){this._hash=a;this._shaderSource=new ce(b);this._scene=b.scene;this._useCount=0;this._allocate(b)},Xb={};xa.get=function(a){const b=[a.scene.canvas.canvas.id,a.scene._clipsState.getHash(),a._geometry._state.hash,a._state.hash].join(";");
let c=Xb[b];if(!c){c=new xa(b,a);if(c.errors)return console.log(c.errors.join("\n")),null;Xb[b]=c;P.memory.programs++}c._useCount++;return c};xa.prototype.put=function(){0===--this._useCount&&(this._program&&this._program.destroy(),delete Xb[this._hash],P.memory.programs--)};xa.prototype.webglContextRestored=function(){this._program=null};xa.prototype.drawMesh=function(a,b){this._program||this._allocate(b);const c=this._scene.canvas.gl;var d=b._material._state;const f=b._geometry._state;a.lastProgramId!==
this._program.id&&(a.lastProgramId=this._program.id,this._bindProgram(a));if(d.id!==this._lastMaterialId){var e=d.backfaces;a.backfaces!==e&&(e?c.disable(c.CULL_FACE):c.enable(c.CULL_FACE),a.backfaces=e);e=d.frontface;a.frontface!==e&&(e?c.frontFace(c.CCW):c.frontFace(c.CW),a.frontface=e);a.lineWidth!==d.lineWidth&&(c.lineWidth(d.lineWidth),a.lineWidth=d.lineWidth);this._uPointSize&&c.uniform1i(this._uPointSize,d.pointSize);this._lastMaterialId=d.id}c.uniformMatrix4fv(this._uModelMatrix,c.FALSE,b.worldMatrix);
f.combined&&(d=b._geometry._getVertexBufs(),d.id!==this._lastVertexBufsId&&(d.positionsBuf&&this._aPosition&&(this._aPosition.bindArrayBuffer(d.positionsBuf,d.quantized?c.UNSIGNED_SHORT:c.FLOAT),a.bindArray++),this._lastVertexBufsId=d.id));this._uClippable&&c.uniform1i(this._uClippable,b._state.clippable);f.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&c.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,f.positionsDecodeMatrix),f.combined?f.indicesBufCombined&&(f.indicesBufCombined.bind(),
a.bindArray++):(this._aPosition&&(this._aPosition.bindArrayBuffer(f.positionsBuf,f.quantized?c.UNSIGNED_SHORT:c.FLOAT),a.bindArray++),f.indicesBuf&&(f.indicesBuf.bind(),a.bindArray++)),this._lastGeometryId=f.id);b=a.pickmeshIndex>>24&255;d=a.pickmeshIndex>>16&255;e=a.pickmeshIndex>>8&255;const g=a.pickmeshIndex&255;a.pickmeshIndex++;c.uniform4f(this._uPickColor,g/255,e/255,d/255,b/255);f.combined?f.indicesBufCombined&&(c.drawElements(f.primitive,f.indicesBufCombined.numItems,f.indicesBufCombined.itemType,
0),a.drawElements++):f.indicesBuf?(c.drawElements(f.primitive,f.indicesBuf.numItems,f.indicesBuf.itemType,0),a.drawElements++):f.positions&&c.drawArrays(c.TRIANGLES,0,f.positions.numItems)};xa.prototype._allocate=function(a){this._program=new Ba(a.scene.canvas.gl,this._shaderSource);if(this._program.errors)this.errors=this._program.errors;else{var b=this._program;this._uPositionsDecodeMatrix=b.getLocation("positionsDecodeMatrix");this._uModelMatrix=b.getLocation("modelMatrix");this._uViewMatrix=b.getLocation("viewMatrix");
this._uProjMatrix=b.getLocation("projMatrix");this._uClips=[];a=a.scene._clipsState.clips;for(let c=0,d=a.length;c<d;c++)this._uClips.push({active:b.getLocation("clipActive"+c),pos:b.getLocation("clipPos"+c),dir:b.getLocation("clipDir"+c)});this._aPosition=b.getAttribute("position");this._uClippable=b.getLocation("clippable");this._uPickColor=b.getLocation("pickColor");this._lastGeometryId=this._lastVertexBufsId=this._lastMaterialId=null}};xa.prototype._bindProgram=function(a){this._program||this._allocate(mesh);
var b=this._scene;const c=b.canvas.gl,d=b._clipsState;b=b.camera;var f=b._state;this._program.bind();a.useProgram++;this._lastGeometryId=this._lastVertexBufsId=this._lastMaterialId=null;c.uniformMatrix4fv(this._uViewMatrix,!1,a.pickViewMatrix||f.matrix);c.uniformMatrix4fv(this._uProjMatrix,!1,a.pickProjMatrix||b.project._state.matrix);if(0<d.clips.length)for(let e=0,g=this._uClips.length;e<g;e++)a=this._uClips[e],f=a.active,b=d.clips[e],f&&c.uniform1i(f,b.active),(f=a.pos)&&c.uniform3fv(a.pos,b.pos),
(f=a.dir)&&c.uniform3fv(a.dir,b.dir)};class de{constructor(a){var b=0<a.scene._clipsState.clips.length,c=!!a._geometry._state.quantized,d=[];d.push("// Surface picking vertex shader");d.push("attribute vec3 position;");d.push("attribute vec4 color;");d.push("uniform mat4 modelMatrix;");d.push("uniform mat4 viewMatrix;");d.push("uniform mat4 projMatrix;");b&&(d.push("uniform bool clippable;"),d.push("varying vec4 vWorldPosition;"));d.push("varying vec4 vColor;");c&&d.push("uniform mat4 positionsDecodeMatrix;");
d.push("void main(void) {");d.push("vec4 localPosition = vec4(position, 1.0); ");c&&d.push("localPosition = positionsDecodeMatrix * localPosition;");d.push("   vec4 worldPosition = modelMatrix * localPosition; ");d.push("   vec4 viewPosition = viewMatrix * worldPosition;");b&&d.push("   vWorldPosition = worldPosition;");d.push("   vColor = color;");d.push("   gl_Position = projMatrix * viewPosition;");d.push("}");this.vertex=d;a=a.scene._clipsState;b=0<a.clips.length;c=[];c.push("// Surface picking fragment shader");
c.push("precision lowp float;");c.push("varying vec4 vColor;");if(b)for(c.push("uniform bool clippable;"),c.push("varying vec4 vWorldPosition;"),d=0;d<a.clips.length;d++)c.push("uniform bool clipActive"+d+";"),c.push("uniform vec3 clipPos"+d+";"),c.push("uniform vec3 clipDir"+d+";");c.push("void main(void) {");if(b){c.push("if (clippable) {");c.push("  float dist = 0.0;");for(d=0;d<a.clips.length;d++)c.push("if (clipActive"+d+") {"),c.push("   dist += clamp(dot(-clipDir"+d+".xyz, vWorldPosition.xyz - clipPos"+
d+".xyz), 0.0, 1000.0);"),c.push("}");c.push("  if (dist > 0.0) { discard; }");c.push("}")}c.push("   gl_FragColor = vColor;");c.push("}");this.fragment=c}}const Ga=function(a,b){const c=b.scene.canvas.gl;this._hash=a;this._shaderSource=new de(b);this._program=new Ba(c,this._shaderSource);this._scene=b.scene;this._useCount=0;if(this._program.errors)this.errors=this._program.errors;else{a=this._program;this._uPositionsDecodeMatrix=a.getLocation("positionsDecodeMatrix");this._uModelMatrix=a.getLocation("modelMatrix");
this._uViewMatrix=a.getLocation("viewMatrix");this._uProjMatrix=a.getLocation("projMatrix");this._uClips=[];b=b.scene._clipsState.clips;for(let d=0,f=b.length;d<f;d++)this._uClips.push({active:a.getLocation("clipActive"+d),pos:a.getLocation("clipPos"+d),dir:a.getLocation("clipDir"+d)});this._aPosition=a.getAttribute("position");this._aColor=a.getAttribute("color");this._uClippable=a.getLocation("clippable")}},Yb={};Ga.get=function(a,b){a=[b.scene.canvas.canvas.id,b.scene._clipsState.getHash(),b._geometry._state.quantized?
"cp":"",b._state.hash].join(";");let c=Yb[a];if(!c){c=new Ga(a,b);if(c.errors)return console.log(c.errors.join("\n")),null;Yb[a]=c;P.memory.programs++}c._useCount++;return c};Ga.prototype.put=function(){0===--this._useCount&&(this._program&&this._program.destroy(),delete Yb[this._hash],P.memory.programs--)};Ga.prototype.webglContextRestored=function(){this._program=null};Ga.prototype._bindProgram=function(a){var b=this._scene;const c=b.canvas.gl;var d=b._clipsState;b=b.camera;var f=b._state;this._program.bind();
a.useProgram++;this._lastGeometryId=this._lastVertexBufsId=null;c.uniformMatrix4fv(this._uViewMatrix,!1,f.matrix);c.uniformMatrix4fv(this._uProjMatrix,!1,b.project._state.matrix);if(0<d.clips.length){a=d.clips;for(let e=0,g=this._uClips.length;e<g;e++)d=this._uClips[e],f=d.active,b=a[e],f&&c.uniform1i(f,b.active),(f=d.pos)&&c.uniform3fv(d.pos,b.pos),(f=d.dir)&&c.uniform3fv(d.dir,b.dir)}};Ga.prototype.drawMesh=function(a,b){const c=this._scene.canvas.gl,d=b._geometry._state;a.lastProgramId!==this._program.id&&
(a.lastProgramId=this._program.id,this._bindProgram(a));c.uniformMatrix4fv(this._uModelMatrix,c.FALSE,b.worldMatrix);this._uClippable&&c.uniform1i(this._uClippable,b._state.clippable);d.id!==this._lastGeometryId&&(a=d.getVertexPickPositions(),this._uPositionsDecodeMatrix?(c.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,d.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a,d.quantized?c.UNSIGNED_SHORT:c.FLOAT)):this._aPosition.bindArrayBuffer(a),a=d.getVertexPickColors(),a.bind(),c.enableVertexAttribArray(this._aColor.location),
this._gl.vertexAttribPointer(this._aColor.location,a.itemSize,a.itemType,!0,0,0),this._lastGeometryId=d.id);c.drawArrays(d.primitive,0,positions.numItems/3)};class ee{constructor(a){var b=0<a.scene._clipsState.clips.length,c=!!a._geometry._state.quantized,d=[];d.push("// Surface picking vertex shader");d.push("attribute vec3 position;");d.push("attribute vec4 color;");d.push("uniform mat4 modelMatrix;");d.push("uniform mat4 viewMatrix;");d.push("uniform mat4 projMatrix;");b&&(d.push("uniform bool clippable;"),
d.push("varying vec4 vWorldPosition;"));d.push("varying vec4 vColor;");c&&d.push("uniform mat4 positionsDecodeMatrix;");d.push("void main(void) {");d.push("vec4 localPosition = vec4(position, 1.0); ");c&&d.push("localPosition = positionsDecodeMatrix * localPosition;");d.push("   vec4 worldPosition = modelMatrix * localPosition; ");d.push("   vec4 viewPosition = viewMatrix * worldPosition;");b&&d.push("   vWorldPosition = worldPosition;");d.push("   vColor = color;");d.push("   gl_Position = projMatrix * viewPosition;");
d.push("}");this.vertex=d;a=a.scene._clipsState;b=0<a.clips.length;c=[];c.push("// Surface picking fragment shader");c.push("precision lowp float;");c.push("varying vec4 vColor;");if(b)for(c.push("uniform bool clippable;"),c.push("varying vec4 vWorldPosition;"),d=0;d<a.clips.length;d++)c.push("uniform bool clipActive"+d+";"),c.push("uniform vec3 clipPos"+d+";"),c.push("uniform vec3 clipDir"+d+";");c.push("void main(void) {");if(b){c.push("if (clippable) {");c.push("  float dist = 0.0;");for(d=0;d<
a.clips.length;d++)c.push("if (clipActive"+d+") {"),c.push("   dist += clamp(dot(-clipDir"+d+".xyz, vWorldPosition.xyz - clipPos"+d+".xyz), 0.0, 1000.0);"),c.push("}");c.push("  if (dist > 0.0) { discard; }");c.push("}")}c.push("   gl_FragColor = vColor;");c.push("}");this.fragment=c}}const Ha=function(a,b){this._hash=a;this._scene=b.scene;this._useCount=0;this._shaderSource=new ee(b);this._allocate(b)},Zb={};Ha.get=function(a){const b=[a.scene.canvas.canvas.id,a.scene._clipsState.getHash(),a._geometry._state.quantized?
"cp":"",a._state.hash].join(";");let c=Zb[b];if(!c){c=new Ha(b,a);if(c.errors)return console.log(c.errors.join("\n")),null;Zb[b]=c;P.memory.programs++}c._useCount++;return c};Ha.prototype.put=function(){0===--this._useCount&&(this._program&&this._program.destroy(),delete Zb[this._hash],P.memory.programs--)};Ha.prototype.webglContextRestored=function(){this._program=null};Ha.prototype.drawMesh=function(a,b){this._program||this._allocate(b);var c=this._scene;const d=c.canvas.gl;var f=c._clipsState;
const e=b._material._state;var g=b._geometry;const h=b._geometry._state,m=e.backfaces,n=e.frontface,p=g._getPickTrianglePositions();g=g._getPickTriangleColors();c=c.camera;var r=c._state;this._program.bind();a.useProgram++;d.uniformMatrix4fv(this._uViewMatrix,!1,a.pickViewMatrix||r.matrix);d.uniformMatrix4fv(this._uProjMatrix,!1,a.pickProjMatrix||c.project._state.matrix);if(0<f.clips.length){f=f.clips;for(let k=0,t=this._uClips.length;k<t;k++){c=this._uClips[k];var q=c.active;r=f[k];q&&d.uniform1i(q,
r.active);(q=c.pos)&&d.uniform3fv(c.pos,r.pos);(q=c.dir)&&d.uniform3fv(c.dir,r.dir)}}a.backfaces!==m&&(m?d.disable(d.CULL_FACE):d.enable(d.CULL_FACE),a.backfaces=m);a.frontface!==n&&(n?d.frontFace(d.CCW):d.frontFace(d.CW),a.frontface=n);this._lastMaterialId=e.id;d.uniformMatrix4fv(this._uModelMatrix,d.FALSE,b.worldMatrix);this._uClippable&&d.uniform1i(this._uClippable,b._state.clippable);this._uPositionsDecodeMatrix?(d.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(p,
h.quantized?d.UNSIGNED_SHORT:d.FLOAT)):this._aPosition.bindArrayBuffer(p);g.bind();d.enableVertexAttribArray(this._aColor.location);d.vertexAttribPointer(this._aColor.location,g.itemSize,g.itemType,!0,0,0);d.drawArrays(h.primitive,0,p.numItems/3)};Ha.prototype._allocate=function(a){this._program=new Ba(a.scene.canvas.gl,this._shaderSource);this._useCount=0;if(this._program.errors)this.errors=this._program.errors;else{var b=this._program;this._uPositionsDecodeMatrix=b.getLocation("positionsDecodeMatrix");
this._uModelMatrix=b.getLocation("modelMatrix");this._uViewMatrix=b.getLocation("viewMatrix");this._uProjMatrix=b.getLocation("projMatrix");this._uClips=[];a=a.scene._clipsState.clips;for(let c=0,d=a.length;c<d;c++)this._uClips.push({active:b.getLocation("clipActive"+c),pos:b.getLocation("clipPos"+c),dir:b.getLocation("clipDir"+c)});this._aPosition=b.getAttribute("position");this._aColor=b.getAttribute("color");this._uClippable=b.getLocation("clippable")}};const cd=l.OBB3();class Pa extends rb{get type(){return"xeogl.Mesh"}static _compareState(a,
b){return a._state.layer-b._state.layer||a._drawRenderer.id-b._drawRenderer.id||a._material._state.id-b._material._state.id||a._vertexBufs.id-b._vertexBufs.id||a._geometry._state.id-b._geometry._state.id}init(a){this._state=new da({visible:!0,culled:!1,pickable:null,clippable:null,colorize:null,collidable:null,castShadow:null,receiveShadow:null,outlined:null,ghosted:!1,highlighted:!1,selected:!1,edges:!1,layer:null,billboard:this._checkBillboard(a.billboard),stationary:!!a.stationary,hash:""});this._worldPositions=
this._pickTriangleRenderer=this._pickMeshRenderer=this._emphasisVerticesRenderer=this._emphasisEdgesRenderer=this._emphasisFillRenderer=this._shadowRenderer=this._drawRenderer=null;this._worldPositionsDirty=!0;this._geometry=a.geometry?this._checkComponent("xeogl.Geometry",a.geometry):this.scene.geometry;this._vertexBufs=this._geometry._getVertexBufs();this._material=a.material?this._checkComponent("xeogl.Material",a.material):this.scene.material;this._ghostMaterial=a.ghostMaterial?this._checkComponent("xeogl.EmphasisMaterial",
a.ghostMaterial):this.scene.ghostMaterial;this._outlineMaterial=a.outlineMaterial?this._checkComponent("xeogl.EmphasisMaterial",a.outlineMaterial):this.scene.outlineMaterial;this._highlightMaterial=a.highlightMaterial?this._checkComponent("xeogl.EmphasisMaterial",a.highlightMaterial):this.scene.highlightMaterial;this._selectedMaterial=a.selectedMaterial?this._checkComponent("xeogl.EmphasisMaterial",a.selectedMaterial):this.scene.selectedMaterial;this._edgeMaterial=a.edgeMaterial?this._checkComponent("xeogl.EdgeMaterial",
a.edgeMaterial):this.scene.edgeMaterial;this._compile();super.init(a);this.scene._meshCreated(this)}_checkBillboard(a){a=a||"none";"spherical"!==a&&"cylindrical"!==a&&"none"!==a&&(this.error("Unsupported value for 'billboard': "+a+" - accepted values are 'spherical', 'cylindrical' and 'none' - defaulting to 'none'."),a="none");return a}_compile(){this._putRenderers();this._makeHash();this._drawRenderer=wa.get(this);this._emphasisFillRenderer=pa.get(this);this._emphasisEdgesRenderer=la.get(this);this._emphasisVerticesRenderer=
qa.get(this);this._pickMeshRenderer=xa.get(this);this._renderer.meshListDirty()}_webglContextRestored(){this._drawRenderer&&this._drawRenderer.webglContextRestored();this._shadowRenderer&&this._shadowRenderer.webglContextRestored();this._emphasisFillRenderer&&this._emphasisFillRenderer.webglContextRestored();this._emphasisEdgesRenderer&&this._emphasisEdgesRenderer.webglContextRestored();this._emphasisVerticesRenderer&&this._emphasisVerticesRenderer.webglContextRestored();this._pickMeshRenderer&&this._pickMeshRenderer.webglContextRestored();
this._pickTriangleRenderer&&this._pickMeshRenderer.webglContextRestored()}_makeHash(){const a=[],b=this._state;b.stationary&&a.push("/s");"none"===b.billboard?a.push("/n"):"spherical"===b.billboard?a.push("/s"):"cylindrical"===b.billboard&&a.push("/c");b.receiveShadow&&a.push("/rs");a.push(";");this._state.hash=a.join("")}_buildMeshAABB(a,b){l.transformOBB3(a,this._geometry.obb,cd);l.OBB3ToAABB3(cd,b)}_getSceneHash(){return(this.scene.gammaInput?"gi;":";")+(this.scene.gammaOutput?"go":"")}_draw(a){(this._drawRenderer||
(this._drawRenderer=wa.get(this)))&&this._drawRenderer.drawMesh(a,this)}_drawGhostFill(a){(this._emphasisFillRenderer||(this._emphasisFillRenderer=pa.get(this)))&&this._emphasisFillRenderer.drawMesh(a,this,0)}_drawGhostEdges(a){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=la.get(this)))&&this._emphasisEdgesRenderer.drawMesh(a,this,0)}_drawGhostVertices(a){(this._emphasisVerticesRenderer||(this._emphasisVerticesRenderer=qa.get(this)))&&this._emphasisVerticesRenderer.drawMesh(a,this,0)}_drawHighlightFill(a){(this._emphasisFillRenderer||
(this._emphasisFillRenderer=pa.get(this)))&&this._emphasisFillRenderer.drawMesh(a,this,1)}_drawHighlightEdges(a){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=la.get(this)))&&this._emphasisEdgesRenderer.drawMesh(a,this,1)}_drawHighlightVertices(a){(this._emphasisVerticesRenderer||(this._emphasisVerticesRenderer=qa.get(this)))&&this._emphasisVerticesRenderer.drawMesh(a,this,1)}_drawSelectedFill(a){(this._emphasisFillRenderer||(this._emphasisFillRenderer=pa.get(this)))&&this._emphasisFillRenderer.drawMesh(a,
this,2)}_drawSelectedEdges(a){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=la.get(this)))&&this._emphasisEdgesRenderer.drawMesh(a,this,2)}_drawSelectedVertices(a){(this._emphasisVerticesRenderer||(this._emphasisVerticesRenderer=qa.get(this)))&&this._emphasisVerticesRenderer.drawMesh(a,this,2)}_drawEdges(a){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=la.get(this)))&&this._emphasisEdgesRenderer.drawMesh(a,this,3)}_drawShadow(a,b){}_drawOutline(a){(this._shadowRenderer||
(this._outlineRenderer=Ca.get(this)))&&this._outlineRenderer.drawMesh(a,this)}_pickMesh(a){(this._pickMeshRenderer||(this._pickMeshRenderer=xa.get(this)))&&this._pickMeshRenderer.drawMesh(a,this)}_pickTriangle(a){(this._pickTriangleRenderer||(this._pickTriangleRenderer=Ha.get(this)))&&this._pickTriangleRenderer.drawMesh(a,this)}_pickVertex(a){(this._pickVertexRenderer||(this._pickVertexRenderer=Ga.get(this)))&&this._pickVertexRenderer.drawMesh(a,this)}_getOutlineRenderer(){this._outlineRenderer=Ca.get(this);
return this._outlineRenderer.errors?(this.errors=(this.errors||[]).concat(this._outlineRenderer.errors),this.error(this._outlineRenderer.errors.join("\n")),!1):!0}_putRenderers(){this._drawRenderer&&(this._drawRenderer.put(),this._drawRenderer=null);this._shadowRenderer&&(this._shadowRenderer.put(),this._shadowRenderer=null);this._emphasisFillRenderer&&(this._emphasisFillRenderer.put(),this._emphasisFillRenderer=null);this._emphasisEdgesRenderer&&(this._emphasisEdgesRenderer.put(),this._emphasisEdgesRenderer=
null);this._emphasisVerticesRenderer&&(this._emphasisVerticesRenderer.put(),this._emphasisVerticesRenderer=null);this._outlineRenderer&&(this._outlineRenderer.put(),this._outlineRenderer=null);this._pickMeshRenderer&&(this._pickMeshRenderer.put(),this._pickMeshRenderer=null);this._pickTriangleRenderer&&(this._pickTriangleRenderer.put(),this._pickTriangleRenderer=null);this._pickVertexRenderer&&(this._pickVertexRenderer.put(),this._pickVertexRenderer=null)}get worldPositions(){if(this._worldPositionsDirty){const a=
this._geometry.positions;this._worldPositions||(this._worldPositions=new Float32Array(a.length));l.transformPositions3(this.worldMatrix,a,this._worldPositions);this._worldPositionsDirty=!1}return this._worldPositions}set worldPositions(a){null===a&&(this._worldPositions=null,this._worldPositionsDirty=!0)}get geometry(){return this._geometry}get material(){return this._material}get ghostMaterial(){return this._ghostMaterial}get highlightMaterial(){return this._highlightMaterial}get selectedMaterial(){return this._selectedMaterial}get edgeMaterial(){return this._edgeMaterial}get outlineMaterial(){return this._outlineMaterial}set visible(a){a=
!1!==a;this._state.visible=a;this._entityType&&this.scene._entityVisibilityUpdated(this,a);this._renderer.imageDirty();this._state.castShadow&&this._renderer.shadowsDirty()}get visible(){return this._state.visible}set ghosted(a){a=!!a;this._state.ghosted!==a&&(this._state.ghosted=a,this._entityType&&this.scene._entityGhostedUpdated(this,a),this._renderer.imageDirty())}get ghosted(){return this._state.ghosted}set highlighted(a){a=!!a;a!==this._state.highlighted&&(this._state.highlighted=a,this._entityType&&
this.scene._entityHighlightedUpdated(this,a),this._renderer.imageDirty())}get highlighted(){return this._state.highlighted}set selected(a){a=!!a;a!==this._state.selected&&(this._state.selected=a,this._entityType&&this.scene._entitySelectedUpdated(this,a),this._renderer.imageDirty())}get selected(){return this._state.selected}set edges(a){a=!!a;a!==this._state.edges&&(this._state.edges=a,this._renderer.imageDirty())}get edges(){return this._state.edges}set culled(a){this._state.culled=!!a;this._renderer.imageDirty()}get culled(){return this._state.culled}set pickable(a){a=
!1!==a;this._state.pickable!==a&&(this._state.pickable=a)}get pickable(){return this._state.pickable}set clippable(a){a=!1!==a;this._state.clippable!==a&&(this._state.clippable=a,this._renderer.imageDirty(),this._state.castShadow&&this._renderer.shadowsDirty())}get clippable(){return this._state.clippable}set collidable(a){a=!1!==a;a!==this._state.collidable&&(this._state.collidable=a)}get collidable(){return this._state.collidable}set castShadow(a){a=!1!==a;a!==this._state.castShadow&&(this._state.castShadow=
a,this._renderer.shadowsDirty())}get castShadow(){return this._state.castShadow}set receiveShadow(a){this._state.receiveShadow=!1}get receiveShadow(){return this._state.receiveShadow}set outlined(a){a=!!a;a!==this._state.outlined&&(this._state.outlined=a,this._renderer.imageDirty())}get outlined(){return this._state.outlined}set colorize(a){let b=this._state.colorize;b||(b=this._state.colorize=new Float32Array(4),b[3]=1);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):(b[0]=1,b[1]=1,b[2]=1);this._renderer.imageDirty()}get colorize(){return this._state.colorize}set opacity(a){let b=
this._state.colorize;b||(b=this._state.colorize=new Float32Array(4),b[0]=1,b[1]=1,b[2]=1);b[3]=null!==a&&void 0!==a?a:1;this._renderer.imageDirty()}get opacity(){return this._state.colorize[3]}set layer(a){a=Math.round(a||0);a!==this._state.layer&&(this._state.layer=a,this._renderer.needStateSort())}get layer(){return this._state.layer}get stationary(){return this._state.stationary}get billboard(){return this._state.billboard}destroy(){super.destroy();this._putRenderers();this._renderer.meshListDirty();
this.scene._meshDestroyed(this);this._state.castShadow&&this._renderer.shadowsDirty()}}M["xeogl.Mesh"]=Pa;const ie=function(a,b){function c(){if(r){m=0;for(const x in a.meshes)a.meshes.hasOwnProperty(x)&&(h[m++]=a.meshes[x]);for(let x=m,B=h.length;x<B;x++)h[x]=null;h.length=m;r=!1;q=!0}q&&(h.sort(Pa._compareState),q=!1,k=!0)}b=b||{};const d=new Md,f=a.canvas.canvas,e=a.canvas.gl,g=!0===b.transparent,h=[];let m=0;const n=[];let p=0,r=!0,q=!0,k=!0,t=this.imageForceDirty=!0,w=null,u=null;this.meshListDirty=
function(){q=r=!0};this.needStateSort=function(){q=!0};this.shadowsDirty=function(){};this.imageDirty=function(){k=!0};this.setImageForceDirty=function(){this.imageForceDirty=!0};this.setBlendOneMinusSrcAlpha=function(x){t=x};this.webglContextLost=function(){};this.webglContextRestored=function(x){w&&w.webglContextRestored(x);u&&u.webglContextRestored(x);k=!0};this.clear=function(x){x=x||{};const B=a.viewport.boundary;e.viewport(B[0],B[1],B[2],B[3]);g?e.clearColor(0,0,0,0):(x=x.ambientColor||this.lights.getAmbientColor(),
e.clearColor(x[0],x[1],x[2],1));e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT)};this.render=function(x){x=x||{};c();if(k||this.imageForceDirty||x.force)z(x),P.frame.frameCount++,this.imageForceDirty=k=!1};var z=function(){const x=[],B=[],C=[],D=[],F=[],K=[],J=[],X=[],R=[],Q=[],W=[],L=[],ca=[],A=[],E=[],H=[],S=[],U=[],ha=[],O=[],ea=[];let V=0;return function(y){var N=!!y.opaqueOnly;Y.SUPPORTED_EXTENSIONS.OES_element_index_uint&&e.getExtension("OES_element_index_uint");Y.SUPPORTED_EXTENSIONS.OES_standard_derivatives&&
e.getExtension("OES_standard_derivatives");var aa=a._lightsState.getAmbientColor();d.reset();d.pass=y.pass;var ka=a.viewport.boundary;e.viewport(ka[0],ka[1],ka[2],ka[3]);g?e.clearColor(0,0,0,0):e.clearColor(aa[0],aa[1],aa[2],1);e.enable(e.DEPTH_TEST);e.frontFace(e.CCW);e.enable(e.CULL_FACE);e.depthMask(!0);let T,ma;aa=Date.now();!1!==y.clear&&e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);let $b=0,ac=0,bc=0,sb=0,tb=0,ub=0,Ra=0,fe=0,ge=0,vb=0,wb=0,xb=0,yb=0,zb=0,Ab=0,Bb=0,Cb=0,
Db=0,Eb=0,Fb=0,Gb=0,cc=0,he=0;y=V=0;for(ka=m;y<ka;y++){T=h[y];ma=T._state;var fa=T._material._state;!0!==ma.culled&&!1!==ma.visible&&0!==fa.alpha&&(ma.ghosted?(fa=T._ghostMaterial._state,fa.edges&&(1>fa.edgeAlpha?N||(K[ub++]=T):C[bc++]=T),fa.vertices&&(1>fa.vertexAlpha?N||(F[tb++]=T):B[ac++]=T),fa.fill&&(1>fa.fillAlpha?N||(D[sb++]=T):x[$b++]=T)):(fa=2===fa.alphaMode||ma.xray||1>ma.colorize[3])?N||(ea[V++]=T):ma.outlined?O[Ra++]=T:T._draw(d),ma.selected&&(fa=T._selectedMaterial._state,fa.edges&&(1>
fa.edgeAlpha?N||(U[Gb++]=T):E[Db++]=T),fa.vertices&&(1>fa.vertexAlpha?N||(S[Fb++]=T):A[Cb++]=T),fa.fill&&(1>fa.fillAlpha?N||(H[Eb++]=T):ca[Bb++]=T),ma.selected&&ge++),ma.highlighted&&(fa=T._highlightMaterial._state,fa.edges&&(1>fa.edgeAlpha?N||(L[Ab++]=T):R[xb++]=T),fa.vertices&&(1>fa.vertexAlpha?W[zb++]=T:X[wb++]=T),fa.fill&&(1>fa.fillAlpha?Q[yb++]=T:J[vb++]=T),ma.highlighted&&fe++),ma.edges&&(1>T._edgeMaterial._state.edgeAlpha?N||he++:ha[cc++]=T))}if(0<Ra){e.enable(e.STENCIL_TEST);e.stencilFunc(e.ALWAYS,
1,1);e.stencilOp(e.KEEP,e.KEEP,e.REPLACE);e.stencilMask(1);e.clearStencil(0);e.clear(e.STENCIL_BUFFER_BIT);for(y=0;y<Ra;y++)O[y]._draw(d);e.stencilFunc(e.EQUAL,0,1);e.stencilOp(e.KEEP,e.KEEP,e.KEEP);e.stencilMask(0);e.disable(e.CULL_FACE);for(y=0;y<Ra;y++)O[y]._drawOutline(d);e.disable(e.STENCIL_TEST)}if(0<cc)for(y=0;y<cc;y++)ha[y]._drawEdges(d);if(0<$b)for(y=0;y<$b;y++)x[y]._drawGhostFill(d);if(0<bc)for(y=0;y<bc;y++)C[y]._drawGhostEdges(d);if(0<ac)for(y=0;y<ac;y++)B[y]._drawGhostVertices(d);if(0<
sb||0<ub||0<tb||0<V){e.enable(e.CULL_FACE);e.enable(e.BLEND);t?e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA):(e.blendEquation(e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA));d.backfaces=!1;if(0<tb)for(y=0;y<tb;y++)F[y]._drawGhostVertices(d);if(0<ub)for(y=0;y<ub;y++)K[y]._drawGhostEdges(d);if(0<sb)for(y=0;y<sb;y++)D[y]._drawGhostFill(d);for(y=Ra=0;y<V;y++)T=ea[y],T._state.outlined?O[Ra++]=T:T._draw(d);e.disable(e.BLEND)}if(0<vb||0<xb||0<wb){d.lastProgramId=
null;e.clear(e.DEPTH_BUFFER_BIT);if(0<wb)for(y=0;y<wb;y++)X[y]._drawHighlightVertices(d);if(0<xb)for(y=0;y<xb;y++)R[y]._drawHighlightEdges(d);if(0<vb)for(y=0;y<vb;y++)J[y]._drawHighlightFill(d)}if(0<yb||0<Ab||0<zb){d.lastProgramId=null;e.clear(e.DEPTH_BUFFER_BIT);e.enable(e.CULL_FACE);e.enable(e.BLEND);e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);if(0<zb)for(y=0;y<zb;y++)W[y]._drawHighlightVertices(d);if(0<Ab)for(y=0;y<Ab;y++)L[y]._drawHighlightEdges(d);if(0<yb)for(y=0;y<yb;y++)Q[y]._drawHighlightFill(d);
e.disable(e.BLEND)}if(0<Bb||0<Db||0<Cb){d.lastProgramId=null;e.clear(e.DEPTH_BUFFER_BIT);if(0<Cb)for(y=0;y<Cb;y++)A[y]._drawSelectedVertices(d);if(0<Db)for(y=0;y<Db;y++)E[y]._drawSelectedEdges(d);if(0<Bb)for(y=0;y<Bb;y++)ca[y]._drawSelectedFill(d)}if(0<Eb||0<Gb||0<Fb){d.lastProgramId=null;e.clear(e.DEPTH_BUFFER_BIT);e.enable(e.CULL_FACE);e.enable(e.BLEND);e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);if(0<Fb)for(y=0;y<Fb;y++)S[y]._drawSelectedVertices(d);if(0<Gb)for(y=0;y<Gb;y++)U[y]._drawSelectedEdges(d);
if(0<Eb)for(y=0;y<Eb;y++)H[y]._drawSelectedFill(d);e.disable(e.BLEND)}N=Date.now();y=P.frame;y.renderTime=(N-aa)/1E3;y.drawElements=d.drawElements;y.drawElements=d.drawElements;y.useProgram=d.useProgram;y.bindTexture=d.bindTexture;y.bindArray=d.bindArray;N=Y.MAX_TEXTURE_UNITS;for(aa=0;aa<N;aa++)e.activeTexture(e.TEXTURE0+aa);e.bindTexture(e.TEXTURE_CUBE_MAP,null);e.bindTexture(e.TEXTURE_2D,null)}}();this.pick=function(){const x=l.vec3(),B=l.mat4(),C=l.vec3([0,1,0]),D=l.frustumMat4(-1,1,-1,1,.1,1E4);
return function(F){c();Y.SUPPORTED_EXTENSIONS.OES_element_index_uint&&e.getExtension("OES_element_index_uint");let K,J;var X,R=X=null;if(F.canvasPos){var Q=F.canvasPos[0];var W=F.canvasPos[1]}else K=F.origin||l.vec3([0,0,0]),J=F.direction||l.vec3([0,0,1]),X=l.addVec3(K,J,x),X=l.lookAtMat4v(K,X,C,B),R=D,Q=.5*f.clientWidth,W=.5*f.clientHeight;w=w||new Wa(f,e);w.bind();var L=Q;var ca=W;var A=X,E=R;d.reset();d.backfaces=!0;d.frontface=!0;d.pickViewMatrix=A;d.pickProjMatrix=E;d.pickMeshIndex=1;A=a.viewport.boundary;
e.viewport(A[0],A[1],A[2],A[3]);e.clearColor(0,0,0,0);e.enable(e.DEPTH_TEST);e.disable(e.CULL_FACE);e.disable(e.BLEND);e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);p=0;let H;const S=F.includeMeshIds,U=F.excludeMeshIds;A=0;for(E=m;A<E;A++)H=h[A],!0===H._state.culled||!1===H._state.visible||!1===H._state.pickable||S&&!S[H.id]||U&&U[H.id]||(n[p++]=H,H._pickMesh(d));L=w.read(Math.round(L),Math.round(ca));L=L[0]+256*L[1]+65536*L[2]+16777216*L[3];L--;ca=0<=L?n[L]:null;if(!ca)return w.unbind(),null;L=
{mesh:ca};F.pickSurface&&(F=Q,Q=X,d.reset(),d.backfaces=!0,d.frontface=!0,d.pickViewMatrix=Q,d.pickProjMatrix=R,R=a.viewport.boundary,e.viewport(R[0],R[1],R[2],R[3]),e.clearColor(0,0,0,0),e.enable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.disable(e.BLEND),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),ca._pickTriangle(d),R=w.read(F,W),L.primIndex=3*(R[0]+256*R[1]+65536*R[2]+16777216*R[3]));X&&(L.origin=K,L.direction=J);w.unbind();return L}}();this.readPixels=function(x,B,C,D){u=u||=new Wa(f,e);u.bind();
u.clear();this.render({force:!0,opaqueOnly:D});let F;for(D=0;D<C;D++){var K=2*D;F=4*D;K=u.read(x[K],x[K+1]);B[F]=K[0];B[F+1]=K[1];B[F+2]=K[2];B[F+3]=K[3]}u.unbind();k=!0};this.destroy=function(){w&&w.destroy();u&&u.destroy()}};class dd extends Z{get type(){return"xeogl.Input"}init(a){super.init(a);const b=this;this.KEY_BACKSPACE=8;this.KEY_TAB=9;this.KEY_ENTER=13;this.KEY_SHIFT=16;this.KEY_CTRL=17;this.KEY_ALT=18;this.KEY_PAUSE_BREAK=19;this.KEY_CAPS_LOCK=20;this.KEY_ESCAPE=27;this.KEY_PAGE_UP=33;
this.KEY_PAGE_DOWN=34;this.KEY_END=35;this.KEY_HOME=36;this.KEY_LEFT_ARROW=37;this.KEY_UP_ARROW=38;this.KEY_RIGHT_ARROW=39;this.KEY_DOWN_ARROW=40;this.KEY_INSERT=45;this.KEY_DELETE=46;this.KEY_NUM_0=48;this.KEY_NUM_1=49;this.KEY_NUM_2=50;this.KEY_NUM_3=51;this.KEY_NUM_4=52;this.KEY_NUM_5=53;this.KEY_NUM_6=54;this.KEY_NUM_7=55;this.KEY_NUM_8=56;this.KEY_NUM_9=57;this.KEY_A=65;this.KEY_B=66;this.KEY_C=67;this.KEY_D=68;this.KEY_E=69;this.KEY_F=70;this.KEY_G=71;this.KEY_H=72;this.KEY_I=73;this.KEY_J=
74;this.KEY_K=75;this.KEY_L=76;this.KEY_M=77;this.KEY_N=78;this.KEY_O=79;this.KEY_P=80;this.KEY_Q=81;this.KEY_R=82;this.KEY_S=83;this.KEY_T=84;this.KEY_U=85;this.KEY_V=86;this.KEY_W=87;this.KEY_X=88;this.KEY_Y=89;this.KEY_Z=90;this.KEY_LEFT_WINDOW=91;this.KEY_RIGHT_WINDOW=92;this.KEY_SELECT_KEY=93;this.KEY_NUMPAD_0=96;this.KEY_NUMPAD_1=97;this.KEY_NUMPAD_2=98;this.KEY_NUMPAD_3=99;this.KEY_NUMPAD_4=100;this.KEY_NUMPAD_5=101;this.KEY_NUMPAD_6=102;this.KEY_NUMPAD_7=103;this.KEY_NUMPAD_8=104;this.KEY_NUMPAD_9=
105;this.KEY_MULTIPLY=106;this.KEY_ADD=107;this.KEY_SUBTRACT=109;this.KEY_DECIMAL_POINT=110;this.KEY_DIVIDE=111;this.KEY_F1=112;this.KEY_F2=113;this.KEY_F3=114;this.KEY_F4=115;this.KEY_F5=116;this.KEY_F6=117;this.KEY_F7=118;this.KEY_F8=119;this.KEY_F9=120;this.KEY_F10=121;this.KEY_F11=122;this.KEY_F12=123;this.KEY_NUM_LOCK=144;this.KEY_SCROLL_LOCK=145;this.KEY_SEMI_COLON=186;this.KEY_EQUAL_SIGN=187;this.KEY_COMMA=188;this.KEY_DASH=189;this.KEY_PERIOD=190;this.KEY_FORWARD_SLASH=191;this.KEY_GRAVE_ACCENT=
192;this.KEY_OPEN_BRACKET=219;this.KEY_BACK_SLASH=220;this.KEY_CLOSE_BRACKET=221;this.KEY_SINGLE_QUOTE=222;this.KEY_SPACE=32;this.KEY_BACKSPACE=8;this.KEY_TAB=9;this.KEY_ENTER=13;this.KEY_SHIFT=16;this.KEY_CTRL=17;this.KEY_ALT=18;this.KEY_PAUSE_BREAK=19;this.KEY_CAPS_LOCK=20;this.KEY_ESCAPE=27;this.KEY_PAGE_UP=33;this.KEY_PAGE_DOWN=34;this.KEY_END=35;this.KEY_HOME=36;this.KEY_LEFT_ARROW=37;this.KEY_UP_ARROW=38;this.KEY_RIGHT_ARROW=39;this.KEY_DOWN_ARROW=40;this.KEY_INSERT=45;this.KEY_DELETE=46;this.KEY_NUM_0=
48;this.KEY_NUM_1=49;this.KEY_NUM_2=50;this.KEY_NUM_3=51;this.KEY_NUM_4=52;this.KEY_NUM_5=53;this.KEY_NUM_6=54;this.KEY_NUM_7=55;this.KEY_NUM_8=56;this.KEY_NUM_9=57;this.KEY_A=65;this.KEY_B=66;this.KEY_C=67;this.KEY_D=68;this.KEY_E=69;this.KEY_F=70;this.KEY_G=71;this.KEY_H=72;this.KEY_I=73;this.KEY_J=74;this.KEY_K=75;this.KEY_L=76;this.KEY_M=77;this.KEY_N=78;this.KEY_O=79;this.KEY_P=80;this.KEY_Q=81;this.KEY_R=82;this.KEY_S=83;this.KEY_T=84;this.KEY_U=85;this.KEY_V=86;this.KEY_W=87;this.KEY_X=88;
this.KEY_Y=89;this.KEY_Z=90;this.KEY_LEFT_WINDOW=91;this.KEY_RIGHT_WINDOW=92;this.KEY_SELECT_KEY=93;this.KEY_NUMPAD_0=96;this.KEY_NUMPAD_1=97;this.KEY_NUMPAD_2=98;this.KEY_NUMPAD_3=99;this.KEY_NUMPAD_4=100;this.KEY_NUMPAD_5=101;this.KEY_NUMPAD_6=102;this.KEY_NUMPAD_7=103;this.KEY_NUMPAD_8=104;this.KEY_NUMPAD_9=105;this.KEY_MULTIPLY=106;this.KEY_ADD=107;this.KEY_SUBTRACT=109;this.KEY_DECIMAL_POINT=110;this.KEY_DIVIDE=111;this.KEY_F1=112;this.KEY_F2=113;this.KEY_F3=114;this.KEY_F4=115;this.KEY_F5=116;
this.KEY_F6=117;this.KEY_F7=118;this.KEY_F8=119;this.KEY_F9=120;this.KEY_F10=121;this.KEY_F11=122;this.KEY_F12=123;this.KEY_NUM_LOCK=144;this.KEY_SCROLL_LOCK=145;this.KEY_SEMI_COLON=186;this.KEY_EQUAL_SIGN=187;this.KEY_COMMA=188;this.KEY_DASH=189;this.KEY_PERIOD=190;this.KEY_FORWARD_SLASH=191;this.KEY_GRAVE_ACCENT=192;this.KEY_OPEN_BRACKET=219;this.KEY_BACK_SLASH=220;this.KEY_CLOSE_BRACKET=221;this.KEY_SINGLE_QUOTE=222;this.KEY_SPACE=32;this._element=a.element;this.mouseDownRight=this.mouseDownMiddle=
this.mouseDownLeft=this.ctrlDown=this.altDown=!1;this.keyDown=[];this.enabled=!0;this.mouseover=!1;document.addEventListener("keydown",this._keyDownListener=function(c){b.enabled&&("INPUT"!==c.target.tagName&&"TEXTAREA"!==c.target.tagName&&(c.ctrlKey?b.ctrlDown=!0:c.altKey?b.altDown=!0:(b.keyDown[c.keyCode]=!0,b.fire("keydown",c.keyCode,!0))),b.mouseover&&c.preventDefault())},!0);document.addEventListener("keyup",this._keyUpListener=function(c){b.enabled&&"INPUT"!==c.target.tagName&&"TEXTAREA"!==
c.target.tagName&&(c.ctrlKey?b.ctrlDown=!1:c.altKey?b.altDown=!1:(b.keyDown[c.keyCode]=!1,b.fire("keyup",c.keyCode,!0)))});a.element.addEventListener("mouseenter",this._mouseEnterListener=function(c){b.enabled&&(b.mouseover=!0,c=b._getClickCoordsWithinElement(c),b.fire("mouseenter",c,!0))});a.element.addEventListener("mouseleave",this._mouseLeaveListener=function(c){b.enabled&&(b.mouseover=!1,c=b._getClickCoordsWithinElement(c),b.fire("mouseleave",c,!0))});a.element.addEventListener("mousedown",this._mouseDownListener=
function(c){if(b.enabled){switch(c.which){case 1:b.mouseDownLeft=!0;break;case 2:b.mouseDownMiddle=!0;break;case 3:b.mouseDownRight=!0}var d=b._getClickCoordsWithinElement(c);a.element.focus();b.fire("mousedown",d,!0);b.mouseover&&c.preventDefault()}});document.addEventListener("mouseup",this._mouseUpListener=function(c){if(b.enabled){switch(c.which){case 1:b.mouseDownLeft=!1;break;case 2:b.mouseDownMiddle=!1;break;case 3:b.mouseDownRight=!1}var d=b._getClickCoordsWithinElement(c);b.fire("mouseup",
d,!0);b.mouseover&&c.preventDefault()}},!0);document.addEventListener("dblclick",this._dblClickListener=function(c){if(b.enabled){switch(c.which){case 1:b.mouseDownLeft=!1;b.mouseDownRight=!1;break;case 2:b.mouseDownMiddle=!1;break;case 3:b.mouseDownLeft=!1,b.mouseDownRight=!1}var d=b._getClickCoordsWithinElement(c);b.fire("dblclick",d,!0);b.mouseover&&c.preventDefault()}});a.element.addEventListener("mousemove",this._mouseMoveListener=function(c){if(b.enabled){var d=b._getClickCoordsWithinElement(c);
b.fire("mousemove",d,!0);b.mouseover&&c.preventDefault()}});a.element.addEventListener("wheel",this._mouseWheelListener=function(c,d){b.enabled&&b.fire("mousewheel",Math.max(-1,Math.min(1,40*-c.deltaY)),!0)},{passive:!0});(function(){let c,d;b.on("mousedown",function(f){c=f[0];d=f[1]});b.on("mouseup",function(f){c>=f[0]-2&&c<=f[0]+2&&d>=f[1]-2&&d<=f[1]+2&&b.fire("mouseclicked",f,!0)})})();(function(){const c={"landscape-primary":90,"landscape-secondary":-90,"portrait-secondary":180,"portrait-primary":0};
let d,f;const e=l.vec3(),g=l.vec3(),h={orientation:null,orientationAngle:0},m={orientationAngle:0,acceleration:null,accelerationIncludingGravity:g,rotationRate:l.vec3(),interval:0},n={alpha:0,beta:0,gamma:0,absolute:!1};window.OrientationChangeEvent&&window.addEventListener("orientationchange",b._orientationchangedListener=function(){f=(d=window.screen.orientation||window.screen.mozOrientation||window.msOrientation||null)?c[d]||0:0;h.orientation=d;h.orientationAngle=f;b.fire("orientationchange",h)},
!1);window.DeviceMotionEvent&&window.addEventListener("devicemotion",b._deviceMotionListener=function(p){m.interval=p.interval;m.orientationAngle=f;var r=p.acceleration;r?(e[0]=r.x,e[1]=r.y,e[2]=r.z,m.acceleration=e):m.acceleration=null;(r=p.accelerationIncludingGravity)?(g[0]=r.x,g[1]=r.y,g[2]=r.z,m.accelerationIncludingGravity=g):m.accelerationIncludingGravity=null;m.rotationRate=p.rotationRate;b.fire("devicemotion",m)},!1);window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",
b._deviceOrientListener=function(p){n.gamma=p.gamma;n.beta=p.beta;n.alpha=p.alpha;n.absolute=p.absolute;b.fire("deviceorientation",n)},!1)})()}_getClickCoordsWithinElement(a){const b=[0,0];if(a){let c=a.target,d=0,f=0;for(;c.offsetParent;)d+=c.offsetLeft,f+=c.offsetTop,c=c.offsetParent;b[0]=a.pageX-d;b[1]=a.pageY-f}else a=window.event,b.x=a.x,b.y=a.y;return b}setEnabled(a){this.enabled!==a&&this.fire("enabled",this.enabled=a)}destroy(){super.destroy();document.removeEventListener("keydown",this._keyDownListener);
document.removeEventListener("keyup",this._keyUpListener);this._element.removeEventListener("mouseenter",this._mouseEnterListener);this._element.removeEventListener("mouseleave",this._mouseLeaveListener);this._element.removeEventListener("mousedown",this._mouseDownListener);document.removeEventListener("mouseup",this._mouseDownListener);document.removeEventListener("dblclick",this._dblClickListener);this._element.removeEventListener("mousemove",this._mouseMoveListener);this._element.removeEventListener("wheel",
this._mouseWheelListener);window.OrientationChangeEvent&&window.removeEventListener("orientationchange",this._orientationchangedListener);window.DeviceMotionEvent&&window.removeEventListener("devicemotion",this._deviceMotionListener);window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",this._deviceOrientListener)}}class dc extends Z{get type(){return"xeogl.Viewport"}init(a){super.init(a);this._state=new da({boundary:[0,0,100,100]});this.boundary=a.boundary;this.autoBoundary=
a.autoBoundary}set boundary(a){this._autoBoundary||(a||(a=this.scene.canvas.boundary,a=[0,0,a[2],a[3]]),this._state.boundary=a,this._renderer.imageDirty(),this.fire("boundary",this._state.boundary))}get boundary(){return this._state.boundary}set autoBoundary(a){a=!!a;a!==this._autoBoundary&&((this._autoBoundary=a)?this._onCanvasSize=this.scene.canvas.on("boundary",function(b){this._state.boundary=[0,0,b[2],b[3]];this._renderer.imageDirty();this.fire("boundary",this._state.boundary)},this):this._onCanvasSize&&
(this.scene.canvas.off(this._onCanvasSize),this._onCanvasSize=null),this.fire("autoBoundary",this._autoBoundary))}get autoBoundary(){return this._autoBoundary}_getState(){return this._state}destroy(){super.destroy();this._state.destroy()}}M["xeogl.Viewport"]=dc;class ec extends Z{get type(){return"xeogl.Perspective"}init(a){super.init(a);this._state=new da({matrix:l.mat4()});this._dirty=!1;this._fov=60;this._near=.1;this._far=1E4;this._canvasResized=this.scene.canvas.on("boundary",this._needUpdate,
this);this.fov=a.fov;this.fovAxis=a.fovAxis;this.near=a.near;this.far=a.far}_update(){var a=this.scene.viewport.boundary;a=a[2]/a[3];let b=this._fov;const c=this._fovAxis;if("x"==c||"min"==c&&1>a||"max"==c&&1<a)b/=a;b=Math.min(b,120);l.perspectiveMat4(Math.PI/180*b,a,this._near,this._far,this._state.matrix);this._renderer.imageDirty();this.fire("matrix",this._state.matrix)}set fov(a){this._fov=void 0!==a&&null!==a?a:60;this._needUpdate(0);this.fire("fov",this._fov)}get fov(){return this._fov}set fovAxis(a){a=
a||"min";this._fovAxis!==a&&("x"!==a&&"y"!==a&&"min"!==a&&(this.error("Unsupported value for 'fovAxis': "+a+" - defaulting to 'min'"),a="min"),this._fovAxis=a,this._needUpdate(0),this.fire("fovAxis",this._fovAxis))}get fovAxis(){return this._fovAxis}set near(a){this._near=void 0!==a&&null!==a?a:.1;this._needUpdate(0);this.fire("near",this._near)}get near(){return this._near}set far(a){this._far=void 0!==a&&null!==a?a:1E4;this._needUpdate(0);this.fire("far",this._far)}get far(){return this._far}get matrix(){this._updateScheduled&&
this._doUpdate();return this._state.matrix}destroy(){super.destroy();this._state.destroy();super.destroy();this.scene.canvas.off(this._canvasResized)}}M["xeogl.Perspective"]=ec;class fc extends Z{get type(){return"xeogl.Ortho"}init(a){super.init(a);this._state=new da({matrix:l.mat4()});this.scale=a.scale;this.near=a.near;this.far=a.far;this._onCanvasBoundary=this.scene.canvas.on("boundary",this._needUpdate,this)}_update(){var a=.5*this._scale,b=this.scene.viewport.boundary,c=b[2],d=b[3];b=c/d;let f;
c>d?(c=-a,d=a,f=a/b,a=-a/b):(c=-a*b,d=a*b,f=a,a=-a);l.orthoMat4c(c,d,a,f,this._near,this._far,this._state.matrix);this._renderer.imageDirty();this.fire("matrix",this._state.matrix)}set scale(a){if(void 0===a||null===a)a=1;0>=a&&(a=.01);this._scale=a;this._needUpdate();this.fire("scale",this._scale)}get scale(){return this._scale}set near(a){this._near=void 0!==a&&null!==a?a:.1;this._needUpdate();this.fire("near",this._near)}get near(){return this._near}set far(a){this._far=void 0!==a&&null!==a?a:
1E4;this._needUpdate();this.fire("far",this._far)}get far(){return this._far}get matrix(){this._updateScheduled&&this._doUpdate();return this._state.matrix}destroy(){super.destroy();this._state.destroy();this.scene.canvas.off(this._onCanvasBoundary)}}M["xeogl.Ortho"]=fc;class gc extends Z{get type(){return"xeogl.Frustum"}init(a){super.init(a);this._state=new da({matrix:l.mat4()});this._left=-1;this._right=1;this._bottom=-1;this._top=1;this._near=.1;this._far=5E3;this.left=a.left;this.right=a.right;
this.bottom=a.bottom;this.top=a.top;this.near=a.near;this.far=a.far}_update(){l.frustumMat4(this._left,this._right,this._bottom,this._top,this._near,this._far,this._state.matrix);this._renderer.imageDirty();this.fire("matrix",this._state.matrix)}set left(a){this._left=void 0!==a&&null!==a?a:-1;this._needUpdate();this.fire("left",this._left)}get left(){return this._left}set right(a){this._right=void 0!==a&&null!==a?a:1;this._needUpdate();this.fire("right",this._right)}get right(){return this._right}set top(a){this._top=
void 0!==a&&null!==a?a:1;this._needUpdate();this.fire("top",this._top)}get top(){return this._top}set bottom(a){this._bottom=void 0!==a&&null!==a?a:-1;this._needUpdate();this.fire("bottom",this._bottom)}get bottom(){return this._bottom}set near(a){this._near=void 0!==a&&null!==a?a:.1;this._needUpdate();this.fire("near",this._near)}get near(){return this._near}set far(a){this._far=void 0!==a&&null!==a?a:1E4;this._needUpdate();this.fire("far",this._far)}get far(){return this._far}get matrix(){this._updateScheduled&&
this._doUpdate();return this._state.matrix}destroy(){super.destroy();this._state.destroy();super.destroy()}}M["xeogl.Frustum"]=gc;class hc extends Z{get type(){return"xeogl.CustomProjection"}init(a){super.init(a);this._state=new da({matrix:l.mat4()});this.matrix=a.matrix}set matrix(a){this._state.matrix.set(a||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.fire("far",this._state.matrix)}get matrix(){return this._state.matrix}destroy(){super.destroy();this._state.destroy()}}M["xeogl.CustomProjection"]=hc;
const Ia=l.vec3(),Sa=l.vec3(),Ta=l.vec3(),Ua=l.vec3(),ic=l.vec3(),jc=l.vec3(),na=l.mat4(),ed=l.mat4(),fd=l.vec3(),gd=l.vec3(),hd=l.vec3(),id=l.vec3();class kc extends Z{get type(){return"xeogl.Camera"}init(a){super.init(a);this._state=new da({deviceMatrix:l.mat4(),hasDeviceMatrix:!1,matrix:l.mat4(),normalMatrix:l.mat4()});this._perspective=new ec(this);this._ortho=new fc(this);this._frustum=new gc(this);this._customProjection=new hc(this);this._project=this._perspective;this._eye=l.vec3([0,0,10]);
this._look=l.vec3([0,0,0]);this._up=l.vec3([0,1,0]);this._worldUp=l.vec3([0,1,0]);this._worldRight=l.vec3([1,0,0]);this._worldForward=l.vec3([0,0,-1]);this.deviceMatrix=a.deviceMatrix;this.eye=a.eye;this.look=a.look;this.up=a.up;this.worldAxis=a.worldAxis;this.gimbalLock=a.gimbalLock;this.constrainPitch=a.constrainPitch;this.projection=a.projection;this._perspective.on("matrix",()=>{"perspective"===this._projectionType&&this.fire("projMatrix",this._perspective.matrix)});this._ortho.on("matrix",()=>
{"ortho"===this._projectionType&&this.fire("projMatrix",this._ortho.matrix)});this._frustum.on("matrix",()=>{"frustum"===this._projectionType&&this.fire("projMatrix",this._frustum.matrix)});this._customProjection.on("matrix",()=>{"customProjection"===this._projectionType&&this.fire("projMatrix",this._customProjection.matrix)})}_update(){const a=this._state;let b;"ortho"===this.projection?(l.subVec3(this._eye,this._look,fd),l.normalizeVec3(fd,gd),l.mulVec3Scalar(gd,1E3,hd),l.addVec3(this._look,hd,
id),b=id):b=this._eye;a.hasDeviceMatrix?(l.lookAtMat4v(b,this._look,this._up,ed),l.mulMat4(a.deviceMatrix,ed,a.matrix)):l.lookAtMat4v(b,this._look,this._up,a.matrix);l.inverseMat4(this._state.matrix,this._state.normalMatrix);l.transposeMat4(this._state.normalMatrix);this._renderer.imageDirty();this.fire("matrix",this._state.matrix);this.fire("viewMatrix",this._state.matrix)}orbitYaw(a){let b=l.subVec3(this._eye,this._look,Ia);l.rotationMat4v(.0174532925*a,this._gimbalLock?this._worldUp:this._up,na);
b=l.transformPoint3(na,b,Sa);this.eye=l.addVec3(this._look,b,Ta);this.up=l.transformPoint3(na,this._up,Ua)}orbitPitch(a){let b=l.subVec3(this._eye,this._look,Ia);var c=l.cross3Vec3(l.normalizeVec3(b,Sa),l.normalizeVec3(this._up,Ta));l.rotationMat4v(.0174532925*a,c,na);b=l.transformPoint3(na,b,Ua);c=l.transformPoint3(na,this._up,ic);if(this._constrainPitch&&(a=l.dotVec3(c,this._worldUp)/l.DEGTORAD,1>a))return;this.up=c;this.eye=l.addVec3(b,this._look,jc)}yaw(a){let b=l.subVec3(this._look,this._eye,
Ia);l.rotationMat4v(.0174532925*a,this._gimbalLock?this._worldUp:this._up,na);b=l.transformPoint3(na,b,Sa);this.look=l.addVec3(b,this._eye,Ta);this._gimbalLock&&(this.up=l.transformPoint3(na,this._up,Ua))}pitch(a){let b=l.subVec3(this._look,this._eye,Ia);var c=l.cross3Vec3(l.normalizeVec3(b,Sa),l.normalizeVec3(this._up,Ta));l.rotationMat4v(.0174532925*a,c,na);c=l.transformPoint3(na,this._up,jc);if(this._constrainPitch&&(a=l.dotVec3(c,this._worldUp)/l.DEGTORAD,1>a))return;this.up=c;b=l.transformPoint3(na,
b,Ua);this.look=l.addVec3(b,this._eye,ic)}pan(a){const b=l.subVec3(this._eye,this._look,Ia),c=[0,0,0];if(0!==a[0]){var d=l.cross3Vec3(l.normalizeVec3(b,[]),l.normalizeVec3(this._up,Sa));d=l.mulVec3Scalar(d,a[0]);c[0]+=d[0];c[1]+=d[1];c[2]+=d[2]}0!==a[1]&&(d=l.mulVec3Scalar(l.normalizeVec3(this._up,Ta),a[1]),c[0]+=d[0],c[1]+=d[1],c[2]+=d[2]);0!==a[2]&&(d=l.mulVec3Scalar(l.normalizeVec3(b,Ua),a[2]),c[0]+=d[0],c[1]+=d[1],c[2]+=d[2]);this.eye=l.addVec3(this._eye,c,ic);this.look=l.addVec3(this._look,c,
jc)}zoom(a){var b=l.subVec3(this._eye,this._look,Ia);const c=Math.abs(l.lenVec3(b,Sa));a=Math.abs(c+a);.5>a||(b=l.normalizeVec3(b,Ta),this.eye=l.addVec3(this._look,l.mulVec3Scalar(b,a),Ua))}set eye(a){this._eye.set(a||[0,0,10]);this._needUpdate(0);this.fire("eye",this._eye)}get eye(){return this._eye}set look(a){this._look.set(a||[0,0,0]);this._needUpdate(0);this.fire("look",this._look)}get look(){return this._look}set up(a){this._up.set(a||[0,1,0]);this._needUpdate(0);this.fire("up",this._up)}get up(){return this._up}set deviceMatrix(a){this._state.deviceMatrix.set(a||
[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this._state.hasDeviceMatrix=!!a;this._needUpdate(0);this.fire("deviceMatrix",this._state.deviceMatrix)}get deviceMatrix(){return this._state.deviceMatrix}set worldAxis(a){a=a||[1,0,0,0,1,0,0,0,1];this._worldAxis?this._worldAxis.set(a):this._worldAxis=new Float32Array(a);this._worldRight[0]=this._worldAxis[0];this._worldRight[1]=this._worldAxis[1];this._worldRight[2]=this._worldAxis[2];this._worldUp[0]=this._worldAxis[3];this._worldUp[1]=this._worldAxis[4];this._worldUp[2]=
this._worldAxis[5];this._worldForward[0]=this._worldAxis[6];this._worldForward[1]=this._worldAxis[7];this._worldForward[2]=this._worldAxis[8];this.fire("worldAxis",this._worldAxis)}get worldAxis(){return this._worldAxis}get worldUp(){return this._worldUp}get worldRight(){return this._worldRight}get worldForward(){return this._worldForward}set gimbalLock(a){this._gimbalLock=!1!==a;this.fire("gimbalLock",this._gimbalLock)}get gimbalLock(){return this._gimbalLock}set constrainPitch(a){this._constrainPitch=
!!a;this.fire("constrainPitch",this._constrainPitch)}get constrainPitch(){return this._constrainPitch}get eyeLookDist(){return l.lenVec3(l.subVec3(this._look,this._eye,Ia))}get matrix(){this._updateScheduled&&this._doUpdate();return this._state.matrix}get viewMatrix(){this._updateScheduled&&this._doUpdate();return this._state.matrix}get normalMatrix(){this._updateScheduled&&this._doUpdate();return this._state.normalMatrix}get viewNormalMatrix(){this._updateScheduled&&this._doUpdate();return this._state.normalMatrix}get projMatrix(){return this[this.projection].matrix}get perspective(){return this._perspective}get ortho(){return this._ortho}get frustum(){return this._frustum}get customProjection(){return this._customProjection}set projection(a){a=
a||"perspective";this._projectionType!==a&&("perspective"===a?this._project=this._perspective:"ortho"===a?this._project=this._ortho:"frustum"===a?this._project=this._frustum:"customProjection"===a?this._project=this._customProjection:(this.error("Unsupported value for 'projection': "+a+" defaulting to 'perspective'"),this._project=this._perspective,a="perspective"),this._projectionType=a,this._renderer.imageDirty(),this._update(),this.fire("dirty"))}get projection(){return this._projectionType}get project(){return this._project}get view(){return this}destroy(){super.destroy();
this._state.destroy()}}M["xeogl.Camera"]=kc;class Za extends Z{get type(){return"xeogl.DirLight"}init(a){super.init(a);const b=this;this._shadowProjMatrix=this._shadowViewMatrix=this._shadowRenderBuf=null;this._shadowProjMatrixDirty=this._shadowViewMatrixDirty=!0;this._state=new da({type:"dir",dir:l.vec3([1,1,1]),color:l.vec3([.7,.7,.8]),intensity:1,space:a.space||"view",shadow:!1,shadowDirty:!0,getShadowViewMatrix:function(){l.vec3();const c=l.vec3([0,1,0]);return function(){if(b._shadowViewMatrixDirty){b._shadowViewMatrix||
(b._shadowViewMatrix=l.identityMat4());const d=b._state.dir;l.lookAtMat4v([-d[0],-d[1],-d[2]],[0,0,0],c,b._shadowViewMatrix);b._shadowViewMatrixDirty=!1}return b._shadowViewMatrix}}(),getShadowProjMatrix:function(){b._shadowProjMatrixDirty&&(b._shadowProjMatrix||(b._shadowProjMatrix=l.identityMat4()),l.orthoMat4c(-10,10,-10,10,0,500,b._shadowProjMatrix),b._shadowProjMatrixDirty=!1);return b._shadowProjMatrix},getShadowRenderBuf:function(){b._shadowRenderBuf||(b._shadowRenderBuf=new Wa(b.scene.canvas.canvas,
b.scene.canvas.gl,{size:[1024,1024]}));return b._shadowRenderBuf}});this.dir=a.dir;this.color=a.color;this.intensity=a.intensity;this.shadow=a.shadow;this.scene._lightCreated(this)}set dir(a){this._state.dir.set(a||[1,1,1]);this._shadowViewMatrixDirty=!0;this._renderer.shadowsDirty()}get dir(){return this._state.dir}set color(a){this._state.color.set(a||[.7,.7,.8]);this._renderer.imageDirty()}get color(){return this._state.color}set intensity(a){this._state.intensity=void 0!==a?a:1;this._renderer.imageDirty()}get intensity(){return this._state.intensity}set shadow(a){a=
!!a;this._state.shadow!==a&&(this._state.shadow=a,this._shadowViewMatrixDirty=!0,this._renderer.shadowsDirty())}get shadow(){return this._state.shadow}destroy(){super.destroy();this._state.destroy();this._shadowRenderBuf&&this._shadowRenderBuf.destroy();this.scene._lightDestroyed(this);this._renderer.shadowsDirty()}}M["xeogl.DirLight"]=Za;class lc extends ua{get type(){return"xeogl.BoxGeometry"}init(a){var b=a.xSize||1;0>b&&(this.error("negative xSize not allowed - will invert"),b*=-1);var c=a.ySize||
1;0>c&&(this.error("negative ySize not allowed - will invert"),c*=-1);var d=a.zSize||1;0>d&&(this.error("negative zSize not allowed - will invert"),d*=-1);var f=a.center;const e=f?f[0]:0,g=f?f[1]:0,h=f?f[2]:0;f=-b+e;const m=-c+g,n=-d+h;b+=e;c+=g;d+=h;super.init(G.apply(a,{positions:[b,c,d,f,c,d,f,m,d,b,m,d,b,c,d,b,m,d,b,m,n,b,c,n,b,c,d,b,c,n,f,c,n,f,c,d,f,c,d,f,c,n,f,m,n,f,m,d,f,m,n,b,m,n,b,m,d,f,m,d,b,m,n,f,m,n,f,c,n,b,c,n],normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,
0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],uv:[1,0,0,0,0,1,1,1,0,0,0,1,1,1,1,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],tangents:null}));this.box=!0}}M["xeogl.BoxGeometry"]=lc;const mc={"default":{edges:!0,edgeColor:[.2,.2,.2],edgeAlpha:.5,edgeWidth:1,vertices:!1,vertexColor:[.4,.4,.4],vertexAlpha:.7,vertexSize:4,fill:!0,fillColor:[.4,
.4,.4],fillAlpha:.2},defaultWhiteBG:{edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1,vertices:!1,vertexColor:[.4,.4,.4],vertexAlpha:.7,vertexSize:4,fill:!0,fillColor:[1,1,1],fillAlpha:.6},defaultLightBG:{edges:!0,edgeColor:[.2,.2,.2],edgeAlpha:.5,edgeWidth:1,vertices:!1,vertexColor:[.4,.4,.4],vertexAlpha:.7,vertexSize:4,fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2},defaultDarkBG:{edges:!0,edgeColor:[.5,.5,.5],edgeAlpha:.5,edgeWidth:1,vertices:!1,vertexColor:[.4,.4,.4],vertexAlpha:.7,vertexSize:4,fill:!0,
fillColor:[.4,.4,.4],fillAlpha:.2},phosphorous:{edges:!0,edgeColor:[.9,.9,.9],edgeAlpha:.5,edgeWidth:2,vertices:!1,vertexColor:[.4,.4,.4],vertexAlpha:.7,vertexSize:1,fill:!0,fillColor:[0,0,0],fillAlpha:.4},sunset:{edges:!0,edgeColor:[.9,.9,.9],edgeAlpha:.5,edgeWidth:1,vertices:!1,vertexColor:[.4,.4,.4],vertexAlpha:.7,vertexSize:1,fill:!0,fillColor:[.9,.9,.6],fillAlpha:.2},vectorscope:{edges:!0,edgeColor:[.2,1,.2],edgeAlpha:1,edgeWidth:2,vertices:!0,vertexColor:[.7,1,.7],vertexAlpha:.9,vertexSize:8,
fill:!0,fillColor:[0,0,0],fillAlpha:.7},battlezone:{edges:!0,edgeColor:[.2,1,.2],edgeAlpha:1,edgeWidth:3,vertices:!1,vertexColor:[.8,1,.8],vertexAlpha:.9,vertexSize:8,fill:!0,fillColor:[0,0,0],fillAlpha:1},sepia:{edges:!0,edgeColor:[.529411792755127,.4577854573726654,.4100345969200134],edgeAlpha:1,edgeWidth:1,vertices:!1,vertexColor:[.7,1,.7],vertexAlpha:.9,vertexSize:4,fill:!0,fillColor:[.970588207244873,.7965892553329468,.6660899519920349],fillAlpha:.4},yellowHighlight:{edges:!0,edgeColor:[.529411792755127,
.4577854573726654,.4100345969200134],edgeAlpha:1,edgeWidth:1,vertices:!1,vertexColor:[.7,1,.7],vertexAlpha:.9,vertexSize:4,fill:!0,fillColor:[1,1,0],fillAlpha:.5},greenSelected:{edges:!0,edgeColor:[.4577854573726654,.529411792755127,.4100345969200134],edgeAlpha:1,edgeWidth:1,vertices:!1,vertexColor:[.7,1,.7],vertexAlpha:.9,vertexSize:4,fill:!0,fillColor:[0,1,0],fillAlpha:.5},gamegrid:{edges:!0,edgeColor:[.4,.4,1.6],edgeAlpha:.8,edgeWidth:3,vertices:!1,vertexColor:[.7,1,.7],vertexAlpha:.9,vertexSize:4,
fill:!0,fillColor:[.2,.2,.7],fillAlpha:.9}};class $a extends va{static get presets(){return mc}get type(){return"xeogl.EmphasisMaterial"}init(a){super.init(a);this._state=new da({type:"EmphasisMaterial",edges:null,edgeColor:null,edgeAlpha:null,edgeWidth:null,vertices:null,vertexColor:null,vertexAlpha:null,vertexSize:null,fill:null,fillColor:null,fillAlpha:null,backfaces:!0});this._preset="default";a.preset?(this.preset=a.preset,void 0!==a.edges&&(this.edges=a.edges),a.edgeColor&&(this.edgeColor=a.edgeColor),
void 0!==a.edgeAlpha&&(this.edgeAlpha=a.edgeAlpha),void 0!==a.edgeWidth&&(this.edgeWidth=a.edgeWidth),void 0!==a.vertices&&(this.vertices=a.vertices),a.vertexColor&&(this.vertexColor=a.vertexColor),void 0!==a.vertexAlpha&&(this.vertexAlpha=a.vertexAlpha),a.vertexSize&&(this.vertexSize=a.vertexSize),void 0!==a.fill&&(this.fill=a.fill),a.fillColor&&(this.fillColor=a.fillColor),void 0!==a.fillAlpha&&(this.fillAlpha=a.fillAlpha),void 0!==a.backfaces&&(this.backfaces=a.backfaces)):(this.edges=a.edges,
this.edgeColor=a.edgeColor,this.edgeAlpha=a.edgeAlpha,this.edgeWidth=a.edgeWidth,this.vertices=a.vertices,this.vertexColor=a.vertexColor,this.vertexAlpha=a.vertexAlpha,this.vertexSize=a.vertexSize,this.fill=a.fill,this.fillColor=a.fillColor,this.fillAlpha=a.fillAlpha,this.backfaces=a.backfaces)}set edges(a){a=!1!==a;this._state.edges!==a&&(this._state.edges=a,this._renderer.imageDirty())}get edges(){return this._state.edges}set edgeColor(a){let b=this._state.edgeColor;if(!b)b=this._state.edgeColor=
new Float32Array(3);else if(a&&b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2])return;a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):(b[0]=.2,b[1]=.2,b[2]=.2);this._renderer.imageDirty()}get edgeColor(){return this._state.edgeColor}set edgeAlpha(a){a=void 0!==a&&null!==a?a:.5;this._state.edgeAlpha!==a&&(this._state.edgeAlpha=a,this._renderer.imageDirty())}get edgeAlpha(){return this._state.edgeAlpha}set edgeWidth(a){this._state.edgeWidth=a||1;this._renderer.imageDirty()}get edgeWidth(){return this._state.edgeWidth}set vertices(a){a=
!!a;this._state.vertices!==a&&(this._state.vertices=a,this._renderer.imageDirty())}get vertices(){return this._state.vertices}set vertexColor(a){let b=this._state.vertexColor;if(!b)b=this._state.vertexColor=new Float32Array(3);else if(a&&b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2])return;a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):(b[0]=.4,b[1]=.4,b[2]=.4);this._renderer.imageDirty()}get vertexColor(){return this._state.vertexColor}set vertexAlpha(a){a=void 0!==a&&null!==a?a:.7;this._state.vertexAlpha!==a&&(this._state.vertexAlpha=
a,this._renderer.imageDirty())}get vertexAlpha(){return this._state.vertexAlpha}set vertexSize(a){this._state.vertexSize=a||4;this._renderer.imageDirty()}get vertexSize(){return this._state.vertexSize}set fill(a){a=!1!==a;this._state.fill!==a&&(this._state.fill=a,this._renderer.imageDirty())}get fill(){return this._state.fill}set fillColor(a){let b=this._state.fillColor;if(!b)b=this._state.fillColor=new Float32Array(3);else if(a&&b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2])return;a?(b[0]=a[0],b[1]=a[1],
b[2]=a[2]):(b[0]=.4,b[1]=.4,b[2]=.4);this._renderer.imageDirty()}get fillColor(){return this._state.fillColor}set fillAlpha(a){a=void 0!==a&&null!==a?a:.2;this._state.fillAlpha!==a&&(this._state.fillAlpha=a,this._renderer.imageDirty())}get fillAlpha(){return this._state.fillAlpha}set backfaces(a){a=!!a;this._state.backfaces!==a&&(this._state.backfaces=a,this._renderer.imageDirty())}get backfaces(){return this._state.backfaces}set preset(a){a=a||"default";if(this._preset!==a){var b=mc[a];b?(this.edges=
b.edges,this.edgeColor=b.edgeColor,this.edgeAlpha=b.edgeAlpha,this.edgeWidth=b.edgeWidth,this.vertices=b.vertices,this.vertexColor=b.vertexColor,this.vertexAlpha=b.vertexAlpha,this.vertexSize=b.vertexSize,this.fill=b.fill,this.fillColor=b.fillColor,this.fillAlpha=b.fillAlpha,this._preset=a):this.error("unsupported preset: '"+a+"' - supported values are "+Object.keys(mc).join(", "))}}get preset(){return this._preset}destroy(){super.destroy();this._state.destroy()}}M["xeogl.EmphasisMaterial"]=$a;const nc=
{"default":{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1},defaultWhiteBG:{edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultLightBG:{edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultDarkBG:{edgeColor:[.5,.5,.5],edgeAlpha:1,edgeWidth:1}};class oc extends va{static get presets(){return nc}get type(){return"xeogl.EdgeMaterial"}init(a){super.init(a);this._state=new da({type:"EdgeMaterial",edgeColor:null,edgeAlpha:null,edgeWidth:null});this._preset="default";a.preset?(this.preset=a.preset,a.edgeColor&&
(this.edgeColor=a.edgeColor),void 0!==a.edgeAlpha&&(this.edgeAlpha=a.edgeAlpha),void 0!==a.edgeWidth&&(this.edgeWidth=a.edgeWidth)):(this.edgeColor=a.edgeColor,this.edgeAlpha=a.edgeAlpha,this.edgeWidth=a.edgeWidth)}set edgeColor(a){let b=this._state.edgeColor;if(!b)b=this._state.edgeColor=new Float32Array(3);else if(a&&b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2])return;a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):(b[0]=.2,b[1]=.2,b[2]=.2);this._renderer.imageDirty()}get edgeColor(){return this._state.edgeColor}set edgeAlpha(a){a=
void 0!==a&&null!==a?a:1;this._state.edgeAlpha!==a&&(this._state.edgeAlpha=a,this._renderer.imageDirty())}get edgeAlpha(){return this._state.edgeAlpha}set edgeWidth(a){this._state.edgeWidth=a||1;this._renderer.imageDirty()}get edgeWidth(){return this._state.edgeWidth}set preset(a){a=a||"default";if(this._preset!==a){var b=nc[a];b?(this.edgeColor=b.edgeColor,this.edgeAlpha=b.edgeAlpha,this.edgeWidth=b.edgeWidth,this._preset=a):this.error("unsupported preset: '"+a+"' - supported values are "+Object.keys(nc).join(", "))}}get preset(){return this._preset}destroy(){super.destroy();
this._state.destroy()}}M["xeogl.EdgeMaterial"]=oc;class pc extends va{get type(){return"xeogl.OutlineMaterial"}init(a){super.init(a);this._state=new da({type:"OutlineMaterial",color:null,alpha:null,width:null});this.color=a.color;this.alpha=a.alpha;this.width=a.width}set color(a){let b=this._state.color;if(!b)b=this._state.color=new Float32Array(3);else if(a&&b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2])return;a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):(b[0]=1,b[1]=.2,b[2]=.2);this._renderer.imageDirty()}get color(){return this._state.color}set alpha(a){a=
void 0!==a&&null!==a?a:1;this._state.alpha!==a&&(this._state.alpha=a,this._renderer.imageDirty())}get alpha(){return this._state.alpha}set width(a){this._state.width=a||4;this._renderer.imageDirty()}get width(){return this._state.width}destroy(){super.destroy();this._state.destroy()}}M["xeogl.OutlineMaterial"]=pc;const qc=l.vec3(),Hb=l.vec3(),Ja=l.vec3(),Ka=l.vec3(),La=l.vec3(),Ib=l.vec3(),Ma=l.vec4(),Jb=l.vec3(),Kb=l.vec3(),Da=l.vec3(),ab=l.vec3(),bb=l.vec3(),cb=l.vec3(),db=l.vec3(),eb=l.vec3(),
fb=l.vec3(),gb=l.vec4(),hb=l.vec4(),Lb=l.vec4(),je=l.vec3(),ke=l.vec3(),le=l.vec3(),me=l.vec3(),ne=l.vec3(),oe=l.vec3(),pe=l.vec3(),qe=l.vec3(),re=l.vec3(),se=l.vec3(),te=l.vec3();class rc extends Z{get type(){return"xeogl.Scene"}init(a){super.init(a);const b=this;var c=!!a.transparent;this.loading=0;this.startTime=(new Date).getTime();this.models={};this.objects={};this.guidObjects={};this.entityTypes={};this.entities={};this.visibleEntities={};this.ghostedEntities={};this.highlightedEntities={};
this.selectedEntities={};this._selectedEntityIds=this._highlightedEntityIds=this._ghostedEntityIds=this._visibleEntityIds=this._entityIds=this._objectGUIDs=null;this.meshes={};this._needRecompileMeshes=!1;this.types={};this.components={};this.rootObjects={};this.clips={};this.lights={};this.lightMaps={};this.reflectionMaps={};this.canvas=new Rb(this,{dontClear:!0,canvas:a.canvas,transparent:c,backgroundColor:a.backgroundColor,backgroundImage:a.backgroundImage,webgl2:!1!==a.webgl2,contextAttr:a.contextAttr||
{},simulateWebGLContextLost:a.simulateWebGLContextLost});this.canvas.on("boundary",function(){b._renderer.imageDirty()});this.canvas.on("webglContextFailed",function(){alert("xeogl failed to find WebGL!")});this._renderer=new ie(this,{transparent:c});this._clipsState=new function(){this.clips=[];let e=null;this.getHash=function(){if(e)return e;const g=this.clips;if(0===g.length)return this.hash=";";const h=[];for(let m=0,n=g.length;m<n;m++)h.push("cp");h.push(";");return e=h.join("")};this.addClip=
function(g){this.clips.push(g);e=null};this.removeClip=function(g){for(let h=0,m=this.clips.length;h<m;h++)if(this.clips[h].id===g.id){this.clips.splice(h,1);e=null;break}}};this._lightsState=new function(){const e=l.vec3([0,0,0]),g=l.vec3();this.lights=[];this.reflectionMaps=[];this.lightMaps=[];let h=null,m=null;this.getHash=function(){if(h)return h;const n=[],p=this.lights;let r;for(let q=0,k=p.length;q<k;q++)r=p[q],n.push("/"),n.push(r.type),n.push("world"===r.space?"w":"v"),r.shadow&&n.push("sh");
0<this.lightMaps.length&&n.push("/lm");0<this.reflectionMaps.length&&n.push("/rm");n.push(";");return h=n.join("")};this.addLight=function(n){this.lights.push(n);h=m=null};this.removeLight=function(n){for(let p=0,r=this.lights.length;p<r;p++)if(this.lights[p].id===n.id){this.lights.splice(p,1);m&&m.id===n.id&&(m=null);h=null;break}};this.addReflectionMap=function(n){this.reflectionMaps.push(n);h=null};this.removeReflectionMap=function(n){for(let p=0,r=this.reflectionMaps.length;p<r;p++)if(this.reflectionMaps[p].id===
n.id){this.reflectionMaps.splice(p,1);h=null;break}};this.addLightMap=function(n){this.lightMaps.push(n);h=null};this.removeLightMap=function(n){for(let p=0,r=this.lightMaps.length;p<r;p++)if(this.lightMaps[p].id===n.id){this.lightMaps.splice(p,1);h=null;break}};this.getAmbientColor=function(){if(!m)for(let p=0,r=this.lights.length;p<r;p++){var n=this.lights[p];if("ambient"===n.type){m=n;break}}if(m){n=m.color;const p=m.intensity;g[0]=n[0]*p;g[1]=n[1]*p;g[2]=n[2]*p;return g}return e}};this.input=
new dd(this,{dontClear:!0,element:this.canvas.canvas});ba._addScene(this);if(c=a.components){let e;var d;for(let g=0,h=c.length;g<h;g++)e=c[g],(d=e.type)&&(d=window[d])&&new d(this,e)}this._initDefaults();this._viewport=new dc(this,{id:"default.viewport",autoBoundary:!0,dontClear:!0});this._camera=new kc(this,{id:"default.camera",dontClear:!0});new Za(this,{dir:[.8,-.6,-.8],color:[1,1,1],intensity:1,space:"view"});new Za(this,{dir:[-.8,-.4,-.4],color:[1,1,1],intensity:1,space:"view"});new Za(this,
{dir:[.2,-.8,.8],color:[.6,.6,.6],intensity:1,space:"view"});const f=this._renderer;this._camera.on("dirty",function(){f.imageDirty()});this.ticksPerRender=a.ticksPerRender;this.passes=a.passes;this.clearEachPass=a.clearEachPass;this.gammaInput=a.gammaInput;this.gammaOutput=a.gammaOutput;this.gammaFactor=a.gammaFactor}_initDefaults(){}_addComponent(a){a.id&&this.components[a.id]&&(this.error("Component "+G.inQuotes(a.id)+" already exists in Scene - ignoring ID, will randomly-generate instead"),a.id=
null);if(!a.id)for(void 0===window.nextID&&(window.nextID=0),a.id="_"+window.nextID++;this.components[a.id];)a.id=l.createUUID();this.components[a.id]=a;const b=a.type;let c=this.types[a.type];c||=this.types[b]={};c[a.id]=a}_removeComponent(a){delete this.components[a.id];const b=this.types[a.type];b&&(delete b[a.id],G.isEmptyObject(b)&&delete this.types[a.type])}_clipCreated(a){this.clips[a.id]=a;this.scene._clipsState.addClip(a._state);this._needRecompileMeshes=!0}_lightCreated(a){this.lights[a.id]=
a;this.scene._lightsState.addLight(a._state);this._needRecompileMeshes=!0}_lightMapCreated(a){this.lightMaps[a.id]=a;this.scene._lightsState.addLightMap(a._state);this._needRecompileMeshes=!0}_reflectionMapCreated(a){this.reflectionMaps[a.id]=a;this.scene._lightsState.addReflectionMap(a._state);this._needRecompileMeshes=!0}_objectCreated(a){this.objects[a.id]=a;a.guid&&(this.guidObjects[a.id]=a,this._objectGUIDs=null);a.parent||(this.rootObjects[a.id]=a);P.components.objects++}_meshCreated(a){this.meshes[a.id]=
a;P.components.meshes++}_modelCreated(a){this.models[a.id]=a;P.components.models++}_clipDestroyed(a){delete this.clips[a.id];this.scene._clipsState.removeClip(a._state);this._needRecompileMeshes=!0}_lightDestroyed(a){delete this.lights[a.id];this.scene._lightsState.removeLight(a._state);this._needRecompileMeshes=!0}_lightMapDestroyed(a){delete this.lightMaps[a.id];this.scene._lightsState.removeLightMap(a._state);this._needRecompileMeshes=!0}_reflectionMapDestroyed(a){delete this.reflectionMaps[a.id];
this.scene._lightsState.removeReflectionMap(a._state);this._needRecompileMeshes=!0}_objectDestroyed(a){delete this.objects[a.id];a.guid&&(delete this.guidObjects[a.guid],this._objectGUIDs=null);a.parent||delete this.rootObjects[a.id];P.components.objects--}_meshDestroyed(a){P.components.meshes--;delete this.meshes[a.id];P.components.meshes--}_modelDestroyed(a){this.models[a.id]=a;P.components.models++}_entityTypeAssigned(a,b){this.entities[a.id]=a;let c=this.entityTypes[b];c||(c={},this.entityTypes[b]=
c);c[a.id]=a;this._entityTypeIds=this._entityIds=null}_entityTypeRemoved(a,b){delete this.entities[a.id];(b=this.entityTypes[b])&&delete b[a.id];this._entityTypeIds=this._entityIds=null}_entityVisibilityUpdated(a,b){b?this.visibleEntities[a.id]=a:delete this.visibleEntities[a.id];this._visibleEntityIds=null}_entityGhostedUpdated(a,b){b?this.ghostedEntities[a.id]=a:delete this.ghostedEntities[a.id];this._ghostedEntityIds=null}_entityHighlightedUpdated(a,b){b?this.highlightedEntities[a.id]=a:delete this.highlightedEntities[a.id];
this._highlightedEntityIds=null}_entitySelectedUpdated(a,b){b?this.selectedEntities[a.id]=a:delete this.selectedEntities[a.id];this._selectedEntityIds=null}_webglContextLost(){this.canvas.spinner.processes++;for(const a in this.components)if(this.components.hasOwnProperty(a)){const b=this.components[a];b._webglContextLost&&b._webglContextLost()}this._renderer.webglContextLost()}_webglContextRestored(){const a=this.canvas.gl;for(const b in this.components)if(this.components.hasOwnProperty(b)){const c=
this.components[b];c._webglContextRestored&&c._webglContextRestored(a)}this._renderer.webglContextRestored(a);this.canvas.spinner.processes--}render(a){const b={sceneId:null,pass:0};this._needRecompileMeshes&&(this._recompileMeshes(),this._needRecompileMeshes=!1);if(0<this.loading||0<this.canvas.spinner.processes)this.canvas.canvas.style.opacity=0;else{var c=Number.parseFloat(this.canvas.canvas.style.opacity);1>c&&(this.canvas.canvas.style.opacity=c+.1);b.sceneId=this.id;c=this._passes;var d=this._clearEachPass,
f;for(f=0;f<c;f++){b.pass=f;this.fire("rendering",b,!0);var e=d||0===f;this._renderer.render({pass:f,clear:e,force:a});this.fire("rendered",b,!0)}this._saveAmbientColor()}}_recompileMeshes(){for(const a in this.meshes)this.meshes.hasOwnProperty(a)&&this.meshes[a]._compile()}_saveAmbientColor(){const a=this.canvas;if(a.transparent||a.backgroundImage||a.backgroundColor)this._lastAmbientColor=null;else{const b=this._lightsState.getAmbientColor();this._lastAmbientColor&&this._lastAmbientColor[0]===b[0]&&
this._lastAmbientColor[1]===b[1]&&this._lastAmbientColor[2]===b[2]&&this._lastAmbientColor[3]===b[3]||(a.backgroundColor=b,this._lastAmbientColor||(this._lastAmbientColor=l.vec4([0,0,0,1])),this._lastAmbientColor.set(b))}}get objectGUIDs(){this._objectGUIDs||(this._objectGUIDs=Object.keys(this.guidObjects));return this._objectGUIDs}get entityTypeIds(){this._entityTypeIds||(this._entityTypeIds=Object.keys(this.entityTypes));return this._entityTypeIds}get entityIds(){this._entityIds||(this._entityIds=
Object.keys(this.entities));return this._entityIds}get visibleEntityIds(){this._visibleEntityIds||(this._visibleEntityIds=Object.keys(this.visibleEntities));return this._visibleEntityIds}get ghostedEntityIds(){this._ghostedEntityIds||(this._ghostedEntityIds=Object.keys(this.ghostedEntities));return this._ghostedEntityIds}get highlightedEntityIds(){this._highlightedEntityIds||(this._highlightedEntityIds=Object.keys(this.highlightedEntities));return this._highlightedEntityIds}get selectedEntityIds(){this._selectedEntityIds||
(this._selectedEntityIds=Object.keys(this.selectedEntities));return this._selectedEntityIds}set ticksPerRender(a){if(void 0===a||null===a)a=1;else if(!G.isNumeric(a)||0>=a)this.error("Unsupported value for 'ticksPerRender': '"+a+"' - should be an integer greater than zero."),a=1;a!==this._ticksPerRender&&(this._ticksPerRender=a)}get ticksPerRender(){return this._ticksPerRender}set passes(a){if(void 0===a||null===a)a=1;else if(!G.isNumeric(a)||0>=a)this.error("Unsupported value for 'passes': '"+a+
"' - should be an integer greater than zero."),a=1;a!==this._passes&&(this._passes=a,this._renderer.imageDirty())}get passes(){return this._passes}set clearEachPass(a){a=!!a;a!==this._clearEachPass&&(this._clearEachPass=a,this._renderer.imageDirty())}get clearEachPass(){return this._clearEachPass}set gammaInput(a){a=!1!==a;a!==this._renderer.gammaInput&&(this._renderer.gammaInput=a,this._needRecompileMeshes=!0)}get gammaInput(){return this._renderer.gammaInput}set gammaOutput(a){a=!1!==a;a!==this._renderer.gammaOutput&&
(this._renderer.gammaOutput=a,this._needRecompileMeshes=!0)}get gammaOutput(){return this._renderer.gammaOutput}set gammaFactor(a){a=void 0===a||null===a?2.2:a;a!==this._renderer.gammaFactor&&(this._renderer.gammaFactor=a,this._renderer.imageDirty())}get gammaFactor(){return this._renderer.gammaFactor}get geometry(){return this.components["default.geometry"]||new lc(this,{id:"default.geometry",dontClear:!0})}get material(){return this.components["default.material"]||new Oa(this,{id:"default.material",
emissive:[.4,.4,.4],dontClear:!0})}get ghostMaterial(){return this.components["default.ghostMaterial"]||new $a(this,{id:"default.ghostMaterial",preset:"sepia",dontClear:!0})}get highlightMaterial(){return this.components["default.highlightMaterial"]||new $a(this,{id:"default.highlightMaterial",preset:"yellowHighlight",dontClear:!0})}get selectedMaterial(){return this.components["default.selectedMaterial"]||new $a(this,{id:"default.selectedMaterial",preset:"greenSelected",dontClear:!0})}get edgeMaterial(){return this.components["default.edgeMaterial"]||
new oc(this,{id:"default.edgeMaterial",preset:"default",edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1,dontClear:!0})}get outlineMaterial(){return this.components["default.outlineMaterial"]||new pc(this,{id:"default.outlineMaterial",dontClear:!0})}get viewport(){return this._viewport}get camera(){return this._camera}get center(){if(this._aabbDirty||!this._center){this._center&&this._center||(this._center=l.vec3());const a=this.aabb;this._center[0]=(a[0]+a[3])/2;this._center[1]=(a[1]+a[4])/2;this._center[2]=
(a[2]+a[5])/2}return this._center}get aabb(){if(this._aabbDirty){this._aabb||(this._aabb=l.AABB3());let b=l.MAX_DOUBLE,c=l.MAX_DOUBLE,d=l.MAX_DOUBLE,f=-l.MAX_DOUBLE,e=-l.MAX_DOUBLE,g=-l.MAX_DOUBLE;const h=this.meshes;for(const m in h)if(h.hasOwnProperty(m)){var a=h[m];a.collidable&&(a=a.aabb,a[0]<b&&(b=a[0]),a[1]<c&&(c=a[1]),a[2]<d&&(d=a[2]),a[3]>f&&(f=a[3]),a[4]>e&&(e=a[4]),a[5]>g&&(g=a[5]))}this._aabb[0]=b;this._aabb[1]=c;this._aabb[2]=d;this._aabb[3]=f;this._aabb[4]=e;this._aabb[5]=g;this._aabbDirty=
!1}return this._aabb}_setBoundaryDirty(){this._aabbDirty=!0;this.fire("boundary")}pick(a){if(0===this.canvas.boundary[2]||0===this.canvas.boundary[3])return this.error("Picking not allowed while canvas has zero width or height"),null;a=a||{};a.pickSurface=a.pickSurface||a.rayPick;a.canvasPos||a.origin&&a.direction||this.warn("picking without canvasPos or ray origin and direction");var b=a.includeMeshes||a.include;b&&(a.includeMeshIds=Bc(this,b));if(b=a.excludeMeshes||a.exclude)a.excludeMeshIds=Bc(this,
b);if(b=this._renderer.pick(a)){b.object=b.mesh;if(a.pickSurface&&void 0!==b.primIndex&&-1<b.primIndex){const n=b.mesh.geometry._state;if("triangles"===n.primitiveName){b.primitive="triangle";var c=b.primIndex,d=n.indices,f=n.positions;if(d){var e=d[c+0],g=d[c+1],h=d[c+2];Ib[0]=e;Ib[1]=g;Ib[2]=h;b.indices=Ib;c=3*e;d=3*g;var m=3*h}else c*=3,d=c+3,m=d+3;Ja[0]=f[c+0];Ja[1]=f[c+1];Ja[2]=f[c+2];Ka[0]=f[d+0];Ka[1]=f[d+1];Ka[2]=f[d+2];La[0]=f[m+0];La[1]=f[m+1];La[2]=f[m+2];n.quantized&&(f=n.positionsDecodeMatrix)&&
(l.decompressPosition(Ja,f,Ja),l.decompressPosition(Ka,f,Ka),l.decompressPosition(La,f,La));a.canvasPos?(f=a.canvasPos,b.canvasPos=a.canvasPos,l.canvasPosToLocalRay(this.camera,b.mesh,f,qc,Hb)):a.origin&&a.direction&&l.worldRayToLocalRay(b.mesh,a.origin,a.direction,qc,Hb);l.normalizeVec3(Hb);l.rayPlaneIntersect(qc,Hb,Ja,Ka,La,Ma);b.localPos=Ma;b.position=Ma;gb[0]=Ma[0];gb[1]=Ma[1];gb[2]=Ma[2];gb[3]=1;l.transformVec4(b.mesh.worldMatrix,gb,hb);Jb[0]=hb[0];Jb[1]=hb[1];Jb[2]=hb[2];b.worldPos=Jb;l.transformVec4(b.mesh.scene.camera.matrix,
hb,Lb);Kb[0]=Lb[0];Kb[1]=Lb[1];Kb[2]=Lb[2];b.viewPos=Kb;l.cartesianToBarycentric(Ma,Ja,Ka,La,Da);b.bary=Da;if(a=n.normals)n.quantized?(c=2*e,d=2*g,m=2*h,l.octDecodeVec2(a.subarray(c,c+2),ab),l.octDecodeVec2(a.subarray(d,d+2),bb),l.octDecodeVec2(a.subarray(m,m+2),cb)):(ab[0]=a[c],ab[1]=a[c+1],ab[2]=a[c+2],bb[0]=a[d],bb[1]=a[d+1],bb[2]=a[d+2],cb[0]=a[m],cb[1]=a[m+1],cb[2]=a[m+2]),a=l.addVec3(l.addVec3(l.mulVec3Scalar(ab,Da[0],je),l.mulVec3Scalar(bb,Da[1],ke),le),l.mulVec3Scalar(cb,Da[2],me),ne),b.normal=
l.transformVec3(b.mesh.worldNormalMatrix,a,oe);if(a=n.uv)db[0]=a[2*e],db[1]=a[2*e+1],eb[0]=a[2*g],eb[1]=a[2*g+1],fb[0]=a[2*h],fb[1]=a[2*h+1],n.quantized&&(e=n.uvDecodeMatrix)&&(l.decompressUV(db,e,db),l.decompressUV(eb,e,eb),l.decompressUV(fb,e,fb)),b.uv=l.addVec3(l.addVec3(l.mulVec2Scalar(db,Da[0],pe),l.mulVec2Scalar(eb,Da[1],qe),re),l.mulVec2Scalar(fb,Da[2],se),te)}}b.mesh.fire("picked",b);return b}}getAABB(a){if(void 0===a)return this.aabb;if(G.isString(a)){const m=this.objects[a];if(m)return m.aabb;
a=[a]}if(0===a.length)return this.aabb;let b=1E5,c=1E5,d=1E5,f=-1E5,e=-1E5,g=-1E5,h;this.withObjects(a,m=>{m=m.aabb;m[0]<b&&(b=m[0]);m[1]<c&&(c=m[1]);m[2]<d&&(d=m[2]);m[3]>f&&(f=m[3]);m[4]>e&&(e=m[4]);m[5]>g&&(g=m[5]);h=!0});return h?(a=l.AABB3(),a[0]=b,a[1]=c,a[2]=d,a[3]=f,a[4]=e,a[5]=g,a):this.aabb}clear(){for(const b in this.components)if(this.components.hasOwnProperty(b)){var a=this.components[b];a._dontClear||a.destroy()}}clearLights(){const a=Object.keys(this.lights);for(let b=0,c=a.length;b<
c;b++)this.lights[a[b]].destroy()}clearClips(){const a=Object.keys(this.clips);for(let b=0,c=a.length;b<c;b++)this.clips[a[b]].destroy()}setVisible(a,b){return this.withObjects(a,c=>{const d=c.visible!==b;c.visible=b;return d})}setCulled(a,b){return this.withObjects(a,c=>{const d=c.culled!==b;c.culled=b;return d})}setSelected(a,b){return this.withObjects(a,c=>{const d=c.selected!==b;c.selected=b;return d})}setHighlighted(a,b){return this.withObjects(a,c=>{const d=c.highlighted!==b;c.highlighted=b;
return d})}setGhosted(a,b){return this.withObjects(a,c=>{const d=c.ghosted!==b;c.ghosted=b;return d})}setEdges(a,b){return this.withObjects(a,c=>{const d=c.edges!==b;c.edges=b;return d})}setOutlined(a,b){return this.withObjects(a,c=>{const d=c.outlined!==b;c.outlined=b;return d})}setColorize(a,b){return this.withObjects(a,c=>{c.colorize=b})}setOpacity(a,b){return this.withObjects(a,c=>{c.opacity=b})}setPickable(a,b){return this.withObjects(a,c=>{const d=c.pickable!==b;c.pickable=b;return d})}withObjects(a,
b){G.isString(a)&&(a=[a]);let c=!1;for(let f=0,e=a.length;f<e;f++){var d=a[f];let g=this.objects[d];if(g)c=b(g)||c;else if(g=this.guidObjects[d])c=b(g)||c;else if(d=this.entityTypes[d])for(const h in d)d.hasOwnProperty(h)&&(c=b(d[h])||c)}return c}destroy(){super.destroy();for(const a in this.components)this.components.hasOwnProperty(a)&&this.components[a].destroy();this._camera=this._viewport=this.input=this._renderer=this.canvas=this.rootObjects=this.components=this.types=this.meshes=this._selectedEntityIds=
this._highlightedEntityIds=this._ghostedEntityIds=this._visibleEntityIds=this._entityIds=this._objectGUIDs=this.reflectionMaps=this.lightMaps=this.lights=this.clips=this.selectedEntities=this.highlightedEntities=this.ghostedEntities=this.visibleEntities=this.entities=this.entityTypes=this.guidObjects=this.objects=this.models=this.canvas.gl=null}}M["xeogl.Scene"]=rc;const jd={},kd=new ta;let sc=null;const ba={version:null,scenes:{},_superTypes:{},getDefaultScene(){sc||=new rc({id:"default.scene"});
return sc},setDefaultScene(a){return sc=a},_addScene(a){if(a.id){if(ba.scenes[a.id]){console.error(`[ERROR] Scene ${G.inQuotes(a.id)} already exists`);return}}else a.id=kd.addItem({});ba.scenes[a.id]=a;const b=a.ticksPerRender;jd[a.id]={ticksPerRender:b,renderCountdown:b};P.components.scenes++;a.on("destroyed",()=>{kd.removeItem(a.id);delete ba.scenes[a.id];delete jd[a.id];P.components.scenes--})},clear(){let a;for(const b in ba.scenes)ba.scenes.hasOwnProperty(b)&&(a=ba.scenes[b],"default.scene"===
b?a.clear():(a.destroy(),delete ba.scenes[a.id]))},isComponentType:function(a,b="xeogl.Component"){if(a===b)return!0;a=M[a];if(!a)return!1;b=M[b];if(!b)return!1;a:{for(a=a.prototype;null!==a;){if(a===b.prototype){b=!0;break a}a=a.__proto__}b=!1}return b}},ld={},ya={sceneId:null,time:null,startTime:null,prevTime:null,deltaTime:null},Mb=[];let tc=0,md,uc=0;const nd=function(){let a=Date.now();if(0<tc){md=a-tc;var b=1E3/md;uc+=b;Mb.push(b);30<=Mb.length&&(uc-=Mb.shift());P.frame.fps=Math.round(uc/Mb.length)}b=
za.runTasks(a+10);var c=za.getNumTasks();P.frame.tasksRun=b;P.frame.tasksScheduled=c;P.frame.tasksBudget=10;ya.time=a;for(var d in ba.scenes)ba.scenes.hasOwnProperty(d)&&(b=ba.scenes[d],ya.sceneId=d,ya.startTime=b.startTime,ya.deltaTime=null!=ya.prevTime?ya.time-ya.prevTime:0,b.fire("tick",ya,!0));ya.prevTime=a;d=ba.scenes;let f,e;for(e in d)d.hasOwnProperty(e)&&(b=d[e],(c=ld[e])||(c=ld[e]={}),f=b.ticksPerRender,c.ticksPerRender!==f&&(c.ticksPerRender=f,c.renderCountdown=f),0===--c.renderCountdown&&
(b.render(!1),c.renderCountdown=f));tc=a;window.requestAnimationFrame(nd)};window.requestAnimationFrame(nd);const vc=l.vec3(),Ea=l.vec3(),Va=l.vec3(),od=l.vec3(),oa=l.vec3(),pd=l.vec3();class wc extends Z{get type(){return"xeogl.CameraFlightAnimation"}init(a){super.init(a);this._aabbHelper=new Pa(this,{geometry:new Xa(this),material:new Oa(this,{diffuse:[0,0,0],ambient:[0,0,0],specular:[0,0,0],emissive:[.5,1,.5],lineWidth:2}),visible:!1,collidable:!1});this._look1=l.vec3();this._eye1=l.vec3();this._up1=
l.vec3();this._look2=l.vec3();this._eye2=l.vec3();this._up2=l.vec3();this._orthoScale2=this._orthoScale1=1;this._flyingLook=this._flyingEye=this._flyEyeLookUp=this._flying=!1;this._time2=this._time1=this._callbackScope=this._callback=null;this.easing=!1!==a.easing;this.duration=a.duration;this.fit=a.fit;this.fitFOV=a.fitFOV;this.trail=a.trail}flyTo(a,b,c){a=a||this.scene;this._flying&&this.stop();this._flying=!1;this._callback=b;this._callbackScope=c;var d=this.scene.camera;this._eye1[0]=d.eye[0];
this._eye1[1]=d.eye[1];this._eye1[2]=d.eye[2];this._look1[0]=d.look[0];this._look1[1]=d.look[1];this._look1[2]=d.look[2];this._up1[0]=d.up[0];this._up1[1]=d.up[1];this._up1[2]=d.up[2];this._orthoScale1=d.ortho.scale;this._orthoScale2=a.orthoScale||this._orthoScale1;let f;if(a.aabb)var e=a.aabb;else if(6===a.length)e=a;else if(a.eye&&a.look||a.up){var g=a.eye;var h=a.look;f=a.up}else if(a.eye)g=a.eye;else if(a.look)h=a.look;else{d=a;if(G.isNumeric(d)||G.isString(d))if(e=d,d=this.scene.components[e],
!d){this.error("Component not found: "+G.inQuotes(e));b&&(c?b.call(c):b());return}e=d.aabb||this.scene.aabb}b=a.poi;if(e){if(e[3]<e[0]||e[4]<e[1]||e[5]<e[2]||e[3]===e[0]&&e[4]===e[1]&&e[5]===e[2])return;!1!==a.showAABB&&(this._aabbHelper.geometry.targetAABB=e);e=e.slice();g=l.getAABB3Center(e);this._look2=b||g;g=l.subVec3(this._eye1,this._look1,vc);g=l.normalizeVec3(g);e=b?l.getAABB3DiagPoint(e,b):l.getAABB3Diag(e);h=Math.abs(e/Math.tan((a.fitFOV||this._fitFOV)*l.DEGTORAD));this._orthoScale2=1.1*
e;this._eye2[0]=this._look2[0]+g[0]*h;this._eye2[1]=this._look2[1]+g[1]*h;this._eye2[2]=this._look2[2]+g[2]*h;this._up2[0]=this._up1[0];this._up2[1]=this._up1[1];this._up2[2]=this._up1[2];this._flyEyeLookUp=!1}else if(g||h||f)this._flyEyeLookUp=!!g&&!!h&&!!f,this._flyingEye=!!g&&!h,this._flyingLook=!!h&&!g,h&&(this._look2[0]=h[0],this._look2[1]=h[1],this._look2[2]=h[2]),g&&(this._eye2[0]=g[0],this._eye2[1]=g[1],this._eye2[2]=g[2]),f&&(this._up2[0]=f[0],this._up2[1]=f[1],this._up2[2]=f[2]);this.fire("started",
a,!0);this._time1=Date.now();this._time2=this._time1+(a.duration?1E3*a.duration:this._duration);this._flying=!0;za.scheduleTask(this._update,this)}jumpTo(a){this._jumpTo(a)}_jumpTo(a){this._flying&&this.stop();const b=this.scene.camera;if(a.aabb)var c=a.aabb;else if(6===a.length)c=a;else if(a.eye||a.look||a.up){var d=a.eye;var f=a.look;var e=a.up}else{var g=a;if(G.isNumeric(g)||G.isString(g))if(c=g,g=this.scene.components[c],!g){this.error("Component not found: "+G.inQuotes(c));return}c=g.aabb||this.scene.aabb}g=
a.poi;if(c)c[3]<=c[0]||c[4]<=c[1]||c[5]<=c[2]||(d=g?l.getAABB3DiagPoint(c,g):l.getAABB3Diag(c),f=g||l.getAABB3Center(c,f),this._trail?l.subVec3(b.look,f,oa):l.subVec3(b.eye,b.look,oa),l.normalizeVec3(oa),a=(void 0!==a.fit?a.fit:this._fit)?Math.abs(d/Math.tan((a.fitFOV||this._fitFOV)*l.DEGTORAD)):l.lenVec3(l.subVec3(b.eye,b.look,vc)),l.mulVec3Scalar(oa,a),b.eye=l.addVec3(f,oa,vc),b.look=f);else if(d||f||e)d&&(b.eye=d),f&&(b.look=f),e&&(b.up=e)}_update(){if(this._flying){var a=(Date.now()-this._time1)/
(this._time2-this._time1),b=1<=a;1<a&&(a=1);a=this.easing?this._ease(a,0,1,1):a;var c=this.scene.camera;if(this._flyingEye||this._flyingLook)this._flyingEye?(l.subVec3(c.eye,c.look,oa),c.eye=l.lerpVec3(a,0,1,this._eye1,this._eye2,Va),c.look=l.subVec3(Va,oa,Ea)):this._flyingLook&&(c.look=l.lerpVec3(a,0,1,this._look1,this._look2,Ea),c.up=l.lerpVec3(a,0,1,this._up1,this._up2,od));else if(this._flyEyeLookUp)c.eye=l.lerpVec3(a,0,1,this._eye1,this._eye2,Va),c.look=l.lerpVec3(a,0,1,this._look1,this._look2,
Ea),c.up=l.lerpVec3(a,0,1,this._up1,this._up2,od);else{l.lerpVec3(a,0,1,this._look1,this._look2,Ea);let d;this._trail?l.subVec3(Ea,c.look,oa):l.subVec3(c.eye,c.look,oa);l.normalizeVec3(oa);l.lerpVec3(a,0,1,this._eye1,this._eye2,Va);l.subVec3(Va,Ea,pd);d=l.lenVec3(pd);l.mulVec3Scalar(oa,d);c.eye=l.addVec3(Ea,oa,Va);c.look=Ea}this.scene.camera.ortho.scale=this._orthoScale1+a*(this._orthoScale2-this._orthoScale1);b?this.stop():za.scheduleTask(this._update,this)}}_ease(a,b,c,d){a/=d;return-c*a*(a-2)+
b}stop(){if(this._flying){this._flying=this._aabbHelper.visible=!1;this._time2=this._time1=null;var a=this._callback;a&&(this._callback=null,this._callbackScope?a.call(this._callbackScope):a());this.fire("stopped",!0,!0)}}cancel(){this._flying&&(this._flying=this._aabbHelper.visible=!1,this._time2=this._time1=null,this._callback&&(this._callback=null),this.fire("canceled",!0,!0))}set duration(a){this._duration=a?1E3*a:500;this.stop()}get duration(){return this._duration/1E3}set fit(a){this._fit=!1!==
a}get fit(){return this._fit}set fitFOV(a){this._fitFOV=a||45}get fitFOV(){return this._fitFOV}set trail(a){this._trail=!!a}get trail(){return this._trail}}M["xeogl.CameraFlightAnimation"]=wc;class qd extends Z{get type(){return"xeogl.Clip"}init(a){super.init(a);this._state=new da({active:!0,pos:new Float32Array(3),dir:new Float32Array(3)});this.active=a.active;this.pos=a.pos;this.dir=a.dir;this.scene._clipCreated(this)}set active(a){this._state.active=!1!==a;this._renderer.imageDirty();this.fire("active",
this._state.active)}get active(){return this._state.active}set pos(a){this._state.pos.set(a||[0,0,0]);this._renderer.imageDirty();this.fire("pos",this._state.pos)}get pos(){return this._state.pos}set dir(a){this._state.dir.set(a||[0,0,-1]);this._renderer.imageDirty();this.fire("dir",this._state.dir)}get dir(){return this._state.dir}destroy(){this._state.destroy();this.scene._clipDestroyed(this);super.destroy()}}M["xeogl.Clip"]=qd;class rd extends Z{get type(){return"xeogl.CameraControl"}init(a){super.init(a);
const b=this;this._boundaryHelper=new Pa(this,{geometry:new Xa(this),material:new Oa(this,{diffuse:[0,0,0],ambient:[0,0,0],specular:[0,0,0],emissive:[1,1,.6],lineWidth:4}),visible:!1,collidable:!1});this._pivoter=new function(){const c=b.scene,d=c.camera,f=c.canvas,e=new Float32Array(3);let g,h=0,m=0,n=0,p=!1;const r=document.createElement("div");r.innerText=" ";r.style.color="#ffffff";r.style.position="absolute";r.style.width="25px";r.style.height="25px";r.style.left="0px";r.style.top="0px";r.style["border-radius"]=
"15px";r.style.border="2px solid #ffffff";r.style.background="black";r.style.visibility="hidden";r.style["box-shadow"]="5px 5px 15px 1px #000000";r.style["z-index"]=0;r.style["pointer-events"]="none";document.body.appendChild(r);(function(){const q=l.vec4(),k=l.vec4(),t=l.vec2();let w=!0;d.on("viewMatrix",function(){w=!0});d.on("projMatrix",function(){w=!0});c.on("tick",function(){if(p&&w){l.transformPoint3(d.viewMatrix,e,q);q[3]=1;l.transformPoint4(d.projMatrix,q,k);var u=f.boundary;t[0]=Math.floor((1+
k[0]/k[3])*u[2]/2);t[1]=Math.floor((1-k[1]/k[3])*u[3]/2);u=f.canvas.getBoundingClientRect();r.style.left=Math.floor(u.left+t[0])-12+"px";r.style.top=Math.floor(u.top+t[1])-12+"px";r.style.visibility="visible";w=!1}})})();this.startPivot=function(q){q&&e.set(q);q=l.lookAtMat4v(d.eye,d.look,d.worldUp);g=l.transformPoint3(q,e);g[2]+=l.distVec3(d.eye,e);q=l.inverseMat4(q);var k=l.transformVec3(q,g);q=l.vec3();l.subVec3(d.eye,e,q);l.addVec3(q,k);1===d.worldUp[2]&&(k=q[1],q[1]=q[2],q[2]=k);n=l.lenVec3(q);
m=Math.acos(q[1]/n);h=Math.atan2(q[0],q[2]);p=!0};this.getPivoting=function(){return p};this.getPivotPos=function(){return e};this.continuePivot=function(q,k){if(p&&(0!==q||0!==k)){h+=.01*- -q;m+=.01*-k;m=l.clamp(m,.001,Math.PI-.001);k=[n*Math.sin(m)*Math.sin(h),n*Math.cos(m),n*Math.sin(m)*Math.cos(h)];1===d.worldUp[2]&&(q=k[1],k[1]=k[2],k[2]=q);q=l.lenVec3(l.subVec3(d.look,d.eye,l.vec3()));l.addVec3(k,e);k=l.lookAtMat4v(k,e,d.worldUp);k=l.inverseMat4(k);var t=l.transformVec3(k,g);k[12]-=t[0];k[13]-=
t[1];k[14]-=t[2];t=[k[8],k[9],k[10]];d.eye=[k[12],k[13],k[14]];l.subVec3(d.eye,l.mulVec3Scalar(t,q),d.look);d.up=[k[4],k[5],k[6]];r.style.visibility="visible"}};this.endPivot=function(){r.style.visibility="hidden";p=!1}};this._cameraFlight=new wc(this,{duration:.5});this.firstPerson=a.firstPerson;this.walking=a.walking;this.keyboardLayout=a.keyboardLayout;this.doublePickFlyTo=a.doublePickFlyTo;this.active=a.active;this.pivoting=a.pivoting;this.panToPointer=a.panToPointer;this.panToPivot=a.panToPivot;
this.inertia=a.inertia;this._initEvents()}set active(a){this._active=!1!==a}get active(){return this._active}set pivoting(a){this._pivoting=!!a}get pivoting(){return this._pivoting}set panToPointer(a){if(this._panToPointer=!!a)this._panToPivot=!1}get panToPointer(){return this._panToPointer}set panToPivot(a){if(this._panToPivot=!!a)this._panToPointer=!1}get panToPivot(){return this._panToPivot}set firstPerson(a){this._firstPerson=!!a}get firstPerson(){return this._firstPerson}set walking(a){this._walking=
!!a}get walking(){return this._walking}set doublePickFlyTo(a){this._doublePickFlyTo=!1!==a}get doublePickFlyTo(){return this._doublePickFlyTo}set inertia(a){this._inertia=void 0===a?.5:a}get inertia(){return this._inertia}set keyboardLayout(a){this._keyboardLayout=a||"qwerty"}get keyboardLayout(){return this._keyboardLayout}_initEvents(){function a(){if(n||p){k=!1;if(q=p||b.hasSubs("hoverSurface")?c.pick({pickSurface:!0,canvasPos:m}):c.pick({canvasPos:m})){const t=q.mesh.id;r!==t&&(void 0!==r&&b.fire("hoverOut",
{mesh:c.meshes[r]}),b.fire("hoverEnter",q),r=t);b.fire("hover",q);q.worldPos&&(k=!0,b.fire("hoverSurface",q))}else void 0!==r&&(b.fire("hoverOut",{mesh:c.meshes[r]}),r=void 0),b.fire("hoverOff",{canvasPos:m});p=n=!1}}const b=this,c=this.scene,d=c.input,f=c.camera,e=this.scene.canvas.canvas;let g=!1;e.oncontextmenu=function(t){t.preventDefault()};const h=function(t,w){if(t){let u=t.target,z=0,x=0;for(;u.offsetParent;)z+=u.offsetLeft,x+=u.offsetTop,u=u.offsetParent;w[0]=t.pageX-z;w[1]=t.pageY-x}else t=
window.event,w[0]=t.x,w[1]=t.y;return w},m=[0,0];let n=!1,p=!1,r,q,k=!1;c.on("tick",a);(function(){function t(){var A=c.aabb,E=A[3]-A[0];const H=A[4]-A[1];A=A[5]-A[2];E=E>H?E:H;return(A>E?A:E)/30}let w=0,u=0,z=0,x=0,B=0,C=0;const D=l.vec2();let F=!1,K=!1;const J=function(){const A=new Float32Array(3);return function(){return l.lenVec3(l.subVec3(f.look,f.eye,A))}}(),X=function(){let A=!0;f.on("projMatrix",function(){A=!0});const E=l.mat4();return function(){A&&l.inverseMat4(f.projMatrix,E);return E}}(),
R=function(){let A=!0;f.on("projMatrix",function(){A=!0});const E=l.mat4();return function(){A&&l.transposeMat4(f.projMatrix,E);return E}}(),Q=function(){let A=!0;f.on("viewMatrix",function(){A=!0});const E=l.mat4();return function(){A&&l.inverseMat4(f.viewMatrix,E);return E}}(),W=function(){let A=!0,E=1;c.on("boundary",function(){A=!0});return function(){A&&(E=l.getAABB3Diag(c.aabb));return E}}(),L=function(){const A=l.vec4(),E=l.vec4(),H=l.vec4(),S=l.vec3();return function(U,ha){var O=X(),ea=Q(),
V=R(),y=V.subarray(8,12);V=V.subarray(12);var N=[0,0,-W(),1];y=l.dotVec4(N,y)/l.dotVec4(N,V);N=c.canvas.canvas;V=N.offsetWidth/2;N=N.offsetHeight/2;A[0]=(U[0]-V)/V;A[1]=(U[1]-N)/N;A[2]=y;A[3]=1;l.mulMat4v4(O,A,E);l.mulVec3Scalar(E,1/E[3]);E[3]=1;E[1]*=-1;l.mulMat4v4(ea,E,H);l.subVec3(H,f.eye,S);l.normalizeVec3(S);U=S[0]*ha;O=S[1]*ha;ha*=S[2];ea=f.eye;y=f.look;f.eye=[ea[0]+U,ea[1]+O,ea[2]+ha];f.look=[y[0]+U,y[1]+O,y[2]+ha]}}(),ca=function(){const A=l.vec3();return function(E,H){l.subVec3(E,f.eye,A);
l.normalizeVec3(A);E=A[0]*H;const S=A[1]*H;H*=A[2];const U=f.eye,ha=f.look;f.eye=[U[0]+E,U[1]+S,U[2]+H];f.look=[ha[0]+E,ha[1]+S,ha[2]+H]}}();c.on("tick",function(){const A=b._inertia;.001>Math.abs(w)&&(w=0);.001>Math.abs(u)&&(u=0);if(0!==u||0!==w)b._pivoter.getPivoting()?b._pivoter.continuePivot(u,w):(0!==w&&(b._firstPerson?f.pitch(-w):f.orbitPitch(w)),0!==u&&(b._firstPerson?f.yaw(u):f.orbitYaw(u))),w*=A,u*=A;.001>Math.abs(z)&&(z=0);.001>Math.abs(x)&&(x=0);.001>Math.abs(B)&&(B=0);if(0!==z||0!==x||
0!==B){var E=J()/80;if(b._walking){var H=f.eye[1];f.pan([z*E,x*E,B*E]);E=f.eye;E[1]=H;f.eye=E}else f.pan([z*E,x*E,B*E])}z*=A;x*=A;B*=A;.001>Math.abs(C)&&(C=0);0!==C&&(b._firstPerson?(b._walking&&(H=f.eye[1]),F?L(D,2*-C):f.pan([0,0,C]),b._walking&&(E=f.eye,E[1]=H,f.eye=E)):(b._panToPointer?(a(),k?ca(q.worldPos,-C):f.zoom(C)):b._panToPivot?ca(b._pivoter.getPivotPos(),-C):f.zoom(C),f.ortho.scale+=C),C*=A)});document.addEventListener("keyDown",function(A){b._active&&"INPUT"!==A.target.tagName&&"TEXTAREA"!==
A.target.tagName&&(K=16===A.keyCode)},!0);document.addEventListener("keyup",function(A){b._active&&"INPUT"!==A.target.tagName&&"TEXTAREA"!==A.target.tagName&&16===A.keyCode&&(K=!1)});(function(){let A,E,H=0,S=0,U=!1,ha;e.addEventListener("mousedown",function(O){if(b._active)switch(g=!0,O.which){case 1:U=!0;S=H=0;h(O,D);A=D[0];E=D[1];break;case 3:U=ha=!0,S=H=0,h(O,D),A=D[0],E=D[1]}});e.addEventListener("mouseup",function(O){if(b._active){switch(O.which){case 3:ha=!1}U=!1;S=H=0}});document.addEventListener("mouseup",
function(O){if(b._active){switch(O.which){case 3:ha=!1}U=!1;S=H=0}});e.addEventListener("mouseenter",function(){b._active&&(g=!0,S=H=0)});e.addEventListener("mouseleave",function(){b._active&&(g=!1,S=H=0)});e.addEventListener("mousemove",function(O){if(b._active&&g&&(h(O,D),F=!0,U)){O=D[0];var ea=D[1];H+=.4*(O-A);S+=.4*(ea-E);A=O;E=ea}});c.on("tick",function(){!b._active||0===Math.abs(H)&&0===Math.abs(S)||(K||ha?(z=.4*H,x=.4*S):(u=.4*-H,w=.4*S),S=H=0)});e.addEventListener("wheel",function(O){if(b._active){b._panToPointer&&
(p=!0);var ea=Math.max(-1,Math.min(1,40*-O.deltaY));0!==ea&&(C=-(ea/Math.abs(ea))*t()*.8,O.preventDefault())}});c.on("tick",function(O){if(b._active&&g&&(O=O.deltaTime,!b.ctrlDown&&!b.altDown)){const ea=d.keyDown[d.KEY_ADD],V=d.keyDown[d.KEY_SUBTRACT];if(ea||V)V?C=O*t()*.02:ea&&(C=-O*t()*.02)}});(function(){c.on("tick",function(O){if(b._active&&g){O=O.deltaTime;if("azerty"==b._keyboardLayout){var ea=d.keyDown[d.KEY_Z];var V=d.keyDown[d.KEY_S];var y=d.keyDown[d.KEY_Q];var N=d.keyDown[d.KEY_D];var aa=
d.keyDown[d.KEY_W]}else ea=d.keyDown[d.KEY_W],V=d.keyDown[d.KEY_S],y=d.keyDown[d.KEY_A],N=d.keyDown[d.KEY_D],aa=d.keyDown[d.KEY_Z];var ka=d.keyDown[d.KEY_X];if(ea||V||y||N||aa||ka)ka?x+=.02*O:aa&&(x-=.02*-O),N?z+=.02*-O:y&&(z=.02*O),V?B=.02*O:ea&&(B=.02*-O)}})})()})();(function(){function A(V){const y=Date.now();if(0===O)return O=V,!0;if(O===V)return 50<y-ea;O=V;ea=y;return!1}const E=new Float32Array(2),H=[];let S=0;const U=new Float32Array(2),ha=new Float32Array(2);let O=0,ea=Date.now();e.addEventListener("touchstart",
function(V){if(b._active){var y=V.touches,N=V.changedTouches;1===y.length&&1===N.length&&(E[0]=y[0].pageX,E[1]=y[0].pageY);for(;H.length<y.length;)H.push(new Float32Array(2));for(let aa=0,ka=y.length;aa<ka;++aa)H[aa][0]=y[aa].pageX,H[aa][1]=y[aa].pageY;O=0;S=y.length;V.stopPropagation()}},{passive:!0});e.addEventListener("touchmove",function(V){if(b._active){var y=V.touches;if(1===S){var N=y[0];if(A(1)){var aa=.3*(N.pageX-H[0][0]);w=.3*(N.pageY-H[0][1]);u=-aa}}else if(2===S){N=y[0];aa=y[1];l.subVec2([N.pageX,
N.pageY],H[0],U);l.subVec2([aa.pageX,aa.pageY],H[1],ha);const ka=0<l.dotVec2(U,ha);ka&&A(2)&&(l.subVec2([N.pageX,N.pageY],H[0],U),z=.2*U[0],x=.2*U[1]);!ka&&A(4)&&(N=l.distVec2([N.pageX,N.pageY],[aa.pageX,aa.pageY]),C=(l.distVec2(H[0],H[1])-N)*t()*.05)}for(N=0;N<S;++N)H[N][0]=y[N].pageX,H[N][1]=y[N].pageY;V.stopPropagation()}},{passive:!0})})();(function(){c.on("tick",function(A){if(b._active&&g){A=A.deltaTime;var E=d.keyDown[d.KEY_LEFT_ARROW],H=d.keyDown[d.KEY_RIGHT_ARROW],S=d.keyDown[d.KEY_UP_ARROW],
U=d.keyDown[d.KEY_DOWN_ARROW];if(E||H||S||U)H?u+=.02*-A:E&&(u+=.02*A),U?w+=.02*A:S&&(w+=.02*-A)}})})();(function(){c.on("tick",function(A){if(b._active&&g){A=A.deltaTime;var E;var H="azerty"==b._keyboardLayout?d.keyDown[d.KEY_A]:d.keyDown[d.KEY_Q];if((E=d.keyDown[d.KEY_E])||H)H?u+=.02*A:E&&(u+=.02*-A)}})})()})();(function(){(function(){e.addEventListener("mousemove",function(x){b._active&&(h(x,m),b.hasSubs("hover")||b.hasSubs("hoverOut")||b.hasSubs("hoverOff")||b.hasSubs("hoverSurface"))&&(n=!0)});
let t,w,u,z;e.addEventListener("mousedown",function(x){b._active&&(t=x.clientX,w=x.clientY,u=m[0],z=m[1],p=b._pivoting,a(),b._pivoting&&(q?b._pivoter.startPivot(q.worldPos):b._pivoter.startPivot()))});e.addEventListener("mouseup",function(x){let B=0,C;return function(D){b._active&&(b._pivoter.endPivot(),3<Math.abs(D.clientX-t)||3<Math.abs(D.clientY-w)||(b._doublePickFlyTo||b.hasSubs("doublePicked")||b.hasSubs("doublePickedSurface")||b.hasSubs("doublePickedNothing")?(B++,1==B?C=setTimeout(function(){p=
(n=b._doublePickFlyTo)||!!b.hasSubs("pickedSurface");m[0]=u;m[1]=z;a();q?(b.fire("picked",q),k&&b.fire("pickedSurface",q)):b.fire("pickedNothing");B=0},250):(clearTimeout(C),p=(n=b._doublePickFlyTo)&&!!b.hasSubs("doublePickedSurface"),a(),q?(b.fire("doublePicked",q),k&&b.fire("doublePickedSurface",q),b._doublePickFlyTo&&b._flyTo(q)):(b.fire("doublePickedNothing"),b._doublePickFlyTo&&b._flyTo()),B=0)):(p=!!b.hasSubs("pickedSurface"),a(),q?(b.fire("picked",q),k&&b.fire("pickedSurface",q)):b.fire("pickedNothing"))))}}(),
!1)})();(function(){let t;const w=[],u=new Float32Array(2);let z=-1,x=-1;e.addEventListener("touchstart",function(B){if(b._active){var C=B.touches,D=B.changedTouches;t=Date.now();1===C.length&&1===D.length?(z=t,u[0]=C[0].pageX,u[1]=C[0].pageY):z=-1;for(;w.length<C.length;)w.push(new Float32Array(2));for(let F=0,K=C.length;F<K;++F)w[F][0]=C[F].pageX,w[F][1]=C[F].pageY;w.length=C.length;B.stopPropagation()}},{passive:!0});e.addEventListener("touchend",function(B){if(b._active){var C=Date.now(),D=B.touches,
F=B.changedTouches;0===D.length&&1===F.length&&-1<z&&150>C-z&&(-1<x&&325>z-x?(m[0]=Math.round(F[0].clientX),m[1]=Math.round(F[0].clientY),n=!0,p=!!b.hasSubs("pickedSurface"),a(),q?(b.fire("doublePicked",q),k&&b.fire("doublePickedSurface",q),b._doublePickFlyTo&&b._flyTo(q)):(b.fire("doublePickedNothing"),b._doublePickFlyTo&&b._flyTo()),x=-1):4>l.distVec2(w[0],u)&&(m[0]=Math.round(F[0].clientX),m[1]=Math.round(F[0].clientY),n=!0,p=!!b.hasSubs("pickedSurface"),a(),q?(b.fire("picked",q),k&&b.fire("pickedSurface",
q)):b.fire("pickedNothing"),x=C),z=-1);w.length=D.length;for(let K=0,J=D.length;K<J;++K)w[K][0]=D[K].pageX,w[K][1]=D[K].pageY;B.stopPropagation()}},{passive:!0})})()})();(function(){const t=l.vec3(),w=l.vec3(),u=l.vec3(),z=l.vec3(),x={eye:new Float32Array(3),look:new Float32Array(3),up:new Float32Array(3)};document.addEventListener("keydown",function(B){if(b._active&&g&&(B=B.keyCode,49===B||50===B||51===B||52===B||53===B||54===B)){var C=c.aabb,D=l.getAABB3Diag(C);t[0]=C[0]+C[3]/2;t[1]=C[1]+C[4]/2;
t[2]=C[2]+C[5]/2;C=Math.abs(D/Math.tan(b._cameraFlight.fitFOV/2));switch(B){case 49:x.eye.set(l.mulVec3Scalar(f.worldRight,C,w));x.look.set(t);x.up.set(f.worldUp);break;case 50:x.eye.set(l.mulVec3Scalar(f.worldForward,C,w));x.look.set(t);x.up.set(f.worldUp);break;case 51:x.eye.set(l.mulVec3Scalar(f.worldRight,-C,w));x.look.set(t);x.up.set(f.worldUp);break;case 52:x.eye.set(l.mulVec3Scalar(f.worldForward,-C,w));x.look.set(t);x.up.set(f.worldUp);break;case 53:x.eye.set(l.mulVec3Scalar(f.worldUp,C,w));
x.look.set(t);x.up.set(l.normalizeVec3(l.mulVec3Scalar(f.worldForward,1,u),z));break;case 54:x.eye.set(l.mulVec3Scalar(f.worldUp,-C,w));x.look.set(t);x.up.set(l.normalizeVec3(l.mulVec3Scalar(f.worldForward,-1,u)));break;default:return}0<b._cameraFlight.duration?b._cameraFlight.flyTo(x):b._cameraFlight.jumpTo(x)}})})()}_flyTo(a){if(a&&a.worldPos)var b=a.worldPos;a=a?a.mesh.aabb:this.scene.aabb;this._boundaryHelper.geometry.targetAABB=a;b&&(b=this.scene.camera,l.subVec3(b.eye,b.look,[]));this._cameraFlight.flyTo({aabb:a},
this._hideBoundary,this)}_hideBoundary(){}destroy(){this.active=!1;super.destroy()}}M["xeogl.CameraControl"]=rd;class sd extends ua{get type(){return"xeogl.TorusGeometry"}init(a){var b=a.radius||1;0>b&&(this.error("negative radius not allowed - will invert"),b*=-1);b*=.5;var c=a.tube||.3;0>c&&(this.error("negative tube not allowed - will invert"),c*=-1);let d=a.radialSegments||32;0>d&&(this.error("negative radialSegments not allowed - will invert"),d*=-1);4>d&&(d=4);let f=a.tubeSegments||24;0>f&&
(this.error("negative tubeSegments not allowed - will invert"),f*=-1);4>f&&(f=4);var e=a.arc||2*Math.PI;0>e&&(this.warn("negative arc not allowed - will invert"),e*=-1);360<e&&(e=360);var g=a.center;let h;var m=g?g[2]:0;g=[];const n=[],p=[],r=[];let q,k,t;for(t=0;t<=f;t++)for(k=0;k<=d;k++){var w=k/d*e;var u=.785398+t/f*Math.PI*2;var z=b*Math.cos(w);h=b*Math.sin(w);q=(b+c*Math.cos(u))*Math.cos(w);w=(b+c*Math.cos(u))*Math.sin(w);u=c*Math.sin(u);g.push(q+z);g.push(w+h);g.push(u+m);p.push(1-k/d);p.push(t/
f);z=l.normalizeVec3(l.subVec3([q,w,u],[z,h,m],[]),[]);n.push(z[0]);n.push(z[1]);n.push(z[2])}for(t=1;t<=f;t++)for(k=1;k<=d;k++)b=(d+1)*t+k-1,c=(d+1)*(t-1)+k-1,e=(d+1)*(t-1)+k,m=(d+1)*t+k,r.push(b),r.push(c),r.push(e),r.push(e),r.push(m),r.push(b);super.init(G.apply(a,{positions:g,normals:n,uv:p,indices:r}))}}M["xeogl.TorusGeometry"]=sd;class td extends ua{get type(){return"xeogl.SphereGeometry"}init(a){var b=a.lod||1,c=a.center?a.center[0]:0,d=a.center?a.center[1]:0;const f=a.center?a.center[2]:
0;let e=a.radius||1;0>e&&(this.warn("negative radius not allowed - will invert"),e*=-1);let g=a.heightSegments||18;0>g&&(this.warn("negative heightSegments not allowed - will invert"),g*=-1);g=Math.floor(b*g);18>g&&(g=18);let h=a.widthSegments||18;0>h&&(this.warn("negative widthSegments not allowed - will invert"),h*=-1);h=Math.floor(b*h);18>h&&(h=18);b=[];const m=[],n=[],p=[];let r;let q,k;let t,w,u;for(r=0;r<=g;r++){var z=r*Math.PI/g;q=Math.sin(z);k=Math.cos(z);for(z=0;z<=h;z++){var x=2*z*Math.PI/
h;var B=Math.sin(x);x=Math.cos(x);x*=q;t=k;B*=q;w=1-z/h;u=r/g;m.push(x);m.push(t);m.push(B);n.push(w);n.push(u);b.push(c+e*x);b.push(d+e*t);b.push(f+e*B)}}for(r=0;r<g;r++)for(z=0;z<h;z++)c=r*(h+1)+z,d=c+h+1,p.push(c+1),p.push(d+1),p.push(d),p.push(c+1),p.push(d),p.push(c);super.init(G.apply(a,{positions:b,normals:m,uv:n,indices:p}))}}M["xeogl.SphereGeometry"]=td;class ud extends ua{get type(){return"xeogl.OBBGeometry"}init(a){super.init(G.apply(a,{combined:!0,quantized:!1,primitive:a.primitive||"lines",
positions:a.positions||[1,1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1],indices:[0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]}));a.target?this.target=a.target:a.targetOBB&&(this.targetOBB=a.targetOBB)}set target(a){let b=!1;const c=this;this._attach({name:"target",type:"xeogl.Component",component:a,sceneDefault:!1,on:{boundary:function(){b||(b=!0,za.scheduleTask(function(){c._setPositionsFromOBB(c._attached.target.obb);b=!1}))}},onAttached:function(){c._setPositionsFromOBB(c._attached.target.obb)}})}get target(){return this._attached.target}set targetOBB(a){a&&
(this._attached.target&&(this.target=null),this._setPositionsFromOBB(a))}_setPositionsFromOBB(a){this.positions=[a[0],a[1],a[2],a[4],a[5],a[6],a[8],a[9],a[10],a[12],a[13],a[14],a[16],a[17],a[18],a[20],a[21],a[22],a[24],a[25],a[26],a[28],a[29],a[30]]}}M["xeogl.OBBGeometry"]=ud;class vd extends ua{get type(){return"xeogl.CylinderGeometry"}init(a){let b=a.radiusTop||1;0>b&&(this.error("negative radiusTop not allowed - will invert"),b*=-1);let c=a.radiusBottom||1;0>c&&(this.error("negative radiusBottom not allowed - will invert"),
c*=-1);var d=a.height||1;0>d&&(this.error("negative height not allowed - will invert"),d*=-1);let f=a.radialSegments||32;0>f&&(this.error("negative radialSegments not allowed - will invert"),f*=-1);3>f&&(f=3);var e=a.heightSegments||1;0>e&&(this.error("negative heightSegments not allowed - will invert"),e*=-1);1>e&&(e=1);const g=!!a.openEnded;var h=a.center;const m=h?h[0]:0,n=h?h[1]:0,p=h?h[2]:0,r=d/2;var q=d/e;const k=2*Math.PI/f,t=1/f,w=(b-c)/e,u=[],z=[],x=[],B=[];var C;let D,F;const K=(90-180*
Math.atan(d/(c-b))/Math.PI)/90;for(C=0;C<=e;C++)for(D=b-C*w,F=r-C*q,d=0;d<=f;d++){var J=Math.sin(d*k);h=Math.cos(d*k);z.push(D*J);z.push(K);z.push(D*h);x.push(d*t);x.push(1*C/e);u.push(D*J+m);u.push(F+n);u.push(D*h+p)}for(C=0;C<e;C++)for(d=0;d<=f;d++)J=C*(f+1)+d,h=J+f,B.push(J),B.push(h),B.push(h+1),B.push(J),B.push(h+1),B.push(J+1);if(!g&&0<b){e=u.length/3;z.push(0);z.push(1);z.push(0);x.push(.5);x.push(.5);u.push(0+m);u.push(r+n);u.push(0+p);for(d=0;d<=f;d++)J=Math.sin(d*k),h=Math.cos(d*k),C=.5*
Math.sin(d*k)+.5,q=.5*Math.cos(d*k)+.5,z.push(b*J),z.push(1),z.push(b*h),x.push(C),x.push(q),u.push(b*J+m),u.push(r+n),u.push(b*h+p);for(d=0;d<f;d++)h=e,J=e+1+d,B.push(J),B.push(J+1),B.push(h)}if(!g&&0<c){e=u.length/3;z.push(0);z.push(-1);z.push(0);x.push(.5);x.push(.5);u.push(0+m);u.push(0-r+n);u.push(0+p);for(d=0;d<=f;d++)J=Math.sin(d*k),h=Math.cos(d*k),C=.5*Math.sin(d*k)+.5,q=.5*Math.cos(d*k)+.5,z.push(c*J),z.push(-1),z.push(c*h),x.push(C),x.push(q),u.push(c*J+m),u.push(0-r+n),u.push(c*h+p);for(d=
0;d<f;d++)h=e,J=e+1+d,B.push(h),B.push(J+1),B.push(J)}super.init(G.apply(a,{positions:u,normals:z,uv:x,indices:B}))}}M["xeogl.CylinderGeometry"]=vd;class wd extends ua{get type(){return"xeogl.PlaneGeometry"}init(a){var b=a.xSize||1;0>b&&(this.error("negative xSize not allowed - will invert"),b*=-1);var c=a.zSize||1;0>c&&(this.error("negative zSize not allowed - will invert"),c*=-1);var d=a.xSegments||1;0>d&&(this.error("negative xSegments not allowed - will invert"),d*=-1);1>d&&(d=1);var f=a.xSegments||
1;0>f&&(this.error("negative zSegments not allowed - will invert"),f*=-1);1>f&&(f=1);var e=a.center,g=e?e[0]:0,h=e?e[1]:0,m=e?e[2]:0,n=b/2,p=c/2;d=Math.floor(d)||1;f=Math.floor(f)||1;e=d+1;const r=f+1,q=b/d,k=c/f;c=new Float32Array(e*r*3);b=new Float32Array(e*r*3);const t=new Float32Array(e*r*2);let w=0,u=0,z,x,B;for(z=0;z<r;z++){const C=z*k-p;for(x=0;x<e;x++)B=x*q-n,c[w]=B+g,c[w+1]=h,c[w+2]=-C+m,b[w+2]=-1,t[u]=(d-x)/d,t[u+1]=(f-z)/f,w+=3,u+=2}w=0;p=new (65535<c.length/3?Uint32Array:Uint16Array)(d*
f*6);for(z=0;z<f;z++)for(x=0;x<d;x++)g=x+e*z,h=x+e*(z+1),m=x+1+e*(z+1),n=x+1+e*z,p[w]=n,p[w+1]=h,p[w+2]=g,p[w+3]=n,p[w+4]=m,p[w+5]=h,w+=6;super.init(G.apply(a,{positions:c,normals:b,uv:t,indices:p}))}}M["xeogl.PlaneGeometry"]=wd;class xd extends Z{get type(){return"xeogl.AmbientLight"}init(a){super.init(a);this._state={type:"ambient",color:l.vec3([.7,.7,.7]),intensity:1};this.color=a.color;this.intensity=a.intensity;this.scene._lightCreated(this)}set color(a){this._state.color.set(a||[.7,.7,.8]);
this._renderer.setImageForceDirty()}get color(){return this._state.color}set intensity(a){this._state.intensity=void 0!==a?a:1;this._renderer.setImageForceDirty()}get intensity(){return this._state.intensity}destroy(){super.destroy()}}M["xeogl.AmbientLight"]=xd;class yd extends Z{get type(){return"xeogl.PointLight"}init(a){super.init(a);const b=this;this._shadowProjMatrix=this._shadowViewMatrix=this._shadowRenderBuf=null;this._shadowProjMatrixDirty=this._shadowViewMatrixDirty=!0;this._state=new da({type:"point",
pos:l.vec3([1,1,1]),color:l.vec3([.7,.7,.8]),intensity:1,attenuation:[0,0,0],space:a.space||"view",shadow:!1,shadowDirty:!0,getShadowViewMatrix:function(){const c=l.vec3([0,0,0]),d=l.vec3([0,1,0]);return function(){b._shadowViewMatrixDirty&&(b._shadowViewMatrix||(b._shadowViewMatrix=l.identityMat4()),l.lookAtMat4v(b._state.pos,c,d,b._shadowViewMatrix),b._shadowViewMatrixDirty=!1);return b._shadowViewMatrix}}(),getShadowProjMatrix:function(){if(b._shadowProjMatrixDirty){b._shadowProjMatrix||(b._shadowProjMatrix=
l.identityMat4());const c=b.scene.canvas.canvas;l.perspectiveMat4(Math.PI/180*70,c.clientWidth/c.clientHeight,.1,500,b._shadowProjMatrix);b._shadowProjMatrixDirty=!1}return b._shadowProjMatrix},getShadowRenderBuf:function(){b._shadowRenderBuf||(b._shadowRenderBuf=new Wa(b.scene.canvas.canvas,b.scene.canvas.gl,{size:[1024,1024]}));return b._shadowRenderBuf}});this.pos=a.pos;this.color=a.color;this.intensity=a.intensity;this.constantAttenuation=a.constantAttenuation;this.linearAttenuation=a.linearAttenuation;
this.quadraticAttenuation=a.quadraticAttenuation;this.shadow=a.shadow;this.scene._lightCreated(this)}set pos(a){this._state.pos.set(a||[1,1,1]);this._shadowViewMatrixDirty=!0;this._renderer.imageDirty()}get pos(){return this._state.pos}set color(a){this._state.color.set(a||[.7,.7,.8]);this._renderer.imageDirty()}get color(){return this._state.color}set intensity(a){this._state.intensity=void 0!==a?a:1;this._renderer.imageDirty()}get intensity(){return this._state.intensity}set constantAttenuation(a){this._state.attenuation[0]=
a||0;this._renderer.imageDirty()}get constantAttenuation(){return this._state.attenuation[0]}set linearAttenuation(a){this._state.attenuation[1]=a||0;this._renderer.imageDirty()}get linearAttenuation(){return this._state.attenuation[1]}set quadraticAttenuation(a){this._state.attenuation[2]=a||0;this._renderer.imageDirty()}get quadraticAttenuation(){return this._state.attenuation[2]}set shadow(a){a=!!a;this._state.shadow!==a&&(this._state.shadow=a,this._shadowViewMatrixDirty=!0,this._renderer.imageDirty())}get shadow(){return this._state.shadow}destroy(){super.destroy();
this._state.destroy();this._shadowRenderBuf&&this._shadowRenderBuf.destroy();this.scene._lightDestroyed(this)}}M["xeogl.PointLight"]=yd;class zd extends Z{get type(){return"xeogl.SpotLight"}init(a){super.init(a);const b=this;this._shadowProjMatrix=this._shadowViewMatrix=this._shadowRenderBuf=null;this._shadowProjMatrixDirty=this._shadowViewMatrixDirty=!0;this._state=new da({type:"spot",pos:l.vec3([1,1,1]),dir:l.vec3([0,-1,0]),color:l.vec3([.7,.7,.8]),intensity:1,attenuation:[0,0,0],space:a.space||
"view",shadow:!1,shadowDirty:!0,getShadowViewMatrix:function(){const c=l.vec3(),d=l.vec3([0,1,0]);return function(){b._shadowViewMatrixDirty&&(b._shadowViewMatrix||(b._shadowViewMatrix=l.identityMat4()),l.addVec3(b._state.pos,b._state.dir,c),l.lookAtMat4v(b._state.pos,c,d,b._shadowViewMatrix),b._shadowViewMatrixDirty=!1);return b._shadowViewMatrix}}(),getShadowProjMatrix:function(){if(b._shadowProjMatrixDirty){b._shadowProjMatrix||(b._shadowProjMatrix=l.identityMat4());const c=b.scene.canvas.canvas;
l.perspectiveMat4(Math.PI/180*60,c.clientWidth/c.clientHeight,.1,400,b._shadowProjMatrix);b._shadowProjMatrixDirty=!1}return b._shadowProjMatrix},getShadowRenderBuf:function(){b._shadowRenderBuf||(b._shadowRenderBuf=new Wa(b.scene.canvas.canvas,b.scene.canvas.gl));return b._shadowRenderBuf}});this.pos=a.pos;this.color=a.color;this.intensity=a.intensity;this.constantAttenuation=a.constantAttenuation;this.linearAttenuation=a.linearAttenuation;this.quadraticAttenuation=a.quadraticAttenuation;this.shadow=
a.shadow;this.scene._lightCreated(this)}set pos(a){this._state.pos.set(a||[1,1,1]);this._shadowViewMatrixDirty=!0;this._renderer.imageDirty()}get pos(){return this._state.pos}set dir(a){this._state.dir.set(a||[1,1,1]);this._shadowViewMatrixDirty=!0;this._renderer.imageDirty()}get dir(){return this._state.dir}set color(a){this._state.color.set(a||[.7,.7,.8]);this._renderer.imageDirty()}get color(){return this._state.color}set intensity(a){this._state.intensity=void 0!==a?a:1;this._renderer.imageDirty()}get intensity(){return this._state.intensity}set constantAttenuation(a){this._state.attenuation[0]=
a||0;this._renderer.imageDirty()}get constantAttenuation(){return this._state.attenuation[0]}set linearAttenuation(a){this._state.attenuation[1]=a||0;this._renderer.imageDirty()}get linearAttenuation(){return this._state.attenuation[1]}set quadraticAttenuation(a){this._state.attenuation[2]=a||0;this._renderer.imageDirty()}get quadraticAttenuation(){return this._state.attenuation[2]}set shadow(a){a=!!a;this._state.shadow!==a&&(this._state.shadow=a,this._shadowViewMatrixDirty=!0,this._renderer.imageDirty(),
this.fire("dirty",!0))}get shadow(){return this._state.shadow}destroy(){super.destroy();this._state.destroy();this._shadowRenderBuf&&this._shadowRenderBuf.destroy();this.scene._lightDestroyed(this)}}M["xeogl.SpotLight"]=zd;const Jd={funcAdd:"FUNC_ADD",funcSubtract:"FUNC_SUBTRACT",funcReverseSubtract:"FUNC_REVERSE_SUBTRACT",zero:"ZERO",one:"ONE",srcColor:"SRC_COLOR",oneMinusSrcColor:"ONE_MINUS_SRC_COLOR",dstColor:"DST_COLOR",oneMinusDstColor:"ONE_MINUS_DST_COLOR",srcAlpha:"SRC_ALPHA",oneMinusSrcAlpha:"ONE_MINUS_SRC_ALPHA",
dstAlpha:"DST_ALPHA",oneMinusDstAlpha:"ONE_MINUS_DST_ALPHA",contantColor:"CONSTANT_COLOR",oneMinusConstantColor:"ONE_MINUS_CONSTANT_COLOR",constantAlpha:"CONSTANT_ALPHA",oneMinusConstantAlpha:"ONE_MINUS_CONSTANT_ALPHA",srcAlphaSaturate:"SRC_ALPHA_SATURATE",front:"FRONT",back:"BACK",frontAndBack:"FRONT_AND_BACK",never:"NEVER",less:"LESS",equal:"EQUAL",lequal:"LEQUAL",greater:"GREATER",notequal:"NOTEQUAL",gequal:"GEQUAL",always:"ALWAYS",cw:"CW",ccw:"CCW",linear:"LINEAR",nearest:"NEAREST",linearMipmapNearest:"LINEAR_MIPMAP_NEAREST",
nearestMipmapNearest:"NEAREST_MIPMAP_NEAREST",nearestMipmapLinear:"NEAREST_MIPMAP_LINEAR",linearMipmapLinear:"LINEAR_MIPMAP_LINEAR",repeat:"REPEAT",clampToEdge:"CLAMP_TO_EDGE",mirroredRepeat:"MIRRORED_REPEAT",alpha:"ALPHA",rgb:"RGB",rgba:"RGBA",luminance:"LUMINANCE",luminanceAlpha:"LUMINANCE_ALPHA",textureBinding2D:"TEXTURE_BINDING_2D",textureBindingCubeMap:"TEXTURE_BINDING_CUBE_MAP",compareRToTexture:"COMPARE_R_TO_TEXTURE",unsignedByte:"UNSIGNED_BYTE"},sa=new Uint8Array([0,0,0,1]);class Nb{constructor(a,
b){this.gl=a;this.target=b||a.TEXTURE_2D;this.texture=a.createTexture();this.setPreloadColor([0,0,0,0]);this.allocated=!0}setPreloadColor(a){a?(sa[0]=Math.floor(255*a[0]),sa[1]=Math.floor(255*a[1]),sa[2]=Math.floor(255*a[2]),sa[3]=Math.floor(255*(void 0!==a[3]?a[3]:1))):(sa[0]=0,sa[1]=0,sa[2]=0,sa[3]=255);a=this.gl;a.bindTexture(this.target,this.texture);a.texParameteri(this.target,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(this.target,a.TEXTURE_MIN_FILTER,a.NEAREST);if(this.target===a.TEXTURE_CUBE_MAP){const b=
[a.TEXTURE_CUBE_MAP_POSITIVE_X,a.TEXTURE_CUBE_MAP_NEGATIVE_X,a.TEXTURE_CUBE_MAP_POSITIVE_Y,a.TEXTURE_CUBE_MAP_NEGATIVE_Y,a.TEXTURE_CUBE_MAP_POSITIVE_Z,a.TEXTURE_CUBE_MAP_NEGATIVE_Z];for(let c=0,d=b.length;c<d;c++)a.texImage2D(b[c],0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,sa)}else a.texImage2D(this.target,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,sa);a.bindTexture(this.target,null)}setTarget(a){this.target=a||this.gl.TEXTURE_2D}setImage(a,b){const c=this.gl;c.bindTexture(this.target,this.texture);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,
b.flipY);if(this.target===c.TEXTURE_CUBE_MAP){if(G.isArray(a)){b=[c.TEXTURE_CUBE_MAP_POSITIVE_X,c.TEXTURE_CUBE_MAP_NEGATIVE_X,c.TEXTURE_CUBE_MAP_POSITIVE_Y,c.TEXTURE_CUBE_MAP_NEGATIVE_Y,c.TEXTURE_CUBE_MAP_POSITIVE_Z,c.TEXTURE_CUBE_MAP_NEGATIVE_Z];for(let d=0,f=b.length;d<f;d++)c.texImage2D(b[d],0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a[d])}}else c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a);c.bindTexture(this.target,null)}setProps(a){const b=this.gl;b.bindTexture(this.target,this.texture);
if(a.minFilter){var c=lb(b,a.minFilter);c&&(b.texParameteri(this.target,b.TEXTURE_MIN_FILTER,c),c!==b.NEAREST_MIPMAP_NEAREST&&c!==b.LINEAR_MIPMAP_NEAREST&&c!==b.NEAREST_MIPMAP_LINEAR&&c!==b.LINEAR_MIPMAP_LINEAR||b.generateMipmap(this.target))}a.magFilter&&(c=lb(b,a.magFilter))&&b.texParameteri(this.target,b.TEXTURE_MAG_FILTER,c);a.wrapS&&(c=lb(b,a.wrapS))&&b.texParameteri(this.target,b.TEXTURE_WRAP_S,c);a.wrapT&&(a=lb(b,a.wrapT))&&b.texParameteri(this.target,b.TEXTURE_WRAP_T,a);b.bindTexture(this.target,
null)}bind(a){if(this.allocated){if(this.texture){const b=this.gl;b.activeTexture(b["TEXTURE"+a]);b.bindTexture(this.target,this.texture);return!0}return!1}}unbind(a){if(this.allocated&&this.texture){const b=this.gl;b.activeTexture(b["TEXTURE"+a]);b.bindTexture(this.target,null)}}destroy(){this.allocated&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)}}class Ob extends Z{get type(){return"xeogl.CubeTexture"}init(a){super.init(a);const b=this.scene.canvas.gl;this._state=new da({texture:new Nb(b,
b.TEXTURE_CUBE_MAP),flipY:this._checkFlipY(a.minFilter),encoding:this._checkEncoding(a.encoding),minFilter:"linearMipmapLinear",magFilter:"linear",wrapS:"clampToEdge",wrapT:"clampToEdge",mipmaps:!0});this._src=a.src;this._images=[];this._loadSrc(a.src);P.memory.textures++}_checkFlipY(a){return!!a}_checkEncoding(a){a=a||"linear";"linear"!==a&&"sRGB"!==a&&"gamma"!==a&&(this.error("Unsupported value for 'encoding': '"+a+"' - supported values are 'linear', 'sRGB', 'gamma'. Defaulting to 'linear'."),a=
"linear");return a}_webglContextRestored(){this._state.texture=null;this._src&&this._loadSrc(this._src)}_loadSrc(a){const b=this,c=this.scene.canvas.gl;this._images=[];let d=!1,f=0;for(let e=0;e<a.length;e++){const g=new Image;g.onload=function(){let h=g;const m=e;return function(){if(!d){var n=h;if(!Cc(n.width)||!Cc(n.height)){const p=document.createElement("canvas");p.width=Dc(n.width);p.height=Dc(n.height);p.getContext("2d").drawImage(n,0,0,n.width,n.height,0,0,p.width,p.height);n=p}h=n;b._images[m]=
h;f++;6===f&&(n=b._state.texture,n||(n=new Nb(c,c.TEXTURE_CUBE_MAP),b._state.texture=n),n.setImage(b._images,b._state),n.setProps(b._state),b.fire("loaded",b._src))}}}();g.onerror=function(){d=!0};g.src=a[e]}}destroy(){super.destroy();this._state.texture&&this._state.texture.destroy();P.memory.textures--;this._state.destroy()}}M["xeogl.CubeTexture"]=Ob;class Ad extends Ob{get type(){return"xeogl.LightMap"}init(a){super.init(a);this.scene._lightMapCreated(this)}destroy(){super.destroy();this.scene._lightMapDestroyed(this)}}
M["xeogl.LightMap"]=Ad;class Bd extends Ob{get type(){return"xeogl.ReflectionMap"}init(a){super.init(a);this.scene._lightsState.addReflectionMap(this._state);this.scene._reflectionMapCreated(this)}destroy(){super.destroy();this.scene._reflectionMapDestroyed(this)}}M["xeogl.ReflectionMap"]=Bd;class Cd extends Z{get type(){return"xeogl.Shadow"}init(a){super.init(a);this._state={resolution:l.vec3([1E3,1E3]),intensity:1};this.resolution=a.resolution;this.intensity=a.intensity}set resolution(a){this._state.resolution.set(a||
[1E3,1E3]);this._renderer.imageDirty();this.fire("resolution",this._state.resolution)}get resolution(){return this._state.resolution}set intensity(a){this._state.intensity=void 0!==a?a:1;this._renderer.imageDirty();this.fire("intensity",this._state.intensity)}get intensity(){return this._state.intensity}destroy(){super.destroy()}}M["xeogl.Shadow"]=Cd;class xc extends rb{get type(){return"xeogl.Group"}init(a){super.init(a)}}M["xeogl.Group"]=xc;class Dd extends xc{get type(){return"xeogl.Model"}init(a){this.components=
{};this.numComponents=0;this.types={};this.objects={};this.guidObjects={};this.meshes={};this.entities={};this.entityTypes={};this._entityIds=this._objectGUIDs=null;super.init(a);this.scene._modelCreated(this)}_addComponent(a){if(G.isNumeric(a)||G.isString(a)){if(a=this.scene.components[a],!a){this.warn("Component not found: "+G.inQuotes(a));return}}else if(G.isObject(a)){var b=a.type||"xeogl.Component";if(!ba.isComponentType(b)){this.error("Not a xeogl component type: "+b);return}a=new window[b](this.scene,
a)}if(a.scene!==this.scene)this.error("Attempted to add component from different xeogl.Scene: "+G.inQuotes(a.id));else if(!this.components[a.id]){a.model&&a.model.id!==this.id&&a.model._removeComponent(a);this.components[a.id]=a;(b=this.types[a.type])||(b=this.types[a.type]={});b[a.id]=a;if(a.isType("xeogl.Object")){b=a;this.objects[b.id]=b;if(b.entityType){this.entities[b.id]=b;let c=this.entityTypes[b.entityType];c||(c={},this.entityTypes[b.entityType]=c);c[b.id]=b;this._entityTypeIds=this._entityIds=
null}b.guid&&(this.guidObjects[b.id]=b,this._objectGUIDs=null);a.isType("xeogl.Mesh")&&(this.meshes[a.id]=a)}this.numComponents++;a._addedToModel(this);return a}}_removeComponent(a){const b=a.id;delete this.components[b];delete this.meshes[b];delete this.objects[b];if(a.entityType){delete this.entities[b];const c=this.entityTypes[a.entityType];c&&delete c[b];this._entityTypeIds=this._entityIds=null}a.guid&&(delete this.guidObjects[a.guid],this._objectGUIDs=null)}clear(){for(var a in this.meshes)this.meshes.hasOwnProperty(a)&&
this.meshes[a].destroy();for(a in this.components)this.components.hasOwnProperty(a)&&this.components[a].destroy();this.components={};this.numComponents=0;this.types={};this.objects={};this.meshes={};this.entities={}}get objectGUIDs(){this._objectGUIDs||(this._objectGUIDs=Object.keys(this.guidObjects));return this._objectGUIDs}get entityTypeIds(){this._entityTypeIds||(this._entityTypeIds=Object.keys(this.entityTypes));return this._entityTypeIds}get entityIds(){this._entityIds||(this._entityIds=Object.keys(this.entities));
return this._entityIds}destroyAll(){this.clear()}destroy(){super.destroy();this.clear();this.scene._modelDestroyed(this)}}M["xeogl.Model"]=Dd;class Ed extends va{get type(){return"xeogl.LambertMaterial"}init(a){super.init(a);this._state=new da({type:"LambertMaterial",ambient:l.vec3([1,1,1]),color:l.vec3([1,1,1]),emissive:l.vec3([0,0,0]),alpha:null,alphaMode:0,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:"/lam;"});this.ambient=a.ambient;this.color=a.color;this.emissive=a.emissive;
this.alpha=a.alpha;this.lineWidth=a.lineWidth;this.pointSize=a.pointSize;this.backfaces=a.backfaces;this.frontface=a.frontface}set ambient(a){let b=this._state.ambient;if(!b)b=this._state.ambient=new Float32Array(3);else if(a&&b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2])return;a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):(b[0]=.2,b[1]=.2,b[2]=.2);this._renderer.imageDirty()}get ambient(){return this._state.ambient}set color(a){let b=this._state.color;if(!b)b=this._state.color=new Float32Array(3);else if(a&&b[0]===
a[0]&&b[1]===a[1]&&b[2]===a[2])return;a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):(b[0]=1,b[1]=1,b[2]=1);this._renderer.imageDirty()}get color(){return this._state.color}set emissive(a){let b=this._state.emissive;if(!b)b=this._state.emissive=new Float32Array(3);else if(a&&b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2])return;a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):(b[0]=0,b[1]=0,b[2]=0);this._renderer.imageDirty()}get emissive(){return this._state.emissive}set alpha(a){a=void 0!==a&&null!==a?a:1;this._state.alpha!==a&&(this._state.alpha=
a,this._state.alphaMode=1>a?2:0,this._renderer.imageDirty())}get alpha(){return this._state.alpha}set lineWidth(a){this._state.lineWidth=a||1;this._renderer.imageDirty()}get lineWidth(){return this._state.lineWidth}set pointSize(a){this._state.pointSize=a||1;this._renderer.imageDirty()}get pointSize(){return this._state.pointSize}set backfaces(a){a=!!a;this._state.backfaces!==a&&(this._state.backfaces=a,this._renderer.imageDirty())}get backfaces(){return this._state.backfaces}set frontface(a){a="cw"!==
a;this._state.frontface!==a&&(this._state.frontface=a,this._renderer.imageDirty())}get frontface(){return this._state.frontface?"ccw":"cw"}_getState(){return this._state}destroy(){super.destroy();this._state.destroy()}}M["xeogl.LambertMaterial"]=Ed;const ue={opaque:0,mask:1,blend:2},ve=["opaque","mask","blend"];class Fd extends va{get type(){return"xeogl.SpecularMaterial"}init(a){super.init(a);this._state=new da({type:"SpecularMaterial",diffuse:l.vec3([1,1,1]),emissive:l.vec3([0,0,0]),specular:l.vec3([1,
1,1]),glossiness:null,specularF0:null,alpha:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null});this.diffuse=a.diffuse;this.specular=a.specular;this.glossiness=a.glossiness;this.specularF0=a.specularF0;this.emissive=a.emissive;this.alpha=a.alpha;a.diffuseMap&&(this._diffuseMap=this._checkComponent("xeogl.Texture",a.diffuseMap));a.emissiveMap&&(this._emissiveMap=this._checkComponent("xeogl.Texture",a.emissiveMap));a.specularMap&&(this._specularMap=
this._checkComponent("xeogl.Texture",a.specularMap));a.glossinessMap&&(this._glossinessMap=this._checkComponent("xeogl.Texture",a.glossinessMap));a.specularGlossinessMap&&(this._specularGlossinessMap=this._checkComponent("xeogl.Texture",a.specularGlossinessMap));a.occlusionMap&&(this._occlusionMap=this._checkComponent("xeogl.Texture",a.occlusionMap));a.alphaMap&&(this._alphaMap=this._checkComponent("xeogl.Texture",a.alphaMap));a.normalMap&&(this._normalMap=this._checkComponent("xeogl.Texture",a.normalMap));
this.alphaMode=a.alphaMode;this.alphaCutoff=a.alphaCutoff;this.backfaces=a.backfaces;this.frontface=a.frontface;this.lineWidth=a.lineWidth;this.pointSize=a.pointSize;this._makeHash()}_makeHash(){const a=this._state,b=["/spe"];this._diffuseMap&&(b.push("/dm"),this._diffuseMap.hasMatrix&&b.push("/mat"),b.push("/"+this._diffuseMap.encoding));this._emissiveMap&&(b.push("/em"),this._emissiveMap.hasMatrix&&b.push("/mat"));this._glossinessMap&&(b.push("/gm"),this._glossinessMap.hasMatrix&&b.push("/mat"));
this._specularMap&&(b.push("/sm"),this._specularMap.hasMatrix&&b.push("/mat"));this._specularGlossinessMap&&(b.push("/sgm"),this._specularGlossinessMap.hasMatrix&&b.push("/mat"));this._occlusionMap&&(b.push("/ocm"),this._occlusionMap.hasMatrix&&b.push("/mat"));this._normalMap&&(b.push("/nm"),this._normalMap.hasMatrix&&b.push("/mat"));this._alphaMap&&(b.push("/opm"),this._alphaMap.hasMatrix&&b.push("/mat"));b.push(";");a.hash=b.join("")}set diffuse(a){let b=this._state.diffuse;if(!b)b=this._state.diffuse=
new Float32Array(3);else if(a&&b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2])return;a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):(b[0]=1,b[1]=1,b[2]=1);this._renderer.imageDirty()}get diffuse(){return this._state.diffuse}get diffuseMap(){return this._diffuseMap}set specular(a){let b=this._state.specular;if(!b)b=this._state.specular=new Float32Array(3);else if(a&&b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2])return;a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):(b[0]=1,b[1]=1,b[2]=1);this._renderer.imageDirty()}get specular(){return this._state.specular}get specularMap(){return this._specularMap}get specularGlossinessMap(){return this._specularGlossinessMap}set glossiness(a){a=
void 0!==a&&null!==a?a:1;this._state.glossiness!==a&&(this._state.glossiness=a,this._renderer.imageDirty())}get glossiness(){return this._state.glossiness}get glossinessMap(){return this._glossinessMap}set specularF0(a){a=void 0!==a&&null!==a?a:0;this._state.specularF0!==a&&(this._state.specularF0=a,this._renderer.imageDirty())}get specularF0(){return this._state.specularF0}set emissive(a){let b=this._state.emissive;if(!b)b=this._state.emissive=new Float32Array(3);else if(a&&b[0]===a[0]&&b[1]===a[1]&&
b[2]===a[2])return;a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):(b[0]=0,b[1]=0,b[2]=0);this._renderer.imageDirty()}get emissive(){return this._state.emissive}get emissiveMap(){return this._emissiveMap}set alpha(a){a=void 0!==a&&null!==a?a:1;this._state.alpha!==a&&(this._state.alpha=a,this._renderer.imageDirty())}get alpha(){return this._state.alpha}get alphaMap(){return this._alphaMap}get normalMap(){return this._normalMap}get occlusionMap(){return this._occlusionMap}set alphaMode(a){a=a||"opaque";let b=ue[a];
void 0===b&&(this.error("Unsupported value for 'alphaMode': "+a+" defaulting to 'opaque'"),b="opaque");this._state.alphaMode!==b&&(this._state.alphaMode=b,this._renderer.imageDirty())}get alphaMode(){return ve[this._state.alphaMode]}set alphaCutoff(a){if(null===a||void 0===a)a=.5;this._state.alphaCutoff!==a&&(this._state.alphaCutoff=a)}get alphaCutoff(){return this._state.alphaCutoff}set backfaces(a){a=!!a;this._state.backfaces!==a&&(this._state.backfaces=a,this._renderer.imageDirty())}get backfaces(){return this._state.backfaces}set frontface(a){a=
"cw"!==a;this._state.frontface!==a&&(this._state.frontface=a,this._renderer.imageDirty())}get frontface(){return this._state.frontface?"ccw":"cw"}set lineWidth(a){this._state.lineWidth=a||1;this._renderer.imageDirty()}get lineWidth(){return this._state.lineWidth}set pointSize(a){this._state.pointSize=a||1;this._renderer.imageDirty()}get pointSize(){return this._state.pointSize}destroy(){super.destroy();this._state.destroy()}}M["xeogl.SpecularMaterial"]=Fd;const we={opaque:0,mask:1,blend:2},xe=["opaque",
"mask","blend"];class Gd extends va{get type(){return"xeogl.MetallicMaterial"}init(a){super.init(a);this._state=new da({type:"MetallicMaterial",baseColor:l.vec4([1,1,1]),emissive:l.vec4([0,0,0]),metallic:null,roughness:null,specularF0:null,alpha:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null});this.baseColor=a.baseColor;this.metallic=a.metallic;this.roughness=a.roughness;this.specularF0=a.specularF0;this.emissive=a.emissive;this.alpha=a.alpha;
a.baseColorMap&&(this._baseColorMap=this._checkComponent("xeogl.Texture",a.baseColorMap));a.metallicMap&&(this._metallicMap=this._checkComponent("xeogl.Texture",a.metallicMap));a.roughnessMap&&(this._roughnessMap=this._checkComponent("xeogl.Texture",a.roughnessMap));a.metallicRoughnessMap&&(this._metallicRoughnessMap=this._checkComponent("xeogl.Texture",a.metallicRoughnessMap));a.emissiveMap&&(this._emissiveMap=this._checkComponent("xeogl.Texture",a.emissiveMap));a.occlusionMap&&(this._occlusionMap=
this._checkComponent("xeogl.Texture",a.occlusionMap));a.alphaMap&&(this._alphaMap=this._checkComponent("xeogl.Texture",a.alphaMap));a.normalMap&&(this._normalMap=this._checkComponent("xeogl.Texture",a.normalMap));this.alphaMode=a.alphaMode;this.alphaCutoff=a.alphaCutoff;this.backfaces=a.backfaces;this.frontface=a.frontface;this.lineWidth=a.lineWidth;this.pointSize=a.pointSize;this._makeHash()}_makeHash(){const a=this._state,b=["/met"];this._baseColorMap&&(b.push("/bm"),this._baseColorMap._state.hasMatrix&&
b.push("/mat"),b.push("/"+this._baseColorMap._state.encoding));this._metallicMap&&(b.push("/mm"),this._metallicMap._state.hasMatrix&&b.push("/mat"));this._roughnessMap&&(b.push("/rm"),this._roughnessMap._state.hasMatrix&&b.push("/mat"));this._metallicRoughnessMap&&(b.push("/mrm"),this._metallicRoughnessMap._state.hasMatrix&&b.push("/mat"));this._emissiveMap&&(b.push("/em"),this._emissiveMap._state.hasMatrix&&b.push("/mat"));this._occlusionMap&&(b.push("/ocm"),this._occlusionMap._state.hasMatrix&&
b.push("/mat"));this._alphaMap&&(b.push("/am"),this._alphaMap._state.hasMatrix&&b.push("/mat"));this._normalMap&&(b.push("/nm"),this._normalMap._state.hasMatrix&&b.push("/mat"));b.push(";");a.hash=b.join("")}set baseColor(a){let b=this._state.baseColor;if(!b)b=this._state.baseColor=new Float32Array(3);else if(a&&b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2])return;a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):(b[0]=1,b[1]=1,b[2]=1);this._renderer.imageDirty()}get baseColor(){return this._state.baseColor}get baseColorMap(){return this._baseColorMap}set metallic(a){a=
void 0!==a&&null!==a?a:1;this._state.metallic!==a&&(this._state.metallic=a,this._renderer.imageDirty())}get metallic(){return this._state.metallic}get metallicMap(){return this._attached.metallicMap}set roughness(a){a=void 0!==a&&null!==a?a:1;this._state.roughness!==a&&(this._state.roughness=a,this._renderer.imageDirty())}get roughness(){return this._state.roughness}get roughnessMap(){return this._attached.roughnessMap}get metallicRoughnessMap(){return this._attached.metallicRoughnessMap}set specularF0(a){a=
void 0!==a&&null!==a?a:0;this._state.specularF0!==a&&(this._state.specularF0=a,this._renderer.imageDirty())}get specularF0(){return this._state.specularF0}set emissive(a){let b=this._state.emissive;if(!b)b=this._state.emissive=new Float32Array(3);else if(a&&b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2])return;a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):(b[0]=0,b[1]=0,b[2]=0);this._renderer.imageDirty()}get emissive(){return this._state.emissive}get emissiveMap(){return this._attached.emissiveMap}get occlusionMap(){return this._attached.occlusionMap}set alpha(a){a=
void 0!==a&&null!==a?a:1;this._state.alpha!==a&&(this._state.alpha=a,this._renderer.imageDirty())}get alpha(){return this._state.alpha}get alphaMap(){return this._attached.alphaMap}get normalMap(){return this._attached.normalMap}set alphaMode(a){a=a||"opaque";let b=we[a];void 0===b&&(this.error("Unsupported value for 'alphaMode': "+a+" defaulting to 'opaque'"),b="opaque");this._state.alphaMode!==b&&(this._state.alphaMode=b,this._renderer.imageDirty())}get alphaMode(){return xe[this._state.alphaMode]}set alphaCutoff(a){if(null===
a||void 0===a)a=.5;this._state.alphaCutoff!==a&&(this._state.alphaCutoff=a)}get alphaCutoff(){return this._state.alphaCutoff}set backfaces(a){a=!!a;this._state.backfaces!==a&&(this._state.backfaces=a,this._renderer.imageDirty())}get backfaces(){return this._state.backfaces}set frontface(a){a="cw"!==a;this._state.frontface!==a&&(this._state.frontface=a,this._renderer.imageDirty())}get frontface(){return this._state.frontface?"ccw":"cw"}set lineWidth(a){this._state.lineWidth=a||1;this._renderer.imageDirty()}get lineWidth(){return this._state.lineWidth}set pointSize(a){this._state.pointSize=
a||1;this._renderer.imageDirty()}get pointSize(){return this._state.pointSize}destroy(){super.destroy();this._state.destroy()}}M["xeogl.MetallicMaterial"]=Gd;class Hd extends Z{get type(){return"xeogl.Texture"}init(a){super.init(a);this._state=new da({texture:new Nb(this.scene.canvas.gl),matrix:l.identityMat4(),hasMatrix:a.translate&&(0!==a.translate[0]||0!==a.translate[1])||!!a.rotate||a.scale&&(0!==a.scale[0]||0!==a.scale[1]),minFilter:this._checkMinFilter(a.minFilter),magFilter:this._checkMagFilter(a.magFilter),
wrapS:this._checkWrapS(a.wrapS),wrapT:this._checkWrapT(a.wrapT),flipY:this._checkFlipY(a.flipY),encoding:this._checkEncoding(a.encoding)});this._image=this._src=null;this._translate=l.vec2([0,0]);this._scale=l.vec2([1,1]);this._rotate=l.vec2([0,0]);this._matrixDirty=!1;this.translate=a.translate;this.scale=a.scale;this.rotate=a.rotate;a.src?this.src=a.src:a.image&&(this.image=a.image);P.memory.textures++}_checkMinFilter(a){a=a||"linearMipmapLinear";"linear"!==a&&"linearMipmapNearest"!==a&&"linearMipmapLinear"!==
a&&"nearestMipmapLinear"!==a&&"nearestMipmapNearest"!==a&&(this.error("Unsupported value for 'minFilter': '"+a+"' - supported values are 'linear', 'linearMipmapNearest', 'nearestMipmapNearest', 'nearestMipmapLinear' and 'linearMipmapLinear'. Defaulting to 'linearMipmapLinear'."),a="linearMipmapLinear");return a}_checkMagFilter(a){a=a||"linear";"linear"!==a&&"nearest"!==a&&(this.error("Unsupported value for 'magFilter': '"+a+"' - supported values are 'linear' and 'nearest'. Defaulting to 'linear'."),
a="linear");return a}_checkFilter(a){a=a||"linear";"linear"!==a&&"nearest"!==a&&(this.error("Unsupported value for 'magFilter': '"+a+"' - supported values are 'linear' and 'nearest'. Defaulting to 'linear'."),a="linear");return a}_checkWrapS(a){a=a||"repeat";"clampToEdge"!==a&&"mirroredRepeat"!==a&&"repeat"!==a&&(this.error("Unsupported value for 'wrapS': '"+a+"' - supported values are 'clampToEdge', 'mirroredRepeat' and 'repeat'. Defaulting to 'repeat'."),a="repeat");return a}_checkWrapT(a){a=a||
"repeat";"clampToEdge"!==a&&"mirroredRepeat"!==a&&"repeat"!==a&&(this.error("Unsupported value for 'wrapT': '"+a+"' - supported values are 'clampToEdge', 'mirroredRepeat' and 'repeat'. Defaulting to 'repeat'."),a="repeat");return a}_checkFlipY(a){return!!a}_checkEncoding(a){a=a||"linear";"linear"!==a&&"sRGB"!==a&&"gamma"!==a&&(this.error("Unsupported value for 'encoding': '"+a+"' - supported values are 'linear', 'sRGB', 'gamma'. Defaulting to 'linear'."),a="linear");return a}_webglContextRestored(){this._state.texture=
new Nb(this.scene.canvas.gl);this._image?this.image=this._image:this._src&&(this.src=this._src)}_update(){const a=this._state;if(this._matrixDirty){let b,c;if(0!==this._translate[0]||0!==this._translate[1])b=l.translationMat4v([this._translate[0],this._translate[1],0],this._state.matrix);if(1!==this._scale[0]||1!==this._scale[1])c=l.scalingMat4v([this._scale[0],this._scale[1],1]),b=b?l.mulMat4(b,c):c;0!==this._rotate&&(c=l.rotationMat4v(.0174532925*this._rotate,[0,0,1]),b=b?l.mulMat4(b,c):c);b&&(a.matrix=
b);this._matrixDirty=!1}this._renderer.imageDirty()}set image(a){this._image=Ec(a);this._image.crossOrigin="Anonymous";this._state.texture.setImage(this._image,this._state);this._state.texture.setProps(this._state);this._src=null;this._renderer.imageDirty()}get image(){return this._image}set src(a){this.scene.loading++;this.scene.canvas.spinner.processes++;const b=this;let c=new Image;c.onload=function(){c=Ec(c);b._state.texture.setImage(c,b._state);b._state.texture.setProps(b._state);b.scene.loading--;
b.scene.canvas.spinner.processes--;b._renderer.imageDirty()};this._src=c.src=a;this._image=null}get src(){return this._src}set translate(a){this._translate.set(a||[0,0]);this._matrixDirty=!0;this._needUpdate()}get translate(){return this._translate}set scale(a){this._scale.set(a||[1,1]);this._matrixDirty=!0;this._needUpdate()}get scale(){return this._scale}set rotate(a){a=a||0;this._rotate!==a&&(this._rotate=a,this._matrixDirty=!0,this._needUpdate())}get rotate(){return this._rotate}get minFilter(){return this._state.minFilter}get magFilter(){return this._state.magFilter}get wrapS(){return this._state.wrapS}get wrapT(){return this._state.wrapT}get flipY(){return this._state.flipY}get encoding(){return this._state.encoding}destroy(){super.destroy();
this._state.texture&&this._state.texture.destroy();this._state.destroy();P.memory.textures--}}M["xeogl.Texture"]=Hd;class Id extends Z{get type(){return"xeogl.Fresnel"}init(a){super.init(a);this._state=new da({edgeColor:l.vec3([0,0,0]),centerColor:l.vec3([1,1,1]),edgeBias:0,centerBias:1,power:1});this.edgeColor=a.edgeColor;this.centerColor=a.centerColor;this.edgeBias=a.edgeBias;this.centerBias=a.centerBias;this.power=a.power}set edgeColor(a){this._state.edgeColor.set(a||[0,0,0]);this._renderer.imageDirty()}get edgeColor(){return this._state.edgeColor}set centerColor(a){this._state.centerColor.set(a||
[1,1,1]);this._renderer.imageDirty()}get centerColor(){return this._state.centerColor}set edgeBias(a){this._state.edgeBias=a||0;this._renderer.imageDirty()}get edgeBias(){return this._state.edgeBias}set centerBias(a){this._state.centerBias=void 0!==a&&null!==a?a:1;this._renderer.imageDirty()}get centerBias(){return this._state.centerBias}set power(a){this._state.power=void 0!==a&&null!==a?a:1;this._renderer.imageDirty()}get power(){return this._state.power}destroy(){super.destroy();this._state.destroy()}}
M["xeogl.Fresnel"]=Id;const ye=ba.getDefaultScene,ze=ba.setDefaultScene,Ae=za.scheduleTask,Be=ba.clear,Ce=G.isString,De=G.apply,Ee=G.isNumeric;I.scenes=ba.scenes;I.getDefaultScene=ye;I.setDefaultScene=ze;I.scheduleTask=Ae;I.clear=Be;I._isString=Ce;I._apply=De;I._isNumeric=Ee;I.WEBGL_INFO=Y;I.stats=P;I.math=l;I.Component=Z;I.CameraFlightAnimation=wc;I.Canvas=Rb;I.Spinner=Ic;I.Clip=qd;I.CameraControl=rd;I.Geometry=ua;I.BoxGeometry=lc;I.TorusGeometry=sd;I.SphereGeometry=td;I.OBBGeometry=ud;I.AABBGeometry=
Xa;I.CylinderGeometry=vd;I.PlaneGeometry=wd;I.Input=dd;I.AmbientLight=xd;I.DirLight=Za;I.PointLight=yd;I.SpotLight=zd;I.CubeTexture=Ob;I.LightMap=Ad;I.ReflectionMap=Bd;I.Shadow=Cd;I.Model=Dd;I.Mesh=Pa;I.Group=xc;I.Object=rb;I.Material=va;I.PhongMaterial=Oa;I.LambertMaterial=Ed;I.SpecularMaterial=Fd;I.MetallicMaterial=Gd;I.EmphasisMaterial=$a;I.EdgeMaterial=oc;I.OutlineMaterial=pc;I.Texture=Hd;I.Fresnel=Id;I.Viewport=dc;I.Camera=kc;I.Frustum=gc;I.Ortho=fc;I.Perspective=ec;I.CustomProjection=hc;I.Scene=
rc;Object.defineProperty(I,"__esModule",{value:!0})});
